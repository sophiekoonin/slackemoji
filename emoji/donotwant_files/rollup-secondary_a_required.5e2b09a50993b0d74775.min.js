(window.webpackJsonp=window.webpackJsonp||[]).push([["rollup-secondary_a_required","TS.enterprise","TS.utility"],{"+J8v":function(e,t){!function(){var e,t;TS.registerModule("ui.react_file_menu",{onStart:function(){e=s(r)},showFileMenu:function(n,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=r.model_ob_id,o=r.thread_ts;t=$(n&&n.target);var l=s;l||(l=TS.model.active_channel_id);var d={channelId:l,ts:o,onMenuItemSelected:TS.ui.react_file_menu.closeFileMenu},c=a();t.closest("#primary_file_button").addClass("active"),TS.tips.hideAll(),TS.interop.mountNewFileMenu(TS.interop.selfTeamIds.getTeamId(TS.redux.getState()),e,d,c)},closeFileMenu:function(){t&&(t.closest("#primary_file_button").removeClass("active"),t=null),TS.tips.unhideAll(),TS.interop.mountNewFileMenu(TS.interop.selfTeamIds.getTeamId(TS.redux.getState()),e,{},{isOpen:!1})}});var n=0,i=-6,r="reactroot_new_file_menu",a=function(){return{targetBounds:t?t.dimensions_rect():{},position:"top-left",allowanceX:46,allowanceY:15,offsetX:n,offsetY:i,isOpen:!0,onClose:TS.ui.react_file_menu.closeFileMenu}},s=function(){if(!document.getElementById(r)){var e=document.createElement("div");e.setAttribute("id",r),document.body.appendChild(e)}return document.getElementById(r)}}()},"/q0e":function(e,t,n){var i=n("lSNA");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(){TS.registerModule("redux.messages",{addMessages:function(e,t,n){var i=_.some(e,(function(e){return!TS.redux.messages.getMessageByTimestamp(e.channel,e.ts)}));if(TS.interop.messages.addMessages(e),t){var r=e&&e[0]&&e[0].channel,a=_.map(e,"ts");TS.interop.messages.markObjectsAsFresh(TS.model.team.id,r,a);var s={};n&&(s={oldest:_.min(a),hasMore:!1}),TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(_.assign({channelId:r,timestamps:a},s)))}return i},addMessage:function(t,n,i){if(t&&t.channel&&t.ts){var r,s=TS.redux.messages.getMessageByTimestamp(t.channel,t.ts);if(TS.boot_data.feature_add_message_perf&&(r=window.performance&&window.performance.now()),TS.interop.messages.addMessages([t]),TS.boot_data.feature_add_message_perf){var o=window.performance&&window.performance.now();o-r>200&&(e%10==0&&TS.interop.utility.getLogger({getState:TS.redux.getState}).error({duration:o-r,channel:t.channel,user:t.user,bot:t.bot_id,counter:e,channel_num_messages:_.size(TS.redux.getState().messages[t.channel])},"TS.redux.messages.addMessage took over 200ms",{subtype:"addMessage_perf"}),e+=1)}var l=t.channel,d=t.ts,c=t.thread_ts,u={channelId:l,timestamps:[d],fromEvtLog:!!i};return n&&(u.oldest=d,u.hasMore=!1,u.append=!0),TS.interop.messages.markObjectsAsFresh(TS.model.team.id,l,[d]),TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(u)),TS.interop.messages.isReply(t)&&TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(a(a({},u),{},{channelId:TS.interop.threads.getThreadKey(l,c)}))),!s}},replaceMessage:function(e,t){if(e&&e.channel&&e.ts){TS.redux.messages.addMessage(e,!1,t)}},removeMessage:function(e,t){e&&e.channel&&e.ts&&TS.redux.dispatch(TS.interop.redux.actions.maybeAnimateDeleteMessage({channelId:e.channel,ts:e.ts,threadTs:e.thread_ts,fromEvtLog:t}))},channelHistoryChanged:function(e){TS.redux.dispatch(TS.interop.redux.models.channelHistory.removeAllTimestamps({channelId:e}))},getMessageByTimestamp:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return TS.interop.messages.getMessageByTimestamp?TS.interop.messages.getMessageByTimestamp(e,t,n):null},getMessagesInChannel:function(e,t,n){if(!e)return[];void 0===n&&(n=!0);var i=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(TS.redux.getState(),e,t),r=TS.interop.messages.getMessagesByChannelId(e),a=i&&i.timestamps||[],s=_(a).map((function(e){return r[e]})).compact().value();s=TS.interop.messages.computeRollups(s).messages;var o=_(s).reject(TS.interop.rules.messages.isHidden).sortBy("ts");return n?o.reverse().value():o.value()},getRecentMessagesInChannel:function(e,t){return TS.redux.messages.getMessagesInChannel(e,null,t)},getRecentMessagesInThread:function(e,t,n){if(!e||!t)return[];var i=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(TS.redux.getState(),TS.interop.rules.threads.getThreadKey(e,t),null);if(!i)return[];var r=_.map(i.timestamps,(function(t){return TS.redux.messages.getMessageByTimestamp(e,t)}));return n?_.reverse(r):r},getLastMessageInChannel:function(e){if(!e)return null;var t=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(TS.redux.getState(),e),n=t&&t.timestamps||[],i=_.last(n);return i?TS.redux.messages.getMessageByTimestamp(e,i):null},getExpandablesInChannel:function(e){var t=TS.redux.messages.getMessagesInChannel(e,null,!1);return _(t).map((function(e){var t=e.ts;return e.file?TS.interop.messages.getExpandableKey("file",t,{id:e.file}):e.files?TS.interop.messages.getExpandableKey("files",t,{fileIds:e.files}):"sh_room_shared"===e.subtype||"sh_room_created"===e.subtype?TS.interop.messages.getExpandableKey("call",t,{id:e._call_id}):e.attachments?_.map(e.attachments,(function(e){return TS.interop.messages.getExpandableKey("attachment",t,{id:e.id,imageUrl:e.image_url,audioHtml:e.audio_html,videoHtml:e.video_html,thumbUrl:e.thumb_url})})):null})).flatten().compact().value()},getMessagesByProp:function(e,t){var n=TS.interop.messages.getMessagesByProps(e,t);return _(n).sortBy("ts").reverse().value()},getMessagesByChannelId:function(e,t){void 0===t&&(t=!0);var n=TS.interop.messages.getMessagesByChannelId(e);return t?_(n).sortBy("ts").reverse().value():_(n).sortBy("ts").value()},recordDeletedMessage:function(e,t){TS.redux.dispatch(TS.interop.redux.features.deletedMessages.recordMessageDeleted({channelId:e,ts:t}))},wasMessageDeleted:function(e,t){var n=TS.redux.getState();return TS.interop.redux.features.deletedMessages.wasMessageDeleted(n,{channelId:e,ts:t})}});var e=0}()},"/xdr":function(e,t){TS.registerModule("redux.prefs",{setUserPrefs:function(e){TS.interop.prefs.setUserPrefs(e)},setTeamPrefs:function(e){TS.interop.prefs.setTeamPrefs(e)},setEnterprisePrefs:function(e){TS.interop.prefs.setEnterprisePrefs({prefs:e})},setUserPref:function(e,t){TS.redux.prefs.getUserPref(e)!==t&&TS.interop.prefs.setUserPref({pref:e,value:t})},setMultipleUserPrefs:function(e){TS.interop.prefs.setMultipleUserPrefs(e)},setTeamPref:function(e,t){TS.redux.prefs.getTeamPref(e)!==t&&TS.interop.prefs.setTeamPref({pref:e,value:t})},setChannelNotificationOverrideAndCallApi:function(e,t,n){TS.interop.prefs.setChannelNotificationOverrideAndCallApi({name:e,value:t,channelId:n})},getUserPref:function(e){return TS.interop.prefs.getUserPref(e)},getTeamPref:function(e){return TS.interop.prefs.getTeamPref(e)},test:function(){return{}}})},"16zC":function(e,t){!function(){TS.registerModule("tabcomplete",{positionUIRelativeToInput:function(e,t,n){if(e&&t){var i,r=$(t).offset();if(e.style.left=r.left+"px",n){var a=r.top+$(t).height()+2;e.style.top=a+"px",i=$(window).height()-a}else e.style.bottom=$(window).height()-r.top+"px",i=r.top;var s=_.clamp(i-$(e).find(".tab_complete_ui_header").outerHeight()-2,454);$(e).find(".tab_complete_ui_scroller").css("maxHeight",s+"px")}},render:function(e,t,n,i){switch(e){case"members":return TS.tabcomplete.members.render(t,n,i);case"commands":return TS.tabcomplete.commands.render(t,n,i);case"emoji":return TS.tabcomplete.emoji.render(t,n,i);case"channels":return TS.tabcomplete.channels.render(t,n,i);default:TS.warn('TS.tabcomplete: unknown render type "'+e+'"')}},renderMenu:function(e,t){return TS.templates.tabcomplete_menu({safe_header_html:new Handlebars.SafeString(e),safe_results_html:new Handlebars.SafeString(t)})},onSelectedIndexChange:function(e){var t=$(".tab_complete_ui_item");t.removeClass("active"),t.removeAttr("aria-selected"),t.eq(e).addClass("active").attr("aria-selected","true"),t.eq(e).scrollintoview({duration:0})},trimTrailingCharacterModifier:function(t){return t?t.replace(e,""):""}});var e=/[`\xb4\u02c6\xa8\u02dc]$/}()},"2h3S":function(e,t){!function(){TS.registerModule("inline_others",{no_scrolling:!1,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function(){},shouldExpand:function(e,t){return!!TS.model.expandable_state["vid_"+e+t.src]||!1!==TS.model.expandable_state["vid_"+e+t.src]&&(t.internal_file_id?TS.prefs.getPref("expand_internal_inline_imgs"):TS.prefs.getPref("expand_inline_imgs"))},expandAllInCurrent:function(){var e=$(".msg_inline_media_toggler[data-media-type=other]:not(.expanded)");e.length&&(TS.inline_others.no_scrolling=!0,e.trigger("click"),TS.inline_others.no_scrolling=!1)},collapseAllInCurrent:function(){$(".msg_inline_media_toggler[data-media-type=other].expanded").trigger("click")},expand:function(e,t){TS.model.expandable_state["vid_"+e+t]=!0,TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(e),i=$(n);if(i.length){var r=function(){return $(this).data("real-src")==t},a=TS.boot_data.feature_attachments_inline?i.find(".inline_attachment").filter(r):null;a&&a.length||(a=i.find(".msg_inline_other_holder").filter(r)),a.removeClass("hidden"),i.find(".msg_inline_media_toggler[data-media-type=other]:not(.expanded)").filter(r).addClass("expanded"),a.css("opacity",0).stop().animate({opacity:1},300),TS.inline_others.no_scrolling||i.find(".msg_inline_other").last().scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"}),TS.inline_others.expand_sig.dispatch(e)}},collapse:function(e,t){TS.model.expandable_state["vid_"+e+t]=!1,TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(e),i=$(n);if(i.length){var r=function(){return $(this).data("real-src")==t},a=TS.boot_data.feature_attachments_inline?i.find(".inline_attachment").filter(r):null;a&&a.length||(a=i.find(".msg_inline_other_holder").filter(r)),a.css("visibility","hidden"),i.find(".msg_inline_media_toggler[data-media-type=other].expanded").filter(r).removeClass("expanded"),a.find(".msg_inline_other_iframe_div").html(""),TS.inline_others.collapse_sig.dispatch(e),setTimeout((function(){a.addClass("hidden"),a.css("visibility","visible")}),200)}},checkForInlineOtherClick:function(e){if(e.target){var t,n=$(e.target);if(t=n.closest(".message").attr("id")){var i=n.closest(".msg_inline_media_toggler[data-media-type=other]");if(i.length){e.preventDefault();var r=i.data("real-src");i.hasClass("expanded")?TS.inline_others.collapse(t,r):TS.inline_others.expand(t,r)}}}},makeInternalInlineOther:function(t){var n;if(t.other_html_width>400&&(t.other_html_height=parseInt(t.other_html_height*(400/t.other_html_width),10),t.other_html_width=400),t.other_html_height>500&&(t.other_html_width=parseInt(t.other_html_width*(500/t.other_html_height),10),t.other_html_height=500),t.google_map_config&&(n=TS.utility.parseJSONOrElse(t.google_map_config,void 0)),n&&n.center&&"string"!=typeof n.center.lat){n.scrollwheel=!1;var i="googmap_"+(e+=1);t.other_html='<div class="google-maps" id="'+i+'" style="width:100%; min-width:'+_.escape(t.other_html_width)+"px; height:"+_.escape(t.other_html_height)+'px;"></div>\t\t\t<script>TS.inline_others.runGoogleMapCode("'+i+"\", '"+JSON.stringify(n)+"')<\/script>",t.safe_other_html=t.other_html}else-1==t.other_html.indexOf("oldwidth")&&(t.other_html=t.other_html.replace(" width=",' width="'+t.other_html_width+'" oldwidth='),t.other_html=t.other_html.replace(" height=",' height="'+t.other_html_height+'" oldheight=')),t.safe_other_html=t.other_html,t.safe_other_html=TS.utility.swapInRedirUrlForIframe(t.safe_other_html),t.safe_audio_html=TS.utility.setCssFromHeightAndWidthAttrs(t.safe_audio_html);TS.model.inline_others[t.other_html]={src:_.escape(t.other_html),attachment:t}},runGoogleMapCode:function(e,t){if(window.google&&t){var n=JSON.parse(t),i=new google.maps.Map(document.getElementById(e),n);if(n.query){var r=new google.maps.Geocoder,a="number"==typeof n.max_results?n.max_results:10;a<0&&(a=Number.MAX_VALUE);google.maps.event.addListener(i,"bounds_changed",(function(){google.maps.event.clearListeners(i,"bounds_changed");var e=i.getBounds(),t=0,s=function(e){new google.maps.Marker({map:i,position:e.geometry.location}),t+=1};r.geocode({address:n.query,bounds:e},(function(r,o){var l=!1;if(o==google.maps.GeocoderStatus.OK?r.slice(0,a).forEach((function(e){s(e),l=l||!e.partial_match})):TS.warn("Geocoder failed due to: "+o),!l&&t<a){new google.maps.places.PlacesService(i).nearbySearch({bounds:e,name:n.query},(function(e,n){n==google.maps.places.PlacesServiceStatus.OK?e.slice(0,a-t).map(s):TS.warn("PlacesService failed due to: "+n)}))}}))}))}}}});var e=0}()},"2hNN":function(e,t,n){var i=n("cDf5");!function(){TS.registerModule("redux.bots",{onStart:function(){Object.defineProperty(TS.model,"bots",{get:function(){return TS.redux.bots.getAllBots()},set:function(){return TS.boot_data.feature_tinyspeck&&TS.warn("TS.redux.bots: Set TS.model.bots"),!1}})},getBotByMsg:function(e){var n=t(e);return n?a(n):null},getAllBots:function(){return _.values(e())},upsertBot:function(e){e&&TS.redux.dispatch(TS.interop.redux.models.bots.upsertBot(e))},bulkUpsertBots:function(e){_.isArray(e)&&TS.redux.dispatch(TS.interop.redux.models.bots.bulkUpsertBots({bots:e}))},logStats:function(){var e=_(n).keys().union(_.keys(r)).value(),t={};_.forEach(e,(function(e){t[e]={gets:n[e]||0,sets:r[e]||0}})),TS.console.table(t)}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.bots.getAllBots"),t=TS.redux.bindSelectorToStore("TS.interop.redux.models.bots.getBotByMsg"),n={},r={},a=function(e){return!window.Proxy||!TS.boot_data||"dev"!==TS.boot_data.version_ts&&"local_js"!==TS.boot_data.version_ts?e:new window.Proxy(e,{get:function(e,t){return function(e,t){return"symbol"!==i(t)&&(_.isNumber(n[t])||(n[t]=0,r[t]=0),n[t]+=1),e[t]}(e,t)},set:function(e,t,a){return function(e,t,a){return"symbol"!==i(t)&&(_.isNumber(r[t])||(n[t]=0,r[t]=0),r[t]+=1),e[t]=a,!0}(e,t,a)}})}}()},"3D55":function(e,t){!function(){TS.registerModule("ui.messages",{onStart:function(){var t=$("body");t.on("click.msg_action","ts-message",(function(t){e(t)})),t.delegate("ts-message.dirty_hover_container","mouseenter",(function(e){TS.ui.messages.updateMessageHoverContainer($(e.currentTarget))}))},maybeUpdateMessageHoverContainer:function(e){e.length&&(e.is(":visible")?TS.ui.messages.updateMessageHoverContainer(e):e.addClass("dirty_hover_container"))},updateMessageHoverContainer:function(e){e.removeClass("dirty_hover_container");var t=e.data("model-ob-id"),n=t?TS.redux.channels.getEntityById(t):TS.shared.legacyGetActiveModelOb();if(n){var i=e.attr("data-ts"),r=TS.utility.msgs.getMsg(i,n.msgs);if(!r&&n._archive_msgs&&(r=TS.utility.msgs.getMsg(i,n._archive_msgs)),r){var a=e.find("[data-js=action_hover_container]"),s=e.closest("ts-conversation").length>0,o=e.closest("#threads_msgs").length>0,l=s||o,d=!r.thread_ts||r.thread_ts===r.ts,c="tombstone"===r.subtype&&n.is_channel&&!n.is_member,u=!1;if(!r.is_ephemeral&&"tombstone"!==r.subtype){var m,p="message";r.file&&(p="file_comment"===r.subtype?"file_comment":"file"),r.file&&(m=_.isString(r.file)?TS.files.getFileById(r.file):r.file);var f={message:r,file:m,file_comment:r.comment}[p],h="file_comment"===p?m:n,g=TS.templates.builders.buildStarComponents(p,f,h,!0),S=g.is_starred?"starred ts_icon_star":"ts_icon_star_o";u={text:g.is_starred?g.unstar_str:g.star_str,classes:"star_link star_"+p+" "+("file_comment"===p?"star_comment":"")+" "+S,attributes:g.html_attrs,starred:g.is_starred}}a.html(TS.templates.action_hover_items({msg:r,actions:TS.utility.msgs.getMsgActions(r,n),ts_tip_delay_class:"ts_tip_delay_60",is_in_threads_view:o,is_in_thread:l,is_root_msg:d,hide_actions_menu:c,show_rxn_action:!!a.data("show_rxn_action"),show_reply_action:!!a.data("show_reply_action"),show_comment_action:!!a.data("show_comment_action"),abs_permalink:a.data("abs_permalink"),star:u})),a.toggleClass("narrow_buttons",a.children().length>3)}else TS.error(i+" not found in "+t)}}});var e=function(e){var n=$(e.target),i=n.closest("[data-action]");if(i.length){var r=n.closest("ts-message"),a=r.data("model-ob-id"),s=a?TS.redux.channels.getEntityById(a):TS.shared.legacyGetActiveModelOb(),o=r.attr("data-ts"),l=TS.utility.msgs.getMsg(o,s.msgs),d=i.data("action"),c=!1;if(l||(l=TS.utility.msgs.getMsg(o,s._archive_msgs))&&(c=!0),!l)return void TS.error("WTF no message to click?");var u=TS.rxns.getRxnKeyByMsgType(l);switch(d){case"actions_menu":c?TS.menu.startWithMessageActions(e,r.data("ts"),s._archive_msgs,s):TS.menu.startWithMessageActions(e,r.data("ts"),s.msgs,s),t("more_actions_button");break;case"reaction":TS.ui.react_emoji_menu.start({e:e,rxn_key:u}),t("add_reaction_button");break;case"pin":TS.pins.startPinMessage(o,s),t("pin_to_this_conversation_button");break;case"unpin":TS.pins.unPinMessage(o,s),t("unpin_from_this_conversation_button");break;case"edit":TS.msg_edit.startEdit(o,s),t("edit_message_button");break;case"delete":TS.msg_edit.startDelete(o,s),t("delete_message_button");break;case"mark_unread":TS.info("_msgActionHandler: setting unread point on "+s.id+", ts = "+o+" (mark_unread)"),t("mark_unread_button");break;case"reply":t("reply_to_thread_button");break;case"open_in_channel":if(TS.web){var _=TS.utility.msgs.constructMsgPermalink(s,o);window.location=_}t("open_in_channel_button");break;case"open_conversation":break;case"copy_link":var m=TS.interop.i18n.t("Copied!","messages_action_items")();TS.tips.updateFloater({title:m,classes_to_add:["success"]}),TS.clipboard.writeText(i.data("permalink")),t("copy_link_button");break;case"comment":var p=r.attr("data-thread-ts")?"reply_to_thread_button":"start_a_thread_button";t(p);break;case"share_message":TS.ui.share_message_dialog.start(l.ts,s),t("share_message_button");break;case"add_handy_rxn":var f=i.data("name"),h=!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(u),f);h&&r.addClass("just_added_handy_rxn_from_actions"),TS.rxns.changeRxnsFromUserAction(u,f,h);break;case"share_file":var g=l.file;if(!g)return;TS.ui.share_dialog.start(g.id);break;case"star":TS.stars.checkForStarClick(e,(function(e){t(e?"star_message_button":"unstar_message_button")}));break;default:TS.error("WTF no action?")}}},t=function(e){var t={action:"click",ui_element:e};TS.interop.clog.track("MSG_ACTION",{contexts:{ui_context:t}})}}()},"3Vm1":function(e,t){TS.registerModule("user_groups",{updated_sig:new signals.Signal,updated_info_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,unknown_resolution_rebuild_sig:new signals.Signal,legacyNeedsToFetchMembership:function(e){return void 0===e.users||_.size(e.users)!==e.user_count}})},"4B0H":function(e,t){!function(){TS.registerModule("redux.notifications",{getCalculatedDesktopNotifySetting:function(t){return e(t)},getCalculatedMobileNotifySetting:function(e){return t(e)},getGlobalDesktopNotifySetting:function(){return i("global_desktop")},getNotificationsChannelPref:function(e,t){return r(e,t)},canChannelHaveAtChannelMentions:function(e){return n(e)}});var e=TS.redux.bindSelectorToStore("TS.interop.notifications.getCalculatedDesktopNotifySetting"),t=TS.redux.bindSelectorToStore("TS.interop.notifications.getCalculatedMobileNotifySetting"),n=TS.redux.bindSelectorToStore("TS.interop.messages.canChannelHaveAtChannelMentions"),i=TS.interop.prefs.getNotificationsGlobalPref,r=TS.interop.prefs.getNotificationsChannelPref}()},"4Cq+":function(e,t){TS.registerModule("bots",{changed_sig:new signals.Signal,legacyBatchUpsertAndSignal:function(e){var t=TS.interop.bots.getBotState();TS.redux.bots.bulkUpsertBots(e),t!==TS.interop.bots.getBotState()&&TS.bots.changed_sig.dispatch()},legacyEnsureBotsInDataArePresent:function(e){var t=TS.interop.utility.extractAllBotIds(e);return TS.interop.bots.ensureBotsArePresent(t)},legacyFetchAndUpsertBotsWithQuery:function(e){return TS.interop.Flannel.fetchRawMembersWithQuery(e).then((function(e){return e.objects=TS.shared.legacyBatchUpsertObjects(e.objects),e}))}})},"4KQo":function(e,t){!function(){TS.registerModule("utility.date",{fake_ts_unique_padder:"x",do24hrTime:function(){return TS.model.user&&TS.prefs.prefs_loaded&&TS.prefs.getPref("time24")},memberUTCOffset:function(t){var n=e(t)/60/60;return n<0?"(UTC"+n+")":n>0?"(UTC+"+n+")":"(UTC)"}});var e=function(e){var t=-28800;return(e&&e.tz_offset&&void 0!==e.tz_offset||0===e.tz_offset)&&(t=e.tz_offset),t}}()},"4oWp":function(e,t){!function(){TS.registerModule("ui.share_dialog",{div:null,showing:!1,delegate:void 0,onStart:function(){TS.files.team_file_changed_sig.add(i),TS.files.team_file_comment_added_sig.add(r),TS.files.team_file_comment_deleted_sig.add(r)},onKeydown:function(e){TS.ui.share_dialog.showing&&(e.which==TS.utility.keymap.enter?"BODY"===TS.utility.getActiveElementProp("NODENAME")&&(TS.ui.share_dialog.go(),e.preventDefault()):e.which==TS.utility.keymap.esc&&"BODY"===TS.utility.getActiveElementProp("NODENAME")&&TS.ui.share_dialog.cancel())},start:function(t,i,r,a,s,o){if(TS.boot_data.feature_file_threads)TS.redux.dispatch(TS.interop.redux.actions.openShareDialog({fileId:t}));else{n=!1,e=t;var l=TS.files.getFileById(t),d="file";"post"===l.mode?d="file_post":"space"===l.mode?d="file_space":"snippet"===l.mode?d="file_snippet":"docs"===l.mode&&(d="file_arugula");var c=TS.templates.builders.buildFileSharingControls(l,!0,null,r),u=i?"":TS.templates.builders.fileHTML(l,{for_share_dialog:!0}),_={type:d,item:l,item_owner:TS.interop.members.getMemberById(l.user),sharing_html:new Handlebars.SafeString(c),file_html:new Handlebars.SafeString(u),show_copy_link:l.permalink&&TS.clipboard.canWriteText()};_.icon_class=TS.utility.getImageIconClass(l,"thumb_80"),TS.ui.share_dialog.div||TS.ui.share_dialog.build();var m=TS.templates.share_dialog(_);m=TS.format.replaceHighlightMarkers(m);var p=TS.ui.share_dialog.div;p.html(m);var f=$("#file_comment_textarea");TS.ui.comments.bindInput(f,TS.ui.share_dialog.go),s&&TS.utility.contenteditable.value(f,s),f=null,p.modal("show"),p.find(".dialog_cancel").click(TS.ui.share_dialog.cancel),p.find(".dialog_go").click(TS.ui.share_dialog.go),TS.ui.file_share.bindFileShareDropdowns(TS.utility.members.getEntityFromFile(l),{id:a},void 0,o),TS.ui.file_share.bindFileShareShareToggle(),TS.ui.file_share.bindFileShareCommentField()}},go:function(){if(n)TS.info("TS.ui.share_dialog stopping because already sharing");else if(TS.ui.share_dialog.showing){var t=$("#select_share_channels").lazyFilterSelect("value")[0],i=_.trim(TS.utility.contenteditable.value($("#file_comment_textarea")));i=TS.utility.contenteditable.legacySynchronouslyReplacePotentialMentions(i,{enableBroadcastKeywords:!1});var r=t&&t.model_ob||{};TS.interop.utility.looksLikeMemberId(r.id)&&(r=TS.redux.channels.getImByMemberId(r.id)||r),TS.interop.utility.isModelObjectExternal(r)&&(i="");var a=function(){TS.shared.legacyGetShareModelObId(l,(function(t){TS.files.shareFile(e,t,i,!1).then((function(){e=null}))}))};if(t&&t.model_ob&&t.model_ob.create_channel){var s=e;return TS.ui.new_channel_modal.start(t.model_ob.name).then((function(t){return e=s,l=t.id,a(),null})).catch((function(){return TS.ui.share_dialog.start(s,!1,!1,!1,i),null})),TS.ui.share_dialog.cancel(),!1}if(TS.interop.utility.isModelObjectExternal(r)||!TS.ui.file_share.shouldBlockUploadDialogSubmission()){var o=$("#share_dialog"),l=o.find("#share_model_ob_id").val();l||t&&(l=t.model_ob.id),l?(TS.ui.share_dialog.delegate&&"function"==typeof TS.ui.share_dialog.delegate.submit?TS.ui.share_dialog.delegate.submit(o,a):a(),n=!0,TS.ui.share_dialog.div.modal("hide")):TS.warn("model_ob_id is not set! "+$("#select_share_channels").val())}}else TS.error("not showing?")},cancel:function(){e=null,TS.ui.share_dialog.div.modal("hide")},end:function(){t&&t.detachEvents&&t.detachEvents(),t=null,TS.model.dialog_is_showing=!1,TS.ui.share_dialog.showing=!1,TS.ui.share_dialog.div.empty(),$(window.document).unbind("keydown",TS.ui.share_dialog.onKeydown)},build:function(){$("body").append('<div id="share_dialog" tabindex="-1" class="modal hide fade"></div>'),TS.ui.share_dialog.div=$("#share_dialog");var e=TS.ui.share_dialog.div;e.on("hidden",(function(e){e.target==this&&TS.ui.share_dialog.end()})),e.on("show",(function(e){e.target==this&&(TS.model.dialog_is_showing=!0,TS.ui.share_dialog.showing=!0)})),e.on("shown",(function(e){e.target==this&&($("#select_share_channels").lazyFilterSelect("value").length<1?$("#select_share_channels").lazyFilterSelect("getInstance").$input.focus():TS.utility.contenteditable.focus($("#file_comment_textarea")),$(window.document).bind("keydown",TS.ui.share_dialog.onKeydown),t=TS.ui.share_dialog.div.find("img.lazy").lazyload())}))}});var e,t=null,n=!1,i=function(t){if(TS.ui.share_dialog.showing&&e===t.id){if(!TS.interop.files.isObjectFresh(t.id))return void TS.files.getFileById(t.id);a(t),s(t)}},r=function(t){TS.ui.share_dialog.showing&&e===t.id&&s(t)},a=function(e){TS.templates.builders.updateFileShareLabels(e),$("#select_share_at_channel_list").html(TS.templates.builders.makeFileCommentHelpHTML(e))},s=function(e){var t=TS.templates.makeFileDomId(e);$("#"+t).replaceWith(TS.templates.builders.fileHTML(e,{for_share_dialog:!0}));var n=$("#"+t).find("img.lazy");n.removeClass("lazy").attr("src",n.attr("data-original"))}}()},"5+2p":function(e,t){!function(){TS.registerModule("click",{onStart:function(){n(),t()},addHandler:function(t,n,i){_.isFunction(t)&&(i=n,n=t,t=null),e.push({selector:t,fn:n,prevent_on_drag:i||!1})},addWebHandler:function(){if(TS.web)return TS.click.addHandler.apply(this,arguments)},test:function(){return{addAll:t,setupBinding:n,handlers:function(){return e},resetHandlers:function(){e=[]},unbind:function(){$("body").off("click.ts_dot_click"),$("body").off("mousedown.ts_dot_click_mousedown")}}}});var e=[],t=function(){TS.click.addWebHandler("#msgs_div",(function(e){TS.utility.isPostClickEventSafe(e)||e.preventDefault()})),TS.click.addHandler(".inline_attachment.clickable, .inline_attachment.clickable + .reply_broadcast_rule",(function(e,t){var n,i=["a",".media_caret",".delete_attachment_link",".msg_inline_video_buttons_div"].join(",");$(e.target).closest(i).length||(n=t.is(".reply_broadcast")||t.closest(".reply_broadcast_rule").length?t.closest(".message_body").find('[data-action="open_conversation"]'):t.find(".attachment_from_url_link"))[0]&&n[0].click()}),!0),TS.click.addHandler(".file_actions",(function(e,t){e.preventDefault(),TS.menu.file.startWithFileActions(e,t.data("file-id"))})),TS.click.addWebHandler("#msgs_div.selecting_messages ts-message",(function(e){var t=$(e.target);if(!t.attr("href")&&!t.hasClass("star")){var n=t.closest("ts-message").find(".msg_select_cb");t.is("input")||n.prop("checked",!n.prop("checked")),TS.msg_edit.batchDeleteSelectionChanged(n,e.shiftKey)}})),TS.click.addHandler(TS.rxns.checkForRxnClick),TS.click.addHandler(TS.stars.checkForStarClick),TS.click.addHandler((function(e){TS.inline_imgs.checkForInlineImgClick(e)})),TS.click.addHandler((function(e){TS.inline_videos.checkForInlineVideoClick(e)})),TS.click.addHandler((function(e){TS.inline_audios.checkForInlineAudioClick(e)})),TS.click.addHandler((function(e){TS.inline_others.checkForInlineOtherClick(e)})),TS.click.addHandler((function(e){TS.inline_attachments.checkForInlineAttachmentClick(e)})),TS.click.addHandler(TS.inline_file_previews.checkForInlineFilePreviewClick),TS.click.addHandler(TS.inline_room_previews.checkForInlineRoomPreviewClick),TS.click.addWebHandler(".reply_bar",(function(e,t){if(!$(e.target).is("a")){var n=t.closest("ts-message"),i=n.attr("data-thread-ts");if(!i)return;var r=n.attr("data-model-ob-id"),a=TS.redux.channels.getEntityById(r);if(!a)return;var s=TS.utility.msgs.constructConversationPermalink(a,i);window.open(s)}}))},n=function(){var t={};$("body").on("mousedown.ts_dot_click_mousedown",(function(e){t.x=e.clientX,t.y=e.clientY})),$("body").on("click.ts_dot_click",(function(n){if(!n.isDefaultPrevented()){var a=$(n.target);if(!a.parents("[data-reactroot]").length&&!a.parents(".ReactModalPortal").length)for(var s,o,l=i(n),d=0;d<e.length;d+=1)if(o=null,!(s=e[d]).prevent_on_drag||n.clientX==t.x&&n.clientY==t.y){if(s.selector){if(!(o=a.closest(s.selector)).length)continue;s.fn(n,o,l),n.isDefaultPrevented()&&TS.has_pri[r]&&TS.log(r,"click on "+s.selector)}else s.fn(n,l);if(n.isDefaultPrevented())return}}}))},i=function(e){var t=$(e.target);if(t.closest("#member_stars_list").length)return"starred_items";if(t.closest("#member_mentions").length)return"mentions";if(t.closest("#file_list").length)return"file_list";if(t.closest("#file_preview_scroller").length)return"file_preview";if(t.closest("#member_preview_scroller").length)return"member_preview";if(t.closest("#convo_scroller").length)return"conversation";if(t.closest("#groups_tab").length)return"groups";if(t.closest("#threads_msgs_scroller_div").length)return"threads";if(t.closest("#channel_page_scroller").length){var n=TS.shared.legacyGetActiveModelOb(),i="channel_page";return n.is_group&&!n.is_mpim?i="group_page":(n.is_im||n.is_mpim)&&(i="im_page"),i}return null},r=2003}()},"54vr":function(e,t){TS.registerModule("enterprise",{})},"6btA":function(e,t){!function(){TS.registerModule("utility.msgs",{allowed_embed_attributes:["class","name","id","src","width","oldwidth","height","oldheight","frameborder","title","scrolling","allowtransparency","allowfullscreen","oallowfullscreen","msallowfullscreen","webkitallowfullscreen","mozallowfullscreen","controls","autoplay","loop","muted","poster","preload","webkit-playsinline","type"],ephemeral_msgs_map:{},messageIncludesMember:function(e,t){if(e){if(t){if(TS.utility.msgs.memberSentMessage(e,t))return!0;for(var n,i=l(t),r=0,a=i.length;r<a;r+=1)if(0===(n=i[r]).indexOf("<")&&0===n.indexOf("<@")){var s=n.replace(/<|>/g,""),o=TS.utility.msgs.getMemberIdFromMemberMarkup(s);if(o&&o==e.id)return!0}return!1}TS.warn("messageIncludesMember: WTF no msg?")}else TS.warn("messageIncludesMember: WTF no member?")},messageIncludesUserGroup:function(e,t){if(!e)return TS.warn("messageIncludesUserGroup: WTF no user group?"),!1;if(!t)return TS.warn("messageIncludesUserGroup: WTF no msg?"),!1;var n=l(t);return _.some(n,(function(t){if(t&&d(t)){var n=TS.utility.msgs.getUserGroupIdFromUserGroupMarkup(t);if(n&&n==e.id)return!0}return!1}))},extractUserGroupIdsFromMessage:function(e){if(!e)return[];var t=l(e);return _.reduce(t,(function(e,t){if(d(t)){var n=TS.utility.msgs.getUserGroupIdFromUserGroupMarkup(t);e.push(n)}return e}),[])},memberSentMessage:function(e,t){if(e){if(t)return!(!t.user||t.user!=e.id)||!(!t.comment||t.comment.user!=e.id);TS.warn("messageIncludesMember: WTF no msg?")}else TS.warn("messageIncludesMember: WTF no member?")},allUnknownUsersInMessage:function(e){for(var t=[],n=e.text,i=TS.format.calculateOptions(e,{}),r=TSF.getTokensArray($.trim(n),i.tsf_mode,{jumbomoji:!i.no_jumbomoji,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()}),a=0;a<r.length;a+=1){var s=r[a];if(0===s.indexOf("<")&&0===s.indexOf("<@")){var o=s.replace(/<|>/g,""),l=TS.utility.msgs.getMemberIdFromMemberMarkup(o),d=TS.redux.members.getPotentiallyUnknownMemberById(l);d||TS.boot_data.feature_deprecate_get_member_by_name||(d=TS.interop.members.getMemberByName(l)),d||t.indexOf(l)<0&&t.push(l)}}return t},appendMsg:function(e,t){e.unshift(TS.utility.msgs.makeSureMsgObIsValid(t))},setMsgs:function(e,t){for(var n=0;n<t.length;n+=1)t[n]=TS.utility.msgs.makeSureMsgObIsValid(t[n]);return TS.utility.msgs.sortMsgs(t),e.msgs=t,e.msgs},spliceMsg:function(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)},getNonTempMsgFromUserMatchingText:function(e,t,n){if(!e&&0!==e)return null;for(var i,r=0;r<n.length;r+=1)if((i=n[r]).user==t&&!TS.interop.rules.messages.isTempMsg(i)&&i.text==e)return i;return null},getMsgByProp:function(e,t,n){if(!t&&0!==t)return null;for(var i,r=0;r<n.length;r+=1)if((i=n[r])[e]==t)return i;return null},sortMsgs:function(e){e.sort((function(e,t){return e.ts<t.ts?1:e.ts>t.ts?-1:0}))},isMsgRolledUp:function(e){return!!e._jl_rolled_up_in&&e._jl_rolled_up_in!==e.ts},getPrevDisplayedMsg:function(e,t){for(var n,i=!1,r=0;r<t.length;r+=1)if(n=t[r],i){if(!TS.interop.rules.messages.isHidden(n)&&!TS.utility.msgs.isMsgRolledUp(n))return n}else n.ts==e&&(i=!0);return null},getDisplayedMsgs:function(e){for(var t,n=[],i=0;i<e.length;i+=1)t=e[i],TS.interop.rules.messages.isHidden(t)||TS.utility.msgs.isMsgRolledUp(t)||n.push(t);return n},getDisplayedMsgAfterTS:function(e,t){for(var n,i=t.length-1;i>-1;i-=1)if((n=t[i]).ts>e&&!TS.interop.rules.messages.isHidden(n)&&!TS.utility.msgs.isMsgRolledUp(n))return n;return null},getDisplayedMsgBeforeTS:function(e,t){for(var n,i=0;i<t.length;i+=1)if((n=t[i]).ts<e&&!TS.interop.rules.messages.isHidden(n)&&!TS.utility.msgs.isMsgRolledUp(n))return n;return null},getUnreadCountableMsgAfterTS:function(e,t){for(var n,i=t.length-1;i>-1;i-=1)if((n=t[i]).ts>e&&TS.interop.messages.canCountAsUnreadForCurrentUser(n,TS.model.user.id))return n;return null},getMarkMsgTSForUnreadPoint:function(e,t,n){var i,r;if(n.oldest_msg_ts&&e==n.oldest_msg_ts?i="0000000000.000000":(r=TS.utility.msgs.getPrevDisplayedMsg(e,t)||TS.utility.msgs.getMsg(e,t))&&(i=r.ts),!i)return null;for(;i&&!TS.utility.msgs.getUnreadCountableMsgAfterTS(i,t);)i=(r=TS.utility.msgs.getPrevDisplayedMsg(i,t))?r.ts:null;return i||null},getMsg:function(e,t){return t?TS.utility.msgs.getMsgByProp("ts",e,t):null},getFileOnMsg:function(e){if(e)return TS.interop.messages.shouldRenderFileThread(e)&&e.files&&e.files.length?e.files[0]:e.file},getFilesOnMsg:function(e){if(!e)return null;if(!e.file&&!e.files)return null;if(TS.interop.messages.shouldRenderFileThread(e)&&e.files&&e.files.length){var t=_.chain(e.files).map((function(e){return _.isString(e)?TS.files.getFileById(e):e&&_.isString(e.id)?TS.files.getFileById(e.id):e})).compact().value();return t&&t.length?t:null}var n=e.file;return _.isString(e.file)?n=TS.files.getFileById(e.file):e.file&&_.isString(e.file.id)&&(n=TS.files.getFileById(e.file.id)),n?[n]:null},getMsgActions:function(e,t,n){if(e){t=t||TS.shared.legacyGetActiveModelOb();var i={edit_msg:TS.interop.messages.canEditMessage(TS.model.user.id,e,t,TS.prefs.getTeamPref("msg_edit_window_mins")),delete_msg:!0},r=!1;e.user==TS.model.user.id&&(r=!0);var a=TS.utility.teams.isMsgFromOtherTeam(e);e.file&&"email"===e.file.mode&&(i.open_original=!0);var s=TS.interop.members.getMemberById(e.user),o=s&&s.is_stranger&&s.deleted;if(TS.prefs.getTeamPref("allow_message_deletion"))if("tombstone"===e.subtype)i.delete_msg=!1;else if("retention"===e.subtype)i.delete_msg=!1;else if(a&&!o)TS.boot_data.page_needs_enterprise&&(r||TS.model.user.enterprise_user.is_admin&&!t.is_im)?i.delete_msg=!0:i.delete_msg=!1;else if(t.is_im)r||"USLACKBOT"===e.user||"bot_message"===e.subtype||(i.delete_msg=!1);else if(r){if(TS.interop.rules.messages.isAutomatedSubtype(e.subtype)){TS.model.user.is_admin||_.includes(["pinned_item","sh_room_created","sh_room_shared","reply_broadcast"],e.subtype)||(i.delete_msg=!1)}}else TS.model.user.is_admin||(i.delete_msg=!1);else a&&!o?TS.boot_data.page_needs_enterprise&&TS.model.user.enterprise_user.is_admin&&!t.is_im?i.delete_msg=!0:i.delete_msg=!1:TS.model.user.is_admin?t.is_im&&(r||"USLACKBOT"===e.user||"bot_message"===e.subtype||(i.delete_msg=!1)):i.delete_msg=!1;var l=n!==TS.interop.constants.MessageContainers.THREADS_FLEXPANE&&n!==TS.interop.constants.MessageContainers.THREADS_VIEW;"thread_broadcast"===e.subtype&&l&&(i.remove_broadcast=i.delete_msg),e.is_ephemeral?i.delete_msg=!0:("file_comment"===e.subtype?i.add_file_comment_rxn=!0:TS.interop.rules.messages.isFile(e)?i.add_file_rxn=!0:"tombstone"===e.subtype?i.add_rxn=!1:i.add_rxn=!0,TS.clipboard.canWriteText()&&(i.copy_link=!0,"tombstone"===e.subtype&&(i.copy_link=!1)));var d=!e.thread_ts||e.thread_ts==e.ts;i.jump_to_original=!0,i.jump_to_original=d;var c="thread_broadcast"===e.subtype&&l;!i.mark_unread||d||c||(i.mark_unread=!1);return e.is_ephemeral||e.subtype&&-1===["bot_message","file_share","file_mention","file_comment","me_message","reply_broadcast","thread_broadcast"].indexOf(e.subtype)||(i.remind_me=!0),(i.jump_to_original||i.copy_link||i.mark_unread||i.remind_me)&&(i.has_private_actions=!0),(i.copy_link||i.add_rxn||i.add_file_rxn||i.add_file_comment_rxn||i.pin_msg||i.unpin_msg)&&(i.has_public_actions=!0),e.is_ephemeral||TS.interop.rules.messages.isTempMsg(e)||("file_share"===e.subtype||"file_mention"===e.subtype?i.share_file=!0:"tombstone"===e.subtype?i.share_message=!1:i.share_message=!TS.interop.channels.isImWithDeletedMember(t)&&(!TS.interop.rules.channels.isArchived(t)||t.is_channel)),i}},validateMsg:function(e,t,n){return t.ts?!TS.utility.msgs.getMsg(t.ts,n)||(TS.warn("msg "+t.ts+" already exists! ("+e+")"),TS.dir(0,t),!1):(TS.error("msg lacks a ts ("+e+")"),TS.dir(0,t),!1)},findMsg:function(e,t){var n=TS.redux.messages.getMessageByTimestamp(t,e);if(n)return n;var i=TS.redux.channels.getEntityById(t);if(i){if(n=i.msgs&&TS.utility.msgs.getMsg(e,i.msgs))return n;if(n=i._archive_msgs&&TS.utility.msgs.getMsg(e,i._archive_msgs))return n}var r=TS.mentions.getMentionByMsgId(t,e);return r?r.message:null},legacyMsgChangedWorker:function(e){var t=TS.redux.channels.getEntityById(e.channel);TS.mentions.replaceMsg(e.channel,e.message),TS.pins&&TS.pins.replaceMsg(e.message,t),(e.message.imgs||TS.utility.msgs.hasImgs(e.message))&&(TS.model.show_inline_img_size_pref_reminder=!0)},legacyMsgDeletedWorker:function(e,t){TS.mentions.legacyRemoveMsg(e.id,t.deleted_ts),TS.pins&&TS.pins.legacyRemoveMsg(t.deleted_ts,e),TS.utility.msgs.legacyDeleteMsg(e,t)},legacyDeleteMsg:function(e,t){var n=TS.utility.msgs.getMsg(t.deleted_ts,e.msgs);!n&&e._archive_msgs&&(n=TS.utility.msgs.getMsg(t.deleted_ts,e._archive_msgs)),n&&TS.shared.legacyRemoveMsgFromModern(e,n)},replaceMsg:function(e,t,n,i,r){TS.redux.messages.replaceMessage(TS.interop.messages.preprocessImsg(t,e.id),r),TS.utility.msgs.legacyReplaceMsg(e,t,n,i)},removeEphemeralMsg:function(e,t){var n=TS.interop.channels.getGroupById(e)||TS.interop.channels.getPublicChannelById(e);if(n){var i=TS.utility.msgs.findMsg(t,n.id);n.is_channel?TS.channels.legacyRemoveMsg(e,i):n.is_mpim?TS.mpims.legacyRemoveMsg(e,i):n.is_group&&TS.groups.legacyRemoveMsg(e,i)}},getMemberFromMemberMarkup:function(e){var t=TS.utility.msgs.getMemberIdFromMemberMarkup(e),n=TS.redux.members.getPotentiallyUnknownMemberById(t);return n||TS.boot_data.feature_deprecate_get_member_by_name||(n=TS.interop.members.getMemberByName(t)),n},getMemberIdFromMemberMarkup:function(e){var t=e.substr(1);return t&&(t=t.split("|")[0]),t},getUserGroupIdFromUserGroupMarkup:function(e){var t=new RegExp(TS.interop.userGroups.USER_GROUP_MSG_REGEX).exec(e);return t&&_.isArray(t)?t[1]:null},makeSureMsgObIsValid:function(e){return e},old_api_url_prefix:"api::",new_api_url_prefix:"slack-action://",doNewApiUrl:function(){alert(TS.interop.i18n.t("This link will not work in the archives.","msgs")())},countAllUnreads:function(t){if(!e){(TS.boot_data.feature_tinyspeck||TS.model&&TS.model.user&&"W461MFL8H"===TS.model.user.id)&&TS.telemeter.mark("count_all_unreads_start");if(TS.model.channels_with_unreads||(TS.model.channels_with_unreads=[]),t){var n=parseInt(t.unread_cnt,10)||0,i=parseInt(t.unread_highlight_cnt,10)||0;c(t.id,n,i),u(t.id,n,i)}TS.model.all_unread_highlights_cnt=0,TS.model.all_unread_cnt=0,TS.model.all_unread_cnt_to_exclude=0,TS.model.all_unread_highlights_cnt_to_exclude=0;var r,a=TS.redux.getState();if(t?(r=TS.model.channels_with_unreads.map((function(e){return TS.interop.channels.getChannelById(e)})),TS.interop.console.debug("[UNREAD-COUNTS]","Looping over the "+_.size(TS.model.channels_with_unreads)+" channels in TS.model.channels_with_unreads \u2728")):(r=TS.interop.channels.getAllChannels(),TS.interop.console.debug("[UNREAD-COUNTS]","Looping over all "+_.size(r)+" of the users channels \ud83d\ude2d")),(TS.boot_data.feature_tinyspeck||TS.model&&TS.model.user&&"W461MFL8H"===TS.model.user.id)&&TS.telemeter.mark("count_all_unreads_loop_start"),_.each(r,(function(e){if(TS.interop.rules.unreads.shouldCountUnreadsInModel(a,e)&&!TS.interop.rules.channels.shouldSuppressOrgChannel(a,e)){var n=parseInt(e.unread_cnt,10)||0,i=parseInt(e.unread_highlight_cnt,10)||0,r=TS.interop.rules.unreads.useUnreadCountAsMentionCount(a,e)?n:i;t||(c(e.id,n,i),u(e.id,n,i)),TS.model.all_unread_cnt+=n,TS.model.all_unread_highlights_cnt+=r}})),TS.boot_data.feature_tinyspeck||TS.model&&TS.model.user&&"W461MFL8H"===TS.model.user.id){var s=TS.telemeter.measureAndClear("count_all_unreads_loop_start","count_all_unreads_loop");TS.interop.console.info("UNREAD-COUNTS","Looping over the channels in countAllUnreads took "+s+"ms")}if(_.each(TS.model.threads_mention_counts,(function(e,t){var n=parseInt(e,10)||0;TS.model.all_unread_highlights_cnt+=n,TS.utility.msgs.maybeExcludeUnreads(TS.redux.channels.getEntityById(t),0,n)})),TS.model.threads_has_unreads&&(TS.model.all_unread_cnt+=1),TS.boot_data.feature_tinyspeck||TS.model&&TS.model.user&&"W461MFL8H"===TS.model.user.id){var o=TS.telemeter.measureAndClear("count_all_unreads_start","count_all_unreads");TS.interop.console.info("UNREAD-COUNTS","countAllUnreads took "+o+"ms")}}},legacyGetChannelsWithUnreads:function(){return TS.model.channels_with_unreads||[]},legacyGetAllUnreadCnt:function(){return TS.model.all_unread_cnt||0},legacyIsChannelsWithUnreadsReady:function(){return r},legacySetChannelsWithUnreadsReady:function(){r=!0},maybeExcludeUnreads:function(e,t,n){e&&(t||n)&&TS.interop.rules.channels.isOrgShared(e)&&(TS.interop.rules.channels.shouldSuppressOrgChannel(TS.redux.getState(),e)?(TS.model.is_our_app&&TS.has_pri[s]&&TS.log(s,"Excluding unread of "+t+" and highlight of "+n+" for shared channel "+e.id+" because this is NOT the relevant team."),TS.model.all_unread_cnt_to_exclude+=t,TS.model.all_unread_highlights_cnt_to_exclude+=n):TS.has_pri[s]&&TS.model.is_our_app&&TS.log(s,"Using unread of "+t+" and highlight of "+n+" for shared channel "+e.id+" because this IS the relevant team."))},doesMsgHaveRxnFromUser:function(e,t){return TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(e._rxn_key),t)},doesMsgHaveRxn:function(e,t){return TS.rxns.doesRxnsHaveRxn(TS.rxns.getExistingRxnsByKey(e._rxn_key),t)},recordEmojiInHash:function(e,t){if(!e)return!1;if(!t)return!1;var n=TS.utility.findAllTeamEmojiInStr(e,!0);if(!n.length)return!1;for(var i,r=!1,a=0;a<n.length;a+=1)(i=TS.emoji.isValidName(n[a]))?(parseInt(t[i],10)||(t[i]=0),t[i]+=1,r=!0):TS.error(n[a]+" invalid");return r},startBatchUnreadCalc:function(){"0"!=TS.qs_args.unread_batch&&(e=!0)},finishBatchUnreadCalc:function(){e=!1,TS.utility.msgs.countAllUnreads()},maybeSetOldestMsgsTsAfterMsgAdded:function(e){e.oldest_msg_ts||e.latest||TS.utility.msgs.setOldestMsgsTs(e)},setOldestMsgsTs:function(e){var t=TS.utility.msgs.getOldestValidTs(e);t&&(TS.pri&&TS.log(58,"setOldestMsgsTs ("+e.id+'): setting oldest_msg_ts from "'+e.oldest_msg_ts+'" -> '+t),e.oldest_msg_ts=t,TS.storage.storeOldestTs(e.id,e.oldest_msg_ts),e._latest_via_users_counts&&(e._latest_via_users_counts=void 0))},resetOldestMsgsTs:function(e){TS.pri&&TS.log(58,"resetOldestMsgsTs ("+e.id+'): setting oldest_msg_ts from "'+e.oldest_msg_ts+'" -> null'),e.oldest_msg_ts=null,TS.storage.storeOldestTs(e.id,null)},getOlderMsgsStatus:function(e){var t,n=e.msgs,i=e.oldest_msg_ts,r=!1,a="ERROR",s=!1,o=0;return e.msgs.length&&(t=TS.interop.rules.channels.getLatestMsgTs(e)||null),i&&TS.utility.msgs.getMsg(i,n)&&(r=!0),t?r||e.is_limited?(s=!1,o=3,a="We have the oldest msg: "+i+". is_limited:"+e.is_limited):(s=!0,o=4,a=i?"There are older messages than these. oldest_msg_ts: "+i:"There are older messages than these. oldest_msg_ts: unknown"):n.length?(s=!1,o=1,a="There are NOT older messages than these."):(s=!1,o=2,a="THIS IS A BRAND NEW CHANNEL SAY SOMETHING"),{text:a,more:s,code:o,is_limited:e.is_limited}},getMostRecentValidTs:function(e){if(!e)return null;for(var t,n=e.msgs||[],i=0;i<n.length;i+=1)if(t=n[i],!TS.interop.rules.messages.isTempMsg(t))return TS.pri&&i>0&&TS.log(58,"getMostRecentValidTs ("+e.id+"): "+t.ts+" at msgs["+i+"] of "+n.length),t.ts;var r=TS.interop.rules.channels.getLatestMsgTs(e)||null;return TS.pri&&TS.log(58,"getMostRecentValidTs ("+e.id+"): did not find most recent valid ts. getLatestMsgTs() returned "+r),r},getOldestValidTs:function(e){var t;if(!e||!e.msgs)return null;for(var n=e.msgs.length-1,i=n;i>-1;i-=1)if(t=e.msgs[i],!TS.interop.rules.messages.isTempMsg(t))return TS.pri&&i!==n&&TS.log(58,"getOldestValidTs("+e.id+"): "+t.ts+" at msgs["+i+"] of "+n),t.ts;return TS.pri&&TS.warn("getOldestValidTs("+e.id+"): none found. msgs.length = "+n),null},getHistoryFetchJobKey:function(e,t){var n=e;return t&&(n+="_"+t),n},processImsg:function(e,t){return TS.interop.messages.preprocessImsg(e,t)},maybeFetchUserDataFromLS:function(e){e?i[e.id]||(e.last_msg_input||(e.last_msg_input=TS.storage.fetchLastMsgInput(e.id),e.has_draft=!!e.last_msg_input,e.last_msg_input&&TS.has_pri[o]&&TS.log(o,'Got last_msg_input for "'+e.id+'": length = '+(e.last_msg_input.length||"unknown"))),i[e.id]=!0):TS.warn("maybeFetchUserDataFromLS: WTF no model_ob?")},_handleLegacyAttachment:function(e,t){if(e){if(e.slack_file_id&&!e._slack_file_is_deleted){var n=TS.files.getFileById(e.slack_file_id);n?e._slack_file=n:e._slack_file&&(e._slack_file=TS.files.upsertFile(e._slack_file,"handleLegacyAttachment").file)}if(e.mrkdwn_in&&_.isArray(e.mrkdwn_in)&&e.mrkdwn_in.length){e.mrkdwn_in_hash={};for(var i=0;i<e.mrkdwn_in.length;i+=1)e.mrkdwn_in_hash[e.mrkdwn_in[i]]=!0}if(e.mrkdwn_in_hash||(e.mrkdwn_in_hash={}),delete e.mrkdwn_in,e.hex_swatches=!!e.hex_swatches,(e.audio_html||e.audio_url)&&TS.inline_audios.makeInternalInlineAudio(e.audio_html||e.audio_url,e),e.other_html)TS.inline_others.makeInternalInlineOther(e);else if(e.video_html){var r=e.video_html_width&&parseInt(e.video_html_width,10)>parseInt(e.thumb_width,10)?e.video_html_width:e.thumb_width,a=e.video_html_height&&parseInt(e.video_html_height,10)>parseInt(e.thumb_height,10)?e.video_html_height:e.thumb_height;TS.inline_videos.makeInternalInlineVideo(e.from_url||e.thumb_url,{title:e.title,html:TS.utility.msgs.filterHTMLForEmbeds(e.video_html),thumbnail:{url:e.thumb_url,width:r,height:a,link_url:e.from_url||e.title_url}})}else e.image_url&&TS.inline_imgs.makeInternalInlineImg(e.from_url||e.image_url,{src:e.image_url,width:e.image_width,height:e.image_height,link_url:e.from_url||e.title_url||e.image_url,bytes:e.image_bytes,rotation:e.rotation,content_type:e.content_type});return TS.inline_attachments.massageAttachment(e,t),e}TS.warn("attachment is null!")},processAttachments:function(e){if(e)for(var t,n=0;n<e.length;n+=1)t=e[n],TS.utility.msgs._handleLegacyAttachment(t,n)},constructMsgPermalink:function(e,t,n){return e?(i=_.isString(e)?e:e.id,TS.interop.rules.messages.constructMsgPermalink(i,t,n)):"";var i},constructAbsoluteMsgPermalink:function(e,t,n){return TS.boot_data.team_url.slice(0,-1)+TS.utility.msgs.constructMsgPermalink(e,t,n)},constructConversationPermalink:function(e,t){return"/conversation/"+(_.isString(e)?e:e.id)+"/p"+t.replace(".","")},shouldMarkUnreadsOnMessageFetch:function(e){return"1"!=TS.qs_args.no_unread_marking_on_msgs_fetch&&(!(e&&(!(t=TS.shared.legacyGetActiveModelOb())||t.id!==e.id))&&(TS.pri&&t&&TS.log(58,"shouldMarkUnreadsOnMessageFetch: returning TRUE for active model_ob of "+t.id),!0));var t},updateFileMsgs:function(e,t){var n=e.msgs;if((n=!(n&&n.length)?e._archive_msgs:n)&&n.length)for(var i,r=function(e){return!!e&&(!!e.attachments&&(!!e.attachments.length&&!!TS.inline_attachments.getAttachmentBySlackFileId(e.attachments,t.id)))},a=n.length-1;a>-1;a-=1){if(i=n[a],t.is_deleted||"file_share"!==i.subtype&&"file_mention"!==i.subtype&&"file_comment"!==i.subtype||!i.file||i.file.id!=t.id){if(!r(i))continue}else;if(i.file=_.assign({},t),t.is_tombstoned)e.id==TS.model.active_im_id?TS.ims.message_changed_sig.dispatch(e,i):e.id==TS.model.active_channel_id?TS.channels.message_changed_sig.dispatch(e,i):e.id==TS.model.active_group_id?TS.groups.message_changed_sig.dispatch(e,i):e.id==TS.model.active_mpim_id&&TS.mpims.message_changed_sig.dispatch(e,i);else if("hosted"===t.mode||"external"===t.mode||"snippet"===t.mode){if(!t.comments.length&&t.is_tombstoned)continue;e.id==TS.model.active_im_id?TS.ims.message_changed_sig.dispatch(e,i):e.id==TS.model.active_channel_id?TS.channels.message_changed_sig.dispatch(e,i):e.id==TS.model.active_group_id?TS.groups.message_changed_sig.dispatch(e,i):e.id==TS.model.active_mpim_id&&TS.mpims.message_changed_sig.dispatch(e,i)}}},updateCommentReferences:function(e){if(e){var t=TS.interop.channels.getAllChannels();_.forEach(t,(function(t){_.forEach(t.msgs,(function(t){if(t.file&&t.file.id===e.id&&t.comment){var n=_.find(e.comments,{id:t.comment.id});n&&(t.comment=n)}}))}))}},getEphemeralMsgsByCidAndType:function(e,t){var n,i=[],r=TS.redux.channels.getEntityById(e);return r?(i=TS.redux.messages.getMessagesByProp(e,{_ephemeral_type:t}),_.forOwn(TS.utility.msgs.ephemeral_msgs_map,(function(a,s){if(a.ephemeral_type==t&&a.c_id==e){if(!(n=TS.utility.msgs.getMsg(s,r.msgs)))return;i.push(n)}})),i):i},removeAllEphemeralMsgsByType:function(e,t,n){if(n){var i,r;_.forOwn(TS.utility.msgs.ephemeral_msgs_map,(function(a,s){if(a.ephemeral_type==e){if(t&&t!=a.c_id)return;if(n&&n!=a.thread_ts)return;if(!(i=TS.redux.channels.getEntityById(a.c_id)))return;if(!(r=TS.utility.msgs.getMsg(s,i.msgs)))return;i.is_im?TS.ims.legacyRemoveMsg(i.id,r):i.is_mpim?TS.mpims.legacyRemoveMsg(i.id,r):i.is_channel?TS.channels.legacyRemoveMsg(i.id,r):i.is_group&&TS.groups.legacyRemoveMsg(i.id,r),delete TS.utility.msgs.ephemeral_msgs_map[s]}}))}else{var a=TS.redux.messages.getMessagesByProp(t,{_ephemeral_type:e});_.forEach(a,(function(e){var t=TS.redux.channels.getEntityById(e.channel);t&&TS.shared.legacyGetControllerForModelOb(t).legacyRemoveMsg(t.id,e)}))}},hasImgs:function(e){if(!e)return!1;if(e.img_vids)_.forOwn(e.img_vids,(function(e){if("img"===e.img_vid_type)return!0}));else if(e.attachments)for(var t=0;t<e.attachments.length;t+=1)if(e.attachments[t].image_url)return!0;return!1},ingestMessagesFromBootData:function(e){if(TS.boot_data.msgs){var t=TS.boot_data.msgs[e.id]||[],n=TS.interop.messages.preprocessImsgs(t.filter((function(e){return!!e.ts})),e.id);TS.utility.msgs.setMsgs(e,n)}},handleSearchHighlights:function(e){return TS.format.replaceHighlightMarkers(e,'<span class="match">',"</span>")},handleFailedMsgSend:function(e,t,n){var i,r,a=TS.utility.msgs.findMsg(e,t.id);a?(n&&a.thread_ts&&(i=TS.utility.msgs.findMsg(a.thread_ts,t.id),r=a._was_reply_broadcast),t.is_mpim?TS.mpims.legacyRemoveMsg(t.id,a):t.is_channel?TS.channels.legacyRemoveMsg(t.id,a):t.is_group?TS.groups.legacyRemoveMsg(t.id,a):TS.ims.legacyRemoveMsg(t.id,a),n&&TS.shared.legacySendMsg(t.id,TS.format.unFormatMsg(a.text,a),i,r),delete TS.model.unsent_msgs[a.ts],delete TS.model.display_unsent_msgs[a.ts]):TS.error("no msg?: "+e)},msgMightBeRolledUp:function(e){return e.subtype&&-1!=TS.model.join_leave_subtypes.indexOf(e.subtype)},msgRollUpWorker:function(e,t,n,i){if(delete t._jl_rollup_hash,delete t._jl_rolled_up_in,TS.utility.msgs.msgMightBeRolledUp(t)){if(i.push(t),0!==e&&TS.utility.msgs.msgMightBeRolledUp(n[e-1]))return"continue";i[0]._jl_rollup_hash={msg_ids:[],users:{}};for(var r,a=i[0]._jl_rollup_hash,s=0;s<i.length;s+=1){r=i[s],a.users[r.user]=a.users[r.user]||{};var o=a.users[r.user];a.msg_ids.push(r.ts),r._jl_rolled_up_in=i[0].ts,"channel_join"===r.subtype||"group_join"===r.subtype?(o.inviter=r.inviter,o.joined=!0,o.is_in=!0):"channel_leave"!==r.subtype&&"group_leave"!==r.subtype||(o.left=!0,o.is_in=!1)}return"swap"}},shouldHaveBotLabel:function(e,t){var n=e.subtype&&("bot_message"===e.subtype||"thread_broadcast"===e.subtype&&e.bot_id)&&"USLACKBOT"!==e.user,i=t&&t.is_bot&&!TS.interop.rules.members.isSlackbot(t);return n||i},filterHTMLForEmbeds:function(e){if(!e)return e;var i,r,a=new DOMParser,s=a.parseFromString(e,"text/html")||a.parseFromString(e,"text/xml"),o="";return s&&(r=$(s.body)),r?(r&&(i=r.find(n)).length&&(o=TS.utility.sanitizeHTML(i.first()[0].outerHTML,t,TS.utility.msgs.allowed_embed_attributes)),a=null,s=null,r=null,i=null,o):e},areMsgsSameDay:function(e,t){var n=TS.interop.datetime.toDateObject(e.ts),i=TS.interop.datetime.toDateObject(t.ts);return TS.interop.datetime.isSameDay(n,i)},maybeSetPrevLastRead:function(e,t){e&&(t!=TS.utility.msgs.getMostRecentValidTs(e)?TS.utility.msgs.setPrevLastRead(e,t):TS.utility.msgs.setPrevLastRead(e,e.last_read))},setPrevLastRead:function(e,t){if(e)if(e._prev_last_read||!e.unread_cnt||TS.notifs.isCorGMuted(e.id)){var n=TS.utility.msgs.getMostRecentValidTs(e),i=TS.utility.msgs.getMsg(n,e.msgs);i&&"pinned_item"===i.subtype&&(e._prev_last_read=t)}else e._prev_last_read=t},maybeClearPrevLastRead:function(e){(e=e||TS.shared.legacyGetActiveModelOb())&&e._prev_last_read&&(e._prev_last_read=void 0)},msgHasReplies:function(e){return!!e&&(e.ts===e.thread_ts&&!!e.reply_count)},startUpdatingRelativeTimestamps:function(e){a.start(e)},stopUpdatingRelativeTimestamps:function(e){a.stop(e)},extractMsgDisplayContext:function(e){return e.closest("#unread_msgs_div").is("#unread_msgs_div")?"all_unreads":null},extractLinkType:function(e,t,n){return t.data("member-id")||e.data("member-id")?"user":t.data("channel-id")||e.data("channel-id")?"channel":t.data("file-id")||e.data("file-id")?"file":n&&n.match(/\.slack\.com\/archives\//)?"message":n&&!TS.interop.url.getHostName(n).match(/\.slack\.com/)?"external":"internal"},extractLinkItemId:function(e,t,n){return"user"===n?t.data("member-id")||e.data("member-id"):"channel"===n?t.data("channel-id")||e.data("channel-id"):"file"===n?t.data("file-id")||e.data("file-id"):null},extractLinkAction:function(e,t){return t.hasClass("file_preview_action")?t.hasClass("file_ssb_download_link")?"file_ssb_download_link":t.hasClass("file_new_window_link")?"file_new_window_link":t.hasClass("file_comment_link")?"file_comment_link":"file_preview_action":e.hasClass("file_viewer_external_link")?"file_viewer_external_link":e.hasClass("file_viewer_link")?"file_viewer_link":t.hasClass("file_preview_link")?"file_preview_link":t.hasClass("file_header")?"file_header":t.parent()&&t.parent().hasClass("rest_text_expander")?"rest_text_expander":null},extractLinkAttachmentField:function(e){var t=e.parent();return e.hasClass("btn_attachment_link")?"attachment_link_button":t.hasClass("attachment_source_icon")?"attachment_source_icon":t.hasClass("attachment_source_name")?"attachment_source_name":t.hasClass("attachment_author_name")?"attachment_author_name":t.hasClass("attachment_title")?"attachment_title":null},isRawLink:function(e,t){if(!e||!t)return!1;if(!e.is("a"))return!1;var n=t.replace(/(^\w+:|^)\/\//,"");return e.text()===t||e.text()===n},legacyReplaceMsg:function(e,t,n,i){var r=TS.utility.msgs.getMsg(t.ts,e.msgs);if(!r&&e._archive_msgs&&(r=TS.utility.msgs.getMsg(t.ts,e._archive_msgs)),r){t._rxn_key=r._rxn_key,t.pinned_to||(t.pinned_to=r.pinned_to),"is_starred"in t||(t.is_starred=r.is_starred);var a=null;if(t.comment&&t.file){var s=TS.files.getFileById(t.file.id);s&&(TS.files.editCommentOnFile(t.comment,s),a=TS.files.getFileCommentById(s,t.comment.id))}t=TS.interop.messages.preprocessImsg(t,e.id),a&&(t.comment=a);var o=_.union(Object.keys(t),Object.keys(r)).filter((function(e){return t[e]!=r[e]}));o.length||i?(_.each(_.keys(r),(function(e){delete r[e]})),_.forOwn(t,(function(e,t){r[t]=e})),e.is_im?TS.ims.message_changed_sig.dispatch(e,r,o):e.is_group&&e.is_mpim?TS.mpims.message_changed_sig.dispatch(e,r,o):e.is_group&&!e.is_mpim?TS.groups.message_changed_sig.dispatch(e,r,o):e.is_channel&&TS.channels.message_changed_sig.dispatch(e,r,o)):TS.info("Not signalling message change because it doesn't look like anything has changed for "+t.ts+" in "+e.id)}else n||TS.error("unknown msg:"+t.ts+" in "+e.id)},isEKMAccessDeniedMessage:function(e){return e&&"ekm_access_denied"===e.subtype},test:function(){return{looksLikeUserGroupMarkup:d,tokenizeMessage:l}}});var e=!1,t=["video","iframe","source"],n=t.join(","),i={},r=!1,a=function(){var e=null,t=[];function n(){_.forEach(t,(function(e){$(e).find(".relative_ts").each((function(){var e=$(this).attr("data-ts"),t=$(this).data("really-short"),n=TS.interop.datetime.toTimeAgo(e,{compact:t});n!==$(this).text()&&$(this).text(n)}))}))}return{start:function(i){_.includes(t,i)||(t.push(i),null===e&&(e=setInterval(n,6e4)))},stop:function(n){_.pull(t,n),t.length||(clearInterval(e),e=null)}}}(),s=67,o=667,l=function(e){var t=e.text,n=TS.format.calculateOptions(e);return TSF.getTokensArray($.trim(t),n.tsf_mode,{jumbomoji:!n.no_jumbomoji,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()})},d=function(e){return 0===e.indexOf("<")&&0===e.indexOf("<!subteam")},c=function(e,t,n){e&&(_.includes(TS.model.channels_with_unreads,e)||0===t&&0===n||(TS.model.channels_with_unreads.push(e),TS.interop.console.debug("[UNREAD-COUNTS]","Adding "+e+" to TS.model.channels_with_unreads because it is unread")))},u=function(e,t,n){e&&_.includes(TS.model.channels_with_unreads,e)&&0===t&&0===n&&(TS.interop.console.debug("[UNREAD-COUNTS]","Removing "+e+" from TS.model.channels_with_unreads because it is no longer unread"),_.pull(TS.model.channels_with_unreads,e))}}()},"7EQy":function(e,t){!function(){TS.registerModule("team",{team_profile_changed_sig:new signals.Signal,team_email_domain_changed_sig:new signals.Signal,team_domain_changed_sig:new signals.Signal,team_name_changed_sig:new signals.Signal,onStart:function(){TS.team.team_name_changed_sig.add(n)},ensureTeamProfileFields:function(){return e||(e=TS.interop.api.call("team.profile.get").then((function(e){TS.redux.teams.upsertTeam(_.assign({id:TS.boot_data.team_id},{profile:e.data.profile}))})))},getTeamProfileFieldById:function(e){TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getTeamProfileFieldById");for(var t=0;t<TS.model.team.profile.fields.length;t+=1)if(TS.model.team.profile.fields[t].id===e)return TS.model.team.profile.fields[t];return null},getVisibleTeamProfileFields:function(){return TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getVisibleTeamProfileFields"),TS.model.team.profile.fields.filter((function(e){return!e.is_hidden}))},getHiddenTeamProfileFields:function(){return TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getHiddenTeamProfileFields"),TS.model.team.profile.fields.filter((function(e){return e.is_hidden}))},getTeamCustomStatusPresets:function(){return _.map(TS.prefs.getTeamPref("custom_status_presets"),(function(e){return{text:e[1],canonical:e[2]||null,emoji:e[0]}}))},sortTeamProfileFieldsByOrdering:function(e){if(e&&e.length)return _.clone(e).sort((function(e,t){return e.ordering-t.ordering}));TS.warn("Ensure profile fields exist before calling sortTeamProfileFieldsByOrdering")},getVisibleTeamProfileFieldsForMember:function(e,t){return e&&e.profile?(TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getVisibleTeamProfileFieldsForMember"),TS.model.team.profile.fields.filter((function(n){return(t||_.get(e.profile,["fields",n.id,"value"]))&&!n.is_hidden})).map((function(t){var n=_.get(e.profile,["fields",t.id,"value"]),i=_.get(e.profile,["fields",t.id,"alt"]),r=n&&"date"===t.type?TS.interop.datetime.convertISOtoUTCReadableDate(n):i;return $.extend(!0,{value:n,alt:r},t)}))):[]},isEntireTeamLoaded:function(){return t}});var e,t=!1,n=function(){$("#team_name").text(TS.model.team.name),document.title=document.title.replace(TS.model.last_team_name,TS.model.team.name),TS.model.last_team_name=TS.model.team.name}}()},"8FFK":function(e,t,n){var i=n("cDf5");!function(){TS.registerModule("prefs",{all_notifications_prefs_changed_sig:new signals.Signal,highlight_words_changed_sig:new signals.Signal,seen_welcome_2_changed_sig:new signals.Signal,emoji_mode_changed_sig:new signals.Signal,obey_inline_img_limit_changed_sig:new signals.Signal,messages_theme_changed_sig:new signals.Signal,expand_inline_imgs_changed_sig:new signals.Signal,expand_internal_inline_imgs_changed_sig:new signals.Signal,expand_non_media_attachments_changed_sig:new signals.Signal,webapp_spellcheck_changed_sig:new signals.Signal,color_names_in_list_changed_sig:new signals.Signal,search_only_my_channels_changed_sig:new signals.Signal,search_exclude_channels_changed_sig:new signals.Signal,search_exclude_bots_changed_sig:new signals.Signal,search_only_current_team_changed_sig:new signals.Signal,box_enabled_changed_sig:new signals.Signal,dropbox_enabled_changed_sig:new signals.Signal,read_changed_sig:new signals.Signal,push_changed_sig:new signals.Signal,time24_changed_sig:new signals.Signal,sidebar_behavior_changed_sig:new signals.Signal,dtop_notif_changed_sig:new signals.Signal,muted_channels_changed_sig:new signals.Signal,mac_ssb_bullet_changed_sig:new signals.Signal,team_hide_referers_changed_sig:new signals.Signal,sidebar_theme_changed_sig:new signals.Signal,no_invites_widget_in_sidebar_changed_sig:new signals.Signal,k_key_omnibox_auto_hide_count_changed_sig:new signals.Signal,display_real_names_override_changed_sig:new signals.Signal,team_display_real_names_changed_sig:new signals.Signal,team_perms_pref_changed_sig:new signals.Signal,privacy_policy_seen_changed_sig:new signals.Signal,two_factor_update_seen_changed_sig:new signals.Signal,compliance_export_start_changed_sig:new signals.Signal,team_disallow_public_file_urls_changed_sig:new signals.Signal,mentions_exclude_at_channels_changed_sig:new signals.Signal,mentions_exclude_at_user_groups_changed_sig:new signals.Signal,team_auth_mode_changed_sig:new signals.Signal,team_sso_auth_restrictions_changed_sig:new signals.Signal,preferred_skin_tone_changed_sig:new signals.Signal,separate_private_channels_changed_sig:new signals.Signal,separate_shared_channels_changed_sig:new signals.Signal,whats_new_read_changed_sig:new signals.Signal,team_dnd_enabled_changed_sig:new signals.Signal,team_dnd_start_hour_changed_sig:new signals.Signal,team_dnd_end_hour_changed_sig:new signals.Signal,team_invites_only_admins_changed_sig:new signals.Signal,tz_changed_sig:new signals.Signal,keyboard_changed_sig:new signals.Signal,msg_input_send_btn_changed_sig:new signals.Signal,msg_input_send_btn_auto_set_changed_sig:new signals.Signal,team_allow_calls_changed_sig:new signals.Signal,team_calling_app_name_changed_sig:new signals.Signal,team_calling_app_id_changed_sig:new signals.Signal,frecency_jumper_changed_sig:new signals.Signal,jumbomoji_changed_sig:new signals.Signal,hide_hex_swatch_changed_sig:new signals.Signal,channel_sort_changed_sig:new signals.Signal,show_memory_instrument_changed_sig:new signals.Signal,enable_unread_view_changed_sig:new signals.Signal,enable_react_emoji_picker_changed_sig:new signals.Signal,team_disable_file_editing_changed_sig:new signals.Signal,team_disable_file_deleting_changed_sig:new signals.Signal,team_display_email_addresses_changed_sig:new signals.Signal,email_alerts_changed_sig:new signals.Signal,team_uses_customized_custom_status_presets_changed_sig:new signals.Signal,team_loud_channel_mentions_limit_changed_sig:new signals.Signal,locale_changed_sig:new signals.Signal,enable_shared_channels_changed_sig:new signals.Signal,a11y_animations_changed_sig:new signals.Signal,prefs_loaded:!1,setPrefs:function(e){var t=TS.prefs.getPref("muted_channels");TS.redux.prefs.setUserPrefs(e),TS.prefs.prefs_loaded=!0,TS.prefs.mergeEmojiUse(TS.prefs.getPref("emoji_use")),TS.prefs.mergeFrecencyJumper(TS.ui.frecency.isEnterprise()?TS.prefs.getPref("frecency_ent_jumper"):TS.prefs.getPref("frecency_jumper")),TS.prefs.setUserColors(TS.prefs.getPref("user_colors")),TS.prefs.setLoudChannels(TS.prefs.getPref("loud_channels")),TS.prefs.setSuppressedChannels(TS.prefs.getPref("at_channel_suppressed_channels")),TS.prefs.setPushSuppressedChannels(TS.prefs.getPref("push_at_channel_suppressed_channels")),TS.prefs.setNeverChannels(TS.prefs.getPref("never_channels")),TS.prefs.setMutedChannels(TS.prefs.getPref("muted_channels"),t),TS.prefs.setLoudChannelsSet(TS.prefs.getPref("loud_channels_set")),TS.prefs.setPushLoudChannels(TS.prefs.getPref("push_loud_channels")),TS.prefs.setPushMentionChannels(TS.prefs.getPref("push_mention_channels")),TS.prefs.setPushLoudChannelsSet(TS.prefs.getPref("push_loud_channels_set")),TS.prefs.setSearchExcludeChannels(TS.prefs.getPref("search_exclude_channels")),TS.prefs.setChannelSort(TS.prefs.getPref("channel_sort")),TS.prefs.setSidebarThemeCustomValues(TS.utility.parseJSONOrElse(TS.prefs.getPref("sidebar_theme_custom_values"),void 0)),TS.emoji.setEmojiMode(),TS.prefs.setTheme(),TS.prefs.setPrefLocal("emoji_autocomplete_big",!1)},setChannelSort:function(e){TS.model.channel_sort=e},setHighlightWords:function(e){TS.prefs.setPrefLocal("highlight_words",e)},setSuppressedChannels:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("at_channel_suppressed_channels",e),TS.model.at_channel_suppressed_channels=[],e&&"string"==typeof e&&(TS.model.at_channel_suppressed_channels=TS.model.at_channel_suppressed_channels.concat(e.split(",")))},setPushSuppressedChannels:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("push_at_channel_suppressed_channels",e),TS.model.push_at_channel_suppressed_channels=[],e&&"string"==typeof e&&(TS.model.push_at_channel_suppressed_channels=TS.model.push_at_channel_suppressed_channels.concat(e.split(",")))},setLoudChannels:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("loud_channels",e),TS.model.loud_channels=[],e&&"string"==typeof e&&(TS.model.loud_channels=TS.model.loud_channels.concat(e.split(",")))},setNeverChannels:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("never_channels",e),TS.model.never_channels=[],e&&"string"==typeof e&&(TS.model.never_channels=TS.model.never_channels.concat(e.split(",")))},setMutedChannels:function(t,n){var i;if(n||(n=TS.prefs.getPref("muted_channels")),n!==t||!e){var r,a;i=TS.prefs.getPref("muted_channels")&&"string"==typeof TS.prefs.getPref("muted_channels")?TS.prefs.getPref("muted_channels").split(","):[],TS.prefs.setPrefLocal("muted_channels",t),e=!0;var s=[],o=[];t&&"string"==typeof t&&(s=s.concat(t.split(",")),o=_.difference(i,s));for(r=0;r<s.length;r+=1)(a=TS.redux.channels.getEntityById(s[r],false))&&a.unread_cnt&&(a._show_in_list_even_though_no_unreads=!0);return TS.model.channels.forEach((function(e){TS.notifs.isCorGMuted(e.id)||(e._show_in_list_even_though_no_unreads=!1)})),TS.model.groups.forEach((function(e){TS.notifs.isCorGMuted(e.id)||(e._show_in_list_even_though_no_unreads=!1)})),TS.redux.channels.updateMutedChannels(s),o}},legacyOnMutedChannelsPrefChanged:function(){TS.prefs.muted_channels_changed_sig.dispatch()},setLoudChannelsSet:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("loud_channels_set",e),TS.model.loud_channels_set=[],e&&"string"==typeof e&&(TS.model.loud_channels_set=TS.model.loud_channels_set.concat(e.split(",")))},setPushLoudChannels:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("push_loud_channels",e),TS.model.push_loud_channels=[],e&&"string"==typeof e&&(TS.model.push_loud_channels=TS.model.push_loud_channels.concat(e.split(",")))},setPushMentionChannels:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("push_mention_channels",e),TS.model.push_mention_channels=[],e&&"string"==typeof e&&(TS.model.push_mention_channels=TS.model.push_mention_channels.concat(e.split(",")))},setPushLoudChannelsSet:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("push_loud_channels_set",e),TS.model.push_loud_channels_set=[],e&&"string"==typeof e&&(TS.model.push_loud_channels_set=TS.model.push_loud_channels_set.concat(e.split(",")))},setSearchExcludeChannels:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("search_exclude_channels",e),TS.model.search_exclude_channels=[],e&&"string"==typeof e&&(TS.model.search_exclude_channels=TS.model.search_exclude_channels.concat(e.split(",")))},mergeFrecencyJumper:function(e){return e&&"object"===i(e)||(e=TS.utility.parseJSONOrElse(e||null)||{}),TS.model.frecency_jumper=e,!0},mergeEmojiUse:function(e){TS.model.emoji_names&&TS.model.emoji_names.length||TS.emoji.makeMenuLists(),e&&"object"===i(e)||(e=TS.utility.parseJSONOrElse(e||null)||{},e=_.pickBy(e,(function(e,t){return _.includes(TS.model.emoji_names,t)})));var t=!1;for(var n in e)(!TS.model.emoji_use.hasOwnProperty(n)||e[n]>TS.model.emoji_use[n])&&(TS.model.emoji_use[n]=e[n],t=!0);return t?(TS.has_pri[777]&&TS.dir(777,TS.model.emoji_use,"mergeEmojiUse TS.model.emoji_use set to:"),!0):(TS.has_pri[777]&&TS.log(777,"mergeEmojiUse TS.model.emoji_use unchanged"),!1)},setUserColors:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("user_colors",e);var r=e?JSON.parse(e):{};TS.model.user_colors=r||{}},setTheme:function(){"default"===TS.prefs.getPref("messages_theme")&&TS.prefs.setPrefLocal("messages_theme","light_with_avatars"),TS.prefs.setPrefLocal("theme","light"),TS.prefs.setPrefLocal("avatars",!0),"dense"===TS.prefs.getPref("messages_theme")?(TS.prefs.setPrefLocal("theme","dense"),TS.prefs.setPrefLocal("avatars",!1)):"light"===TS.prefs.getPref("messages_theme")?(TS.prefs.setPrefLocal("theme","light"),TS.prefs.setPrefLocal("avatars",!1)):"light_with_avatars"===TS.prefs.getPref("messages_theme")&&(TS.prefs.setPrefLocal("theme","light"),TS.prefs.setPrefLocal("avatars",!0))},legacyOnTeamPrefChanged:function(e){"msg_edit_window_mins"===e.name?TS.prefs.setTeamPrefLocal("msg_edit_window_mins",e.value):"allow_message_deletion"===e.name?TS.prefs.setTeamPrefLocal("allow_message_deletion",!!e.value):"hide_referers"===e.name?(TS.prefs.setTeamPrefLocal("hide_referers",!!e.value),TS.prefs.team_hide_referers_changed_sig.dispatch()):"display_real_names"===e.name?(TS.prefs.setTeamPrefLocal("display_real_names",!!e.value),TS.prefs.team_display_real_names_changed_sig.dispatch()):"display_email_addresses"===e.name?(TS.prefs.setTeamPrefLocal("display_email_addresses",!!e.value),TS.prefs.team_display_email_addresses_changed_sig.dispatch()):0===e.name.indexOf("who_can_")?TS.prefs.getTeamPref(e.name)!=e.value&&(TS.prefs.setTeamPrefLocal(e.name,e.value),TS.prefs.team_perms_pref_changed_sig.dispatch(e.name)):"compliance_export_start"===e.name?TS.prefs.getTeamPref("compliance_export_start")!=e.value&&(TS.prefs.setTeamPrefLocal("compliance_export_start",e.value),TS.prefs.compliance_export_start_changed_sig.dispatch()):"disallow_public_file_urls"===e.name?(TS.prefs.setTeamPrefLocal("disallow_public_file_urls",!!e.value),TS.prefs.team_disallow_public_file_urls_changed_sig.dispatch()):"auth_mode"===e.name?(TS.prefs.setTeamPrefLocal("auth_mode",e.value),TS.prefs.team_auth_mode_changed_sig.dispatch()):"sso_auth_restrictions"===e.name?(TS.prefs.setTeamPrefLocal("sso_auth_restrictions",e.value),TS.prefs.team_sso_auth_restrictions_changed_sig.dispatch()):"dnd_enabled"===e.name?(TS.prefs.setTeamPrefLocal("dnd_enabled",e.value),TS.prefs.team_dnd_enabled_changed_sig.dispatch()):"dnd_start_hour"===e.name?(TS.prefs.setTeamPrefLocal("dnd_start_hour",e.value),TS.prefs.team_dnd_start_hour_changed_sig.dispatch()):"dnd_end_hour"===e.name?(TS.prefs.setTeamPrefLocal("dnd_end_hour",e.value),TS.prefs.team_dnd_end_hour_changed_sig.dispatch()):"invites_only_admins"===e.name?(TS.prefs.setTeamPrefLocal("invites_only_admins",e.value),TS.prefs.team_invites_only_admins_changed_sig.dispatch()):"allow_calls"===e.name?(TS.prefs.setTeamPrefLocal("allow_calls",e.value),TS.prefs.team_allow_calls_changed_sig.dispatch()):"calling_app_id"===e.name?(TS.prefs.setTeamPrefLocal("calling_app_id",e.value),TS.prefs.team_calling_app_id_changed_sig.dispatch()):"calling_app_name"===e.name?(TS.prefs.setTeamPrefLocal("calling_app_name",e.value),TS.prefs.team_calling_app_name_changed_sig.dispatch()):"disable_file_editing"===e.name?(TS.prefs.setTeamPrefLocal("disable_file_editing",e.value),TS.prefs.team_disable_file_editing_changed_sig.dispatch()):"disable_file_deleting"===e.name?(TS.prefs.setTeamPrefLocal("disable_file_deleting",e.value),TS.prefs.team_disable_file_deleting_changed_sig.dispatch()):"uses_customized_custom_status_presets"===e.name?(TS.prefs.setTeamPrefLocal(e.name,e.value),TS.prefs.team_uses_customized_custom_status_presets_changed_sig.dispatch()):"loud_channel_mentions_limit"===e.name?(TS.prefs.setTeamPrefLocal(e.name,e.value),TS.prefs.team_loud_channel_mentions_limit_changed_sig.dispatch()):"enable_shared_channels"===e.name?(TS.prefs.setTeamPrefLocal(e.name,e.value),TS.prefs.enable_shared_channels_changed_sig.dispatch()):"dropbox_legacy_picker"===e.name?(TS.prefs.setTeamPrefLocal(e.name,e.value),TS.prefs.dropbox_enabled_changed_sig.dispatch()):TS.prefs.setTeamPrefLocal(e.name,e.value)},getPref:function(e){return TS.redux.prefs.getUserPref(e)},setPrefLocal:function(e,t){TS.redux.prefs.setUserPref(e,t)},getTeamPref:function(e){return TS.redux.prefs.getTeamPref(e)},setTeamPrefLocal:function(e,t){TS.redux.prefs.setTeamPref(e,t)},legacyOnPrefChanged:function(e){switch(e.name){case"all_notifications_prefs":TS.prefs.setPrefLocal("all_notifications_prefs",e.value),TS.prefs.all_notifications_prefs_changed_sig.dispatch(e.value);break;case"locale":TS.prefs.setPrefLocal("locale",e.value),TS.prefs.locale_changed_sig.dispatch(e.value);break;case"flannel_server_pool":TS.prefs.setPrefLocal("flannel_server_pool",e.value);break;case"color_names_in_list":TS.prefs.setPrefLocal("color_names_in_list",!!e.value),TS.prefs.color_names_in_list_changed_sig.dispatch();break;case"display_real_names_override":TS.prefs.setPrefLocal("display_real_names_override",e.value),TS.prefs.display_real_names_override_changed_sig.dispatch();break;case"growls_enabled":TS.prefs.setPrefLocal("growls_enabled",!!e.value),TS.prefs.dtop_notif_changed_sig.dispatch();break;case"sidebar_theme":TS.prefs.getPref("sidebar_theme")!==e.value&&(TS.prefs.setPrefLocal("sidebar_theme",e.value),TS.prefs.sidebar_theme_changed_sig.dispatch());break;case"sidebar_theme_custom_values":TS.prefs.getPref("sidebar_theme_custom_values")!==e.value&&(TS.prefs.setSidebarThemeCustomValues(JSON.parse(e.value)),TS.prefs.sidebar_theme_changed_sig.dispatch());break;case"expand_inline_imgs":TS.prefs.setPrefLocal("expand_inline_imgs",!!e.value),TS.prefs.expand_inline_imgs_changed_sig.dispatch();break;case"webapp_spellcheck":TS.prefs.setPrefLocal("webapp_spellcheck",!!e.value),TS.prefs.webapp_spellcheck_changed_sig.dispatch();break;case"expand_internal_inline_imgs":TS.prefs.setPrefLocal("expand_internal_inline_imgs",!!e.value),TS.prefs.expand_internal_inline_imgs_changed_sig.dispatch();break;case"expand_non_media_attachments":TS.prefs.setPrefLocal("expand_non_media_attachments",!!e.value),TS.prefs.expand_non_media_attachments_changed_sig.dispatch();break;case"messages_theme":TS.prefs.setPrefLocal("messages_theme",e.value),TS.prefs.setTheme(),TS.prefs.messages_theme_changed_sig.dispatch();break;case"highlight_words":TS.prefs.setHighlightWords(e.value),TS.prefs.highlight_words_changed_sig.dispatch();break;case"at_channel_suppressed_channels":TS.prefs.setSuppressedChannels(e.value),TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_at_channel_suppressed_channels":TS.prefs.setPushSuppressedChannels(e.value),TS.prefs.push_changed_sig.dispatch();break;case"loud_channels":TS.prefs.setLoudChannels(e.value);break;case"never_channels":TS.prefs.setNeverChannels(e.value);break;case"muted_channels":TS.boot_data.feature_tinyspeck&&TS.interop.console.info("PREFS","muted_channels updated: "+e.value),TS.prefs.setMutedChannels(e.value),TS.prefs.muted_channels_changed_sig.dispatch();break;case"loud_channels_set":TS.prefs.setLoudChannelsSet(e.value),TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_loud_channels":TS.prefs.setPushLoudChannels(e.value);break;case"push_mention_channels":TS.prefs.setPushMentionChannels(e.value);break;case"push_loud_channels_set":TS.prefs.setPushLoudChannelsSet(e.value),TS.prefs.push_changed_sig.dispatch();break;case"emoji_use":TS.prefs.mergeEmojiUse(e.value)&&TS.emoji.maybeRemakeMenuListsIfFrequentsChanged();break;case"user_colors":_.each(_.keys(TS.model.user_colors),(function(e){var t=TS.interop.members.getMemberById(e);t&&TS.members.setMemberUserColor(t,t.color)})),TS.prefs.setUserColors(e.value),_.forOwn(TS.model.user_colors,(function(e,t){var n=TS.interop.members.getMemberById(t);n&&TS.members.setMemberUserColor(n,e)}));break;case"graphic_emoticons":TS.rxns.clearHandyRxnsDisplayDataCache(),TS.prefs.setPrefLocal("graphic_emoticons",e.value),TS.emoji.setEmojiMode(),TS.prefs.emoji_mode_changed_sig.dispatch();break;case"ss_emojis":TS.prefs.setPrefLocal("ss_emojis",e.value),TS.emoji.setEmojiMode(),TS.prefs.emoji_mode_changed_sig.dispatch(),TS.emoji.makeMenuLists();break;case"emoji_mode":TS.rxns.clearHandyRxnsDisplayDataCache();var t=e.value;"as_text"!==e.value&&(t=TS.interop.rules.emoji.getEmojiMode({forceDisplay:!0})),TS.emoji.setEmojiMode(t),TS.prefs.setPrefLocal("emoji_mode",e.value),TS.prefs.emoji_mode_changed_sig.dispatch(),TS.emoji.makeMenuLists();break;case"obey_inline_img_limit":TS.prefs.setPrefLocal("obey_inline_img_limit",e.value),TS.prefs.obey_inline_img_limit_changed_sig.dispatch();break;case"search_only_my_channels":case"search_only_current_team":case"search_exclude_bots":break;case"search_exclude_channels":TS.prefs.setSearchExcludeChannels(e.value),TS.prefs.search_exclude_channels_changed_sig.dispatch();break;case"has_uploaded":TS.prefs.setPrefLocal("has_uploaded",!!e.value);break;case"has_invited":TS.prefs.setPrefLocal("has_invited",!!e.value);break;case"has_created_channel":TS.prefs.setPrefLocal("has_created_channel",!!e.value);break;case"no_joined_overlays":TS.prefs.setPrefLocal("no_joined_overlays",!!e.value);break;case"no_created_overlays":TS.prefs.setPrefLocal("no_created_overlays",!!e.value);break;case"seen_welcome_2":TS.prefs.setPrefLocal("seen_welcome_2",!!e.value),TS.prefs.seen_welcome_2_changed_sig.dispatch();break;case"box_enabled":TS.prefs.setPrefLocal("box_enabled",!!e.value),TS.prefs.box_enabled_changed_sig.dispatch();break;case"dropbox_enabled":TS.prefs.setPrefLocal("dropbox_enabled",!!e.value),TS.prefs.dropbox_enabled_changed_sig.dispatch();break;case"mark_msgs_read_immediately":TS.prefs.getPref("mark_msgs_read_immediately")!==!!e.value&&(TS.prefs.setPrefLocal("mark_msgs_read_immediately",!!e.value),TS.prefs.read_changed_sig.dispatch());break;case"start_scroll_at_oldest":TS.prefs.getPref("start_scroll_at_oldest")!==!!e.value&&(TS.prefs.setPrefLocal("start_scroll_at_oldest",!!e.value),TS.prefs.read_changed_sig.dispatch());break;case"mac_ssb_bullet":TS.prefs.getPref("mac_ssb_bullet")!==!!e.value&&(TS.prefs.setPrefLocal("mac_ssb_bullet",!!e.value),TS.prefs.mac_ssb_bullet_changed_sig.dispatch());break;case"all_channels_loud":TS.prefs.getPref("all_channels_loud")!==!!e.value&&(TS.prefs.setPrefLocal("all_channels_loud",!!e.value),TS.prefs.dtop_notif_changed_sig.dispatch());break;case"push_everything":TS.prefs.getPref("push_everything")!==!!e.value&&(TS.prefs.setPrefLocal("push_everything",!!e.value),TS.prefs.push_changed_sig.dispatch());break;case"push_mention_alert":TS.prefs.getPref("push_mention_alert")!==!!e.value&&(TS.prefs.setPrefLocal("push_mention_alert",!!e.value),TS.prefs.push_changed_sig.dispatch());break;case"push_dm_alert":TS.prefs.getPref("push_dm_alert")!==!!e.value&&(TS.prefs.setPrefLocal("push_dm_alert",!!e.value),TS.prefs.push_changed_sig.dispatch());break;case"time24":TS.prefs.getPref("time24")!==!!e.value&&(TS.prefs.setPrefLocal("time24",!!e.value),TS.prefs.time24_changed_sig.dispatch());break;case"sidebar_behavior":TS.prefs.getPref("sidebar_behavior")!=e.value&&(TS.prefs.setPrefLocal("sidebar_behavior",e.value),TS.prefs.sidebar_behavior_changed_sig.dispatch());break;case"two_factor_update_seen":TS.model.two_factor_update_seen!=e.value&&(TS.mode.prefs.two_factor_update_seen=e.value,TS.prefs.two_factor_update_seen_changed_sig.dispatch());break;case"privacy_policy_seen":TS.prefs.getPref("privacy_policy_seen")!=e.value&&(TS.prefs.setPrefLocal("privacy_policy_seen",e.value),TS.prefs.privacy_policy_seen_changed_sig.dispatch());break;case"last_seen_at_channel_warning":TS.prefs.getPref("last_seen_at_channel_warning")!=e.value&&TS.prefs.setPrefLocal("last_seen_at_channel_warning",e.value);break;case"mentions_exclude_at_channels":TS.prefs.getPref("mentions_exclude_at_channels")!=e.value&&(TS.prefs.setPrefLocal("mentions_exclude_at_channels",e.value),TS.prefs.mentions_exclude_at_channels_changed_sig.dispatch());break;case"mentions_exclude_at_user_groups":TS.prefs.getPref("mentions_exclude_at_user_groups")!=e.value&&(TS.prefs.setPrefLocal("mentions_exclude_at_user_groups",e.value),TS.prefs.mentions_exclude_at_user_groups_changed_sig.dispatch());break;case"no_invites_widget_in_sidebar":TS.prefs.getPref("no_invites_widget_in_sidebar")!=e.value&&(TS.prefs.setPrefLocal("no_invites_widget_in_sidebar",e.value),TS.prefs.no_invites_widget_in_sidebar_changed_sig.dispatch());break;case"k_key_omnibox_auto_hide_count":TS.prefs.getPref("k_key_omnibox_auto_hide_count")!=e.value&&(TS.prefs.setPrefLocal("k_key_omnibox_auto_hide_count",e.value),TS.prefs.k_key_omnibox_auto_hide_count_changed_sig.dispatch());break;case"show_sidebar_quickswitcher_button":TS.prefs.getPref("show_sidebar_quickswitcher_button")!=e.value&&TS.prefs.setPrefLocal("show_sidebar_quickswitcher_button",e.value);break;case"preferred_skin_tone":TS.prefs.getPref("preferred_skin_tone")!=e.value&&(TS.rxns.clearHandyRxnsDisplayDataCache(),TS.prefs.setPrefLocal("preferred_skin_tone",e.value),TS.prefs.preferred_skin_tone_changed_sig.dispatch());break;case"separate_private_channels":TS.prefs.getPref("separate_private_channels")!=e.value&&(TS.prefs.setPrefLocal("separate_private_channels",e.value),TS.prefs.separate_private_channels_changed_sig.dispatch());break;case"separate_shared_channels":TS.prefs.getPref("separate_shared_channels")!=e.value&&(TS.prefs.setPrefLocal("separate_shared_channels",e.value),TS.prefs.separate_shared_channels_changed_sig.dispatch());break;case"whats_new_read":TS.prefs.getPref("whats_new_read")!=e.value&&(TS.prefs.setPrefLocal("whats_new_read",e.value),TS.prefs.whats_new_read_changed_sig.dispatch());break;case"tz":TS.prefs.getPref("tz")!=e.value&&(TS.prefs.setPrefLocal("tz",e.value),TS.prefs.tz_changed_sig.dispatch());break;case"keyboard":TS.prefs.getPref("keyboard")!=e.value&&(TS.prefs.setPrefLocal("keyboard",e.value),TS.prefs.keyboard_changed_sig.dispatch());break;case"msg_input_send_btn":TS.prefs.getPref("msg_input_send_btn")!=e.value&&(TS.prefs.setPrefLocal("msg_input_send_btn",e.value),TS.prefs.msg_input_send_btn_changed_sig.dispatch());break;case"msg_input_send_btn_auto_set":TS.prefs.getPref("msg_input_send_btn_auto_set")!=e.value&&(TS.prefs.setPrefLocal("msg_input_send_btn_auto_set",e.value),TS.prefs.msg_input_send_btn_auto_set_changed_sig.dispatch());break;case"frecency_jumper":if(TS.ui.frecency.isEnterprise())break;TS.prefs.conditionallyClogFrecencyDueToSizeChange("PREF_USER_TEAM_FRECENCY_SHRINKAGE",JSON.stringify(TS.model.frecency_jumper),e.value),TS.prefs.mergeFrecencyJumper(e.value)&&TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"frecency_ent_jumper":TS.prefs.conditionallyClogFrecencyDueToSizeChange("PREF_USER_ORG_FRECENCY_SHRINKAGE",JSON.stringify(TS.model.frecency_jumper),e.value),TS.log(666,"Received a pref_change event for frecency_ent_jumper."),TS.prefs.mergeFrecencyJumper(e.value)&&TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"jumbomoji":TS.prefs.getPref("jumbomoji")!=e.value&&(TS.prefs.setPrefLocal("jumbomoji",e.value),TS.prefs.jumbomoji_changed_sig.dispatch());break;case"hide_hex_swatch":TS.prefs.getPref("hide_hex_swatch")!=e.value&&(TS.prefs.setPrefLocal("hide_hex_swatch",e.value),TS.prefs.hide_hex_swatch_changed_sig.dispatch());break;case"a11y_animations":TS.prefs.getPref("a11y_animations")!==e.value&&(TS.prefs.setPrefLocal("a11y_animations",e.value),TS.prefs.a11y_animations_changed_sig.dispatch());break;case"show_memory_instrument":TS.prefs.getPref("show_memory_instrument")!==e.value&&(TS.prefs.setPrefLocal("show_memory_instrument",e.value),TS.prefs.show_memory_instrument_changed_sig.dispatch());break;case"channel_sort":TS.prefs.getPref("channel_sort")!==e.value&&(TS.prefs.setPrefLocal("channel_sort",e.value),TS.prefs.setChannelSort(TS.prefs.getPref("channel_sort")),TS.prefs.channel_sort_changed_sig.dispatch());break;case"enable_unread_view":TS.prefs.getPref("enable_unread_view")!==e.value&&(TS.prefs.setPrefLocal("enable_unread_view",e.value),TS.prefs.enable_unread_view_changed_sig.dispatch());break;case"enable_react_emoji_picker":TS.prefs.getPref("enable_react_emoji_picker")!==e.value&&(TS.prefs.setPrefLocal("enable_react_emoji_picker",e.value),TS.prefs.enable_react_emoji_picker_changed_sig.dispatch());break;case"client_logs_pri":TS.prefs.setPrefLocal(e.name,e.value),TS.console.setAppropriatePri();break;case"email_alerts":TS.prefs.setPrefLocal(e.name,e.value),TS.prefs.email_alerts_changed_sig.dispatch();break;default:TS.prefs.setPrefLocal(e.name,e.value)}},onLocaleChanged:function(e){TS.prefs.locale_changed_sig.dispatch(e)},hex_regex:new RegExp(/^#?([0-9a-f]{6})$/i),conditionallyClogFrecencyDueToSizeChange:function(e,t,n){n.length/t.length<.1&&TS.interop.clog.track(e,{updated_user_client_prefs:{existing_frecency:t,new_frecency:n}})},setSidebarThemeCustomValues:function(e){var t=!1;e&&"object"===i(e)&&void 0===e.length&&_.forOwn(e,(function(n,i){return t=!1,!!n&&(!!n.substr&&(e[i]=n.substr(0,7),!!n.match(TS.prefs.hex_regex)&&void(t=!0)))})),t?TS.prefs.setPrefLocal("sidebar_theme_custom_values",JSON.stringify(e)):(TS.prefs.setPrefLocal("sidebar_theme","default"),TS.prefs.setPrefLocal("sidebar_theme_custom_values",JSON.stringify(TS.sidebar_themes.default_themes.default_theme)))},setMultiPrefsByAPI:function(e,t){var n="";if(_.forOwn(e,(function(e,t){n+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e)})),n){var i={prefs:n};return TS.prefs.setPrefByAPI(i,t)}TS.error(" no prefs to set?")},setPrefByAPI:function(e,t){return TS.interop.api.callExpedited("users.prefs.set",e).then((function(e){var n=e.data,i=e.args;if(n&&n.prefs&&i){var r=i.name&&[i.name]||_.keys(TS.interop.url.queryStringParse(i.prefs));_.forEach(r,(function(e){return TS.prefs.legacyOnPrefChanged({name:e,value:n.prefs[e]})}))}if(t)return t(!0,n,i)})).catch((function(e){var t,n=e.args;n.hasOwnProperty("name")?t="pref name: "+n.name:n.prefs&&(t="(multiple prefs)"),TS.interop.utility.getLogger({getState:TS.redux.getState}).error(t,"TS.prefs.setPrefByAPI call got a not ok rsp",{subtype:"API response error"}),setTimeout((function(){n.prefs?TS.error("multi preferences setting failed."):TS.error('"'+n.name+'" preference setting failed.')}),0)}))},setTeamPrefByAPI:function(e,t,n){return TS.interop.api.callExpedited("team.prefs.set",{prefs:JSON.stringify(e)}).then((function(t){var i=t.data;TS.web&&(n=n||[],Object.keys(e).concat(n).forEach((function(t){i.prefs.hasOwnProperty(t)&&(e.hasOwnProperty(t)||TS.prefs.getTeamPref(t)!==i.prefs[t])&&TS.prefs.legacyOnTeamPrefChanged({name:t,value:i.prefs[t]})})));return Promise.resolve(i.prefs)})).catch((function(e){var n=e.data;return t&&t(n),Promise.reject(n)}))},removeTeamFromEnterpriseExcludeTeamPref:function(e){if(TS.boot_data.page_needs_enterprise){var t=TS.prefs.getPref("enterprise_excluded_app_teams");if(t){var n=t?t.split(","):[];_.pull(n,e),TS.prefs.setPrefByAPI({name:"enterprise_excluded_app_teams",value:n.join(",")})}}}});var e=!1}()},"9mk2":function(e,t){TS.registerModule("help",{issues_sorted_sig:new signals.Signal,issues:[],fake_api_rsps:!1,max_title_chars:100,getIssueById:function(e){for(var t,n=0;n<TS.help.issues.length;n+=1)if((t=TS.help.issues[n]).id==e)return t;return null},onListIssues:function(e,t){TS.help.fake_api_rsps?TS.help.issues=[{id:"T00001",title:"issue 1",ts:"1111111111",short_text:"blah blah blah blah blah",state:"resolved"},{id:"T00002",title:"issue 2",ts:"1141111111",short_text:"I think this is ok",state:"open"},{id:"T00003",title:"issue 3",ts:"1121111111",short_text:"but I am not so sure abotu this",state:"unread"},{id:"T00004",title:"issue 4",ts:"1161111111",short_text:"what about that?",state:"open"},{id:"T00005",title:"issue 5",ts:"1151111111",short_text:"fuck it all to hell",state:"open"},{id:"T00006",title:"issue 6",ts:"1171111111",short_text:"MORE BATTRY PLZ",state:"read"},{id:"T00007",title:"issue 7",ts:"1191111111",short_text:"halp",state:"unread"},{id:"T00008",title:"issue 8",ts:"191111111",short_text:"halp",state:"unread"},{id:"T00009",title:"issue 9",ts:"181111111",short_text:"halp",state:"unread"},{id:"T000010",title:"issue 10",ts:"171111111",short_text:"halp halp halp halp halp halp halp halp halp halp ...",state:"unread"}]:e&&(TS.help.issues=t.issues),TS.help.sortIssues(),TS.help.updateIcon()},sortIssues:function(){for(var e,t={unread:4,open:3,read:2,resolved:1},n=0;n<TS.help.issues.length;n+=1)(e=TS.help.issues[n])._sorter=parseFloat((t[e.state]||5)+"."+e.ts);TS.help.issues.sort((function(e,t){return e._sorter<t._sorter?1:e._sorter>t._sorter?-1:0})),TS.help.issues_sorted_sig.dispatch()},updateIcon:function(){for(var e="normal",t=0,n=0;n<TS.help.issues.length;n+=1)"unread"===TS.help.issues[n].state&&(e="unread",t+=1);$("#flex_menu_toggle").removeClass("normal open unread").addClass(e),$("#help_toggle").removeClass("normal open unread").addClass(e),$("#help_icon_circle_count, .help_icon_circle_count").addClass("hidden"),t>9&&(t="9+"),t&&$("#help_icon_circle_count, .help_icon_circle_count").removeClass("hidden").text(t)},createIssue:function(e,t){var n=e.title,i=e.text;if(n){var r={title:n,text:i=i||""};e.tags&&(r.tags=e.tags);var a=function(e,r){if(!e&&TS.help.fake_api_rsps){var a={id:Date.now(),title:n,ts:Date.now()/1e3,short_text:i.substr(0,50),state:"open"};setTimeout((function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_created",issue:a}))}),2e3)}t&&t(e,TS.help.makeErrStr(r))};TS.interop.api.call("help.issues.create",r).then((function(e){var t=e.data,n=e.args,i=e.request_id;return a(!0,t),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return a(!1,t),{data:t,args:n,request_id:i}}))}},markIssueRead:function(e,t){var n=TS.help.getIssueById(e);if(n)if("unread"===n.state){var i=function(e,i){if(!e&&TS.help.fake_api_rsps){var r=_.cloneDeep(n);r.state="read",setTimeout((function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_change",issue:r}))}),2e3)}t&&t(e,TS.help.makeErrStr(i))};TS.interop.api.call("help.issues.markRead",{id:e}).then((function(e){var t=e.data,n=e.args,r=e.request_id;return i(!0,t),{data:t,args:n,request_id:r}})).catch((function(e){var t=e.data,n=e.args,r=e.request_id;return i(!1,t),{data:t,args:n,request_id:r}}))}else t&&t(!0);else t&&t(!1,"unknown issue")},markIssueResolved:function(e,t){var n=TS.help.getIssueById(e);if(n){var i=function(e,i){if(TS.help.fake_api_rsps||!e&&i&&"ticket_closed"===i.error){e=!0;var r=_.cloneDeep(n);r.state="resolved",setTimeout((function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_change",issue:r}))}),1e3)}t&&t(e,TS.help.makeErrStr(i))};TS.interop.api.call("help.issues.markResolved",{id:e}).then((function(e){var t=e.data,n=e.args,r=e.request_id;return i(!0,t),{data:t,args:n,request_id:r}})).catch((function(e){var t=e.data,n=e.args,r=e.request_id;return i(!1,t),{data:t,args:n,request_id:r}}))}else t&&t(!1,"unknown issue")},onIssueChange:function(e){var t=TS.help.getIssueById(e.id);t?TS.help.updateIssue(e,t):TS.help.issues.push(e),TS.help.sortIssues(),TS.help.updateIcon()},updateIssue:function(e,t){_.forOwn(e,(function(e,n){t[n]=e})),t.comments&&t.comments.sort((function(e,t){return e.ts<t.ts?1:e.ts>t.ts?-1:0}))},makeErrStr:function(e){if(!e)return"missing data";if(e.ok)return null;if(e.error&&e.info&&TS.boot_data.feature_tinyspeck)try{return'api error: "'+e.error+'"<br><br><div class="admin-section" style="word-wrap: break-word; word-break: break-word;">api rsp: '+JSON.stringify(e).replace(/,/g,", ")+"</div>"}catch(e){}return e.error?'api error: "'+e.error+'"':void 0}})},Bnag:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},Chwb:function(e,t){!function(){TS.registerModule("menu.member",{member:null,member_item_click_sig:new signals.Signal,onStart:function(){},startWithEditMemberProfilePhotoActions:function(e,t){if(!TS.menu.isRedundantClick(e)&&!TS.model.menu_is_showing){TS.menu.buildIfNeeded();var n=!0===TS.model.user.profile.is_custom_image,i=$(e.target),r=i.is(".btn"),a={show_delete:n&&!r,is_iOS:TS.model.is_iOS};TS.menu.clean(),TS.menu.$menu_header.addClass("hidden").empty(),TS.menu.$menu_items.html(TS.templates.menu_edit_member_profile_photo_action_items(a)),TS.menu.$menu_items.on("click.menu","li",t),TS.menu.start(e,null,{menu_class:"member_menu"}),r?TS.menu.positionAt(i,0,i.outerHeight()+5):TS.menu.positionAt(i.closest('[data-action="edit_member_profile_photo_menu"]'),36,156),TS.menu.keepInBounds()}},startWithEnterpriseMemberHeader:function(t){if(!TS.menu.isRedundantClick(t)&&!TS.model.menu_is_showing){TS.menu.buildIfNeeded(),TS.menu.clean();var n={enterprise_name:$("[data-enterprise-name]").val(),signout_url:TS.boot_data.signout_url};TS.menu.$menu_header.addClass("hidden").empty(),TS.menu.$menu_items.html(TS.templates.menu_enterprise_member_header(n)),TS.menu.$menu_items.on("click.menu","li",e),TS.kb_nav.setSubmitItemHandler(e),TS.menu.start(t,null,{menu_class:"member_menu"});var i=$("[data-header-menu-toggle]"),r=-TS.menu.$menu.outerWidth()+i.outerWidth(),a=i.outerHeight()+15;TS.menu.positionAt(i,r,a),t.preventDefault()}},end:function(){TS.menu.member.member=null,TS.menu.end(),TS.menu.clean()}});var e=function(e){var t=$(this).attr("id");"sign_out"!==t&&"view_account"!==t&&(e.preventDefault(),TS.warn("not sure what to do with clicked element id:"+t))}}()},Cs7e:function(e,t){var n;!function(){TS.registerModule("menu",{$menu:null,$submenu:null,$submenu_origin:null,$submenu_parent:null,$menu_header:null,$menu_items:null,$menu_list_container:null,$menu_list:null,$menu_footer:null,menu_lazy_load:null,user_group:null,end_tim:0,$target_element:null,$secondary_target_element:null,large_dom_trigger:500,menu_items_hidden:!0,has_submenu:!1,menu_closed_sig:new signals.Signal,onStart:function(){},buildIfNeeded:_.once((function(){TS.menu.$menu=$(TS.templates.menu());var e=TS.menu.$menu;if("mobile"!==TS.boot_data.app&&"0"!=TS.qs_args.new_scroll){if(e.appendTo($("body")),!TS.environment.supports_custom_scrollbar){var t="1"==TS.qs_args.debug_scroll;e.find("#menu_items_scroller").monkeyScroll({debug:t})}e.detach()}TS.menu.$menu_header=e.find("#menu_header"),TS.menu.$menu_body=e.find(".menu_body"),TS.menu.$menu_list_container=e.find("#menu_list_container"),TS.menu.$menu_list=e.find("#menu_list"),TS.menu.$menu_items=e.find("#menu_items"),TS.menu.$menu_footer=e.find("#menu_footer")})),startWithList:function(e,n,i){if(n&&n.length&&!TS.menu.isRedundantClick(e))if(i=i||{},TS.menu.buildIfNeeded(),TS.menu.clean(),TS.menu.$menu_header.addClass("hidden").empty(),TS.menu.$menu_items.html(n.html()),TS.menu.$menu.addClass(i.menu_class),(i.close_on_click||i.onClick)&&TS.menu.$menu_items.on("click.menu","li",(function(e){"function"==typeof i.onClick&&i.onClick(e),i.close_on_click&&TS.menu.end()})),TS.menu.start(e,void 0,i),i.attach_to_target_at_full_width)TS.menu.$menu.css({width:"100%",top:"calc(100% + 3px)",left:"0"});else{var r=t(i.align_right);TS.menu.positionAt(TS.menu.$target_element,r.left,r.top)}},startWithMessageActions:function(e,t,n,i){if(TS.interop.connectivity.isOnline()){if(!TS.menu.isRedundantClick(e)&&!TS.model.menu_is_showing){TS.menu.buildIfNeeded(),TS.menu.clean(),i=i||TS.shared.legacyGetActiveModelOb();var r=TS.redux.messages.getMessageByTimestamp(i.id,t),a=$(e.target),s=TS.interop.constants.MessageContainers.MESSAGE_PANE;a.closest("ts-conversation").length>0?s=TS.interop.constants.MessageContainers.THREADS_FLEXPANE:a.closest("#threads_msgs").length>0?s=TS.interop.constants.MessageContainers.THREADS_VIEW:a.closest("#unread_msgs_div").length>0&&(s=TS.interop.constants.MessageContainers.UNREAD_VIEW),TS.ui.react_message_menu.showMessageMenu(e,{channel:i,message:r,message_container_type:s})}}else TS.sounds.play("beep")},did_start_slack_menu_signal_listeners:!1,stopListeningForRebuildWorthiness:function(){TS.menu.did_start_slack_menu_signal_listeners=!1},onTeamAndUserItemMouseenter:function(e){if(($(this).hasClass("has_submenu")&&"member_current_status_item"!==$(this).attr("id")||!TS.menu._current_status_input||!TS.menu._current_status_input.isEdited())&&(TS.menu.$submenu&&TS.menu.$submenu_parent&&TS.menu.$submenu_parent.submenu("destroy"),$(e.currentTarget).hasClass("has_submenu"))){var t=$(this).attr("id")||$(this).data("action"),n=TS.menu.$menu_body,i={};switch(TS.menu.submenu_template_args[t]&&(i=TS.menu.submenu_template_args[t]),t){case"administration":if(TS.model.user.enterprise_user&&(TS.model.user.enterprise_user.is_admin||TS.model.user.enterprise_user.is_owner))i.show_org_settings=!0,i.enterprise_domain=TS.boot_data.enterprise_url+"/manage";else{var r=TS.interop.desktop.isAppStoreBuild(),a=(TS.model.user.is_owner||TS.prefs.getPref("purchaser"))&&!r;TS.interop.members.isAppmin()?i.show_apps_link=!0:a&&(i.show_billing_link=a),TS.prefs.getPref("seen_administration_menu")||TS.prefs.setPrefByAPI({name:"seen_administration_menu",value:!0})}i.is_admin=TS.menu.isAdminOrOwner(),i.can_create_shared_channel=TS.interop.rules.user.canUserApproveExternalSharedChannels()||TS.interop.rules.user.canUserViewExternalSharedChannelRelationships(),TS.menu.$submenu_parent=n.find("#administration"),TS.menu.$submenu_parent.submenu({items_html:TS.templates.administration_items(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick});break;case"switch_teams":TS.menu.$submenu_parent=n.find("#switch_teams"),TS.menu.$submenu_parent.submenu({items_html:TS.templates.switch_teams_items(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick});break;case"team_invitations":e.preventDefault(),TS.interop.mountInviteModal(TS.boot_data.team_id,{source:"team_menu"}),TS.interop.clog.track(this.getAttribute("data-clog-event"),this.getAttribute("data-clog-params"))}}},onTeamAndUserItemSubmenuClick:function(e){var t=$(e.target).closest("li");switch(t.attr("id")||t.data("action")){case"team_settings":TS.interop.clog.trackClickWithContext({event:"ADMIN_TEAM_MENU_ADMINISTRATION_SUBMENU_CLICK",element:"TEAM_MENU_ADMINISTRATION_TEAM_SETTINGS_BTN"});break;case"team_services":TS.interop.clog.trackClickWithContext({event:"ADMIN_TEAM_MENU_ADMINISTRATION_SUBMENU_CLICK",element:"TEAM_MENU_ADMINISTRATION_TEAM_SERVICES_BTN"});break;case"org_settings":TS.interop.clog.trackClickWithContext({event:"ADMIN_TEAM_MENU_ADMINISTRATION_SUBMENU_CLICK",element:"TEAM_MENU_ADMINISTRATION_ORG_SETTINGS_BTN"});break;case"switch_team":case"logout":case"enterprise_logout":break;case"enterprise_teams_dialog":e.preventDefault(),TS.ui.enterprise_teams_dialog.show(TS.model.user);break;case"manage_shared_channels":e.preventDefault(),TS.interop.mountManageSharedChannelsModal(TS.boot_data.team_id,{referringUiElement:"TEAM_MENU_ADMINISTRATION_MANAGE_SHARED_CHANNELS_BTN"});break;case"manage_team":TS.interop.clog.trackClickWithContext({event:"ADMIN_TEAM_MENU_ADMINISTRATION_SUBMENU_CLICK",element:"TEAM_MENU_ADMINISTRATION_MANAGE_TEAM_BTN"});break;default:return void(e&&e.target&&"_blank"===e.target.getAttribute("target")||e.preventDefault())}TS.menu.$submenu&&TS.menu.$submenu_parent&&TS.menu.$submenu_parent.submenu("destroy"),TS.menu.end()},onTeamAndUserItemClick:function(e){clearTimeout(TS.menu.end_time);var t=$(this);if(t.is("[disabled]")||t.hasClass("disabled"))e.preventDefault();else{var n=t.attr("id");switch(!n&&t.hasClass("switch_team")&&(n="switch_team"),n){case"leave_workspace":e.preventDefault(),TS.ui.leave_team_dialog.start(TS.model.team.id);break;case"workspaces":e.preventDefault(),TS.ui.workspaces.start();break;case"shared_channels_open_beta":case"shared_channels_open_beta_free_team":e.preventDefault();break;case"version_info":e.preventDefault(),TS.ui.showVersionInfo();break;case"member_account_item":e.preventDefault();break;case"team_settings":case"manage_team":case"team_billing":case"team_services":case"team_customize":case"team_statistics":case"limit_meter":case"team_apps":TS.telemeter.count("team_menu_download_apps");break;case"team_invitations":e.preventDefault(),TS.interop.mountInviteModal(TS.boot_data.team_id,{source:"team_menu"}),TS.interop.clog.track(this.getAttribute("data-clog-event"),this.getAttribute("data-clog-params"));break;case"member_prefs_item":e.preventDefault(),TS.redux.dispatch(TS.interop.redux.actions.openPrefsModal());break;case"team_help":e.preventDefault();break;case"add_team":case"enterprise_login":TS.interop.desktop.isDesktop&&(TS.interop.desktop.signInTeam(),e.preventDefault());break;case"member_presence":return e.preventDefault(),TS.redux.presence.toggleUserPresence(),void(TS.menu.end_time=setTimeout(TS.menu.end,1e3));case"logout":if(e.preventDefault(),TS.interop.desktop.isDesktop&&TS.interop.desktop.canSignOut()){TS.interop.desktop.legacySignOutTeam(TS.model.team.id);break}TS.utility.loadUrlInWindowIfOnline(TS.boot_data.logout_url);break;case"enterprise_logout":if(TS.interop.environment.isWindows()&&TS.interop.environment.isElectronAndAtLeastVersion("3.0.0")){e.preventDefault();var i=new URL(TS.boot_data.enterprise_logout_url);i.search="",window.location=i}break;case"switch_team":var r=$(this).data("user-id");if(TS.interop.desktop.isDesktop)TS.interop.desktop.displayTeam(r),e.preventDefault();else{var a=$(this).find("a").attr("href");a&&-1==a.indexOf("?")&&$(this).find("a").attr("href",[a,TS.getQsArgsForUrl()].join("?"))}break;case"member_current_status_item":$(".team_name_caret").focus(),TS.redux.dispatch(TS.interop.redux.actions.openCustomStatusDialog());break;case"member_current_status_clear_item":TS.interop.members.updateCurrentMemberProfile({profile:{status_text:"",status_emoji:"",status_text_canonical:"",status_expiration:0}});break;case"team_pricing":if(!$(e.target).hasClass("see_upgrade_options_link"))return void e.preventDefault();break;default:return void e.preventDefault()}TS.menu.end()}},startWithEditTeamProfileListActions:function(e,t,n){if(!TS.menu.isRedundantClick(e)&&!TS.model.menu_is_showing){TS.menu.buildIfNeeded();var i=$(e.target),r=TS.team.getTeamProfileFieldById(i.data("id")),a={id:r.id,hidden:!(!r||!r.is_hidden),is_scim:n.is_scim};TS.menu.clean(),TS.menu.$menu_header.addClass("hidden").empty(),TS.menu.$menu_items.html(TS.templates.admin_menu_edit_team_profile_list_action_items(a)),TS.menu.$menu_items.on("click.menu","li",t),TS.menu.start(e),TS.menu.positionAt(i.find('[data-action="edit_team_profile_list_menu"]'),-(TS.menu.$menu.width()+6),0),TS.menu.keepInBounds()}},positionAt:function(e,t,n){t=t||0,n=n||0;var i=e.offset(),r=i.left+t,a=i.top+n;TS.menu.$menu.css({top:a,left:r})},isRedundantClick:function(e){return!(!e||!TS.menu.last_e||e.target!=TS.menu.last_e.target&&e.currentTarget!=TS.menu.last_e.currentTarget)},isLarge:function(){return TS.menu&&TS.menu.$menu&&TS.menu.$menu.find("li").length>TS.menu.large_dom_trigger},start:function(t,i,r){if(r=r||{},TS.menu.last_e=t,!e){var a=$(t.target).offset(),s=a.left+$(t.target).width()+10,o=a.top;i&&(s=t.pageX+10,o=t.pageY+10)}_.isFunction(r.needs_to_remain_open)&&(TS.menu.needs_to_remain_open=r.needs_to_remain_open),$(".tooltip").hide(),TS.tips.hideAll(),$(t.currentTarget).addClass("active"),TS.menu.$target_element=$(t.currentTarget),TS.model.menu_is_showing=!0;var l=TS.menu.$menu;r.onClose&&l.one("closed",r.onClose),r.menu_class&&l.addClass(r.menu_class);var d=TS.menu.isLarge();e||l.css({top:o,left:s});var c=l.find("#menu_items_scroller");c.scrollTop(0),r.attach_to_target_at_full_width?TS.menu.$target_element.after(l):l.appendTo($("body")),r.keep_menu_open_if_target_clicked_again&&TS.menu.$menu.addClass("keep_menu_open_if_target_clicked_again"),d||e?l.css("opacity",1):(l.css("opacity",0),l.stop().transition({opacity:1},200)),l.find(".menu_close").on("click",TS.menu.end),r.ignore_bounds||TS.menu.keepInBounds(),TS.ui.utility.updateClosestMonkeyScroller(c,!0),TS.menu.menu_lazy_load&&TS.menu.menu_lazy_load.detachEvents&&TS.menu.menu_lazy_load.detachEvents(),TS.menu.menu_lazy_load=TS.menu.$menu_items.find(".lazy").lazyload({container:$("#menu_items_scroller"),all_images_same_size:!0,throttle:250}),r.ignore_bounds||$(window).bind("resize",TS.menu.keepInBounds),$(window.document).bind("keydown",TS.menu.onKeyDown),$("html").bind("mousedown touchstart",TS.menu.onMouseDown);var u=l.find(".menu_list"),m=u.length?u:l.find("#menu_items");TS.menu.has_submenu?TS.kb_nav.start(m,"li:not(.divider)",l,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists}):TS.kb_nav.start(m,"li:not(.divider)");var p=u.length?u.first().find("a, button").first():null;TS.ui&&TS.ui.a11y&&TS.ui.a11y.focusAndAddTabindex(p),e=!1,n=r.on_esc},clean:function(){TS.menu.$menu_footer.empty(),TS.menu.$menu_header.removeClass("hidden"),TS.menu.$menu.removeClass("no_min_width no_max_width profile_preview flex_menu search_filter_menu popover_menu no_icons team_menu member_menu file_menu all_unreads_sort_order_menu searchable_member_list_filter_menu selectable member_file_filter_menu app_card keep_menu_open_if_target_clicked_again member_file_filter_menu").css("max-height",""),TS.menu.$menu.removeAttr("data-qa"),TS.menu.$menu.find("#menu_items_scroller").css("max-height",""),TS.menu.$menu.find(".arrow, .arrow_shadow").remove(),TS.menu.$menu_items.off("mouseenter.section_header"),TS.menu.$menu.removeClass("narrow_menu"),TS.menu.$menu_body.off("mouseenter.section_header"),TS.menu.needs_to_remain_open=void 0,TS.menu.$menu.removeClass("date_picker"),TS.boot_data.page_needs_enterprise&&(TS.menu.$menu_list_container.html('<div id="menu_list" role="menu"></div>').removeClass("populated"),TS.menu.$menu_list=TS.menu.$menu.find("#menu_list"),TS.menu.$menu.off("keydown","#file_member_filter .member_filter")),TS.menu.$menu.removeAttr("data-model-ob-id"),TS.menu.$menu.removeAttr("data-thread-ts"),TS.menu.$menu.find(".member_item")&&(TS.menu.$menu.find(".member_item").remove(),TS.menu.$menu.find(".list_items").css("height",0)),n=null},end:function(){if(!_.isFunction(TS.menu.needs_to_remain_open)||!TS.menu.needs_to_remain_open()){TS.menu.$submenu&&TS.menu.$submenu_parent&&TS.menu.$submenu_parent.submenu("destroy"),TS.menu.$menu.width(""),TS.model.menu_is_showing=!1,TS.menu.menu_items_hidden=!0,TS.menu.has_submenu=!1,TS.menu.$submenu_parent=null,TS.menu.submenu_template_args={},TS.menu.did_start_slack_menu_signal_listeners&&TS.menu.stopListeningForRebuildWorthiness();var t=TS.menu.$menu,n=function(){TS.model.menu_is_showing||(setTimeout((function(){TS.model.menu_is_showing||(TS.menu.last_e=null)}),50),t.detach(),TS.menu.$menu_header.empty(),TS.menu.$menu_footer.empty(),TS.menu.$menu_items.empty(),TS.menu.$menu_items.removeClass("hidden"),TS.menu.$menu_body.empty(),TS.menu.clean())};TS.menu.isLarge()||e?n():t.stop().transition({opacity:0},200,n),t.trigger("closed"),TS.menu.$target_element&&(TS.menu.$target_element.removeClass("active"),TS.menu.$target_element=null),TS.menu.$secondary_target_element&&(TS.menu.$secondary_target_element.removeClass("active"),TS.menu.$secondary_target_element=null),TS.menu.user_group=null,TS.menu.$menu_header.unbind("click.menu"),TS.menu.$menu_items.off("click.menu"),TS.menu.$menu_body.off("click.menu"),$(window).unbind("resize",TS.menu.keepInBounds),$(window.document).unbind("keydown",TS.menu.onKeyDown),$("html").unbind("mousedown touchstart",TS.menu.onMouseDown),TS.members.view.team_filter_changed_sig.remove(TS.kb_nav.clearHighlightedItem),$(".file_list_item.active").removeClass("active"),TS.tips.unhideAll(),TS.menu.search_filter_is_showing=!1,$("#search_filter_menu_label").removeClass("active"),$("#mentions_filter_menu_label").removeClass("active"),$("#flex_menu_toggle").removeClass("menu_open"),$("#channel_actions_toggle").removeClass("active"),$("#menu_member_dm_input").length&&TS.utility.contenteditable.unload($("#menu_member_dm_input")),t.removeClass("narrow_menu"),setTimeout((function(){TS.menu.file.file_list_menu_up=!1,$(".inline_file_preview_container.file_menu_open, .file_container.file_menu_open").removeClass("file_menu_open")}),100),TS.menu.menu_lazy_load&&TS.menu.menu_lazy_load.detachEvents&&(TS.menu.menu_lazy_load.detachEvents(),TS.menu.menu_lazy_load=null),TS.kb_nav.end(),TS.menu.menu_closed_sig.dispatch()}},onKeyDown:function(e){var t=TS.utility.keymap,i=e.which,r=e.metaKey||e.ctrlKey||e.altKey;if(i==t.esc){if(TS.utility.contenteditable.hasFocus($("#menu_member_dm_input")))return;e.stopPropagation(),e.preventDefault(),TS.menu.end(),n&&n()}else r||TS.utility.isArrowKey(i)||i==t.tab||i==t.enter||i==t.shift||(TS.kb_nav.clearHighlightedItem(),TS.utility.contenteditable.focus($("#menu_member_dm_input")))},onLeftKeyDownIfSubmenuExists:function(){var e=!1;if(TS.menu.$submenu&&TS.menu.$submenu.hasClass("kb_active")){TS.menu.$submenu.removeClass("kb_active"),TS.kb_nav.end(),TS.kb_nav.highlightItemWithKey(TS.menu.$submenu_origin);var t=TS.menu.$menu.find(".menu_list"),n=t.length?t:TS.menu.$menu.find("#menu_items");TS.kb_nav.start(n,"li:not(.divider)",TS.menu.$menu,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists}),-1===["member_current_status_item","switch_teams"].indexOf(TS.menu.$submenu_origin.attr("id"))&&TS.menu.$submenu_origin.submenu("destroy"),e=!0}return e},onRightKeyDownIfSubmenuExists:function(){var e=!1;return TS.menu.$submenu&&(TS.menu.$submenu.hasClass("kb_active")?(TS.menu.$submenu.removeClass("kb_active"),TS.menu.end()):(TS.menu.$submenu.addClass("kb_active"),TS.kb_nav.end(),TS.kb_nav.highlightItemWithKey(TS.menu.$submenu.find("li:not(.divider)").first()),TS.kb_nav.start(TS.menu.$submenu.find("ul"),"li:not(.divider)",TS.menu.$submenu,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists})),e=!0),e},onMouseDown:function(e){var t=$(e.target);TS.menu.$menu&&TS.menu.$menu.hasClass("keep_menu_open_if_target_clicked_again")&&t.is(TS.menu.$target_element)||(0===t.closest("#menu, .submenu, .trap_menu_clicks").length||t.hasClass("popover_mask"))&&TS.menu.end()},keepInBounds:function(){window.requestAnimationFrame?TS.utility.rAF(TS.menu.keepInBoundsThrottled):TS.menu.keepInBoundsThrottled()},keepInBoundsThrottled:function(){var e=TS.menu.$menu,t=e.dimensions_rect(),n={top:10,right:$(window).width()-10,bottom:$(window).height()-24,left:10};TS.utility.doesRectContainRect(n,t)||(t.left<n.left?e.css("left",n.left):t.right>n.right&&e.css("left",Math.max(n.left,n.right-t.width)),t.top<n.top?e.css("top",n.top):t.bottom>n.bottom&&e.css("top",Math.max(n.top,n.bottom-t.height+$(window).scrollTop())))},showAdminLink:function(){var e=TS.interop.rules.members,t=e.canManageExternalSharedChannels,n=e.isAdmin,i=e.isOwner,r=e.isEnterpriseAdmin,a=e.isEnterpriseOwner,s=TS.model.user,o=t(TS.redux.getState(),{blockAllForNoOne:!1}),l=n(s),d=i(s),c=r(s)||a(s);return o||l||d||c},isAdminOrOwner:function(){return TS.interop.rules.members.isAdmin(TS.model.user)||TS.interop.rules.members.isOwner(TS.model.user)||TS.interop.rules.members.isEnterpriseAdmin(TS.model.user)||TS.interop.rules.members.isEnterpriseOwner(TS.model.user)}});var e=!1,t=function(e){var t=TS.menu.$target_element.outerHeight()+3,n=0;return e&&(n=TS.menu.$target_element.outerWidth()-TS.menu.$menu.outerWidth()),{left:n,top:t}};$.widget("TS.submenu",{_create:function(){this.element.data("has-submenu",!0);var e=TS.interop.i18n.t("submenu","menu_source")(),t='<div class="menu submenu'+(this.options.help?" submenu_help":"")+'" data-origin-id="'+this.element.attr("id")+'" data-model-ob-id="'+this.element.data("modelObId")+'"><ul aria-hidden="true" aria-label="'+e+'">'+this.options.items_html+"</ul></div>",n=TS.menu.$menu.offset().left+TS.menu.$menu.width()+-13,i=this.element.offset().top-11;(this.$submenu=$(t),this.$submenu.appendTo("body"),TS.menu.$submenu=this.$submenu,TS.menu.$submenu_origin=this.element,n+this.$submenu.width()>window.innerWidth)&&(TS.menu.$menu.offset().left- -13>window.innerWidth-n&&(n=TS.menu.$menu.offset().left-this.$submenu.width()- -13));i+this.$submenu.height()>window.innerHeight&&(i=i>Math.abs(window.innerHeight-(i+this.$submenu.height()))?window.innerHeight-this.$submenu.height()-11:11);this.$submenu.css({position:"absolute",left:n+"px",top:i+"px"});var r=this.options.onclick;r&&this.$submenu.on("click",(function(e){r.call(this,e)}))},_destroy:function(){TS.menu.$submenu=null,TS.menu.$submenu_origin=null,this.options.ondestroy&&this.options.ondestroy(),this.$submenu.remove()}})}()},D7d6:function(e,t,n){var i=n("lSNA");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(){TS.registerModule("utility.attachments",{hasContent:function(t,n){if(!t)return!1;_.isArray(n)||(n=[].concat(n));var i=_.difference(e,n);return _.some(i,(function(e){return!_.isEmpty(t[e])}))},getMediaSource:function(e){if(e){switch(TS.utility.attachments.getMediaType(e)){case"video":return e.thumb_url;case"audio":return e.audio_html||e.audio_url;case"other":return e.other_html;case"image":return e.image_url}return e.from_url}},getMediaType:function(e){if(e)return e.video_html?"video":e.audio_html||e.audio_url?"audio":e.other_html?"other":e.image_url?"image":void 0},getDecoratedAttachment:function(e,t){var a=_.cloneDeep(e);if((a=n(a))._source=i(a),r(a)?a=s(a,t):"twitter"===a.service_name?a=o(a):"salesforce"===a.service_name&&(a=l(a)),a.is_app_unfurl&&a.bot_id){var c=TS.interop.bots.getBotById(a.bot_id);c&&(a._attribution=c.name,a._attribution_link="/services/"+a.bot_id)}if(a._source.icon){var u=d(a._source.icon);a._source.icon=u.src,a._source.icon_srcset=u.srcset}if(a.footer_icon){var m=d(a.footer_icon);a.footer_icon=m.src,a.footer_icon_srcset=m.srcset}return a},getSlackMessageFooterText:function(e,t,n){if(!r(e))return"";var i=e.channel_name,a=e.channel_id;!a&&e.from_url&&(a=TS.utility.getChannelNameFromUrl(e.from_url));var s=TS.redux.channels.getEntityById(a)||TS.redux.channels.getPublicChannelByName(i);!i&&s&&(i=_.escape(s.name));var o=t.source_team_id&&TS.teams.getTeamNameById(t.source_team_id),l='<a class="channel_link_unfurl_footer" data-channel-id='+a+" data-channel-name="+i+' target="_blank" href='+e.from_url+">#"+i+"</a>";return i?"Direct Message"===i||s&&(s.is_im||s.is_mpim)?TS.interop.i18n.t("Direct message","attachments")():e.is_reply_unfurl?n?TS.interop.i18n.t("From a thread in {channel_link}","attachments")({channel_link:TS.interop.i18n.safeString(l)}):TS.interop.i18n.t("From a thread in #{channel_name}","attachments")({channel_name:TS.interop.i18n.safeString(i)}):e.is_thread_root_unfurl?n?TS.interop.i18n.t("Thread in {channel_link}","attachments")({channel_link:TS.interop.i18n.safeString(l)}):TS.interop.i18n.t("Thread in #{channel_name}","attachments")({channel_name:TS.interop.i18n.safeString(i)}):n?TS.interop.i18n.t("Posted in {channel_link}","attachments")({channel_link:TS.interop.i18n.safeString(l)}):TS.interop.i18n.t("Posted in #{channel_name}","attachments")({channel_name:TS.interop.i18n.safeString(i)}):o?TS.interop.i18n.t("From {team_name}","attachments")({team_name:o}):TS.interop.i18n.t("From another workspace","attachments")()},getSlackMessageFooterPermalinkText:function(e){if(!r(e)||!1===e._unfurl_type_message)return"";var t=e.channel_name,n=e.channel_id;!n&&e.from_url&&(n=TS.utility.getChannelNameFromUrl(e.from_url));var i=TS.redux.channels.getEntityById(n)||TS.redux.channels.getPublicChannelByName(t);if(t){if("Direct Message"===t||i&&(i.is_im||i.is_mpim))return TS.interop.i18n.t("View conversation","attachments")();if(e.is_reply_unfurl)return TS.interop.i18n.t("View reply","attachments")()}return TS.interop.i18n.t("View message","attachments")()},getMediaCaretLocation:function(e){return _.find(t,(function(t){return _.some(e[t])}))||"end"},isAutomatedSlackUnfurl:function(e){return!!e&&r(e)&&TS.interop.rules.messages.isAutomatedSubtype(e.msg_subtype)},formatMessageAttachmentPart:function(e,t,n,i,r,a){t&&(n&&TS.interop.rules.messages.isAutomatedSubtype(t.subtype)&&(n=!1),n&&!_.isEmpty(t.attachments)&&t.attachments.some(TS.utility.attachments.isAutomatedSlackUnfurl)&&(n=!1));!0===a&&(e=_.escape(e));var s=TS.format.formatWithOptions(e,t,{no_highlights:!0!==n,no_specials:!0!==i,enable_slack_action_links:!0===r});return s=TS.utility.msgs.handleSearchHighlights(s)},findAttachment:function(e){if(e){var t=TS.utility.msgs.findMsg(e.message_ts,e.channel_id);if(t)return _.find(t.attachments,{id:e.attachment_id})}},unfurlPlaceholders:function(e){e.find(".unfurl-placeholder:not(.unfurled)").each((function(e,t){var n=$(t);n.addClass("unfurled");var i=_.uniqueId("pending_unfurl_");n.attr("id",i);try{var r=n.attr("href");TS.interop.api.call("chat.unfurlLink",{url:r}).then((function(e){if(!(e&&e.data&&e.data.attachments&&e.data.attachments[r]))throw new Error("No unfurl data");var t=e.data.attachments[r],n=$("#"+i);if(n.length&&(!1!==TS.prefs.getPref("a11y_animations")||"gif"!==t.file_type)){var a=TS.inline_attachments.renderStandaloneAttachment(t),s=n.closest(".unfurl-container");n.replaceWith(a),s.wrap('<div class="unfurl"></div>'),s.removeClass("unfurl-render-pending")}})).catch((function(){$("#"+i).addClass("hidden")}))}catch(e){n.addClass("hidden")}}))},test:function(){var e={};return Object.defineProperty(e,"_isSlackMessageUnfurl",{get:function(){return r},set:function(e){r=e}}),e}});var e=["title","text","pretext","video_html","audio_html","audio_url","other_html","from_url","fields","actions","image_url","thumb_url","author_name","service_name","footer","footer_icon","ts"],t=["ts","footer","fields","text","title","_source"],n=function(e){if(e.author_id&&!e.author_name){var t=TS.redux.members.getPotentiallyUnknownMemberById(e.author_id);!t||t.is_non_existent?(e.author_name=TS.interop.i18n.t("Private user info","member_token")(),e.author_icon=cdn_url+"/80588/img/unknown_avatar.png"):t.is_unknown||(e.author_name=TS.interop.members.getPrefCompliantMemberName(t),e.author_link="/team/"+t.id,t.profile&&(e.author_icon=t.profile.image_24))}return e},i=function(e){var t={};return t.icon=e.service_icon||e.author_icon,t.name=e.service_name||e.author_name,t.link=e.service_url||e.author_link,t.author_name=e.author_name==t.name?e.author_subname:e.author_name,t.author_link=e.author_link,t},r=function(e){return!!e.is_msg_unfurl||(e.from_url&&/slack\.com\/archives\/.+\/p.+/.test(e.from_url)?(e.is_msg_unfurl=!0,!0):void 0)},s=function(e,t){if(e.author_link){var n=TS.utility.getMemberIdFromURL(e.author_link),i=TS.interop.utility.getBotIdFromUrl(e.author_link);n&&(e._slack_author_id=n),i&&(e._slack_bot_id=i)}if(t&&"pinned_item"===t.subtype&&(e.from_url=TS.utility.msgs.constructAbsoluteMsgPermalink(TS.shared.legacyGetActiveModelOb(),e.ts)),e._is_automated_unfurl=TS.utility.attachments.isAutomatedSlackUnfurl(e),e.color=null,_.set(e,"mrkdwn_in_hash.text",!0),TS.interop.members.shouldDisplayRealNames()?e._source.name=e.author_name||e.author_subname:e._source.name=e.author_subname||e.author_name,e._source.author_name=null,e._source.author_link=null,e._unfurl_type_message=!0,e._show_permalink=!0,e.from_url){var r=TS.interop.permalink.getPermalinkIdentifier(e.from_url);if(r&&TS.interop.utility.looksLikeChannelId(r)){var a=(0,TS.interop.channels.getChannelById)(r),s=TS.interop.permalink.parsePermalink(e.from_url).team,o=TS.interop.teams.getTeamByDomain(s),l=TS.interop.channels.isMemberOfChannel(a),d=TS.interop.rules.teams.isTeamExternal(TS.redux.getState(),o),c=TS.interop.rules.user.canJoinChannel(r);l||!d||c||(e._unfurl_type_message=!1,e._show_permalink=!1)}}if(!e.footer){var u=TS.utility.attachments.getSlackMessageFooterText(e,t);u&&(e.footer=u)}return e},o=function(e){return e._source.name=e.author_name,e._source.link="https://twitter.com/"+e.author_subname,e._source.author_name=e.author_subname,e._source.author_link=e._source.link,e._unfurl_type_message=!0,e.footer||(e.footer=TS.interop.i18n.t("Twitter","attachments")()),e.footer_icon||(e.footer_icon=cdn_url+"/80588/img/services/twitter_pixel_snapped_32.png"),e},l=function(e){return e._source.name=e.author_name,e._source.author_name=e.author_subname,e._unfurl_type_message=!0,e._always_expand=!0,e},d=function(e){if(e){if(0===e.indexOf("/img/"))return e;var t={width:16,height:16};"ico"===e.split(".").pop()&&(t.convert_ico=!0);var n=TS.utility.getImgProxyURLWithOptions(e,t);return{src:n,srcset:n+" 1x, "+TS.utility.getImgProxyURLWithOptions(e,a(a({},t),{},{width:2*t.width,height:2*t.height}))+" 2x"}}}}()},EXLS:function(e,t,n){var i=n("cDf5");!function(){var e,t;TS.registerModule("redux.user_groups",{onStart:function(){Object.defineProperty(TS.model,"user_groups",{get:function(){return TS.redux.user_groups.getAllUserGroups()},set:function(){return TS.error("TS.redux.user_groups: trying to set TS.model.user_groups???"),!1}})},getUserGroupById:function(e){var t=TS.interop.userGroups.getUserGroupById(e);return!t||TS.interop.rules.user_groups.isUnknownOrNonExistent(t)||t.id!==e?null:a(t)},getAllUserGroups:function(){var n=TS.interop.userGroups.getAllUserGroups();return n===e||(t=_.values(n).sort(TS.interop.i18n.mappedSorter("_name_lc")),e=n),t},addUserGroup:function(e){e&&TS.interop.userGroups.upsertUserGroups([e])},logStats:function(){var e=_(n).keys().union(_.keys(r)).value(),t={};_.forEach(e,(function(e){t[e]={gets:n[e]||0,sets:r[e]||0}})),TS.console.table(t)}});var n={},r={},a=function(e){return!window.Proxy||!TS.boot_data||"dev"!==TS.boot_data.version_ts&&"local_js"!==TS.boot_data.version_ts?e:new window.Proxy(e,{get:function(e,t){return function(e,t){return"symbol"!==i(t)&&(_.isNumber(n[t])||(n[t]=0,r[t]=0),n[t]+=1),e[t]}(e,t)},set:function(e,t,a){return function(e,t,a){return"symbol"!==i(t)&&(_.isNumber(r[t])||(n[t]=0,r[t]=0),r[t]+=1),e[t]=a,!0}(e,t,a)}})}}()},EbDI:function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},EcSN:function(e,t){!function(){var e,t,n,i,r,a,s,o;TS.registerModule("ui.fs_modal",{is_showing:!1,transition_duration:250,start:function(s){if(TS.ui.fs_modal.is_showing)return y(s);var l;if(m=_.defaults({},s,p),TS.ui.fs_modal.is_showing=!0,TS.tips.hideAll(),f(),m.modal_class&&e.addClass(m.modal_class),m.modal_bg_class&&t.addClass(m.modal_bg_class),m.modal_contents_container_class&&e.find(".contents_container").addClass(m.modal_contents_container_class),i=e.find(".contents"),r=e.find("#fs_modal_sidebar"),a=e.find("#fs_modal_header"),o=e.find("#fs_modal_footer_content"),m.body_template_html?(l=m.body_template_html,m.body&&TS.warn("Both body and body_template_html were passed in settings to TS.ui.fs_modal.start(). Using body_template.")):l=TS.templates.fs_modal_generic_contents({settings:m,fs_modal_header:_.includes(m.modal_class,"fs_modal_header"),fs_modal_footer:_.includes(m.modal_class,"fs_modal_footer")}),i.html(l),m.header_html&&a.replaceWith(m.header_html),m.footer_html&&o.html(m.footer_html),m.sidebar_html&&r.html(m.sidebar_html),m.modal_gallery&&k(),s.title&&e.attr("aria-label",s.title),!s.title&&a&&e.attr("aria-labelledby","fs_modal_header"),$("#client-ui").attr("aria-hidden",!0),e.on("click",".dialog_go",h),e.on("click",".dialog_secondary_go",g),e.on("click",".dialog_cancel",b),$(window.document).off(".fs_modal"),$(window.document).on("keydown.fs_modal",S),$(window.document).on("focusin.fs_modal",T),n.on("click",(function(){m.esc_for_ok?h():b()})),$("html").addClass("fs_modal_active"),setTimeout((function(){t&&t.addClass("active"),e&&e.addClass("active")}),0),e.find("input").length?e.find("input").first().focus():document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),m.onShow&&m.onShow(),m.onShowComplete||TS.model.is_our_app&&TS.interop.desktop.legacyAreDragRegionsRequired()){var c=!1,u=w();d=setTimeout((function(){c=!0,x(),m.onShowComplete&&m.onShowComplete(),e.off(u+".fs_modal_show_complete")}),600),e.one(u+".fs_modal_show_complete",(function(){c||(x(),clearTimeout(d),m.onShowComplete&&m.onShowComplete())}))}},close:function(e){b(e)},bindBackButton:function(e){$("#fs_modal_back_btn").off("click.fs_modal").on("click.fs_modal",e)},unbindBackButton:function(){$("#fs_modal_back_btn").off("click.fs_modal")},showBackButton:function(){$("#fs_modal_back_btn").removeClass("hidden")},hideBackButton:function(){$("#fs_modal_back_btn").addClass("hidden")},activate:function(){e.addClass("active"),t.addClass("active")},deactivate:function(){e.removeClass("active"),t.removeClass("active")},setHeaderTitle:function(t){if(a.length){var n=TS.templates.fs_modal_header({title:t});a.replaceWith(n),a=e.find("#fs_modal_header")}},showFooter:function(){s.length&&(e.addClass("fs_modal_footer"),s.removeClass("hidden"))},hideFooter:function(){s.length&&(e.removeClass("fs_modal_footer"),s.addClass("hidden"))},isShowing:function(){return TS.ui.fs_modal.is_showing}});var l,d,c=0,u=!1,m=null,p={title:"",body:"",body_template_html:null,show_go_button:!0,show_secondary_go_button:!1,show_cancel_button:!0,go_button_text:TS.interop.i18n.t("OK","fs_modal")(),go_button_class:"",secondary_go_button_text:TS.interop.i18n.t("OK 2","fs_modal")(),secondary_go_button_class:"",cancel_button_text:TS.interop.i18n.t("Cancel","fs_modal")(),disable_default_controls:!1,disable_esc:!1,onGo:null,onSecondaryGo:null,onCancel:null,onEnd:null,esc_for_ok:!1,onShow:null,enter_always_gos:!1,fullscreen:!1,modal_class:null,modal_bg_class:null,modal_contents_container_class:null,modal_gallery:null,sidebar_html:null,header_html:null,footer_html:null,full_height_contents:!1},f=function(){t=null,e=null,a=null,s=null,o=null,n=null,i=null,r=null;var l={settings:m,fs_modal_header:_.includes(m.modal_class,"fs_modal_header"),fs_modal_footer:_.includes(m.modal_class,"fs_modal_footer"),fs_modal_sidebar:_.includes(m.modal_class,"fs_modal_sidebar"),disable_default_controls:m.disable_default_controls},d=TS.templates.fs_modal(l);$("body").append(d),t=$("#fs_modal_bg"),e=$("#fs_modal"),a=$("#fs_modal_header"),s=$("#fs_modal_footer"),n=$("#fs_modal_close_btn")},h=function(){TS.ui.fs_modal.is_showing?m.onGo?!1!==m.onGo()&&b():b():TS.error("not showing?")},g=function(){TS.ui.fs_modal.is_showing?m.onSecondaryGo?!1!==m.onSecondaryGo()&&b():b():TS.error("not showing?")},S=function(e){if(e.which!=TS.utility.keymap.enter||"BODY"!==TS.utility.getActiveElementProp("NODENAME")&&!m.enter_always_gos){if(e.which==TS.utility.keymap.esc){if(m.disable_esc)return;m.esc_for_ok?h():(b(),m.clog_name&&TS.interop.clog.track(m.clog_name+"_ACTION",{source:m.clog_source,action:"close_modal",trigger:"esc_key"}))}}else m.show_go_button&&(h(),e.preventDefault())},T=function(t){var n=$(".modal,[role=dialog]:not(.modal),[role=alertdialog]:not(.modal)").filter((function(){return"none"!==$(this).css("display")})).toArray(),i=_.sortBy(n,(function(e){return parseInt($(e).css("z-index"),10)})).pop();if(e.is(i)){var r=t.target;e.is(r)||e.has(r).length||e.focus()}},b=function(n){I(n)&&(e&&e.removeClass("active"),t&&t.removeClass("active"),setTimeout((function(){$("html").removeClass("fs_modal_active")}),TS.ui.fs_modal.transition_duration),m.onCancel&&m.onCancel(),v())},v=function(){setTimeout((function(){e.removeAttr("aria-label"),e.removeAttr("aria-labelledby"),e.remove(),t.remove(),TS.ui.fs_modal.is_showing=!1,C(),$("#client-ui").removeAttr("aria-hidden")}),TS.ui.fs_modal.transition_duration),$(window.document).off("keydown.fs_modal"),$(window.document).off("focusin.fs_modal"),clearTimeout(d),e.off(w()+".fs_modal_show_complete"),m.onEnd&&m.onEnd(),TS.tips.unhideAll()},y=function(n){e.removeClass("active"),m.onCancel&&m.onCancel();var i=t.attr("id",null).addClass("fs_modal_bg");return new Promise((function(t){setTimeout((function(){e.remove(),TS.ui.fs_modal.is_showing=!1,t(TS.ui.fs_modal.start(n)),setTimeout(i.remove.bind(i),TS.ui.fs_modal.transition_duration)}),TS.ui.fs_modal.transition_duration)}))},w=function(){var t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",transition:"transitionend"};for(var n in t)if(void 0!==e[0].style[n])return t[n]},k=function(){var t=e.find("[data-modal-items]");c=m.modal_gallery.index,TS.ui.fs_modal.hideFooter(),c?e.find('[data-modal-gallery-index="'+c+'"]').removeClass("hidden"):e.find("[data-modal-gallery-index]").first().removeClass("hidden"),e.on("click","[data-modal-gallery-direction]",(function(){var e=$(this).data("modal-gallery-direction");c+=e,t.find("[data-modal-gallery-index]").addClass("hidden"),t.find('[data-modal-gallery-index="'+c+'"]').removeClass("hidden"),M()})),M()},x=function(){if(TS.model.is_our_app&&TS.interop.desktop.legacyAreDragRegionsRequired())if(_.get(window,"desktop.app.updateDragRegion"))window.desktop.app.updateDragRegion([]);else{TS.interop.desktop.legacyUpdateNoDragRegion([]);var e=$("#fs_modal").find("header").find("button, a").toArray();u||(TSSSB.nodrag.updateElements(e),u=!0),l=_.debounce((function(){TS.interop.utility.requestIdleCallback((function(){return TSSSB.nodrag.updateElements(e)}),{timeout:200})}),400),$(window).off("resize.setupNoDragFSM").on("resize.setupNoDragFSM",l)}},C=function(){TS.model.is_our_app&&TS.interop.desktop.legacyAreDragRegionsRequired()&&(u=!1,$(window).off("resize.setupNoDragFSM"),TS.interop.desktop.legacyUpdateNoDragRegion([]))},M=function(){var t=e.find('[data-modal-gallery-direction="-1"]'),n=e.find('[data-modal-gallery-direction="1"]'),i=e.find("[data-modal-slideshow-count]"),r=e.find("[data-modal-slideshow-total]"),a=m.modal_gallery.total_items;0===c?t.prop("disabled",!0):t.prop("disabled",!1),c===a?n.prop("disabled",!0):n.prop("disabled",!1),i.html(c+1),r.html(a+1)},I=function(e){return!!e||!TS.ui.lazy_filter_select.is_list_open&&(!TS.ui.react_emoji_menu.is_showing&&(!TS.model.menu_is_showing&&(!TS.model.dialog_is_showing&&!TS.utility.isTabCompleteShowing())))}}()},"F/UT":function(e,t){!function(){TS.registerModule("mpims",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,onStart:function(){TS.prefs.display_real_names_override_changed_sig.add(t),TS.prefs.team_display_real_names_changed_sig.add(t),TS.members.changed_profile_sig.add(e)},legacyRemoveMsg:function(e,t){var n=TS.interop.channels.getMpimById(e,!1);if(n){if(TS.redux.messages.removeMessage(t),TS.interop.messages.isReply(t)){n._archive_msgs&&TS.utility.msgs.spliceMsg(n._archive_msgs,t);var i=n.msgs;TS.utility.msgs.spliceMsg(i,t)}TS.mpims.message_removed_sig.dispatch(n,t)}else TS.error('unknown mpim "'+e+'"')},legacyMarkMostRecentReadMsg:function(e,t){e?TS.interop.channels.markMostRecentMsgRead({channelId:e.id,reason:t}):TS.error("mpim unknown")},legacyGetMembersInDisplayOrder:function(e){if(e){var t=TS.model&&TS.model.user?TS.model.user.id:TS.boot_data.user_id;return _.chain(e.members).without(t).map((function(e){return TS.redux.members.getPotentiallyUnknownMemberById(e)})).compact().value()}},legacyGetDisplayName:function(e,t,n,a,s){var o=_.isInteger(a);return!e._display_name||t||n||o||s?!e._display_name_truncated||t||n||s||!o?s?r(e):i(e,t):e._display_name_truncated:e._display_name},getMemberCount:function(e){return e&&e.members?Math.min(Math.max((e.members.length||1)-1,2),9):null},checkMpimMatch:function(e,t,n){if(e){for(var i=!0,r=TS.mpims.legacyGetMembersInDisplayOrder(e),a=0;a<t.length;a+=1){for(var s=!1,o=0;o<r.length;o+=1)(TS.utility.members.checkMemberMatch(r[o],t[a],true)||n&&TS.utility.members.checkMemberMatch(r[o],n[a],true))&&(s=!0);s||(i=!1)}return i}}});var e=function(e){TS.model.mpims.forEach((function(t){-1!==t.members.indexOf(e.id)&&n(t)}))},t=function(){TS.model.mpims.forEach(n)},n=function(e){e._display_name=void 0},i=function(e,t){var n=TS.mpims.legacyGetMembersInDisplayOrder(e),i=_.find(n,"is_unknown");if(i)return t?TS.templates.unknown_member({id:i.id}):"";var r=_(n).map((function(e){var n=TS.interop.members.getPrefCompliantMemberName(e);if(t){var i="",r=TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),e.id);(r.emoji||r.text)&&(i=" "+TS.templates.current_status({tip_direction:"bottom",member:e,classes:"ts_tip_float ts_tip_hidden"})),n=_.escape($.trim(n)),n='<li class="mpdm_member '+TS.templates.makeMemberDomId(e)+" "+TS.templates.makeMemberPresenceStateClass(e)+'" data-member-id="'+e.id+'">'+n+i+"</li>"}return n})).compact().value(),a=t?r.join(" "):r.join(", ");return t||(e._display_name=a),a},r=function(e){var t=TS.mpims.legacyGetMembersInDisplayOrder(e).map((function(e){return TS.interop.members.getPrefCompliantMemberName(e)}));return TS.interop.i18n.listify(t,{strong:!0}).join("")}}()},Foai:function(e,t,n){var i=n("cDf5"),r=n("lSNA");function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(){TS.registerModule("files",{team_file_deleted_sig:new signals.Signal,team_file_deleted_success_sig:new signals.Signal,team_file_changed_sig:new signals.Signal,team_file_comment_added_sig:new signals.Signal,team_file_comment_deleted_sig:new signals.Signal,file_uploaded_sig:new signals.Signal,uploadQ:[],uploading:!1,polling_count:0,polling_file_id:null,polling_ticket:null,polling_tim:null,polling_handler:null,waiting_for_refresh:{},onStart:function(){TS.prefs.team_disable_file_editing_changed_sig.add(TS.files.getFileActions,TS.files.upsertAndSignal),TS.files.file_uploaded_sig.add(r)},isFilePrivate:function(e){return!e.is_public&&!e.is_external&&!e.is_shared},isFileAuthorExternal:function(e){if(!_.isObject(e))return!1;var t=TS.interop.members.getMemberById(e.user);return!!_.isObject(t)&&TS.interop.members.isExternal(t)},createPublicURL:function(e,t){if(!TS.prefs.getTeamPref("disallow_public_file_urls")){var n=function(n,i,r){n?TS.files.upsertAndSignal({id:e.id,public_url_shared:!0},"createPublicURL"):i.error&&"not_allowed"===i.error&&(TS.prefs.setTeamPrefLocal("disallow_public_file_urls",!0),TS.generic_dialog.alert(TS.interop.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this space.","files")())),t&&"function"==typeof t&&t(n,i,r)};return TS.interop.api.callExpedited("files.sharedPublicURL",{file:e.id}).then((function(e){var t=e.data,i=e.args,r=e.request_id;return n(!0,t,i),{data:t,args:i,request_id:r}})).catch((function(e){var t=e.data,i=e.args,r=e.request_id;return n(!1,t,i),{data:t,args:i,request_id:r}}))}},createSpace:function(e){var t={};TS.boot_data.page_needs_enterprise&&(t.team=TS.model.team.id);var n=function(t,n){if(t){var i=TS.files.upsertAndSignal(n.file,"createSpace").file;TS.web&&TS.ssb.upsertFileInSSBParentWin(i),e(i)}else TS.generic_dialog.alert('<p class="no_bottom_margin">'+TS.interop.i18n.t("Oops! Something went wrong. Please try again.","files")()+"</p>"),e(null)};return TS.interop.api.callExpedited("files.createSpace",t).then((function(e){var t=e.data,i=e.args,r=e.request_id;return n(!0,t),{data:t,args:i,request_id:r}})).catch((function(e){var t=e.data,i=e.args,r=e.request_id;return n(!1,t),{data:t,args:i,request_id:r}}))},createAndOpenNewSpace:function(e,t){var n=TS.model.active_cid?"?origin_channel="+TS.model.active_cid:"";if(TS.boot_data.page_needs_enterprise&&(n.length?n+="&origin_team="+TS.model.team.id:n="?origin_team="+TS.model.team.id),t||!TS.model.is_our_app){var i="/files/create/post"+n;return TS.utility.openInNewTab(i,"_blank"),"function"==typeof e&&e(),Promise.resolve()}return TS.files.createSpace((function(t){if(t){var i=t.permalink+n;TS.ssb.openNewFileWindow(t,i,n)||TS.utility.openInNewTab(i,t.id)}"function"==typeof e&&e()}))},promptForFileUnshare:function(e,t){var n=TS.redux.channels.getEntityById(t);if(n&&!n.is_im&&!n.is_mpim){var i=TS.interop.i18n.t("<p>Are you sure you want to un-share this file from the <strong>{channel_name}</strong> {is_private, select, true {private} other {}} channel?</p>\t\t\t<p>Un-sharing the file will not remove existing share and comment messages, but it will keep any future comments from appearing in the channel.</p>","files")({is_private:n.is_private||n.is_group,channel_name:n.is_channel&&!n.is_private?"#"+n.name:n.name});TS.generic_dialog.start({title:TS.interop.i18n.t("Un-share file","files")(),body:i,show_cancel_button:!0,show_go_button:!0,go_button_text:TS.interop.i18n.t("Yes, unshare this file","files")(),cancel_button_text:TS.interop.i18n.t("Cancel","files")(),onGo:function(){TS.files.unshareFile(e,t)}})}},shareFile:function(e,t,n,i,r){var a={file:e,channel:t,comment:TS.format.cleanMsg(n),resharing_aware:!0};i&&(a.share_quietly=!0);var s=function(e,t,n){TS.files.onFileShare(e,t,n),r&&r(e,t,n)};return TS.interop.api.call("files.share",a).then((function(e){var t=e.data,n=e.args,i=e.request_id;return s(!0,t,n),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return s(!1,t,n),{data:t,args:n,request_id:i}}))},onFileShare:function(e,t,n){e&&TS.files.fetchFileInfo(n.file,(function(e,t){TS.web&&TS.files.upsertAndSignal(t,"onFileShare")}))},unshareFile:function(e,t,n){var i=function(t,i,r){TS.files.onFileUnShare(t,i,r),n&&n(e,TS.files.getFileById(e))};TS.interop.api.call("files.unshare",{file:e,channel:t}).then((function(e){var t=e.data,n=e.args,r=e.request_id;return i(!0,t,n),{data:t,args:n,request_id:r}})).catch((function(e){var t=e.data,n=e.args,r=e.request_id;return i(!1,t,n),{data:t,args:n,request_id:r}}))},fetchFileInfo:function(e,t,n){var i=TS.redux.dispatch(TS.interop.files.fetchAndUpsertFileById({fileId:e,reason:n}));return t?i.tap((function(n){return t(e,n)})).catch((function(){return t(e,null)})):i},onFileUnShare:function(e,t,n){e&&TS.files.fetchFileInfo(n.file,(function(e,t){TS.web&&TS.files.upsertAndSignal(t,"onFileUnShare")}))},getFileById:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return TS.redux.files.getFileById(e,t)},getFileActions:function(e){if(e){var t={},n=!1;if(e.user==TS.model.user.id&&(n=!0),e.is_public||n?t.share=!0:t.share_private_file=!0,t.comment=!0,e.public_url_shared||"external"===e.mode||TS.model.user.is_restricted||TS.prefs.getTeamPref("disallow_public_file_urls")||(e.is_public||n)&&(t.create_public_link=!0),!e.public_url_shared||TS.model.user.is_restricted||!TS.model.user.is_admin&&!n||TS.prefs.getTeamPref("disallow_public_file_urls")||(t.revoke_public_link=!0),"hosted"!==e.mode&&"snippet"!==e.mode||(t.download=!0),(e.mimetype&&0===e.mimetype.indexOf("image/")||"pdf"===e.filetype||"external"===e.mode||"snippet"===e.mode||"email"===e.mode)&&(t.open_original=!0),TS.web&&("post"!==e.mode&&"snippet"!==e.mode&&"space"!==e.mode&&"email"!==e.mode&&"docs"!==e.mode||(t.print=!0)),"space"!==e.mode||"USLACKBOT"===e.user&&"Getting_Started_with_Posts"===e.name||(t.learn_more=!0),"space"!==e.mode&&"docs"!==e.mode||(t.new_window=!0),"space"===e.mode&&"locked"!==e.state&&(t.edit=!0),n&&("snippet"!==e.mode&&"post"!==e.mode&&"space"!==e.mode&&"docs"!==e.mode||(t.edit=!0),"hosted"!==e.mode&&"email"!==e.mode||(t.edit_title=!0),t.delete_file=!0),TS.model.user.is_admin){var i=TS.interop.members.isExternalById(e.user);t.delete_file=!i}return TS.clipboard.canWriteText()&&(t.copy_file_link=!0),"external"===e.mode&&(n||TS.model.user.is_admin)&&(t.refresh=!0),window.Dropbox&&Dropbox.isBrowserSupported()&&TS.prefs.getPref("dropbox_enabled")&&"hosted"===e.mode&&(t.save_to_dropbox=!0),t.rxn_file=!0,TS.prefs.getTeamPref("disable_file_editing")&&(t.edit=!1,t.edit_title=!1),TS.prefs.getTeamPref("disable_file_deleting")&&(t.delete_file=!1),e.is_tombstoned&&(t.edit=!1,t.edit_title=!1,t.delete_file=!1),t}},getThumbSrcForFile:function(e,t){try{e=n(e)}catch(e){return!1}var i=s({suppressAnimations:!TS.prefs.getPref("a11y_animations")},t);return TS.interop.files.getThumbSrcForFile(e,i)},fileIsImage:function(e){try{e=n(e)}catch(e){return!1}return TS.interop.files.fileIsImage(e)},fileIsPDF:function(e){try{e=n(e)}catch(e){return!1}return"pdf"===e.filetype||e.converted_pdf},getHiddenFileTemplateArgs:function(e){var t=TS.interop.messages.getClogUIStepFromContext(e);return{is_hidden_by_storage_limit:!0,pricing_link_a_tag:'<a href="/pricing?ui_step='+t+'&ui_element=5" data-clog-click="true" data-clog-event="GROWTH_PRICING" data-clog-ui-action="click" data-clog-ui-step='+t+' data-clog-ui-element="pricing_link" data-clog-ui-component="file_storage_limit_banner" target="_blank">'}},getFileTemplateArguments:function(e,t,n){var i={};if(i.current_user_id=TS.model.user.id,i.file_partial="generic",/(snippet|post|email|docs)/.test(e.mode)&&(i.file_partial=e.mode),/(space)/.test(e.mode)&&(i.file_partial="post"),TS.interop.files.shouldShowFile(e)&&(i.file_show_meta_text=!0),TS.interop.files.isTombstone(e)&&(i.file_partial="tombstone",i.file_tombstone=!0),TS.interop.files.isHiddenByStorageLimit(e)&&(i.file_partial="hidden_by_limit",_.assign(i,TS.files.getHiddenFileTemplateArgs(n))),TS.files.fileIsImage(e)&&(i.file_partial="image",i.image_src=TS.files.getThumbSrcForFile(e,{maxSize:t}),i.image_width=360===t?e.thumb_360_w:e.thumb_480_w||e.thumb_360_w,i.image_height=360===t?e.thumb_360_h:e.thumb_480_h||e.thumb_360_h,i.preserve_aspect_ratio=i.image_width>0&&i.image_height>0,i.preview_actions_class="",(i.image_width<170||i.image_height<50)&&(i.preview_actions_class+=" overflow_preview_actions"),i.image_width<170&&(i.preview_actions_class+=" overflow_preview_actions_width")),/(post|space|email|docs|generic)/.test(i.file_partial)&&(i.title_hider=!0),"snippet"===e.mode&&(i.title_hider="Untitled"===e.title),i.filesize=e.size>2e4&&!/(gdoc|gpres|gsheet|gdraw)/.test(e.filetype),/(space|post)/.test(e.filetype)||(i.meta_filetype=new Handlebars.SafeString(TS.templates.builders.makeFiletypeHTML(e))),TS.templates.builders.makeExternalFiletypeHTML(e)===i.meta_filetype&&(i.meta_filetype=!1),TS.interop.files.fileIsHostedSupportedMedia(e)){if(TS.interop.files.fileIsSupportedVideo(e)){i.file_is_video=!0;var r={width:e.width,height:e.height,source:e.url_private,size:e.size};if(e.video&&(i.transcoding_status=e.video.status,e.video.outputs))for(var a=e.video.outputs.length-1;a>=0;a-=1){var s=e.video.outputs[a];s.source&&((!r.width||s.width>r.width)&&(r=s))}i.video_height=TS.model.native_video_embed_height,e.thumb_video&&(i.poster=e.thumb_video),i.best_source=r.source}TS.interop.files.fileIsSupportedAudio(e)&&(i.file_is_audio=!0,i.audio_preload="metadata",e.size<=TS.model.native_media_preload_limit_bytes&&(i.audio_preload="auto"))}return i},sortFiles:function(e){e.sort((function(e,t){return e.timestamp<t.timestamp?1:e.timestamp>t.timestamp?-1:0}))},getFileCommentById:function(e,t){for(var n,i=0;i<e.comments.length;i+=1)if((n=e.comments[i]).id==t)return n;return null},addCommentToFile:function(e,t){var n=TS.files.getFileCommentById(t,e.id);return n||(e._rxn_key=TS.rxns.getRxnKey("file_comment",e.id),TS.rxns.upsertRxnsFromDataAndUpdateUI(e._rxn_key,e.reactions),delete e.reactions,t.comments.push(e),TS.files.sortCommentsOnFile(t),TS.files.team_file_comment_added_sig.dispatch(t,e),e)},editCommentOnFile:function(e,t){for(var n,i=!1,r=!1,a=0;a<t.comments.length;a+=1)if((n=t.comments[a]).id==e.id){i=!0,t.comments[a]=e,n.is_starred&&(e.is_starred=!0),n._rxn_key&&(e._rxn_key=n._rxn_key),n.pinned_to&&!e.pinned_to&&(e.pinned_to=n.pinned_to),t.initial_comment&&n.id==t.initial_comment.id&&(t.initial_comment=e,r=!0);break}return!!i&&(TS.files.sortCommentsOnFile(t),r&&TS.files.team_file_changed_sig.dispatch(t),!0)},deleteCommentOnFile:function(e,t){for(var n,i,r=[],a=0;a<t.comments.length;a+=1)(n=t.comments[a]).id!=e?r.push(n):(i=n,t.initial_comment&&n.id==t.initial_comment.id&&(t.initial_comment=null));r.length!=t.comments.length&&(t.comments=r,TS.files.sortCommentsOnFile(t),TS.files.team_file_comment_deleted_sig.dispatch(t,e,i),TS.files.team_file_changed_sig.dispatch(t))},sortCommentsOnFile:function(e){e.comments.sort((function(e,t){return e.timestamp>t.timestamp?1:e.timestamp<t.timestamp?-1:0}))},upsertFile:function(e,n){n=n||"no reason";var r="NOOP",a=[];if(Object.keys(e).length<2)return TS.error("upserting a bad file object! it has less than 2 properties",e,"with reason: "+n),{status:r,file:e,what_changed:a};e&&_.isString(e)&&TS.interop.utility.looksLikeFileId(e)?(TS.interop.files.markObjectsAsFresh([e]),e=TS.files.getFileById(e)):TS.interop.files.markObjectsAsFresh([e.id]);var s,o,l=TS.files.getFileById(e.id);if(e=TS.interop.files.processFileForUpserting(e),l){if(e._rxn_key=TS.rxns.getRxnKey("file",e.id),TS.rxns.getExistingRxnsByKey(e._rxn_key)&&!e.reactions?TS.error("file:"+e.id+" ("+n+") has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(e._rxn_key,e.reactions),delete e.reactions,e.comments)for(o=0;o<e.comments.length;o+=1)(s=e.comments[o])._rxn_key=TS.rxns.getRxnKey("file_comment",s.id),TS.rxns.getExistingRxnsByKey(s._rxn_key)&&!s.reactions?TS.warn("comment:"+e.id+" ("+n+") has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(s._rxn_key,s.reactions),delete s.reactions;for(var d in e.initial_comment&&(e.initial_comment._rxn_key=TS.rxns.getRxnKey("file_comment",e.initial_comment.id),TS.rxns.getExistingRxnsByKey(e.initial_comment._rxn_key)&&!e.initial_comment.reactions?TS.warn("initial_comment:"+e.id+" ("+n+") has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(e.initial_comment._rxn_key,e.initial_comment.reactions),delete e.initial_comment.reactions),e)if("channels"===d||"ims"===d||"groups"===d||"pinned_to"===d||"to"===d||"from"===d||"cc"===d||"attachments"===d){var c=!1,u=_.isArray(e[d])?e[d]:[],m=_.isArray(l[d])?l[d]:[];"to"===d||"from"===d||"cc"===d||"attachments"===d?m.length!=u.length&&(c=!0):m.join("")!=u.join("")&&(c=!0),c&&(r="CHANGED",a.push(d))}else"preview"===d?l[d]!==e[d]&&(r="CHANGED",a=a.concat([d,"content","content_html","content_highlight_html"])):"comments"===d?e[d]&&!TS.utility.areSimpleObjectsEqual(e[d],l[d],"file:"+e.id+" "+e.name)&&(r="CHANGED",a.push(d)):"content"===d?e[d]&&l[d]!=e[d]&&(r="CHANGED",a.push(d)):"editor"===d||"state"===d?e[d]!=l[d]&&(a.push(d),r="CHANGED"):"initial_comment"===d||"reactions"===d||("channel_map"!==d&&"group_map"!==d&&"im_map"!==d&&"teams"!==d&&"teams_shared_with"!==d&&"users"!==d||TS.utility.isScalar(e[d]))&&("video"===d?e[d]&&!TS.utility.areSimpleObjectsEqual(e[d],l[d],"file:"+e.id+" "+e.name)&&(r="CHANGED",a.push(d)):"shares"===d?TS.boot_data.feature_file_threads&&(TS.utility.areSimpleObjectsEqual(l[d],e[d])||(r="CHANGED")):"pinned_info"===d?TS.utility.areSimpleObjectsEqual(l[d],e[d])||(r="CHANGED",a.push(d)):l[d]!=e[d]&&(e[d]&&!TS.utility.isScalar(e[d])?TS.warn(d+" is not scalar! it needs to be handled by upsertFile specifically to test if it has changed! "+i(e[d])):"boolean"==typeof e[d]&&!e[d]==!l[d]||(a.push(d+" ["+l[d]+"] -> ["+e[d]+"]"),r="CHANGED")));l=e}else if(e&&_.isObject(e)){if(r="ADDED",e._rxn_key=TS.rxns.getRxnKey("file",e.id),TS.rxns.upsertRxnsFromDataAndUpdateUI(e._rxn_key,e.reactions),delete e.reactions,e.comments){for(o=0;o<e.comments.length;o+=1)(s=e.comments[o])._rxn_key=TS.rxns.getRxnKey("file_comment",s.id),TS.rxns.upsertRxnsFromDataAndUpdateUI(s._rxn_key,s.reactions),delete s.reactions;e.initial_comment&&(e.initial_comment._rxn_key=TS.rxns.getRxnKey("file_comment",e.initial_comment.id),TS.rxns.upsertRxnsFromDataAndUpdateUI(e.initial_comment._rxn_key,e.initial_comment.reactions),delete e.initial_comment.reactions)}var p=TS.redux.members.getPotentiallyUnknownMemberById(e.user);p?(p.files.push(e),TS.files.sortFiles(p.files)):TS.error("hmmm, file "+e.id+" does not have a known user "+e.user),t(e),l=e}return"CHANGED"===r&&(t(e),_.includes(a,"comments")&&TS.utility.msgs.updateCommentReferences(l)),"NOOP"!==r&&TS.redux.dispatch(TS.interop.redux.models.files.addFile(l)),{status:r,file:l,what_changed:a}},upsertAndSignal:function(e,t){var n=TS.files.upsertFile(e,t);return"CHANGED"===n.status&&TS.files.team_file_changed_sig.dispatch(n.file),n},removeFile:function(e){TS.log(4,'removing file "'+e+'"');var t=TS.files.getFileById(e);t&&(t.is_deleted=!0),t&&(TS.redux.dispatch(TS.interop.redux.models.files.tombstoneFiles({fileIds:[e]})),t=TS.files.getFileById(e)),t&&TS.files.team_file_deleted_sig.dispatch(t)},actuallyUpload:function(t){TS.files.uploading=!0,t.retry_num=t.retry_num||0,TS.boot_data.feature_legacy_file_upload_analytics&&(t.start_time=new Date);var n=new FormData;if(t.title&&(t.title=TS.emoji.maybeGetCanonicalEmojiString(t.title)),t.text?(n.append("content",t.text),t.filetype&&n.append("filetype",t.filetype),t.filename&&TS.warn("ignoring filename because it makes no sense for text files")):("string"==typeof t.file?n.append("content64",t.file):n.append("file",t.file),t.filename&&n.append("filename",t.filename),t.filetype&&TS.warn("ignoring filetype we send a filename which can intuit it")),n.append("token",TS.model.api_token),t.channels&&t.channels.length){var i="";"string"==typeof t.channels?i=t.channels:t.channels.join&&(i=t.channels.join(",")),n.append("channels",i)}n.append("title",t.title),t.initial_comment&&n.append("initial_comment",TS.format.cleanMsg(t.initial_comment));var r,a="files.uploadAsync";t.link&&(t.is_dropbox&&(a="files.uploadExternal"),t.is_box&&(a="files.uploadExternal"),n.append("link",t.link)),TS.boot_data.feature_legacy_file_upload_analytics&&(t.is_external="files.uploadExternal"===a),TS.boot_data.feature_file_threads&&(t.thread_ts&&n.append("thread_ts",t.thread_ts),t.broadcast&&n.append("broadcast",t.broadcast)),r="files.uploadAsync"===a?TS.model.async_api_url+a:TS.model.api_url+a;var o=t,l=!1;e=$.ajax({url:r,data:n,dataType:"json",cache:!1,contentType:!1,processData:!1,type:"POST",xhr:function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",(function(e){e.lengthComputable||TS.info("Upload length not computable")}),!1),e},error:function(e,n,i){l=!0,TS.info("Error: Failed to upload file."),TS.info("textStatus:"+n+" errorThrown:"+i),TS.info("data:"+e),"abort"!==n?0===t.retry_num?(t.retry_num+=1,TS.files.actuallyUpload(t)):TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")(),go_button_text:TS.interop.i18n.t("Yes, try again","files")(),cancel_button_text:TS.interop.i18n.t("No, cancel","files")(),onGo:function(){t.retry_num+=1,TS.files.actuallyUpload(t)},onCancel:function(){TS.files.uploadOver(!1),TS.boot_data.feature_legacy_file_upload_analytics&&TS.files.clogCompleteUpload(s({ok:!1,error:"Error during request. Status: "+status+", error: "+i},t))}}):TS.files.uploadOver(!1)},complete:function(e){if(!l)if((e=jQuery.parseJSON(e.responseText))&&e.ok&&e.file){if("files.uploadAsync"===a){TS.files.startPollingForUploadProcessing(e.file,e.ticket,(function(e,t,n){if(TS.files.polling_file_id)if(e)if("complete"===t.status){var i=TS.files.upsertAndSignal(t.file,"actuallyUploadAsync");TS.files.uploadProcessingOver(!0,i.file.id,o)}else if("failed"===t.status){var r="";t.debug&&TS.boot_data.feature_tinyspeck&&(r="<br><br>TS only Debugging:<br><br>"+t.debug),TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")()+r,go_button_text:TS.interop.i18n.t("Yes, try again","files")(),cancel_button_text:TS.interop.i18n.t("No, cancel","files")(),onGo:function(){n.retry_num+=1,TS.files.actuallyUpload(n)},onCancel:function(){TS.files.uploadProcessingOver(!1,TS.files.polling_file_id)}})}else TS.files.pollForUploadProcessing();else TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload.","files")(),show_cancel_button:!0}),TS.files.uploadProcessingOver(!1,TS.files.polling_file_id)}))}else{var n=TS.files.upsertAndSignal(e.file,"actuallyUpload");TS.files.uploadOver(e.ok,n.file.id,o)}TS.boot_data.feature_legacy_file_upload_analytics&&TS.files.clogCompleteUpload(s({ok:!0},t))}else{TS.info("Error: Failed to upload file."),TS.info(e);var i=function(){if(TS.boot_data.feature_legacy_file_upload_analytics){var n=e&&e.error;TS.files.clogCompleteUpload(s({ok:!1,error:n},t))}};e?0===t.retry_num?(t.retry_num+=1,TS.files.actuallyUpload(t)):"folders_not_supported"===e.error?TS.generic_dialog.start({title:TS.interop.i18n.t("Folders not supported","files")(),body:TS.interop.i18n.t("<p>Sorry, <strong>{folder_name}</strong> is a folder, and folder uploads are not supported by Slack.</p>\t\t\t\t\t\t\t\t\t<p>Try uploading a .zip version of the file instead.</p>","files")({folder_name:_.escape(t.filename)}),show_cancel_button:!1,esc_for_ok:!0,onGo:function(){TS.generic_dialog.end(),TS.files.uploadOver(!1),i()}}):"request_timeout"===e.error?TS.generic_dialog.start({title:TS.interop.i18n.t("File upload timed out","files")(),body:TS.interop.i18n.t('<p>It looks like you\u2019re on a slow or inconsistent internet connection. You may want to try your file upload again later. Or, try again now and it might work if you cross your fingers!</p>\t\t\t\t\t\t\t\t\t<p>If you\u2019re still having problems, you can:</p>\t\t\t\t\t\t\t\t\t<ul><li><a href="/help/test" target="{new_win_name}" class="bold">Run our Self-Help Tests</a></li>\t\t\t\t\t\t\t\t\t<li><a href="/help/requests/new" target="{new_win_name}" class="bold">Contact our support team</li></ul>',"files")({new_win_name:TS.templates.builders.newWindowName()}),show_cancel_button:!1,esc_for_ok:!0,onGo:function(){TS.generic_dialog.end(),TS.files.uploadOver(!1),i()}}):"file_uploads_disabled"===e.error?TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("At the request of your administrator, file uploads have been disabled on this workspace.","files")(),show_cancel_button:!1,onGo:function(){TS.files.uploadOver(!1),i()}}):"file_uploads_except_images_disabled"===e.error?TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("At the request of your administrator, only images can be uploaded to this workspace.","files")(),show_cancel_button:!1,onGo:function(){TS.files.uploadOver(!1),i()}}):TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")(),go_button_text:TS.interop.i18n.t("Yes, try again","files")(),cancel_button_text:TS.interop.i18n.t("No, cancel","files")(),onGo:function(){t.retry_num+=1,TS.files.actuallyUpload(t)},onCancel:function(){TS.files.uploadOver(!1),i()}}):(alert("Upload failed."),TS.files.uploadOver(!1))}}})},startPollingForUploadProcessing:function(e,t,n){TS.files.polling_count=0,TS.files.polling_file_id=e,TS.files.polling_ticket=t,TS.files.polling_handler=n,TS.files.pollForUploadProcessing()},pollForUploadProcessing:function(){TS.files.polling_count+=1,TS.files.polling_tim=setTimeout((function(){if(TS.files.polling_ticket){var e=function(e,t,n){TS.files.polling_ticket&&TS.files.polling_handler(e,t,n)};TS.interop.api.callExpedited("files.uploadStatus",{ticket:TS.files.polling_ticket}).then((function(t){var n=t.data,i=t.args,r=t.request_id;return e(!0,n,i),{data:n,args:i,request_id:r}})).catch((function(t){var n=t.data,i=t.args,r=t.request_id;return e(!1,n,i),{data:n,args:i,request_id:r}}))}}),1e3*TS.files.polling_count)},uploadProcessingOver:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};TS.files.polling_file_id==t&&(TS.info("TS.files.uploadProcessingOver polling_file_id:"+TS.files.polling_file_id+" polling_ticket:"+TS.files.polling_ticket+" polling_count:"+TS.files.polling_count),TS.files.polling_count=0,TS.files.polling_file_id=null,TS.files.polling_ticket=null,TS.files.polling_handler=null,clearTimeout(TS.files.polling_tim),TS.files.uploadOver(e,t,n))},uploadOver:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};TS.files.file_uploaded_sig.dispatch(t,n,i),TS.files.uploading=!1,e=null,TS.files.uploadQ.length&&TS.files.actuallyUpload.call(null,TS.files.uploadQ.shift())},cancelCurrentUpload:function(){e&&e.abort()},refreshFile:function(e){TS.files.startRefreshingFile(e),TS.interop.api.call("files.refresh",{file:e}).then((function(e){var t=e.data,n=e.args,i=e.request_id;return TS.files.onFileRefresh&&TS.files.onFileRefresh(!0,t,n,i),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return TS.files.onFileRefresh&&TS.files.onFileRefresh(!1,t,n,i),{data:t,args:n,request_id:i}}))},onFileRefresh:function(e,t,n){var i=n.file,r=TS.menu.$menu.find("#refresh_file").find(".item_label");if(e?r.text(TS.interop.i18n.t("File refreshed!","files")()).end():e||(TS.files.doneRefreshingFile(i,'<span class="moscow_red">'+TS.interop.i18n.t("Refresh failed.","files")()+"</span>",5e3),r.text(TS.interop.i18n.t("Refresh failed","files")()).end()),e&&!t.will_refresh&&TS.files.doneRefreshingFile(i,'<span class="moscow_red">'+TS.interop.i18n.t("File refreshed < 1 minute ago.","files")()+"</span>",5e3),TS.web&&e&&(r.text(TS.interop.i18n.t("Reloading...","files")()),TS.reload(!1,"TS.files.onFileRefresh")),!e&&"file_deleted"===t.error){var a=TS.files.getFileById(i);a&&TS.files.removeFile(a.id)}},startRefreshingFile:function(e){TS.files.waiting_for_refresh[e]=!0,$('.file_refresh[data-file-id="'+e+'"]').addClass("hidden"),$('.file_refresh_status[data-file-id="'+e+'"]').removeClass("hidden")},doneRefreshingFile:function(e,t,n){delete TS.files.waiting_for_refresh[e],$('.file_refresh_status[data-file-id="'+e+'"]').html(t),setTimeout((function(){$('.file_refresh[data-file-id="'+e+'"]').removeClass("hidden"),$('.file_refresh_status[data-file-id="'+e+'"]').text(TS.interop.i18n.t("Refreshing file...","files")()).addClass("hidden")}),n)},updateFileListItem:function(e,t,n){var i=t.find('.file_list_item[data-file-id="'+e.id+'"]');i.length&&(i.replaceWith(TS.templates.builders.fileHTML(e,{viewContext:n})),TS.files.fileIsImage(e)&&t.find(".lazy").lazyload())},containerHasFileListItem:function(e,t){return!!t.find('.file_list_item[data-file-id="'+e.id+'"]').length},nonImageCanUseFSFV:function(e){return!!e&&(TS.model.pdf_viewer_enabled&&"hosted"===e.mode&&TS.files.fileIsPDF(e)&&e.size<=5e7)},clogCompleteUpload:function(e){var t=e.ok,n=e.is_external,i=e.start_time,r=e.initial_comment,a=e.retry_num,s=e.error,o=e.metadata,l=TS.interop.clogTypes.EventId,d=TS.interop.clogTypes.FileUploadType,c=t?l.FILE_COMPLETE_UPLOAD_SUCCESS:l.FILE_COMPLETE_UPLOAD_FAILURE,u=n?d.EXTERNAL:d.ASYNC,_=s?"Failed to upload file: "+s+".":void 0,m=o&&o.fileUploadAction,p=o&&o.fileUploadSrc;TS.interop.clog.track(c,{duration:new Date-i,type:u,has_upload_message:!!r,file_count:1,retry_count:a,file_upload_error_message:_,file_upload_action:m,file_upload_src:p})},test:function(){return{_handleFileUploaded:r}}});var e=null,t=function(e){if(TS.files.fileIsImage(e)){var t={width:e.thumb_360_w,height:e.thumb_360_h,link_url:e.url_private,internal_file_id:e.id};"gif"===e.filetype&&(e.deanimate_gif?TS.inline_imgs.makeInternalInlineImg(e.deanimate_gif,t):e.thumb_160&&TS.inline_imgs.makeInternalInlineImg(e.thumb_160,t)),e.thumb_480_gif||e.thumb_360_gif?(e.thumb_480_gif&&TS.inline_imgs.makeInternalInlineImg(e.thumb_480_gif,t),e.thumb_360_gif&&TS.inline_imgs.makeInternalInlineImg(e.thumb_360_gif,t)):(e.thumb_720&&TS.inline_imgs.makeInternalInlineImg(e.thumb_720,t),e.thumb_480&&TS.inline_imgs.makeInternalInlineImg(e.thumb_480,t),e.thumb_360&&TS.inline_imgs.makeInternalInlineImg(e.thumb_360,t),e.thumb_pdf&&TS.inline_imgs.makeInternalInlineImg(e.thumb_pdf,t))}},n=function(e){var t=_.isString(e)?TS.files.getFileById(e):e;if(!_.isObject(t))throw new Error("Expected file or file ID.");return t},r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e){var i=TS.files.getFileById(t);if(i)if(TS.boot_data.feature_file_threads&&n.thread_ts){var r=n.channels,a=n.thread_ts;TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:r,threadTs:a})),n.broadcast&&TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:r}))}else{var s=TS.interop.files.getFileShareLocations(i);s.forEach((function(e){return TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:e}))}))}}}}()},G4VQ:function(e,t){var n,i,r;n=10,i=10,r=100,TS.registerComponent("SearchableEnterpriseTeamList",{_constructor:function(e){this.id=e.id,this.triggered_by_user_action=e.triggered_by_user_action,this.$_container=e.$container,this.$_long_list_view,this.$_search_bar,this.$_search_input,this.$_clear_icon,this._team_searcher={},this._have_all_teams=!1,this._model_ob_id=e.model_ob_id,this._omit_my_team=!!e.omit_my_team,this._current_query="",this._approx_item_height=30,this._long_list_view_height=0,this._long_list_view_items_height=0,this._long_list_view_initial_height=null,this._fetch_page_p=null,this._resize_sig_handler=null,this.team_clicked_sig=new signals.Signal},destroy:function(){this.$_container.off(),this.$_long_list_view&&this.$_long_list_view.off(),this.$_search_input&&this.$_search_input.off(),this.$_clear_icon&&this.$_clear_icon.off(),this.$_long_list_view&&this.$_long_list_view.length&&$.data(this.$_long_list_view.get(0),"TS-longListView")&&this.$_long_list_view.longListView("destroy"),this.$_search_bar&&this.$_search_bar.remove()},showInitial:function(){var e=this;this.$_long_list_view=this.$_container.find(".p-searchable_enterprise_team_list__scroller"),this._showLoadingState(),this._fetchPage().then((function(){e._hideLoadingState()})).then((function(){return e._setupLongListView(),e._maybeSetupSearchBar(),null}))},maybeRerenderLongListView:function(){this.$_long_list_view&&_.get(this._team_searcher,"items")&&this.$_long_list_view.longListView("setItems",this._team_searcher.items,!0,!0)},_fetchPage:function(){if(this._fetch_page_p)return this._fetch_page_p;var e=this;return this._setupSearcher(),this._fetch_page_p=TS.teams.promiseToSearchTeams(this._team_searcher).then((function(){e._fetch_page_p=null,e._have_all_teams=e._team_searcher.num_remaining<=0})),this._fetch_page_p},_setupSearcher:function(){this._team_searcher.max_api_results=this._current_query?r:i;var e=TS.interop.utility.looksLikeMemberId(this._model_ob_id)?TS.interop.members.getMemberById(this._model_ob_id):TS.redux.channels.getEntityById(this._model_ob_id);this._team_searcher.included_ids=TS.interop.utility.looksLikeMemberId(_.get(e,"id"))?_.get(e,"enterprise_user.teams",[]):TS.interop.rules.channels.getInternalTeamIds(TS.redux.getState(),e),_.get(TS.model.user,"is_restricted")&&(this._team_searcher.included_ids=_.intersection(_.get(TS.model.user,"enterprise_user.teams"),this._team_searcher.included_ids)),this._omit_my_team&&(this._team_searcher.omitted_ids=[TS.model.team.id]),this._current_query&&(this._team_searcher.query=this._current_query)},_fetchProcessAndDisplayPage:function(){var e=this;return this._fetchPage().then((function(){return e._maybeHideNoResultsState(),_.get(e._team_searcher,"items.length")?e.$_long_list_view.longListView("setItems",e._team_searcher.items,!0,!0):e._showNoResultsState(),null})).then((function(){return TS.utility.rAF((function(){e._long_list_view_height=e.$_long_list_view.height(),e._long_list_view_items_height=e.$_long_list_view.find(".list_items").height(),e._recursivelyFillLongListViewToHeight()})),null}))},_maybeSetupSearchBar:function(){var e=this;if(!this.$_search_bar){var t=TS.interop.utility.looksLikeMemberId(this._model_ob_id)?TS.interop.members.getMemberById(this._model_ob_id):TS.redux.channels.getEntityById(this._model_ob_id);(TS.interop.utility.looksLikeMemberId(_.get(t,"id"))?_.get(t,"enterprise_user.teams.length"):_.get(t,"is_global_shared")?1/0:TS.interop.rules.channels.getInternalTeamIds(TS.redux.getState(),t).length)>=n&&(e.$_long_list_view.before(TS.templates.teams_search_bar()),e.$_search_bar=e.$_container.find(".p-searchable_enterprise_team_list__search_bar"),e.$_search_input=e.$_search_bar.find(".p-searchable_enterprise_team_list__input"),e._setupSearchInput())}},_setupSearchInput:function(){var e=this;this.$_search_bar.find(".p-searchable_enterprise_team_list__search.loading").replaceWith(TS.templates.teams_search_bar_input()),this.$_search_input=this.$_search_bar.find(".p-searchable_enterprise_team_list__input"),this.$_clear_icon=this.$_container.find(".icon_close"),this.$_search_input.bind("keyup.searchable_enterprise_team_list",this._handleSearchKeyUp.bind(this)),this.$_clear_icon.bind("click",(function(){e._reset(),Promise.resolve().then((function(){return e.$_search_input.focus(),null}))})),this.triggered_by_user_action&&this.$_search_input.focus()},_setupLongListView:function(){var e=this,t=TS.interop.utility.looksLikeMemberId(this._model_ob_id);this.$_long_list_view.longListView({items:this._team_searcher.items||[],approx_item_height:this._approx_item_height,approx_divider_height:this._approx_divider_height,calcItemHeight:function(e){return e.outerHeight()},makeElement:function(){return $(TS.templates.teams_list_item())},renderItem:function(n,i){var r=TS.model.team.id!==i.id,a=t&&r;n.html(TS.templates.teams_team_row({team:i,linked:!!a&&e._buildTeamLink(i),target:a?e._buildTeamLinkTarget(i):""})),TS.utility.makeSureAllLinksHaveTargets(n)}}),this.$_long_list_view.on("click","[data-long-list-item]",(function(t){e.team_clicked_sig.dispatch(t,TS.teams.getTeamById($(t.target).closest(".p-enterprise_team_item").find("[data-team-id]").data("teamId")))})),this._resize_sig_handler=_.throttle((function(){e._long_list_view_height=e.$_long_list_view.height(),e._long_list_view_items_height=e.$_long_list_view.find(".list_items").height(),e._long_list_view_initial_height||(e._long_list_view_initial_height=e._long_list_view_height)}),33),this.$_long_list_view.on("scroll",_.debounce((function(t){e._current_query||e._long_list_view_items_height-($(t.target).scrollTop()+e._long_list_view_height)<100&&e._fetchProcessAndDisplayPage()}),100)),TS.utility.rAF((function(){e._recursivelyFillLongListViewToHeight()}))},_recursivelyFillLongListViewToHeight:function(){var e=this;this._current_query||this._long_list_view_items_height<=this._long_list_view_height&&!this._have_all_teams&&this._fetchProcessAndDisplayPage().then((function(){e._long_list_view_items_height=e.$_long_list_view.find(".list_items").height()}))},_reset:function(){this._team_searcher={},this._current_query="",this.$_search_input.val(""),this.$_clear_icon.addClass("hidden"),this._have_all_teams=!1,this._maybeHideNoResultsState(),this.$_long_list_view.longListView("setItems",[],!0,!0),this.$_long_list_view.scrollTop(0),this.$_long_list_view.height(this._long_list_view_initial_height),this._fetchProcessAndDisplayPage()},_showLoadingState:function(){this.$_long_list_view.before(TS.templates.infinite_spinner({color:"white",size:"medium"}))},_hideLoadingState:function(){this.$_container.find(".infinite_spinner").remove()},_showNoResultsState:function(){var e=this.$_container.find(".no_results");e.length>0&&e.remove();var t=this,n={query:this._current_query},i=TS.templates.teams_searchable_no_results(n);this.$_long_list_view.hide().before(i),this.$_container.on("click",".clear_enterprise_team_filter",(function(){t._reset()}))},_maybeHideNoResultsState:function(){var e=this.$_container.find(".no_results");if(0!=e.length){var t=this.$_container.find(".other_matches");t&&t.remove(),e.remove(),this.$_long_list_view.show()}},_handleSearchKeyUp:function(e){var t=$(e.target).val();t.trim()!==this._current_query&&(this._fetch_page_p&&(this._fetch_page_p.cancel(),this._fetch_page_p=null),this._team_searcher={},this._have_all_teams=!1,this._current_query=t.trim(),this._fetchProcessAndDisplayPage(),this.$_long_list_view.scrollTop(0),this.$_clear_icon.toggleClass("hidden",!this._current_query))},_buildTeamLink:function(e){return TS.utility.enterprise.buildTeamUrl(e.domain)+"home"},_buildTeamLinkTarget:function(e){return TS.utility.enterprise.buildTeamUrl(e.domain)},test:function(){var e={};return Object.defineProperty(e,"MINIMUM_TEAMS_FOR_SEARCH",{get:function(){return n},set:function(e){n=e}}),Object.defineProperty(e,"FETCH_PAGE_SIZE",{get:function(){return i},set:function(e){i=e}}),Object.defineProperty(e,"FETCH_PAGE_SIZE_SEARCH",{get:function(){return r},set:function(e){r=e}}),e}})},GNek:function(e,t){TS.registerModule("redux.reactions",{getReactionsForKey:function(e){return TS.interop.redux.models.reactions.getReactionsForKey(TS.redux.getState(),e)},getReactionsForKeyAndName:function(e,t){return TS.interop.redux.models.reactions.getReactionsForKeyAndName(TS.redux.getState(),e,t)},changeReactionFromUserAction:function(e,t,n){return TS.redux.dispatch(TS.interop.redux.actions.changeReactionFromUserAction({key:e,name:t,adding:n}))},addOrRemoveReaction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.adding,n=e.key,i=e.name,r=e.userId,a=e.url,s=e.fromUserAction,o=TS.redux.reactions.getReactionsForKey(n),l=t?TS.interop.redux.models.reactions.addReaction({key:n,name:i,userId:r,url:a,fromUserAction:s}):TS.interop.redux.models.reactions.removeReaction({key:n,name:i,userId:r,url:a,fromUserAction:s}),d=TS.redux.dispatch(l),c="NOOP",u=TS.redux.reactions.getReactionsForKey(n);return d&&(u&&_.isEmpty(o)?c="ADDED":_.isEqual(o,u)||(c="CHANGED")),{status:c,what_changed:[],rxns:u}},upsertReactions:function(e,t,n){var i=TS.redux.reactions.getReactionsForKey(e),r="NOOP";return TS.redux.dispatch(TS.interop.redux.models.reactions.upsertReactions({key:e,reactions:t,fromUserAction:n}))&&(t&&_.isEmpty(i)?r="ADDED":_.isEqual(i,t)||(r="CHANGED")),{status:r,what_changed:[],rxns:t}}})},GhNQ:function(e,t){!function(){function e(e,t){if(e&&t&&t.length){var n=_.map(t,"id"),i=_.cloneDeep(e);return i.actions.forEach((function(e){e._disabled=!0,e._loading=_.includes(n,e.id)})),i._pending=!0,i}}function t(t){if(t&&t.message&&t.attachment&&t.action&&t.channel_id){var n=e(t.attachment,[t.action]);n&&TS.attachment_actions.render(n,t.message.ts);var i=_.clone(t.action);delete i.options;var r={actions:[i],attachment_id:t.attachment.id,callback_id:t.attachment.callback_id,channel_id:t.channel_id,is_ephemeral:t.message.is_ephemeral,message_ts:t.message.ts},a=_.get(t.message,"bot_profile.team_id",!1);a&&(r.team_id=a);var s={payload:JSON.stringify(r),client_token:TS.interop.client_action_token.generateAndEnqueue()};t.message.bot_id&&(s.service_id=t.message.bot_id),t.message.user&&(s.bot_user_id=t.message.user),TS.interop.api.call("chat.attachmentAction",s).then((function(e){TS.attachment_actions.action_completed_sig.dispatch({attachment:t.attachment,message_ts:t.message.ts,channel_id:t.channel_id,is_expecting_ms_update:!(!_.get(e,"data.replaced")&&!_.get(e,"data.deleted"))})})).catch((function(e){TS.error(e),TS.attachment_actions.action_completed_sig.dispatch({attachment:t.attachment,message_ts:t.message.ts,channel_id:t.channel_id,err:e})}))}else TS.warn("_onActionTriggered: missing message, attachment, action, or channel_id")}function n(e){e&&e.attachment&&e.message_ts&&e.channel_id&&!e.is_expecting_ms_update&&function(e){TS.utility.rAF((function(){var t=TS.utility.attachments.findAttachment({attachment_id:e.attachment.id,message_ts:e.message_ts,channel_id:e.channel_id});t&&TS.attachment_actions.render(t,e.message_ts,!0)}))}(e)}function i(e){var t=e.parents("[data-attachment-id]"),n=t.parents("ts-message"),i={action_id:String(e.data("action-id")||""),attachment_id:String(t.data("attachment-id")||""),channel_id:String(n.data("model-ob-id")||""),message_ts:String(n.data("ts")||"")};return Object.keys(i).forEach((function(e){if(!i[e])throw new Error('Attachment is missing "'+e+'"')})),i}TS.registerModule("attachment_actions",{action_triggered_sig:new signals.Signal,action_completed_sig:new signals.Signal,onStart:function(){TS.attachment_actions.action_triggered_sig.add(t),TS.attachment_actions.action_completed_sig.add(n)},getActionContext:function(e){var t=i(e),n=TS.utility.msgs.findMsg(t.message_ts,t.channel_id);if(n){var r=_.find(n.attachments,{id:t.attachment_id});if(r){var a=_.find(r.actions,{id:t.action_id});if(a)return{action:a,attachment:r,channel_id:t.channel_id,message:n}}}},handleActionEventAndGetContext:function(e){var t=e.data("url");if(!t)return TS.attachment_actions.getActionContext(e);var n=t.match(/<(.*?)\|/),i=n?n[1]:t;if(i)if(0===i.indexOf(TS.utility.msgs.new_api_url_prefix))TS.utility.msgs.doNewApiUrl(i);else{var r=TS.model.isSSB()&&parseFloat(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor)>=2.6,a=TS.interop.url.parseUrl(t);TS.interop.url.isValidSlackHostName(a.hostname)&&"/oauth/authorize"===a.pathname&&r?TS.utility.openAuthenticatedInBrowser(a.pathname+a.search):TS.utility.openInNewTab(t,"_blank",{dontEncodeHash:!0})}},confirmAction:function(e,t,n){var i="danger"===e.style?"btn_danger":"btn_primary",r=_.defaults(e.confirm,{dismiss_text:TS.interop.i18n.t("Cancel","attachment_actions")(),ok_text:TS.interop.i18n.t("OK","attachment_actions")(),text:"",title:""});r.text?r.text=TS.emoji.graphicReplace(r.text):r.title||(r.text=TS.interop.i18n.t("Are you sure?","attachment_actions")()),r.title&&(r.title=TS.emoji.graphicReplace(r.title)),TS.generic_dialog.start({title:r.title,body:r.text,show_go_button:!0,show_cancel_button:!0,go_button_text:r.ok_text,go_button_class:i,cancel_button_text:r.dismiss_text,onGo:t,onCancel:n})},render:function(e,t,n){if(e&&t){var i=function(e,t){var n=TS.templates.makeMsgDomId(t);return $("#"+n+", #"+n+"_conversation").find("[data-attachment-id="+e.id+"] .attachment_actions")}(e,t);if(i.length&&(!n||i.find(".attachment_actions_interactions").hasClass("attachment_pending"))){var r=TS.templates.attachment_actions({attachment:e,message_ts:t});i.html(r),TS.attachment_actions.select.decorateNewElements(i)}}},test:function(){var t={};return Object.defineProperty(t,"_getActionContextDataFromDOM",{get:function(){return i},set:function(e){i=e}}),Object.defineProperty(t,"_getPendingAttachment",{get:function(){return e},set:function(t){e=t}}),t}})}()},GhXE:function(e,t,n){var i=n("cDf5");!function(){var e="STORAGE";TS.registerModule("storage",{version:"0.85",msgs_version:window.boot_data&&boot_data.cache_version||"unknown_version",cache_ts_version:window.boot_data&&boot_data.cache_ts_version||"unknown_version",do_compression:!(TS.model.is_our_app||void 0===window.Worker||window.bowser&&(bowser.phantom||bowser.msie)),test:function(){return{getLocalStorage:I,setLocalStorage:E,getKeys:h,set:C}},onStart:function(){TS.storage.onStart=function(){},TS.storage.do_compression||(TS.interop.console.info(e,"Special case: force-enabling LS compression for this session."),TS.storage.do_compression=!0),TS.storage.version+=TS.storage.do_compression?"-compressed-LZString":"";var n=t||!M||!TS.storage.storageAvailable()&&(S(),!TS.storage.storageAvailable())&&(TS.interop.console.info(e,"TS.storage.storageAvailable() = false in onStart after flushing all our keys, so disabling"),!0);TS.has_pri[F]&&(TS.log(F,"TS.storage.onStart should_disable:"+n),TS.log(F,"TS.storage.do_compression:"+TS.storage.do_compression+" (_ls.getItem('is_compressed') === 'yes'):"+(M&&"yes"===M.getItem("is_compressed")))),TS.ui.window_unloaded_sig.add(b),TS.ui.window_focus_changed_sig.add(v),TS.storage.setDisabled(n),C("rxn_records",null);var i=TS.storage.fetchExpandableState();TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(i))},setDisabled:function(e){t!=e&&(e||!M?(t=!0,M&&S()):(t=!1,g()),TS.log(F,"_disabled:"+t))},storageAvailable:function(){if(!M)return!1;try{var e="test_to_see_if_we_can_write_to_local_storage";return M.setItem(e,"foo"),M.removeItem(e),!0}catch(e){return!1}},storageSize:function(t){var n=0;if(!M)return n;for(var r,a,s=h(),o=0,l=0;l<s.length;l+=1)o+=1,r=s[l],(a=M.getItem(r))||""===a?(n+=a.length,t&&TS.info(r+"="+(2*a.length/1024).toFixed(2)+"KB (total="+(n/1024).toFixed(2)+"KB)")):TS.interop.console.info(e,r+" not measurable value, typeof:"+i(a));return t&&TS.info("total for "+o+" items is "+(n/1024).toFixed(2)+"KB"),n},completelyEmptyAllStorageAndReset:function(){TS.info("completelyEmptyAllStorageAndReset running"),T(),TS.storage.storeLastEventTS("",!0,!0);var e=TS.storage.fetchLastEventTS(!0);TS.info("completelyEmptyAllStorageAndReset fetched_b4_flush:"+e),e&&(TS.info("completelyEmptyAllStorageAndReset _getKeys:"+h().join(", ")),TS.info("completelyEmptyAllStorageAndReset Object.keys(_buffer):"+Object.keys(l).join(", "))),w(!0,"completelyEmptyAllStorageAndReset");var t=TS.storage.fetchLastEventTS(!0);TS.info("completelyEmptyAllStorageAndReset fetched_after_flush:"+t),t&&(TS.info("completelyEmptyAllStorageAndReset _getKeys:"+h().join(", ")),TS.info("completelyEmptyAllStorageAndReset Object.keys(_buffer):"+Object.keys(l).join(", ")))},flush:function(e){TS.has_pri[F]&&TS.log(F,"TS.storage.flush()"),S(),e&&TS.storage.clearBufferAndCache()},clearBufferAndCache:function(){TS.has_pri[F]&&TS.log(F,"TS.storage.clearBufferAndCache()"),l={},d={},TS.compresion&&TS.compression.terminate()},fetchStorageVersion:function(){return k("storage_version")},storeStorageVersion:function(e){C("storage_version",e,!0)},fetchCacheTSStorageVersion:function(){return k("storage_cache_ts_version")},storeCacheTSStorageVersion:function(e){C("storage_cache_ts_version",e,!0)},_makeMsgInputId:function(e){return"msg_input_"+e},fetchLastMsgInput:function(e){var t=k(TS.storage._makeMsgInputId(e),null);return"\u4000"===t?(TS.interop.utility.getLogger({getState:TS.redux.getState}).error({storage_version:TS.storage.fetchStorageVersion(),ts_storage_version:TS.storage.version,is_our_app:TS.model.is_our_app,typeof_window_worker:i(window.Worker),has_bowser:!!window.bowser},"decompress_general_compressed_fail"),""):t},storeLastMsgInput:function(e,t){C(TS.storage._makeMsgInputId(e),t)},legacyGetAllDraftChannelIds:function(){return h().map((function(e){return e.match(/msg_input_(C|G|D)[A-Z0-9]{8,}$/)?e.split("_")[3]:void 0})).filter((function(e){return e&&!!TS.storage.fetchLastMsgInput(e)}))||[]},_makeCommentInputId:function(e){return"comment_input_"+e},fetchLastCommentInput:function(e){return k(TS.storage._makeCommentInputId(e),null)},storeLastCommentInput:function(e,t){C(TS.storage._makeCommentInputId(e),t)},fetchOldestTs:function(e){return k(s(e),null)},storeOldestTs:function(e,t){C(s(e),t)},fetchActiveHistory:function(){return k("active_history",[])||[]},storeActiveHistory:function(e){C("active_history",e,!0)},fetchLastEventTS:function(e){return k("last_event_ts","",e)||""},storeLastEventTS:function(e,t,n){C("last_event_ts",e,t,n)},fetchUIState:function(){var e=k("ui_state",{})||{};return _.isString(e)&&(e={}),e},storeUIState:function(e){C("ui_state",e)},fetchExpandableState:function(){var e=k("expandable_state",{});return e&&"object"===i(e)?e:{}},storeExpandableState:function(e){C("expandable_state",e)},fetchClientWindows:function(){return k("client_windows",{})||{}},storeClientWindows:function(e){C("client_windows",e)},fetchInputHistory:function(){var e=k("input_history",[])||[];"string"==typeof e&&(e=[e]);return e.length>300&&(e.length=300),e},storeInputHistory:function(e){C("input_history",e)},fetchCustomEmoji:function(){return k("custom_emoji",null)||null},storeCustomEmoji:function(e){C("custom_emoji",e)},fetchStaticTranslations:function(){return k("static_translations",null)||null},storeStaticTranslations:function(e){C("static_translations",e)},fetchApps:function(){return k("apps",null)||null},storeApps:function(e){C("apps",e)},fetchAppsSearchResults:function(){return k("apps_search",null)||null},storeAppsSearchResults:function(e){C("apps_search",e)},fetchCmds:function(){return k("cmds",null)||null},storeCmds:function(e){C("cmds",e)},fetchChannelPageState:function(){return k("channel_page_state",{})||{}},storeChannelPageState:function(e){C("channel_page_state",e)},fetchInvitesState:function(){return k("invites_state",[])||[]},storeInvitesState:function(e){C("invites_state",e)},fetchReplyInput:function(e,t){var n=k("reply_inputs")||[],i=_.find(n,{model_ob_id:e,thread_ts:t});return i?i.text:""},storeReplyInput:function(e,t,n){var i=k("reply_inputs")||[];(i=_.reject(i,{model_ob_id:e,thread_ts:t})).length>10&&i.shift(),i.push({model_ob_id:e,thread_ts:t,text:n}),C("reply_inputs",i)},fetchFilterState:function(){return k("team_filter_state","")||""},storeFilterState:function(e){C("team_filter_state",e)},fetchCallsState:function(){return k("calls_state",{})||{}},storeCallsState:function(e){C("calls_state",e)},fetchFrecency:function(e){return k("frecency_"+e)},storeFrecency:function(e,t){C("frecency_"+e,t)},clearFrecency:function(e){C("frecency_"+e,"")},fetchEnterpriseState:function(){return k("enterprise_state",{})||{}},storeEnterpriseState:function(e){C("enterprise_state",e)},fetchLastEKMChangeTimestamp:function(){return k("last_ekm_change_ts","0")||"0"},storeLastEKMChangeTimestamp:function(e){C("last_ekm_change_ts",e)}});var t,n=window.boot_data.user_id+"_",r="channel_msgs_",a="oldest_msg_ts_",s=function(e){return a+e},o=!1,l={},d={},c=!1,u=!1,m=1e3,p=!1,f=!1,h=function(){var e=[];if(!M)return e;var t=M.length;if(!t)return e;for(var n=0;n<t;n+=1)e.push(M.key(n));return e},g=function(){var i;if(!t){var r=-1!=(TS.storage.fetchStorageVersion()||"").indexOf("-compressed")||"yes"===M.getItem("is_compressed");TS.storage.do_compression&&!r?(TS.interop.console.info(e,"migrating to compressed format"),(i=h()).forEach((function(e){var t=e.replace(n,""),i=x(e,M.getItem(e)),r="converting: "+e+" -> "+t+" val.length: "+(null==i?-1:String(i).length);C(t,null),C(t,i),k(t)==i?TS.has_pri[F]&&TS.log(F,r+" SUCCESS _get(name) has a value:"+!!k(t)+", and it it the same as val"):TS.error(r+" FAILURE _get(name) !== val")})),TS.interop.console.info(e,"migration to compressed format complete, "+i.length+" migrated"),TS.storage.storeStorageVersion(TS.storage.version)):TS.has_pri[F]&&TS.log(F,"no migration needed"),M.setItem("is_compressed",TS.storage.do_compression?"yes":"no")}var a=TS.storage.fetchCacheTSStorageVersion();TS.has_pri[F]&&TS.log(F,"storage_cache_ts_version:"+a);var s=TS.storage.fetchStorageVersion()||"";TS.has_pri[F]&&(TS.log(F,"TS.storage.version:"+TS.storage.version),TS.log(F,"storage_version:"+s),TS.log(F,"TS.storage last_unload_flushing: "+k("last_unload_flushing")),TS.log(F,"TS.storage.storageAvailable(): "+TS.storage.storageAvailable())),i=h(),TS.has_pri[F]&&TS.dir(F,i,"_getKeys()"),TS.storage.storageAvailable()?s!=TS.storage.version?(TS.log(F,"storage_version:"+s+" does not match TS.storage.version:"+TS.storage.version+" so flushing all our keys: "+i.join(", ")),S()):TS.storage.fetchLastEventTS()||(TS.log(F,"TS.storage.fetchLastEventTS() is empty so flushing channel data"),T()):(TS.log(F,"TS.storage.storageAvailable() = false so flushing all our keys"),S()),TS.storage.storeStorageVersion(TS.storage.version)},S=function(){h().forEach((function(e){0===e.indexOf(n)&&M.removeItem(e)}))},T=function(){var e,t=h();TS.has_pri[F]&&TS.log(F,t,"_getKeys()");for(var i=0;i<t.length;i+=1)0===(e=t[i]).indexOf(n)&&(-1==e.indexOf(r)&&-1==e.indexOf(a)||(M.removeItem(e),delete l[e]));for(e in l)0===e.indexOf(n)&&(-1==e.indexOf(r)&&-1==e.indexOf(a)||delete l[e]);d={},t=h(),TS.dir(488,t,"_getKeys()")},b=function(){o=!0,C("last_unload_flushing",(new Date).toString(),!0),w(!0,"_windowUnloaded"),TS.compression.terminate()},v=function(){w(!0,"_windowBlurred")},y=function(e){return"string"!=typeof e&&"number"!=typeof e&&e?JSON.stringify(e):e},w=function(e,n){if(!t){var i,r,a,s,o,c,u,_=new Date,h=Date.now(),g=0,T=TS.model&&TS.model.team&&TS.model.team.domain&&TS.boot_data.feature_tinyspeck;for(r in l)if(!l[r].being_flushed){if(null==(c=y(l[r].val)))M.removeItem(r),delete l[r],delete d[r];else try{A(r,c)}catch(e){TS.error(0,e),S(),delete l[r],delete d[r];continue}if(g+=1,i=Date.now()-h,T&&TS.has_pri[F]&&TS.log(F,"_flushBuffer _ls.setItem "+r+": "+i+"ms "+(l[r]&&l[r].val&&l[r].val.toString?l[r].val.toString().substr(0,100):"NULL?")),!e&&(a=new Date-_,!p&&a>m)){p=!0,o=new Date;try{s=TS.storage.storageSize()}catch(e){}o=new Date-o,u="Took "+a+"ms for "+g+" item (!all case) (threshold is "+"1000 ms). Key: "+r+". Buffer length: "+(l[r]&&l[r].val&&l[r].val.toString()?l[r].val.toString().length:"unknown (not a string)")+". localStorage size: "+(s||"unknown")+". Time to read LS size: "+o,TS.info("_flushBuffer exceeded slow write threshold: "+u)}if(l[r]&&(l[r].being_flushed=!0),!e)return void(TS.has_pri[F]&&TS.log(F,"_flushBuffer: Wrote one item. why: "+n));d={}}if(g&&!f&&(a=new Date-_)>m){f=!0;try{s=TS.storage.storageSize()}catch(e){}u="Took "+a+"ms for "+g+" items (threshold is "+"1000 ms). localStorage size: "+s+". App open for "+((Date.now()-TS.boot_data.start_ms)/1e3/60).toFixed(2)+" min. why: "+n,TS.info("_flushBuffer exceeded slow write threshold (all case): "+u)}TS.has_pri[F]&&(0===g?TS.log(F,"_flushBuffer: Nothing to save."):TS.log(F,"_flushBuffer: Saved "+g+(1===g?" item":" items")+" why: "+n))}},k=function(e,i,r){var a=n+e;if(r&&TS.info("_get name:"+e+" k:"+a+" disabled:"+t+' _buffer["'+a+'"].val:'+(l[a]&&l[a].val)),t)return l[a]&&l[a].val||i;if(a in l)return l[a]&&l[a].val||i;if(d.hasOwnProperty(a))return d[a];var s=x(a,O(a,M.getItem(a)),i,r);return d[a]=s,s},x=function(e,t,n,r){var a,s=new Date,o=function(e){return"undefined"===e||"null"===e?null:e}(t);if(r&&TS.info("_get _correctBadValsFromStorage(_ls.getItem(k)) k:"+e+" typeof result:"+i(o)+" /^[{[]/.test(result):"+/^[{[]/.test(o)),o&&"string"==typeof o&&/^[{[]/.test(o)&&(o=TS.utility.parseJSONOrElse(o)||o),o=o||(void 0!==n?n:null),s=new Date-s,!c&&s>1e3){c=!0;try{a=TS.storage.storageSize()}catch(e){}var l="_get took longer than threshold: Took "+s+"ms to read "+e+" (theshold is 1000ms), length = "+(o&&!isNaN(o.length)?o.length:"unknown")+". Storage size: "+a;TS.info(l)}return o},C=function(i,r,a,s){var o,c=!1,_=new Date,m=n+i;if(l[m]={val:r,being_flushed:!1},d[m]=l[m].val,s&&TS.info("_set immediate:"+a+" name:"+i+" k:"+m+" disabled:"+t+" do_compression:"+TS.storage.do_compression+' _buffer["'+m+'"].val:'+l[m].val),a){if(!t){var p=y(r);if(null==p)M.removeItem(m),delete l[m];else try{A(m,p,a)}catch(e){TS.interop.console.warn("_set _ls.setItem failed, flushing. TS.storage.storageSize():"+TS.storage.storageSize(!1)),c=!0}}if(s&&TS.info("_set failed:"+c),!c)if(s&&TS.info('_set _buffer["'+m+'"]:'+(l[m]&&JSON.stringify(l[m]))),(_=new Date-_)>1e3){if(TS.interop.console.info(e,"_set immediately "+i+": "+_+"ms "+(r&&r.toString?r.toString().substr(0,100):"NULL?")),!u){u=!0;try{o=TS.storage.storageSize()}catch(e){}var f="_set exceeded slow set threshold (immediate): Took "+_+"ms to write "+m+" (theshold is 1000ms), length = "+(r&&!isNaN(r.length)?r.length:"unknown")+". Storage length: "+o;TS.info(f)}}else TS.has_pri[F]&&TS.log(F,"_set GOOD immediately: "+a+" "+i+": "+_+"ms",r)}},M=window.localStorage,I=function(){return M},E=function(e){M=e},A=function(e,t,n){t=String(t),TS.storage.do_compression?TS.compression.compress(e,t,n||o,P):P({k:e,str:t})},P=function(t){M.setItem(t.k,t.str);!function n(r){var a=M.getItem(t.k);if(a===t.str)return r>1&&TS.interop.console.info(e,t.k+" now saved, try #"+r),delete l[t.k],void delete d[t.k];!(r>1)||l[t.k]&&l[t.k].val==t.str?(TS.error("WTF not saved, try #"+r+" "+t.k+" "+(t.str||"").length+" typeof ob.str:"+i(t.str)+" from_ls:"+i(a)),M.setItem(t.k,t.str),setTimeout(n,1e3,r+1)):TS.error("buffer changed for "+t.k+" so we don't care anymore, a new value is being set for it, try #"+r)}(1)},O=function(e,t){if(!TS.storage.do_compression)return"\u4000"===t?(TS.interop.utility.getLogger({getState:TS.redux.getState}).error({storage_version:TS.storage.fetchStorageVersion(),ts_storage_version:TS.storage.version,is_our_app:TS.model.is_our_app,typeof_window_worker:i(window.Worker),has_bowser:!!window.bowser},"decompress_empty_string_fail"),""):t;var n=Date.now();t&&(t=LZString.decompress(t));var r=Date.now()-n;return t&&TS.has_pri[F]&&TS.log(F,e+" took "+r+"ms to _decompress str.length: "+t.length),"\u4000"===t?(TS.interop.utility.getLogger({getState:TS.redux.getState}).error({storage_version:TS.storage.fetchStorageVersion(),ts_storage_version:TS.storage.version,is_our_app:TS.model.is_our_app,typeof_window_worker:i(window.Worker),has_bowser:!!window.bowser},"decompress_double_compressed_fail"),""):t},F=488}()},HUaD:function(e,t){!function(){TS.registerModule("enterprise.workspaces",{onStart:function(){},joinTeam:function(e){var n=TS.teams.getTeamById(e);if(!n)return TS.generic_dialog.alert(TS.interop.i18n.t("Invalid workspace","enterprise_dashboard")(),TS.interop.i18n.t("Oops! Something went wrong.","enterprise_dashboard")());if(!n.is_open&&!n.is_assigned)return TS.generic_dialog.alert(TS.interop.i18n.t("This workspace is not available to join.","enterprise_dashboard")(),TS.interop.i18n.t("Oops! Something went wrong.","enterprise_dashboard")());var i={team:n.id};"client"===TS.boot_data.app&&(i.enterprise_token=TS.model.enterprise_api_token);var r=function(e,n,i){var r=TS.teams.getTeamById(i.team),a=new Handlebars.SafeString(emoji.replace_colons(":sparkles:")+TS.interop.i18n.t(" You\u2019ve successfully joined <strong>{team_name}</strong>","enterprise_dashboard")({team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(r)))}));return e?(TS.redux.teams.upsertTeam(_.merge({},TS.teams.getTeamById(i.team),{joined_date:n.joined_date})),t("success",a),!0):"user_already_team_member"===n.error?(t("success",a),!0):"team_is_not_open"===n.error?(t("error",TS.interop.i18n.t("This workspace is not open to join.","enterprise_dashboard")()),!1):(t("error",TS.interop.i18n.t('Joining workspace failed with error "{error}"',"enterprise_dashboard")({error:n.error})),!1)};return TS.interop.api.call("enterprise.teams.join",i).then((function(e){var t=e.data,n=e.args,i=e.request_id;return r(!0,t,n),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return r(!1,t,n),{data:t,args:n,request_id:i}}))},requestToJoinTeam:function(e,n){var i={team:e};n&&(i=_.merge({},i,n)),"client"===TS.boot_data.app&&(i.enterprise_token=TS.model.enterprise_api_token);var r=function(e,n,i){var r=TS.teams.getTeamById(i.team),a=new Handlebars.SafeString(TS.interop.i18n.t("Request to join <strong>{team_name}</strong> sent!","enterprise_dashboard")({team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(r)))}));return e?(TS.redux.teams.upsertTeam(_.merge({},TS.teams.getTeamById(i.team),{has_join_request:!0})),t("success",a),!0):(t("error",TS.interop.i18n.t("Your request couldn\u2019t be sent. Try again later, or contact the Workspace Admin for help.","enterprise_dashboard")({error:n.error})),!1)};return TS.interop.api.call("enterprise.teams.joinrequests.create",i).then((function(e){var t=e.data,n=e.args,i=e.request_id;return r(!0,t,n),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return r(!1,t,n),{data:t,args:n,request_id:i}}))},createLogoutURL:function(e,t){var n=document.createElement("a");n.href=t;var i=n.protocol+"//"+n.host+"/signout/"+e+n.search+n.hash;return n=null,i},recordTeamLeave:function(t,n,i){i||(i="");var r={anchor_page:n,entity_key:"leave_workspace",target_team_id:t,tracking_code:i};TS.interop.clog.track(e,_.assign({},r,{contexts:{ui_context:{action:"click",action_status:1}}}))},recordTeamLeaveConfirm:function(t,n,i){i||(i="");var r={anchor_page:n,entity_key:"leave_workspace_confirm",target_team_id:t,tracking_code:i};TS.interop.clog.track(e,_.assign({},r,{contexts:{ui_context:{action:"click",action_status:1}}}))},showRequestDialog:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.displayModernToast,r=void 0===i?_.noop:i,a="#generic_dialog",s=".dialog_go",o="enterprise.teams.creationrequests.create",l="#input_ws_team_name",d="#textarea_ws_team_message";function c(){var n=$(a).find(s);return e&&t?(n.removeAttr("disabled"),!0):(n.attr("disabled",!0),!1)}TS.generic_dialog.start({title:TS.interop.i18n.t("Request creation of a new workspace","enterprise_workspaces")(),body:TS.templates.ws_request_dialog(),show_cancel_button:!0,show_go_button:!0,go_button_text:TS.interop.i18n.t("Send Request","enterprise_workspaces")(),onGo:function(){var e=$(a),t=$(l),n=_.escape(t.val()),i=$(d).val(),c=e.find(s);c.addClass("ladda-button"),c.attr("data-style","expand-right");var u=Ladda.create(c[0]);u.start();var m={name:_.unescape(n),reason:i};return"client"===TS.boot_data.app&&(m.enterprise_token=TS.model.enterprise_api_token),TS.interop.api.callExpedited(o,m).then((function(){r({type:"success",teamName:n}),TS.generic_dialog.end(),TS.generic_dialog.cancel()})).catch((function(e){if(e&&e.data){var t=e.data;r({type:"error",errorType:t.error,teamName:n}),TS.error(o+" failed with error: "+(t.error||"undefined")),u.stop()}else TS.error("WTF: error, but no response or data on "+o+"?",e)})),!1}}),$(l).on("keyup change",(function(){e=TS.ui.validation.validate($(l)),c()})),$(d).on("keyup change",(function(){t=TS.ui.validation.validate($(d)),c()})),$(l).focus(),$(a).find(s).attr("disabled",!0)}});var e="ENTERPRISE_DISCOVER_WORKSPACES",t=function(e,t){TS.ui.toast.show({type:e,message:t})}}()},HfRC:function(e,t){!function(){TS.registerModule("rxns",{rxn_records_changed_sig:new signals.Signal,member_rxns_fetched_sig:new signals.Signal,member_rxns_being_fetched_sig:new signals.Signal,need_alerts:{},upsertRxnsFromDataAndUpdateUI:function(e,t){var n=l(e,t);return"NOOP"!==n.status&&s(e),n},getRxnKey:function(e,t,n){return"message"!==e||n||TS.error("getRxnKey: no c_id provided for message rxn_key"),"message"!==e&&n&&TS.error("getRxnKey: c_id provided for but this is not a message rxn_key"),e+"-"+t+"-"+(n||"")},getRxnKeyByMsgType:function(e){var t;if("file_upload"===e.subtype||"file_share"===e.subtype||"file_mention"===e.subtype||"file_reaction"===e.subtype){if(e.file){var n=e.file;_.isString(n)&&(n=TS.files.getFileById(n)),t=n&&n._rxn_key}}else"file_comment"===e.subtype?e.comment&&(t=e.comment._rxn_key):t=e._rxn_key;return t},getRxnKeyFromData:function(e){var t;if("message"===e.type)t=e.ts||e.message.ts;else if("file"===e.type)t=e.file.id||e.file;else{if("file_comment"!==e.type)throw new Error("item.type not handled");t=e.file_comment||e.comment.id}return TS.rxns.getRxnKey(e.type,t,e.channel)},getExistingRxnsByKey:function(e){var t=TS.redux.reactions.getReactionsForKey(e);return t&&t.length?t:null},getRxnRecordByKey:function(e){if(i[e])return i[e];for(var t=n.length-1;t>-1;t-=1)if(n[t].rxn_key===e)return i[e]=n[t],i[e];return null},getNextRxnRecordThatNeedsAlert:function(){for(var e,t=n.length-1;t>-1&&TS.rxns.need_alerts[n[t].rxn_key];t-=1)e=n[t];return e},getRxnsFromData:function(e){return"message"===e.type?e.message&&e.message.reactions:"file"===e.type?e.file&&e.file.reactions:"file_comment"===e.type?e.comment&&e.comment.reactions:null},doesRxnsHaveRxnFromMember:function(e,t,n){var i=TS.emoji.nameToCanonicalName(t);if(!e)return!1;var r=TS.rxns.getRxnFromRxns(e,t)||TS.rxns.getRxnFromRxns(e,i);return!!r&&(!!r.count&&(!!r.users&&-1!==r.users.indexOf(n)))},doesRxnsHaveRxnFromUser:function(e,t){return TS.rxns.doesRxnsHaveRxnFromMember(e,t,TS.model.user.id)},doesRxnsHaveRxn:function(e,t){return!!e&&!!TS.rxns.getRxnFromRxns(e,t)},doesRxnsHaveSkinlessRxn:function(e,t){if(!e)return!1;var n=[t.replace(/(::skin-tone-[2-6])/,"")];TS.emoji.spliceSkinToneVariationsIntoAnArrayOfEmojiNames(n);for(var i=0;i<n.length;i+=1)if(TS.rxns.getRxnFromRxns(e,n[i]))return!0;return!1},countAllRxns:function(e){if(!e)return 0;var t=0;return e.forEach((function(e){t+=e.count||0})),t},countAllEmoji:function(e){return e?e.length:0},countAllUsersRxns:function(e,t){if(!e)return 0;var n=0;return e.forEach((function(e){e.users.indexOf(t)>-1&&(n+=1)})),n},getAllUniqueRxners:function(e,t){if(!e)return[];var n=[];return e.forEach((function(e){e&&e.count&&e.users&&e.users.forEach((function(e){t!=e&&-1==n.indexOf(e)&&n.push(e)}))})),n},getRxnFromRxns:function(e,t){return e&&e.filter((function(e){return e.name==t}))[0]||null},changeRxnsFromUserAction:function(e,t,n){return TS.redux.reactions.changeReactionFromUserAction(e,t,n).catch((function(e){[f,p].indexOf(e.message)>-1?m(e.message):e.message===h&&TS.warn("Attempted to add/remove invalid emoji and the API complained: "+t)}))},checkForRxnClick:function(e){if(e&&e.target){var t=$(e.target),n=t.closest(".rxn");if(n.length){var i,r=String(n.data("emoji")),a=t.closest(".rxn_panel").data("rxn-key"),s=n.hasClass("is_handy");if(n.hasClass("menu_rxn"))TS.ui.react_emoji_menu.start({e:e,rxn_key:a});else if(!(i=!n.hasClass("user_reacted"))&&e.shiftKey)g(a);else{var o=s&&TS.emoji.isNameSkinToneModifiable(r)?":"+TS.emoji.getChosenSkinToneModifier():"";TS.rxns.changeRxnsFromUserAction(a,r+o,i)}}}},getRxnRecords:function(){return n},getRxnKeyParts:function(e){var t=e.split("-");return{type:t[0],id:t[1],c_id:t[2]}},test:function(){return{updateUI:a,addOrRemoveRxnFromRxns:o,upsertRxnsFromData:l,incrementPendingCnt:d,decrementPendingCnt:c,fetchAndUpdateRxns:u,displayTooManyError:m,TOO_MANY_REACTIONS:p,TOO_MANY_EMOJI:f}},clearHandyRxnsDisplayDataCache:function(){e=void 0},getMemberRxnsFromMessage:function(e,t){if(e&&t){var n=TS.rxns.getRxnKeyByMsgType(e);if(n){var i=TS.rxns.getExistingRxnsByKey(n);if(i)return i.filter((function(e){return _.includes(e.users,t)}))}}},getHandyRxnsDisplayDataByRxnKey:function(){e||(e={items:{}},t.forEach((function(t){var n=":"+t+":"+(TS.emoji.isNameSkinToneModifiable(t)?TS.emoji.getChosenSkinToneModifier():"");e.items[t]={html:new Handlebars.SafeString(TS.emoji.graphicReplace(n,{no_skin_tone_squares:!0})),name:n,names:n}})));return e},legacyUpdateUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.key,n=e.name,i=e.userId,r=e.type,o=e.shouldThrottle;o?s(t,r):a(t,n,i,r)}});var e,t=["slightly_smiling_face","+1","heavy_check_mark","heart","eyes"],n=[],i={},r={},a=function(e,t,n,i){TS.templates.builders.updateRxnPanels(e,t,n),"file"===i&&TS.log("(Temporary) Rebuilding mentions due to file reaction.")},s=function(e,t){a(e,void 0,void 0,t)},o=function(e,t,n,i,r){var a=TS.rxns.getRxnFromRxns(t,n);if(e)a?TS.utility.ensureInArray(a.users,i)&&(a.count+=1):t.push({users:[i],count:1,name:n,url:r});else if(a){a.users.indexOf(i)>=0&&(_.pull(a.users,i),a.count-=1,(a.count<1||0===a.users.length)&&_.pull(t,a),t.length||(t=null))}return t},l=function(e,t){return TS.redux.reactions.upsertReactions(e,t,!1)},d=function(e){e&&(r[e]=r[e]||0,r[e]+=1,TS.has_pri[S]&&TS.log(S,"_incrementPendingCnt "+e+": "+r[e]))},c=function(e){r[e]?(r[e]-=1,0===r[e]&&delete r[e],TS.has_pri[S]&&TS.log(S,"_decrementPendingCnt "+e+": "+r[e])):TS.has_pri[S]&&TS.log(S,"_decrementPendingCnt "+e+": "+r[e])},u=function(e){d(e),TS.redux.dispatch(TS.interop.reactions.fetchReactions({reactionKey:e})).then((function(t){c(e);var n=TS.rxns.getRxnsFromData(t),i=l(e,n);TS.has_pri[S]&&TS.dir(S,i,"_fetchAndUpdateRxns upsert status:"+i.status),"NOOP"!==i.status&&a(e)})).catch((function(){c(e),TS.error("_fetchAndUpdateRxns got an err")}))},m=function(e){var t=TS.interop.i18n.t("You\u2019ve reached the reaction limit","rxns")(),n=[TS.interop.i18n.t("For reasons of performance and productivity and brevity being the soul of wit, you can add up to 23 emoji to a message, but no more.","rxns")(),TS.interop.i18n.t("Well done! You\u2019ve added the maximum amount of emoji one person can add to one message. For reasons of performance, productivity and sharpened creative thinking, we cap the number of individual reacji to 23.","rxns")(),TS.interop.i18n.t("Emotions! We all have them \u2014 but on Slack, you\u2019re limited to 23 reactions per message.","rxns")()],i=[TS.interop.i18n.t("The human heart is a powerful thing; its capacity to feel is limitless! A message\u2019s capacity is 50.","rxns")(),TS.interop.i18n.t("Alas! Slack only allows each message a grand total of 50 emoji reactions.","rxns")(),TS.interop.i18n.t("A single message can\u2019t have more than 50 unique reactions. When we asked the engineers why they said, \u201cwe have to set limits somewhere,\u201d and then we tried to frown but this error popped up. So that\u2019s where we\u2019re at.","rxns")()];if(e==p){var r=_.sample(n);TS.generic_dialog.alert('<p class="no_bottom_margin">'+r+"</p>",t)}else if(e==f){var a=_.sample(i);TS.generic_dialog.alert('<p class="no_bottom_margin">'+a+"</p>",t)}},p="too_many_reactions",f="too_many_emoji",h="invalid_name",g=function(e){var t=TS.rxns.getExistingRxnsByKey(e);t&&t.forEach((function(n){TS.rxns.doesRxnsHaveRxnFromUser(t,n.name)&&TS.rxns.changeRxnsFromUserAction(e,n.name,!1)}))},S="888"}()},HtJm:function(e,t,n){!function(){function e(e){var t=e.file,n=e.msg,i=e.starred_items_list,r=e.model_ob,a=e.viewContext,s={};return s.file=t,s.edit=TS.files.getFileActions(t).edit,s.download=!("snippet"===t.mode||"post"===t.mode||"space"===t.mode||t.is_external),s.new_window=!s.edit&&!s.download,s.abs_permalink=t.permalink,i||(s.star_components=TS.templates.builders.buildStarComponents("file",t,null)),$.extend(s,TS.files.getFileTemplateArguments(t,360,a)),s.is_message=!0,s.lightbox=!0,("file_share"===n.subtype||TS.boot_data.feature_file_threads)&&n.upload?("email"===t.mode&&(s.is_added=!0),s.icon_class=TS.utility.getImageIconClass(t,"thumb_80")):t.user!=n.user&&(s.uploader=TS.utility.members.getEntityFromFile(t)),!TS.interop.messages.shouldRenderFileThread(n)&&"file_share"===n.subtype&&n.upload&&t.initial_comment&&(s.show_initial_comment=!0),TS.files.isFileAuthorExternal(t)&&(s.show_comment_action=!1),TS.interop.messages.shouldRenderFileThread(n)&&(s.can_remove_file=TS.interop.rules.messages.canRemoveFileFromMessage(TS.redux.getState(),{channel:r,message:n,file:t})),s}TS.registerModule("templates.builders.msgs",{buildHTML:function(t,n){n&&TS.dir(0,t);try{var i=t.msg,r=t.model_ob,a=t.prev_msg,s=!!t.highlight,o=!!t.no_attachments,l=!!t.standalone,d=!(!l&&!t.hide_actions),c=!!t.full_date;TS.prefs.getPref("fuller_timestamps")&&!c&&(c=i.ts&&!TS.interop.datetime.isSameDay(TS.interop.datetime.toDateObject(i.ts),new Date));var u,m=!!t.relative_ts,p=t.jump_link?new Handlebars.SafeString(t.jump_link):"",f=!!t.starred_items_list,h=t.starred_items_actions,g=t.container_id?"#"+t.container_id:"",S=!!t.enable_slack_action_links,T=!(!t||!t.highlight_as_new),b="",v=TS.utility.members.getEntityFromMessage(i),y=!0,w=i.ts&&TS.interop.datetime.toDateObject(i.ts),k=!1,x=!1,C=!!i.is_pending,M=i.user,I=i.is_ephemeral,E=TS.templates.makeMsgDomId(i.ts),A=TS.utility.msgs.getMsgActions(i,r),P=TS.utility.msgs.isEKMAccessDeniedMessage(i),O=!!i.blocks&&!TS.interop.rules.messages.isRichTextMessage(i);if(!i.blocks&&i.attachments)for(var F=0,j=i.attachments;F<j.length;F++)if(j[F].blocks){O=!0;break}M||(M=TS.templates.builders.getBotIdentifier(i));var H,D,L,N,B=TS.utility.msgs.shouldHaveBotLabel(i,v);E=t.msg_dom_id||E;var R=!!t.is_in_conversation,U=!!t.is_threads_view,q=TS.interop.constants.MessageContainers.UNREAD_VIEW;if(f?q=TS.interop.constants.MessageContainers.STARS_FLEXPANE:U?q=TS.interop.constants.MessageContainers.THREADS_VIEW:t.for_mention_display?q=TS.interop.constants.MessageContainers.ACTIVITY_FLEXPANE:t.highlight_items_list&&(q=TS.interop.constants.MessageContainers.HIGHLIGHTS_FLEXPANE),B){var G=TS.interop.bots.getBotInfoByMsg(i);G&&(H=_.get(G,"appId"),D=_.get(G,"botId"),L=_.get(G,"teamId")?G.teamId:_.get(i,"source_team_id")),N=!0}if(a&&((u="file_comment"===a.subtype&&a.comment?a.comment.user:a.user)||(u=TS.templates.builders.getBotIdentifier(a))),!i.no_display&&!l)if(a){var z=a.ts&&TS.interop.datetime.toDateObject(a.ts);i.subtype&&"file_comment"===i.subtype&&i.comment&&(M=i.comment.user);var W=TS.interop.rules.messages.isAutomatedSubtype(i.subtype);if(W||"thread_broadcast"===i.subtype)y=!0;else if(u==M&&!W)if(!i.subtype&&a.subtype&&"file_comment"===a.subtype)y=!0;else{if(!a.subtype||TS.templates.builders.getBotIdentifier(a)){var K=a.thread_ts||a.ts,V=i.thread_ts==K,Y=!i.thread_ts&&!a.thread_ts;(V||Y)&&(y=!1)}!TS.interop.rules.messages.isTempMsg(i)||"bot_message"!==i.type&&"USLACKBOT"!==i.user||(y=!0)}if(!C&&w&&z&&!TS.interop.datetime.isSameDay(w,z)&&!R){k=!0;var J=$(g+" div.day_divider");if(J.length>0){var Q,X=$(J[J.length-1]);if(X.length){Q="";try{Q=TS.templates.messages_day_divider({ts:X.data("ts")})}catch(e){e.message||(e.message=""),e.message+=" $last_divider.data('ts'):"+X.data("ts"),TS.info("Problem with TS.templates.messages_day_divider 2.1: "+JSON.stringify(e))}X.replaceWith(Q)}if(J.length>1){var Z=$(J[J.length-2]);if(Z.length){Q="";try{Q=TS.templates.messages_day_divider({ts:Z.data("ts")})}catch(e){e.message||(e.message=""),e.message+=" $second_last_divider.data('ts'):"+Z.data("ts"),TS.info("Problem with TS.templates.messages_day_divider 3.1: "+JSON.stringify(e))}Z.replaceWith(Q)}}}}!C&&TS.interop.datetime.distanceInMinutes(w,z)>TS.model.msg_activity_interval&&(x=!0)}else R||(x=!0);x&&(y=!0),"message"!==i.type&&(y=!0),("me_message"===i.subtype||a&&"me_message"===a.subtype)&&(y=!0);var ee=!0;l&&(ee=!1);var te=!1;TS.rxns.getExistingRxnsByKey(i._rxn_key)&&(te=!0),t.for_mention_rxn_display&&(y=!1),d=!(!d&&!C),P&&(d=!0,l=!1);var ne={msg:i,model_ob:r,member:v,actions:A,show_user:y,unprocessed:C,highlight:s,do_inline_imgs:ee,msg_dom_id:E,standalone:l,hide_actions:d,full_date:c,relative_ts:m,jump_link:p,show_resend_controls:i.ts in TS.model.display_unsent_msgs,starred_items_list:f,starred_items_actions:h,no_attachments:o,is_ephemeral:I,enable_slack_action_links:S,is_bot:B,bot_id:D,app_id:H,team_id:L,is_app_data_enabled:N,highlight_as_new:T,show_star:!1,has_rxns:te,for_mention_display:t.for_mention_display,for_mention_rxn_display:t.for_mention_rxn_display,for_search_display:t.for_search_display,for_top_results_search_display:t.for_top_results_search_display,ts_tip_delay_class:"ts_tip_delay_600",is_root_msg:t.is_root_msg,is_in_conversation:R,is_threads_view:U,file_title_only:"file_reaction"===i.subtype,is_slackbot_response:"slackbot_response"===i.subtype,is_ekm_denied_message:P,is_ekm_error:i.isEKMError,show_block_kit_error:O,hide_msg_text:!!i.blocks&&!TS.interop.rules.messages.isRichTextMessage(i)},ie=TS.utility.msgs.getFilesOnMsg(i),re=_.first(ie);(A.add_rxn||A.add_file_rxn||A.add_file_comment_rxn)&&(ne.show_rxn_action=!0),ne.star_components=TS.templates.builders.buildStarComponents("message",i,r);var ae,se=!0;if(l&&(se=!1),TS.interop.rules.messages.isFile(i)&&(se=!1),ne.selectable=se,R&&(ne.msg_dom_id=TS.templates.makeMsgDomIdInConversation(i.ts)),TS.interop.messages.isReply(i)?ne.show_reply_action=!1:(ne.show_reply_action=!1,!ne.show_reply_action&&TS.interop.rules.messages.isFile(i)&&re&&(ne.show_comment_action=!0)),!(i.ts==i.thread_ts)||!i.reply_count||R||l||t.for_search_display||t.for_top_results_search_display||t.is_threads_view||(ne.show_reply_bar=!0),ne.is_tombstone="tombstone"===i.subtype,ne.is_new_reply=!!t.is_new_reply,!TS.interop.messages.isReply(i)||"thread_broadcast"!==i.subtype||R||l||t.is_threads_view||(ne.is_broadcast=!0,ne.show_reply_action=!0),ne.is_broadcast&&i.root&&(ne.root_repliers_summary=new Handlebars.SafeString(TS.templates.builders.buildBroadcastRepliersSummaryHTML(i.root)),"tombstone"!==i.root.subtype)){var oe=i.root.text,le=_.first(i.root.attachments);if(_.get(le,"is_msg_unfurl")){var de=le.from_url&&i.root.text==="<"+le.from_url+">";oe&&!de||(oe=le.text)}if(oe){var ce=TS.format.formatBroadcastExcerpt(oe,i.root);ce.length>150&&(ce=TS.utility.truncateHTML(ce,150)),ne.root_excerpt=new Handlebars.SafeString(ce)}}if(ne.show_broadcast_indicator=TS.boot_data.feature_broadcast_indicator&&"thread_broadcast"===i.subtype&&(R||U),(ae="file_share"===i.subtype||"file_mention"===i.subtype||TS.boot_data.feature_file_threads&&!i.subtype&&re?re:"file_comment"===i.subtype?i.comment:i)&&ae.pinned_to&&ae.pinned_to.length>0?ne.is_pinned=_.some(ae.pinned_to,(function(e){return e===r.id})):ne.is_pinned=!1,ne.is_pinned?ne.pin_html=TS.templates.builders.buildPinInfoHtml(i):ne.pin_html="",!i.subtype&&(t.for_search_display||t.for_top_results_search_display)&&re&&(i.comment?ne.star_components=TS.templates.builders.buildStarComponents("file_comment",i.comment,re):ne.star_components=TS.templates.builders.buildStarComponents("file",re,null)),(!TS.interop.rules.messages.isTempMsg(i)&&!i.is_ephemeral||O)&&(ne.permalink=TS.utility.msgs.constructMsgPermalink(r,i.ts,i.thread_ts),ne.abs_permalink=TS.utility.msgs.constructAbsoluteMsgPermalink(r,i.ts,i.thread_ts)),(t.for_top_results_search_display||t.for_search_display)&&TS.boot_data.page_needs_enterprise&&(ne.abs_permalink=i.permalink,ne.archive_link=i.permalink,ne.permalink=i.permalink),"file_share"===i.subtype||"file_mention"===i.subtype||"file_reaction"===i.subtype||TS.interop.messages.shouldRenderFileThread(i)&&re){re&&$.extend(ne,e({file:re,msg:i,starred_items_list:f,model_ob:r,viewContext:q}));var ue=TS.templates.builders.msgs.buildFileShareMetaText(i);ne.file_share_html=new Handlebars.SafeString(ue)}else"file_comment"===i.subtype&&(a&&!a.no_display&&a.file&&re&&re.id==a.file.id&&(k||(ne.is_file_convo_continuation=!0)),ne.show_comment_quote_icon=!0,a&&!a.no_display&&a.file&&re&&re.id==a.file.id&&((TS.boot_data.feature_file_threads&&!i.subtype||"file_share"===a.subtype)&&a.upload&&a.file.initial_comment&&(k||(ne.show_comment_quote_icon=!1)),"file_comment"===a.subtype&&(k||(ne.show_comment_quote_icon=!1))),ne.file=re,ne.icon_class=TS.utility.getImageIconClass(re,"thumb_40"),ne.comment=i.comment,ne.member=TS.utility.members.getEntityFromMessage(i),re&&re.user!=i.comment.user&&(ne.uploader=TS.utility.members.getEntityFromFile(re)),f||(ne.star_components=TS.templates.builders.buildStarComponents("file_comment",i.comment,re)));ne.render_file_thread=TS.interop.messages.shouldRenderFileThread(i),ne.files=ie&&ie.map((function(t){return e({file:t,msg:i,starred_items_list:f,model_ob:r,viewContext:q})}));var _e=function(e,t){var n=["message"];e.subtype&&("channel_join"===e.subtype||"group_join"===e.subtype||"app_conversation_join"===e.subtype||"app_conversation_created"===e.subtype?n.push("joined","automated"):"channel_leave"===e.subtype||"group_leave"===e.subtype||"app_conversation_leave"===e.subtype?n.push("left","automated"):"channel_topic"===e.subtype||"group_topic"===e.subtype?n.push("topic","automated"):"channel_name"===e.subtype||"group_name"===e.subtype?n.push("rename","automated"):"channel_purpose"===e.subtype||"group_purpose"===e.subtype?n.push("purpose","automated"):"channel_archive"===e.subtype||"group_archive"===e.subtype?n.push("archived","automated"):"channel_unarchive"===e.subtype||"group_unarchive"===e.subtype?n.push("unarchived","automated"):"bot_message"===e.subtype||"thread_broadcast"===e.subtype&&e.bot_id?n.push("bot_message"):"sh_room_shared"===e.subtype?n.push("sh_shared","automated"):"sh_room_created"===e.subtype?n.push("sh_created","automated"):"bot_add"===e.subtype||"bot_remove"===e.subtype||"bot_enable"===e.subtype||"bot_disable"===e.subtype?n.push("bot_change","automated"):"reminder_add"===e.subtype||"reminder_delete"===e.subtype?n.push("reminder_change","automated"):"slack_connect_dm_acceptance"===e.subtype&&n.push("automated"));e.alert_type&&"shared_channel_join"===e.alert_type&&n.push("highlight_yellow_bg");e.no_display&&n.push("hidden");t.for_search_display&&n.push("for_search_display");t.for_top_results_search_display&&n.push("for_top_results_search_display");t.starred_items_list&&n.push("for_star_display");t.for_mention_display&&n.push("for_mention_display");t.for_mention_rxn_display&&n.push("for_mention_rxn_display");t.is_ephemeral&&n.push("ephemeral");t.unprocessed&&n.push("unprocessed");t.show_resend_controls&&n.push("resend");t.highlight&&n.push("highlight");t.highlight_as_new&&n.push("new");t.app_id&&n.push("is_app");t.is_pinned&&n.push("is_pinned");t.show_broadcast_indicator&&n.push("show_broadcast_indicator");t.standalone?n.push("standalone"):n.push("dirty_hover_container");t.show_user?n.push("first"):(t.file&&n.push("first"),t.is_in_conversation&&n.push("first"));t.file&&(n.push("file_reference"),t.is_mention?n.push("file_mention"):n.push("file_share"));t.comment&&(t.is_file_convo_continuation?n.push("comment_continuation"):n.push("first"));t.is_root_msg&&n.push("selected");t.is_root_msg&&TS.boot_data.feature_file_threads&&n.push("feature_file_threads");t.is_new_reply&&n.push("new_reply");t.is_tombstone&&n.push("deleted");t.is_broadcast&&n.push("thread_broadcast");_.get(t.member,"is_unknown")&&n.push("member_is_unknown");return n}(i,ne);return ne.msg_classes=_e.join(" "),ne.addDirectionAttr=parseInt(i.ts,10)>1541628e3,b+=TS.templates.message(ne),b=TS.format.replaceHighlightMarkers(b)}catch(e){var me="";if(i){me="msg.ts:"+i.ts,delete t.model_ob;try{t.msg=_.cloneDeep(i),t.msg.text="REDACTED",t.msg.attachments&&(t.msg.attachments="REDACTED"),t.prev_msg&&(t.prev_msg=t.prev_msg.ts),t.msg.channel&&t.msg.channel.id&&(t.msg.channel=t.msg.channel.id),me+=" "+JSON.stringify(t,null,"  ")}catch(e){}}return e.message||(e.message=""),e.message+=" "+me,TS.warn("Problem in TS.templates.builders.msgs.buildHTML with args: "+JSON.stringify(e.message)),e.stack&&TS.info(e.stack),TS.boot_data.feature_tinyspeck?TS.templates.message_failed({subtype:i&&i.subtype?i.subtype:"",msg_ts:i?i.ts:"",model_ob_id:r?r.id:""}):""}},buildFileShareMetaText:function(e,n){if(!e)return"";var i=TS.utility.msgs.getFileOnMsg(e);if(!i)return"";var r,a=(TS.boot_data.feature_file_threads&&!e.subtype||"file_share"===e.subtype)&&e.upload,s=i.user!=e.user&&!a,o=!function(e){var t=TS.utility.msgs.getFileOnMsg(e);return!!t&&(t.name===TS.utility.welcome_post.WELCOME_POST_NAME&&"USLACKBOT"===e.user&&t.user===TS.model.user.id)}(e),l=TS.interop.files.getFileMetaTemplate(i);if(s&&o)if(("file_share"===e.subtype||TS.boot_data.feature_file_threads&&!e.subtype)&&e.upload)if(i.initial_comment)r=t.test(i.mode)?l.addedCommentedPossessive:l.uploadedCommentedPossessive;else{if(!t.test(i.mode))return l.uploadedPossessive;r=l.addedPossessive}else r="file_mention"===e.subtype?l.mentionedPossessive:l.sharedPossessive;else r=("file_share"===e.subtype||TS.boot_data.feature_file_threads&&!e.subtype)&&e.upload?i.initial_comment?t.test(i.mode)?l.addedCommented:l.uploadedCommented:t.test(i.mode)?l.added:l.uploaded:"file_mention"===e.subtype?l.mentioned:l.shared;var d,c=TS.utility.members.getEntityFromFile(i);if(n){var u=TS.interop.members.getPrefCompliantMemberName(c);d=TS.interop.i18n.fullPossessiveString(u)}else{var _=TS.templates.builders.makeMemberPreviewLink(c,!1),m=TS.interop.i18n.possessive(TS.interop.members.getPrefCompliantMemberName(c)),p="client"===TS.boot_data.app?'target="'+i.permalink+'" ':"",f='<a href="'+i.permalink+'" '+p+'data-file-id="'+i.id+'">';d="</a> "+TS.interop.i18n.t("{uploader_name}{uploader_name_affix}","message")({uploader_name:TS.interop.i18n.safeString(_),uploader_name_affix:m})+f}return r({uploader_name_possessive_html:TS.interop.i18n.safeString(d),file_pretty_name:e&&i&&i.pretty_type?i.pretty_type:""})}});var t=/(snippet)/}()},I1WX:function(e,t,n){var i=n("lSNA"),r=n("cDf5");function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(){TS.registerModule("templates.helpers",{onStart:function(){TS.templates.helpers.register()},register:function(){Handlebars.registerHelper("debugger",(function(){})),Handlebars.registerHelper("i18n_ns",(function(e){_.isObject(this)?(this._i18n_ns&&(this._i18n_ns_history?this._i18n_ns_history.push(this._i18n_ns):this._i18n_ns_history=[this._i18n_ns]),this._i18n_ns=e):TS.warn('Cannot set i18n namespace "'+e+'". Chances are you\u2019ve inadvertently changed the context in a Handlebars partial to something that\u2019s not an object.')})),Handlebars.registerHelper("_i18n_ns_end",(function(){this._i18n_ns_history&&this._i18n_ns_history.length&&(this._i18n_ns=this._i18n_ns_history.pop())})),Handlebars.registerHelper("i18n_img",(function(e){var t=e.fn(this),n=e&&e.hash&&e.hash.locales?e.hash.locales:null;return n&&(n=n.replace(/\s/g,"")).split(",").indexOf(TS.interop.i18n.locale)>-1&&(t=t.replace(/(\..+$)/,"."+TS.interop.i18n.locale+"$1")),t})),Handlebars.registerHelper("t",(function(e){var t,n;"string"==typeof e?(t=e,e=arguments[1]):t=e.fn(),n=void 0!==e.hash.ns?e.hash.ns:void 0!==this._i18n_ns?this._i18n_ns:e.data.root&&e.data.root._i18n_ns?e.data.root._i18n_ns:"";var i=this;_.isObject(i)||(i={this:i});var r,a={};_.forOwn(e.hash,(function(e,t){a[t]=i[t],i[t]=Handlebars.Utils.escapeExpression(e)}));var s=t.match(/{[^\s}]+}/g);if(s&&s.length)for(var o,l=function(e){var t=e.split(".");if(t.length>1){for(var n=0,r=t.length,a=i;n<r;n+=1)if(void 0===(a=a[t[n]]))return;return a}return i[e]},d=0,c=s.length;d<c;d+=1)r=s[d].slice(1,-1),void 0===e.hash[r]&&void 0!==(o=l(r))&&(a[r]=i[r],i[r]=Handlebars.Utils.escapeExpression(o));return e.hash.debug&&(TS.info("debug handlerbars t helper"),TS.info(this)),i.__handlebars=!0,t=TS.interop.i18n.t(t,n)(i),_.forOwn(a,(function(e,t){i[t]=e})),t})),Handlebars.registerHelper("zdLocale",(function(){return TS.interop.i18n.zdLocale({featureFlags:{featureLocaleKoKr:TS.boot_data.feature_locale_ko_KR,featureLocaleItIt:TS.boot_data.feature_locale_it_IT,featureLocaleZhCn:TS.boot_data.feature_locale_zh_CN,featureLocaleZhTw:TS.boot_data.feature_locale_zh_TW,featureLocaleRuRu:TS.boot_data.feature_locale_ru_RU}})})),Handlebars.registerHelper("exampleEmail",(function(e){return TS.utility.exampleEmailAddress(e)})),Handlebars.registerHelper("convertTimestampToMilliseconds",(function(e){return 1e3*e})),Handlebars.registerHelper("listify",(function(e,t){t.hash.map&&(e=_.map(e,t.hash.map));var n=_.get(t.hash,"conjunction"),i=_.get(t.hash,"strong"),r=_.get(t.hash,"no_escape"),a=TS.interop.i18n.listify(e,{conj:n,strong:i,noEscape:r});return new Handlebars.SafeString(a.join(""))})),Handlebars.registerHelper("isClient",(function(e){return"client"===TS.boot_data.app?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("isChrome",(function(e){return TS.model.is_chrome_desktop||TS.model.is_chrome_mobile?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("isWeb",(function(e){return"web"===TS.boot_data.app||"space"===TS.boot_data.app||"calls"===TS.boot_data.app?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("isMac",(function(e){return TS.model.is_mac?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("isWin",(function(e){return TS.model.is_win?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("isLin",(function(e){return TS.model.is_lin?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("isOurApp",(function(e){return TS.model.is_our_app?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("feature",(function(e){var t=e.hash.flag;return 1==TS.qs_args[t]||1==TS.boot_data[t]?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("pageNeedsEnterprise",(function(e){return TS.boot_data.page_needs_enterprise?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("canDisconnectSharedChannels",(function(e){return TS.permissions.members.canDisconnectSharedChannels()?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("isChannelRequired",(function(e,t){return TS.interop.rules.channels.isRequired(e)?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("canPostInModelOb",(function(e,t){return TS.permissions.members.canPostInModelOb(e)?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("experiment",(function(e){var t=e.hash.name,n=e.hash.group||"treatment";return TS.interop.experiments.getGroupForUser(t)===n?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("comments",(function(e){return new Handlebars.SafeString(TS.templates.builders.buildComments(e))})),Handlebars.registerHelper("comment_standalone",TS.templates.builders.buildCommentStandalone),Handlebars.registerHelper("star",(function(e,t,n){return new Handlebars.SafeString(TS.templates.builders.buildStar(e,t,n))})),Handlebars.registerHelper("starWithTip",(function(e,t,n){return new Handlebars.SafeString(TS.templates.builders.buildStarWithTip(e,t,n))})),Handlebars.registerHelper("isInlineFilePreviewExpanded",(function(e){var n=e.hash.container_id,i=e.hash.file_id,r=t(i,360);return(r?TS.inline_imgs.shouldExpand(n,TS.model.inline_imgs[r]):TS.inline_file_previews.shouldExpand(n,i))?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("shouldTruncateInlineFilePreview",(function(e,t){return"string"==typeof e&&(e=TS.files.getFileById(e)),e&&TS.inline_file_previews.shouldTruncate(e)?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("isInlineFilePreviewTruncated",(function(e,t,n){return"string"==typeof t&&(t=TS.files.getFileById(t)),t&&TS.inline_file_previews.isTruncated(e,t)?n.fn(this):n.inverse(this)})),Handlebars.registerHelper("formatActionLink",(function(e,t,n){if(!e)return"";var i="<"+e.url+"|"+e.title+">",r=TS.format.formatWithOptions(i,t,{no_highlights:!0,no_specials:!0,enable_slack_action_links:!0===n});return new Handlebars.SafeString(r)})),Handlebars.registerHelper("stripWhitespace",(function(e){return e.replace(/\s+/g,"")})),Handlebars.registerHelper("cash",(function(e){var t=e.hash.all_digits||!1,n=e.hash.currency_code||"USD",i=parseInt(e.hash.value,10);return TS.interop.currency.formatCurrency(i,n,{displayTrailingZeroes:t})})),Handlebars.registerHelper("possessive",(function(e){return TS.interop.i18n.possessive(e)})),Handlebars.registerHelper("fullPossessiveString",(function(e){return TS.interop.i18n.fullPossessiveString(e)})),Handlebars.registerHelper("possessiveForMemberById",(function(e){var t=TS.interop.members.getMemberById(e);return t?Handlebars.helpers.possessiveForMember(t):""})),Handlebars.registerHelper("possessiveForMember",(function(e){var t=TS.interop.members.getPrefCompliantMemberName(e);return TS.interop.i18n.possessive(t)})),Handlebars.registerHelper("concatStr",(function(){return Array.prototype.slice.call(arguments,0,arguments.length-1).join("")})),Handlebars.registerHelper("toLowerCase",(function(e){return e.toLowerCase()})),Handlebars.registerHelper("initialsSafe",(function(e){var t=TS.interop.rules.teams.getTeamInitials(e,{limit:2});return new Handlebars.SafeString(t)})),Handlebars.registerHelper("json",(function(e){return"object"===r(e)&&null!==e&&"json"===e.name?JSON.stringify(this):JSON.stringify(e)})),Handlebars.registerHelper("currentTeamName",(function(){return _.escape(_.get(TS.model.team,"name",""))})),Handlebars.registerHelper("currentTeamNameSafe",(function(){return new Handlebars.SafeString(_.escape(_.get(TS.model.team,"name","")))})),Handlebars.registerHelper("canUserCreatePrivateChannels",(function(e){return TS.permissions.members.canCreateGroups()?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("canKickFromChannels",(function(e){return TS.permissions.members.canKickFromChannels()?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("canKickFromGroups",(function(e){return TS.permissions.members.canKickFromGroups()?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("isSlackbot",(function(e){return TS.interop.rules.members.isSlackbot(e)})),Handlebars.registerHelper("convertFilesize",(function(e){return TS.interop.utility.convertFilesize(e)})),Handlebars.registerHelper("roundToThree",(function(e){return TS.utility.roundToThree(e)})),Handlebars.registerHelper("toDate",(function(e){return TS.interop.datetime.formatDate(e,"{date_num}",{customFormat:"YYYY-MM-DD, LT"})})),Handlebars.registerHelper("toCalendarDate",(function(e){return TS.interop.datetime.toCalendarDate(e)})),Handlebars.registerHelper("toCalendarDateShort",(function(e){return TS.interop.datetime.toCalendarDate(e,{shortenMonth:!0})})),Handlebars.registerHelper("toCalendarDateOrNamedDay",(function(e){return TS.interop.datetime.toCalendarDateOrNamedDay(e)})),Handlebars.registerHelper("toCalendarDateIfYesterdayOrToday",(function(e){return TS.interop.datetime.toCalendarDateIfYesterdayOrToday(e)})),Handlebars.registerHelper("toCalendarDateOrNamedDayShort",(function(e){return TS.interop.datetime.toCalendarDateOrNamedDay(e,{shortenMonth:!0})})),Handlebars.registerHelper("dayDividerPretty",(function(e){return TS.interop.datetime.formatDate(e,"{day_divider_pretty}")})),Handlebars.registerHelper("toTime",(function(e,t,n){return e&&!_.isObject(e)||(e=window.moment().unix()),TS.interop.datetime.formatDate(e,"{time}",{do24hrTime:TS.utility.date.do24hrTime(),includeMeridiem:!1!==t,includeSeconds:!0===n})})),Handlebars.registerHelper("toTimeShort",(function(e){return TS.utility.date.do24hrTime()?TS.interop.datetime.formatDate(e,"{time}",{customFormat:"HH:mm"}):TS.interop.datetime.formatDate(e,"{time}",{customFormat:"h:mm"})})),Handlebars.registerHelper("toTimeAgo",(function(e){return TS.interop.datetime.toTimeAgo(e,{alwaysAgo:!0})})),Handlebars.registerHelper("toTimeAgoShort",(function(e,t){t=!!_.isBoolean(t)&&t;var n=TS.interop.datetime.toTimeAgo(e,{compact:t,alwaysAgo:!0}),i='<span class="relative_ts" data-ts="'+_.escape(e)+'" data-really-short="'+!!t+'">'+_.escape(n)+"</span>";return new Handlebars.SafeString(i)})),Handlebars.registerHelper("toTimeDuration",(function(e){return TS.interop.datetime.toTimeDuration(e)})),Handlebars.registerHelper("msgTsTitle",(function(e,t){var n,i,r=TS.model.unread_view_is_showing&&_.isString(t)&&t===TS.templates.makeMsgDomIdInUnreadView(e.ts),a=TS.model.threads_view_is_showing&&_.isString(t)&&t===TS.templates.makeMsgDomIdInThreadsView(e.ts);r?i=TS.interop.i18n.t("Jump to conversation","templates_helpers")():a&&(i=e.ts===e.thread_ts?TS.interop.i18n.t("Open in channel","templates_helpers")():TS.interop.i18n.t("Open in sidebar","templates_helpers")());var s=TS.interop.i18n.t("{date} at {time}","templates_helpers")({date:e.ts&&TS.interop.datetime.toCalendarDateOrNamedDay(e.ts,{shortenMonth:!0}),time:e.ts&&TS.interop.datetime.formatDate(e.ts,"{time}",{do24hrTime:TS.utility.date.do24hrTime(),includeSeconds:!0})}).replace(/\s/g,"&nbsp;");return n=i?i+'<br><span class="subtle_silver no_wrap">'+s+"</span>":s,new Handlebars.SafeString(n)})),Handlebars.registerHelper("toHour",(function(e){return TS.interop.datetime.toHour(e)})),Handlebars.registerHelper("shouldShowMemberTimezone",(function(e){return e.tz&&!e.is_slackbot&&!e.is_bot})),Handlebars.registerHelper("memberLocalTime",(function(e){var t=e&&e.tz?e.tz:"America/Los_Angeles",n=TS&&TS.boot_data&&TS.boot_data.dst_offsets&&TS.boot_data.dst_offsets[e.tz]&&TS.boot_data.dst_offsets[e.tz].tz_offset?TS.boot_data.dst_offsets[e.tz].tz_offset:-25200,i=TS.interop.datetime.memberLocalTime(Date.now(),{timeZone:t,timeZoneOffset:n,do24hrTime:TS.utility.date.do24hrTime()}),r=TS.interop.i18n.t('<span class="timezone_value">{local_time}</span> local time',"date_utilities")({local_time:i});return new Handlebars.SafeString(r)})),Handlebars.registerHelper("isToday",(function(e,t){return TS.interop.datetime.isToday(TS.interop.datetime.toDateObject(e))?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("if_equal",(function(t,n){return t==(n=e(n)).hash.compare?n.fn(this):n.inverse(this)})),Handlebars.registerHelper("if_not_equal",(function(t,n){return t!=(n=e(n)).hash.compare?n.fn(this):n.inverse(this)})),Handlebars.registerHelper("if_gt",(function(t,n){return t>(n=e(n)).hash.compare?n.fn(this):n.inverse(this)})),Handlebars.registerHelper("if_lt",(function(t,n){return t<(n=e(n)).hash.compare?n.fn(this):n.inverse(this)})),Handlebars.registerHelper("if_starts_with",(function(t,n){return n=e(n),0===(t||"").indexOf(n.hash.compare||"")?n.fn(this):n.inverse(this)})),Handlebars.registerHelper("or",(function(t,n,i){return i=e(i),t||n?i.fn(this):i.inverse(this)})),Handlebars.registerHelper("and",(function(t,n,i){return i=e(i),t&&n?i.fn(this):i.inverse(this)})),Handlebars.registerHelper("foreach",(function(e,t){return t.inverse&&!e.length?t.inverse(this):e.map((function(n,i){var r={index:i,value:n,length:e.length};return r.first=0===i,r.last=i===e.length-1,t.fn(r)})).join("")})),Handlebars.registerHelper("repeat",(function(e,t){for(var n="",i=0;i<e;i+=1)n+=t.fn(i);return n})),Handlebars.registerHelper("makeDayDividerDomId",(function(e){return TS.templates.makeDayDividerDomId(e)})),Handlebars.registerHelper("formatFileTitle",(function(e){return new Handlebars.SafeString(TS.templates.builders.formatFileTitle(e))})),Handlebars.registerHelper("formatMessageByType",(function(e,t,n,i,r){return new Handlebars.SafeString(TS.templates.builders.formatMessageByType(e,t,n,i,r))})),Handlebars.registerHelper("formatAttachments",(function(e,t,n,i){return new Handlebars.SafeString(TS.templates.builders.formatAttachments(e,t,n,i))})),Handlebars.registerHelper("formatMessage",(function(e,t){return new Handlebars.SafeString(TS.format.formatDefault(e,t))})),Handlebars.registerHelper("formatMessageAttachmentPartEscaped",TS.utility.attachments.formatMessageAttachmentPart),Handlebars.registerHelper("formatMessageAttachmentPart",(function(e,t,n,i,r,a){return new Handlebars.SafeString(TS.utility.attachments.formatMessageAttachmentPart(e,t,n,i,r,a))})),Handlebars.registerHelper("formatMessageAttachmentSlackFooter",(function(e,t){var n;return n=e.channel_name&&e.channel_id?TS.utility.attachments.getSlackMessageFooterText(e,t,!0):TS.format.formatJustText(TS.format.cleanMsg(e.footer)),new Handlebars.SafeString(n)})),Handlebars.registerHelper("getAttachmentPermalinkText",(function(e,t){return new Handlebars.SafeString(TS.utility.attachments.getSlackMessageFooterPermalinkText(e,t))})),Handlebars.registerHelper("formatCurrentStatus",(function(e,t){return t=(t=t||{}).hash||t,new Handlebars.SafeString(TS.format.formatCurrentStatus(e,void 0,t))})),Handlebars.registerHelper("formatCurrentStatusWithoutAnimations",(function(e,t){return t=(t=t||{}).hash||t,new Handlebars.SafeString(TS.format.formatCurrentStatus(e,void 0,_.assign({stop_animations:!0},t)))})),Handlebars.registerHelper("rxnPanel",(function(e){var t=TS.templates.builders.rxnPanel(e);return t?new Handlebars.SafeString(t):""})),Handlebars.registerHelper("makeRefererSafeLink",(function(e){return"string"!=typeof e.hash.url?"":new Handlebars.SafeString(TS.utility.makeRefererSafeLink(e.hash.url))})),Handlebars.registerHelper("makeMsgAttachmentTextExpanderDomId",TS.templates.makeMsgAttachmentTextExpanderDomId),Handlebars.registerHelper("makeMemberColorClass",(function(){return TS.templates.builders.makeMemberColorClass.apply(this,arguments)})),Handlebars.registerHelper("newWindowName",TS.templates.builders.newWindowName),Handlebars.registerHelper("nl2br",(function(e){return e?(e=_.escape(e)).replace(/\n/g,"<br />").replace(/&amp;#95;/g,"_"):e})),Handlebars.registerHelper("smartnl2br",(function(e){return e?(e=(e=(e=(e=(e=_.escape(e)).replace(/\n\r\n\r/g,'<span class="para_break"><br /></span>')).replace(/\n\r\n/g,'<span class="para_break"><br /></span>')).replace(/\n\n/g,'<span class="para_break"><br /></span>')).replace(/\n/g,"<br />"),new Handlebars.SafeString(e.replace(/&amp;#95;/g,"_"))):e})),Handlebars.registerHelper("truncate",(function(e,t){return truncate(e,t).replace(/&#64;/g,"@")})),Handlebars.registerHelper("truncateToNearestWordBoundary",TS.utility.truncateToNearestWordBoundary),Handlebars.registerHelper("proxyImgUrls",(function(e){var t=$("<div>"+e+"</div>");return TS.templates.builders.proxyImgUrlsForEmails(t),t.html()})),Handlebars.registerHelper("isArchived",(function(e){return TS.interop.rules.channels.isArchived(e)})),Handlebars.registerHelper("makeFileDragData",(function(e){return TS.templates.makeFileDragData(e)})),Handlebars.registerHelper("ChannelPurposeMaxLength",(function(){return TS.model.channel_purpose_max_length})),Handlebars.registerHelper("makeChannelLink",(function(e,t){return t=(t=t||{}).hash||t,new Handlebars.SafeString(TS.templates.builders.makeChannelLink(e,t))})),Handlebars.registerHelper("makeModelObNameForDisplay",(function(e,t){return t=(t=t||{}).hash||t,new Handlebars.SafeString(TS.templates.builders.makeModelObNameForDisplay(e,t))})),Handlebars.registerHelper("isEnterpriseTeam",(function(e){return TS.boot_data.page_needs_enterprise?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("memberIsUnavailable",(function(t,n){return n=e(n),TS.interop.rules.members.isUnavailable(TS.redux.getState(),t)?n.fn(this):n.inverse(this)})),Handlebars.registerHelper("currentEnterpriseName",(function(){return TS.boot_data.page_needs_enterprise&&TS.redux.teams.getSelfEnterpriseOrgName()||""})),Handlebars.registerHelper("isModelObExtShared",(function(e,t){return TS.interop.utility.isModelObjectExternal(e)?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("shouldUseInitialsIcon",(function(e,t,n){return e&&e.icon&&(e.icon.image_default||t)?n.fn(this):n.inverse(this)})),Handlebars.registerHelper("makeTeamNameList",(function(e,t){if(t=(t=t||{}).hash||t,!e)return"";var n=_.map(e,(function(e){return TS.teams.getTeamById(e)})).map((function(e){return TS.interop.rules.teams.isUnknown(e)?TS.templates.unknown_team({id:e.id,subtler:t.subtler}):_.escape(TS.interop.rules.teams.getTeamDisplayName(e))})),i=TS.interop.i18n.listify(n,s(s({},t),{},{noEscape:!0})).join("");return i?new Handlebars.SafeString(i):void 0})),Handlebars.registerHelper("makeGroupLinkAriaLabelSafe",TS.templates.builders.makeGroupLinkAriaLabelSafe),Handlebars.registerHelper("mpimMemberCount",(function(e){return TS.mpims.getMemberCount(e)})),Handlebars.registerHelper("mpimDisplayName",(function(e,t,n,i,r){t=!0===t,r=!0===r;var a=TS.mpims.legacyGetDisplayName(e,t,!0===n,i,r);return t||r?new Handlebars.SafeString(a):a})),Handlebars.registerHelper("currentUserId",(function(){return TS.model.user.id})),Handlebars.registerHelper("makeMemberPresenceIcon",(function(e){return TS.warn("Presence icons should not be used outside of the client application, because they rely on a WS connection to keep presence up to date. Rendering anyway, but be careful out there!"),new Handlebars.SafeString(TS.templates.makeMemberPresenceIcon(e))})),Handlebars.registerHelper("showDraftIcon",(function(e,t){return TS.templates.builders.legacyShowDraftIcon(e)?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("makeMemberPreviewLink",(function(){var e=TS.templates.builders.makeMemberPreviewLink.apply(this,arguments);return new Handlebars.SafeString(e)})),Handlebars.registerHelper("makeMemberPreviewLinkById",(function(e,t){!0!==t&&(t=!1);var n=TS.redux.members.getPotentiallyUnknownMemberById(e);return n&&!n.is_non_existent||(n=TS.interop.bots.getBotById(e)),n?new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLink(n,t)):new Handlebars.SafeString(_.escape(e))})),Handlebars.registerHelper("makeMemberPreviewLinkImage",(function(){return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLinkImage.apply(this,arguments))})),Handlebars.registerHelper("makeProfileImage",TS.templates.builders.makeProfileImage),Handlebars.registerHelper("makePendingUserImage",(function(){return new Handlebars.SafeString(TS.templates.builders.makePendingUserImage.apply(this,arguments))})),Handlebars.registerHelper("emojiGraphicReplace",(function(e,t){var n={};return t&&"string"==typeof t?n.force_style=t:n.obey_emoji_mode_pref=!0,new Handlebars.SafeString(TS.emoji.graphicReplace(e,n))})),Handlebars.registerHelper("makeUsernameImage",(function(e,t){var i,r,a,s,o,l=TS.redux.bots.getBotByMsg(e);e.icons?o=e.icons:l&&l.icons?o=l.icons:e.bot_profile&&e.bot_profile.icons&&(o=e.bot_profile.icons),o&&(o.image_36&&!TS.environment.is_retina?i=o.image_36:o.image_72&&TS.environment.is_retina?i=o.image_72:o.image_48?i=o.image_48:o.emoji&&":"===o.emoji.substr(0,1)&&":"===o.emoji.substr(o.emoji.length-1,1)&&(a=o.emoji));var d,c={},u=TS.templates.builders.makeBotLink(l,c),m=e&&e.is_ephemeral&&"slackbot"===e.username?TS.interop.members.getMemberById("USLACKBOT"):null;switch(t){case 24:r="thumb_24",s=cdn_url+"/df10d/img/avatars/ava_0002-24.png",m&&(s=m.profile.image_24);break;case 32:r="thumb_32",s=cdn_url+"/df10d/img/avatars/ava_0002-32.png",m&&(s=m.profile.image_32);break;case 36:r="thumb_36",s=cdn_url+"/df10d/img/avatars/ava_0002-48.png",m&&(s=m.profile.image_48);break;case 72:r="thumb_72",s=cdn_url+"/df10d/img/avatars/ava_0002-72.png",m&&(s=m.profile.image_72);break;case 192:r="thumb_192",s=cdn_url+"/df10d/img/avatars/ava_0002-192.png",m&&(s=m.profile.image_192);break;default:r="thumb_48",s=cdn_url+"/df10d/img/avatars/ava_0002-192.png",m&&(s=m.profile.image_48)}if(i)e.bot_profile&&TS.interop.bots.isBotExternal(e.bot_profile)?(c.classes="member_image "+r,c.style="background-image:url('"+i+"')",c.external_badge=TS.templates.member_type_external_badge({team:TS.teams.getTeamById(e.bot_profile.team_id),size:t,badge_size:n(16),with_tooltip:!0}),d=""+(u=TS.templates.builders.makeBotLink(l,c)).start_a+u.end_a):d=u.start_a+'<img style="border: 0" src="'+i+'" class="member_image '+r+'" />'+u.end_a;else if(a){var p;TS.boot_data.feature_sonic_emoji&&(p={emojiSize:TS.interop.emojiComponent.EmojiSizes.LARGE}),d=u.start_a+'<div style="border: 0" class="member_image '+r+'">'+TS.emoji.graphicReplace(_.escape(a),p)+"</div>"+u.end_a}else d=m?u.start_a+'<img src="'+s+'" class="member_image '+r+'" />'+u.end_a:u.start_a+'<img src="'+s+'" class="member_image bot_icon_default '+r+'" />'+u.end_a;return new Handlebars.SafeString(d)})),Handlebars.registerHelper("getMemberPreviewLinkImageArgs",(function(e,t,n,i,a,s,o){var l,d,c,u;if(!(l="object"===r(e)?e:TS.interop.members.getMemberById(e))||!l.profile)return"";switch(n=!0===n,i=!0===i,a=!0===a,s=!0===s,o="string"==typeof o&&o,"USLACKBOT"===e&&o&&(l=TS.utility.slackbot.getWithFeels(o)),c="background-image: ",u=[],t){case 20:case 24:d=TS.environment.is_retina?l.profile.image_48:l.profile.image_24;break;case 32:d=TS.environment.is_retina?l.profile.image_72:l.profile.image_32;break;case 36:case 48:d=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;break;case 56:case 72:d=TS.environment.is_retina?l.profile.image_192:l.profile.image_72;break;case 192:d=TS.environment.is_retina&&l.profile.image_512||l.profile.image_192;break;case 512:d=TS.environment.is_retina?l.profile.image_1024||l.profile.image_512||l.profile.image_192:l.profile.image_512||l.profile.image_192;break;default:d=TS.environment.is_retina?l.profile.image_72:l.profile.image_48}if(u.push("url('"+d+"')"),512===t){var _=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;u.push("url('"+_+"')")}return{omit_link:i,omit_badge:a,lazy:n,member:l,size:t,include_restricted_overlay:!s||!0,bg_img_style:c=n?u.length?u.join(", "):"":u.length?c+u.join(", "):""}})),Handlebars.registerHelper("getGuestBadgeSize",(function(e){var t;switch(e){case 24:t=10;break;case 32:case 36:case 48:t=16;break;case 72:t=24;break;case 192:t=48;break;case 512:t=96;break;default:t=16}return t})),Handlebars.registerHelper("getTeamBadgeSize",n),Handlebars.registerHelper("getMemberNameById",(function(e){var t=TS.interop.members.getMemberById(e);return t?t.name:e})),Handlebars.registerHelper("getPrefCompliantMemberNameById",(function(e){return TS.interop.members.getPrefCompliantMemberNameById(e)})),Handlebars.registerHelper("getMemberNameNoModel",(function(e,t){return TS.boot_data.name_tagging_client?e.display_name||e.real_name||t:e.real_name||t})),Handlebars.registerHelper("getMemberComponentPrimaryName",(function(e,t){return t?"real_name"===t?TS.interop.members.getMemberRealName(e):TS.interop.members.getMemberMentionName(e):TS.interop.members.getPrefCompliantMemberName(e,!1,!1)})),Handlebars.registerHelper("memberIsInvited",(function(e,t){return e&&e.is_invited_user?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("memberComponentHasSecondaryName",(function(e,t,n){var i=!1;return e&&(i=t?"real_name"===t?!!TS.interop.members.getMemberProfileFieldDisplayName(e):!!TS.interop.members.getMemberRealName(e):!!TS.interop.members.getMemberSecondaryName(e)),i&&!e.is_invited_user?n.fn(this):n.inverse(this)})),Handlebars.registerHelper("getMemberComponentSecondaryName",(function(e,t){if(t){if("real_name"===t)return TS.interop.members.getMemberProfileFieldDisplayName(e);if("display_name"===t)return TS.interop.members.getMemberProfileFieldDisplayName(e)?TS.interop.members.getMemberRealName(e):""}return TS.interop.members.getMemberSecondaryName(e)})),Handlebars.registerHelper("getPrefCompliantMemberName",(function(e,t,n){return TS.interop.members.getPrefCompliantMemberName(e,!0===t,!0===n)})),Handlebars.registerHelper("getMemberAsContentsString",(function(e){return TS.interop.texty.getMemberAsContentsString(e)})),Handlebars.registerHelper("shouldShowMemberRestrictionBanner",(function(t,n){return n=e(n),_.isString(t)&&(t=TS.interop.members.getMemberById(t)),t&&(t.is_restricted||t.isExternal)?n.fn(this):n.inverse(this)})),Handlebars.registerHelper("shouldShowMemberProfileBlock",(function(e){var t=e.is_admin&&e.team_id===TS.model.user.team_id,n=e.is_self||TS.prefs.getTeamPref("display_email_addresses");return TS.interop.rules.members.isActionable(TS.redux.getState(),e)&&e.profile&&(e.profile.display_name||Handlebars.helpers.shouldShowMemberTimezone(e)||e.profile.phone||e.profile.email&&n||t||Handlebars.helpers.getVisibleTeamProfileFieldsForMember(e).length)})),Handlebars.registerHelper("getTeamNameByMember",(function(e){if(!_.isObject(e))return null;var t=TS.teams.getTeamById(e.team_id);return _.isObject(t)?TS.interop.rules.teams.isUnknown(t)?new Handlebars.SafeString(TS.templates.unknown_team({id:t.id})):TS.interop.rules.teams.getTeamDisplayName(t):null})),Handlebars.registerHelper("getTeamById",(function(e){return TS.teams.getTeamById(e)})),Handlebars.registerHelper("getTeamDisplayName",(function(e){return TS.interop.rules.teams.isUnknown(e)?new Handlebars.SafeString(TS.templates.unknown_team({id:e.id})):TS.interop.rules.teams.getTeamDisplayName(e)})),Handlebars.registerHelper("getMemberPreviewLinkTarget",(function(e){return TS.utility.shouldLinksHaveTargets()?new Handlebars.SafeString('target="/team/'+e.id+'"'):""})),Handlebars.registerHelper("getMemberProfileFieldDisplayName",(function(e){return TS.interop.members.getMemberProfileFieldDisplayName(e)})),Handlebars.registerHelper("getMemberSecondaryName",(function(e){return TS.interop.members.getMemberSecondaryName(e)})),Handlebars.registerHelper("memberHasSecondaryName",(function(e,t){var n=!1;return e&&(n=!!TS.interop.members.getMemberSecondaryName(e)),n?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("getMemberProfileFieldDisplayName",(function(e){return TS.interop.members.getMemberProfileFieldDisplayName(e)})),Handlebars.registerHelper("memberHasProfileFieldDisplayName",(function(e,t){var n=!1;return e&&(n=!!TS.interop.members.getMemberProfileFieldDisplayName(e)),n?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("getMemberRealName",(function(e){return TS.interop.members.getMemberRealName(e)})),Handlebars.registerHelper("getMemberProfileFieldDisplayNameandRealNameInCorrectOrder",(function(e){var t='<span class="member_real_name">'+_.escape(TS.interop.members.getPrefCompliantMemberName(e))+"</span>",n='<span class="member_preferred_name">'+(e.is_self?TS.interop.i18n.t("(you)","templates_helpers")():_.escape(TS.interop.members.getMemberSecondaryName(e)))+"</span>";return new Handlebars.SafeString(t+n)})),Handlebars.registerHelper("getMemberCurrentStatusEmoji",(function(e,t){return t=(t=t||{}).hash||t,Handlebars.helpers.formatCurrentStatusWithoutAnimations(TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),e&&e.id).emoji,_.assign({transform_missing_emoji:!0,show_icon_for_emoji_in_as_text_mode:!0},t))})),Handlebars.registerHelper("getMemberCurrentStatusForDisplay",(function(e){return new Handlebars.SafeString(TS.templates.builders.getMemberCurrentStatusForDisplay(e))})),Handlebars.registerHelper("getMemberCurrentStatusForDisplayWithoutAnimations",(function(e,t){return t=(t=t||{}).hash||t,new Handlebars.SafeString(TS.templates.builders.getMemberCurrentStatusForDisplay(e,_.assign({stop_animations:!0},t)))})),Handlebars.registerHelper("getMemberCurrentStatusExpiration",(function(e,t){return t=(t=t||{}).hash||t,e&&!e.is_self?"":new Handlebars.SafeString(TS.templates.builders.buildMemberCustomStatusExpiration(e,t))})),Handlebars.registerHelper("getTeamCustomStatusPresets",(function(){return TS.team.getTeamCustomStatusPresets()})),Handlebars.registerHelper("memberHasIm",(function(e){var t=e.hash.member,n=!1;return t&&TS.redux.channels.getImByMemberId(t.id)&&(n=!0),n?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("memberHasImUnreadCount",(function(e){var t=e.hash.member,n=!1;if(t){var i=TS.redux.channels.getImByMemberId(t.id);i&&i.unread_cnt&&(n=!0)}return n?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("getUnreadCountForIMByMemberId",(function(e){var t=TS.redux.channels.getImByMemberId(e);return t?t.unread_cnt:""})),Handlebars.registerHelper("makeMemberLinksWithDisplayNames",(function(e){if(!e)return"";var t=e.split(/\s*,\s*/).map((function(e){return TS.templates.builders.makeMemberPreviewLink(TS.interop.members.getMemberById(e))})).join(", ");return new Handlebars.SafeString(t)})),Handlebars.registerHelper("makeIMLink",(function(e){return new Handlebars.SafeString(function(e){var t=TS.interop.members.getMemberById(e.user);if(!t)return TS.warn("Missing member in makeIMLink: "+e.user),TS.templates.search_im_link({im_exists:!1,im_member_id:e.user,im_name:e.user,im_id:e.id,member_color:"unknown"});var n={im_exists:!TS.interop.channels.isImWithDeletedMember(e),im_member_id:t.id,im_name:TS.ims.getDisplayNameOfUserForIm(e),im_id:e.id,member_color:"color_"+(t?t.id+" color_"+t.color:"unknown")};if(TS.utility.shouldLinksHaveTargets()){var i="/messages/"+e.id;TS.interop.channels.isImWithDeletedMember(e)&&(i=TS.templates.builders.newWindowName()),n.target=i}return TS.templates.search_im_link(n)}(e))})),Handlebars.registerHelper("getBotName",TS.templates.builders.getBotName),Handlebars.registerHelper("getBotNameWithLink",TS.templates.builders.getBotNameWithLink),Handlebars.registerHelper("getBotColorClassByUserName",(function(e){return e?"color_bot_"+TS.utility.makeSafeForDomClass(e):"color_unknown"})),Handlebars.registerHelper("getMemberColorClassById",(function(e){var t=TS.interop.members.getMemberById(e);return t?"color_"+t.id+" color_"+t.color:"color_unknown"})),Handlebars.registerHelper("memberIsSelf",(function(e){var t=TS.interop.members.getMemberById(e.hash.id);return t&&t.is_self?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("memberIsAdmin",(function(e){var t=TS.interop.members.getMemberById(e.hash.id);return t&&t.is_admin?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("currentUserIsAdmin",(function(e){return TS.model.user.is_admin?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("currentUserIsOwner",(function(e){return TS.model.user.is_owner?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("currentUserIsRA",(function(e){return TS.model.user.is_restricted?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("tinyspeck",(function(e){return TS.boot_data.feature_tinyspeck?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("makeFileDomId",(function(e){return TS.templates.makeFileDomId(e)})),Handlebars.registerHelper("makeFileCommentHelpHTML",(function(e){return new Handlebars.SafeString(TS.templates.builders.makeFileCommentHelpHTML(e))})),Handlebars.registerHelper("formatSpaceHtml",(function(e){var t=$("<div>").html(e);return TS.templates.builders.replaceEmojiForPosts(t[0]),TS.utility&&TS.utility.attachments&&TS.utility.attachments.unfurlPlaceholders(t),new Handlebars.SafeString(t.html())})),Handlebars.registerHelper("fileIsImage",(function(e){var t=TS.files.getFileById(e.hash.id);return t&&t.mimetype&&0===t.mimetype.indexOf("image/")?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("mimeTypeIsImage",(function(e){return e.hash.type&&0===e.hash.type.indexOf("image/")?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("fileDefaultIsNewWindow",(function(t){t=e(t);var n=TS.files.getFileById(t.hash.id);if(!n)return t.inverse(this);var i=n.mimetype&&0===n.mimetype.indexOf("image/")&&-1===n.mimetype.indexOf("svg"),r="pdf"===n.filetype;return i||r?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("fileOpensOnTeamSite",(function(t){if(t=e(t),!TS.boot_data.feature_file_threads)return t.fn(this);var n=TS.files.getFileById(t.hash.id);if(!n)return t.inverse(this);var i=n.mode;return"space"===i||"email"===i||"snippet"===i?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("fileIconTypeDownload",(function(){var t=Array.prototype.slice.call(arguments),n=e(t.pop()),i=t[0];if("string"==typeof i&&(i=TS.files.getFileById(i)),!i)return n.inverse(this);var r="external"===i.mode,a=i.mimetype&&0===i.mimetype.indexOf("image/")&&-1===i.mimetype.indexOf("svg"),s="pdf"===i.filetype;return r||a||s?n.inverse(this):n.fn(this)})),Handlebars.registerHelper("nonImageCanUseFSFV",(function(e,t){return TS.files.nonImageCanUseFSFV(e)?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("makeFilePrivacyLabel",(function(e){var t="",n=e.is_public,i=e.groups.length>0||e.ims.length>0,r="email"===e.mode,a="snippet"===e.mode,s="post"!=e.mode&&"space"!=e.mode&&!r&&!a;return"post"===e.mode||"space"===e.mode?t=n?TS.interop.i18n.t("Shared","templates_helpers")():i?TS.interop.i18n.t("Private","templates_helpers")():TS.interop.i18n.t("Draft","templates_helpers")():n&&r?t=TS.interop.i18n.t("Shared email","templates_helpers")():n&&a?t=TS.interop.i18n.t("Shared snippet","templates_helpers")():n&&s?t=TS.interop.i18n.t("Shared file","templates_helpers")():i&&r?t=TS.interop.i18n.t("Private email","templates_helpers")():i&&a?t=TS.interop.i18n.t("Private snippet","templates_helpers")():i&&s&&(t=TS.interop.i18n.t("Private file","templates_helpers")()),t})),Handlebars.registerHelper("makeExternalFiletypeHTML",(function(e){return new Handlebars.SafeString(TS.templates.builders.makeExternalFiletypeHTML(e))})),Handlebars.registerHelper("makeFileShareLabel",(function(e){return new Handlebars.SafeString(TS.templates.builders.makeFileShareLabel(e))})),Handlebars.registerHelper("isFileAuthorExternal",(function(e){return TS.files.isFileAuthorExternal(e)})),Handlebars.registerHelper("nl2brAndHighlightSearchMatches",(function(e){if(e)return e=(e=_.escape(e)).replace(/\n/g,"<br />"),new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(e))})),Handlebars.registerHelper("maybeGetIconForTeamProfileField",(function(e){if(e=e.toLowerCase(),["slack","apple","android","twitter","github","google","windows","youtube","skype","facebook","asana","linkedin","tumblr","instagram","soundcloud","flickr","pinterest","tripit","hangouts","viber","line"].indexOf(e)>-1)return'<i class="ts_icon ts_icon_'+e+'"></i>'})),Handlebars.registerHelper("getVisibleTeamProfileFieldsForMember",(function(e,t){var n=TS.team.getVisibleTeamProfileFieldsForMember(e);return new Handlebars.SafeString(TS.templates.team_profile_fields({fields:n,lazy_load_profile_fields:t&&t.hash.lazy_load_profile_fields}))})),Handlebars.registerHelper("isSkypeTeamProfileField",(function(e,t){return"text"===e.type&&"skype"===e.label.toLocaleLowerCase()?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("getSafeSkypeURLComponent",(function(e){var t=e.match(/^[a-zA-Z][a-zA-Z0-9.,\-_@]{5,31}/);return t?t[0]:""})),Handlebars.registerHelper("highlightSearchMatches",(function(e){if(e)return e=_.escape(e),TS.utility.msgs.handleSearchHighlights(e)})),Handlebars.registerHelper("highlightSearchMatchesInSpacesHtml",(function(e){if(e){var t=Handlebars.helpers.formatSpaceHtml(e);return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(t))}})),Handlebars.registerHelper("highlightSearchMatchesInFileTitle",(function(e){if(e)return e=_.unescape(e),e=_.escape(e),e=TS.emoji.graphicReplace(e),new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(e))})),Handlebars.registerHelper("math",(function(e,t,n){return arguments.length<4&&(n=t,t="+"),{"+":(e=parseFloat(e))+(n=parseFloat(n)),"-":e-n,"*":e*n,"/":e/n,"%":e%n}[t]})),Handlebars.registerHelper("loadingHTML",(function(){return new Handlebars.SafeString(TS.templates.builders.loadingHTML())})),Handlebars.registerHelper("versioned_loading_animation",(function(){return cdn_url+"/80588/img/loading.gif"})),Handlebars.registerHelper("versioned_loading_hash_animation",(function(){return cdn_url+"/80588/img/loading_hash_animation_@2x_vogue.gif"})),Handlebars.registerHelper("versioned_upload_file_icon",(function(e){return"1x"===e?cdn_url+"/80588/img/upload_file_icon.png":"2x"===e?cdn_url+"/80588/img/upload_file_icon@2x.png":void 0})),Handlebars.registerHelper("versioned_default_application_icon",(function(){return cdn_url+"/80588/img/apps/default_new_app_icon.png"})),Handlebars.registerHelper("versioned_tos_book_illustration",(function(e){return"1x"===e?cdn_url+"/80588/img/signup/book_illustration.png":"2x"===e?cdn_url+"/80588/img/signup/book_illustration@2x.png":void 0})),Handlebars.registerHelper("versioned_basic_analytics_upsell_banner_image",(function(){return cdn_url+"/80588/img/enterprise/ent_basic_analytics_upsell_banner_image.gif"})),Handlebars.registerHelper("pinToLabel",(function(e){var t="";return e.is_channel&&(t+="#"),e.is_im||e.is_mpim?t+=TS.interop.i18n.t("this conversation","pins")():t+=_.escape(e.name),new Handlebars.SafeString(t)})),Handlebars.registerHelper("number",(function(e){return _.isUndefined(e)?"":TS.interop.i18n.number(e)||""})),Handlebars.registerHelper("buildReplyBarHTML",(function(e,t){return new Handlebars.SafeString(TS.templates.builders.buildReplyBarHTML(e,t))})),Handlebars.registerHelper("atLabel",(function(e){return TS.templates.builders.atLabel(e)})),Handlebars.registerHelper("renderAttachmentActions",(function(e,t,n){return new Handlebars.SafeString(TS.templates.builders.buildAttachmentActions(e,t,n))})),Handlebars.registerHelper("renderAttachmentActionSelectOption",(function(e,t){var n=_.merge({},e,{is_group_item:t.hash.is_group_item}),i=TS.templates.attachment_actions_select_option(n);return new Handlebars.SafeString(i)})),Handlebars.registerHelper("renderAttachmentMedia",(function(e,t){var n,i;switch(TS.utility.attachments.getMediaType(e)){case"other":e.other_html&&(n=TS.templates.builders.buildInlineOtherDiv(e.other_html,t,e.safe_other_html));break;case"video":e.video_html&&e.thumb_url&&(i=e.from_url||e.thumb_url,n=TS.templates.builders.buildInlineVideoDiv(i,t));break;case"image":if(e.image_url){i=e.from_url||e.image_url;var r={flush_with_attachment:!0};r.is_giphy_shuffle=e.fallback&&e.fallback.indexOf("giphy")>=0&&e.actions&&e.actions[1]&&"shuffle"===e.actions[1].name,n=TS.templates.builders.buildInlineImgDiv(i,t,r)}break;case"audio":e.audio_html?n=TS.templates.builders.buildInlineAudioDiv(e.audio_html,t,e.safe_audio_html):e.audio_url&&(n=TS.templates.builders.formatSoundUrl(e))}if(n)return new Handlebars.SafeString(n)})),Handlebars.registerHelper("renderAttachmentFile",(function(e,t){var n=TS.files.getFileTemplateArguments(e,null,t),i="";if(TS.interop.files.isTombstone(e))i=TS.templates.file_tombstone();else if(TS.interop.files.isHiddenByStorageLimit(e))i=TS.templates.file_hidden_by_limit(n);else if(TS.interop.files.fileIsImage(e))i=TS.templates.file_image(s(s({},n),{},{file:e}));else{var r=s(s({},e),{},{thumb_pdf:void 0,thumb_480:void 0,has_rich_preview:void 0,filetype:"space"===e.filetype||"docs"===e.filetype?"post":e.filetype});i=TS.templates.file_generic(s(s({},n),{},{file:r,attachment_file:!0,file_is_video:void 0,file_is_audio:void 0,action:TS.interop.files.getMainAction(e,TS.boot_data.feature_file_threads)}))}return new Handlebars.SafeString(i)})),Handlebars.registerHelper("getFileMetaText",(function(e){var t=TS.interop.rules.files.getFileType(e),n="image"===t||"snippet"===t,i=e.pretty_type||TS.interop.i18n.t("file","files"),r=new Handlebars.SafeString(TS.templates.builders.formatFileTitle(e))||e.name||TS.interop.i18n.t("Untitled","files");return n?r:i})),Handlebars.registerHelper("shouldIncludeUploaderName",(function(e,t,n){return e&&t&&e.user!==t.user&&e.bot_id!==t.bot_id?n.fn(this):n.inverse(this)})),Handlebars.registerHelper("getMemberTypeClass",TS.templates.builders.getMemberTypeClass),Handlebars.registerHelper("inlineSaver",(function(e){var t=TS.templates.inline_saver({hide_text:e.hash.hide_text,target:e.hash.target});return new Handlebars.SafeString(t)})),Handlebars.registerHelper("dangerouslyRenderHTML",(function(e){return new Handlebars.SafeString(e)})),Handlebars.registerHelper("attachmentMediaCaret",(function(e,t){var n,i="";switch(TS.utility.attachments.getMediaType(e)){case"video":n=e.from_url||e.thumb_url,i=TS.templates.builders.buildInlineVideoToggler(n,t,!0);break;case"audio":n=e.audio_html||e.audio_url,i=TS.templates.builders.buildInlineAudioToggler(n,t);break;case"other":i=TS.templates.builders.buildInlineOtherToggler(e.other_html,t);break;case"image":n=e.from_url||e.image_url;var r={};r.is_giphy_shuffle=e.fallback&&e.fallback.indexOf("giphy")>=0&&e.actions&&e.actions[1]&&"shuffle"===e.actions[1].name,i=TS.templates.builders.buildInlineImgToggler(n,t,!1,r);break;default:i=TS.templates.builders.buildInlineAttachmentToggler(e.from_url,t)}return i&&(i='<span class="media_caret">'+i+"</span>"),new Handlebars.SafeString(i)})),Handlebars.registerHelper("getTeamIconOfSize",(function(e,t){return e&&e.icon?e.icon["image_"+t]:null})),Handlebars.registerHelper("listItemCount",(function(e){return _.isUndefined(e)?(TS.error("The template helper listItemCount failed because it was passed undefined"),0):(e=TS.utility.parseJSONOrElse(e,e),_.isString(e)&&e.length?e.split(",").length:e.length)})),Handlebars.registerHelper("objectKeyCount",(function(e){return _.isObject(e)?_.keys(e).length:0})),Handlebars.registerHelper("getIconSizeToFit",(function(e){return TS.interop.utility.getIconSizeToFit(e,[230,132,102,88,68,44,34])})),Handlebars.registerHelper("teamRetentionDuration",(function(e){return e&&TS.interop.rules.channels.isPrivateChannel(e)?TS.prefs.getTeamPref("group_retention_duration"):TS.prefs.getTeamPref("retention_duration")})),Handlebars.registerHelper("teamRetentionType",(function(e){return e&&TS.interop.rules.channels.isPrivateChannel(e)?TS.prefs.getTeamPref("group_retention_type"):TS.prefs.getTeamPref("retention_type")})),Handlebars.registerHelper("formatWorkspaceDiscoverability",(function(e){return TS.utility.enterprise.getWorkspaceVisibilityLabel(e)})),Handlebars.registerHelper("escape",(function(e){return _.escape(e)})),Handlebars.registerHelper("isDefined",(function(e){return void 0!==e}))},test:function(){return{_optionsFnInverseBooleanHelper:e,_inlineImgSrcForFile:t}}});var e=function(e){return"function"!=typeof e.fn&&(e.fn=function(){return!0}),"function"!=typeof e.inverse&&(e.inverse=function(){return!1}),e},t=function(e,t){return"string"==typeof e&&(e=TS.files.getFileById(e)),!!e&&(!!TS.files.fileIsImage(e)&&(t||(t=480),TS.files.getThumbSrcForFile(e,{maxSize:t})))},n=function(e){var t;switch(e){case 32:case 36:case 48:t=16;break;case 72:t=22;break;case 192:case 512:break;default:t=16}return t}}()},IZwQ:function(e,t){!function(){TS.registerModule("ui.lazy_filter_select",{STYLES:{default:"default",filter_in_list:"filter_in_list",normal:"normal",small:"small"},onStart:function(){$("select[data-lazy-filter-select], label[data-lazy-filter-select] select").addClass("hidden").lazyFilterSelect({use_data_attributes:!0})},create:function(t,n){n.use_data_attributes&&Object.keys(t.data()).forEach((function(e){if(e.indexOf("lazyFilterSelect")>-1&&"TS-lazyFilterSelect"!==e&&""!==t.data(e)){var i=t.data(e);"true"!==i&&"false"!==i||(i="true"===i),n[e.replace("lazyFilterSelect","").toLowerCase()]=i}}));"SELECT"===t.prop("tagName")&&void 0===n.single&&(n.single=!t.prop("multiple"));var r=$.extend({},e,n);void 0===n.approx_divider_height&&(r.approx_divider_height*=1),void 0===n.approx_item_height&&(r.approx_item_height*=1);var a=$('<div class="lazy_filter_select">');r.classes&&a.addClass(r.classes),t.prop("disabled")&&(r.disabled=!0),r.disabled&&a.addClass("disabled"),r.style=_.get(TS.ui.lazy_filter_select.STYLES,r.style,TS.ui.lazy_filter_select.STYLES.default),J(r)&&!r.single&&(TS.warn("Multi-select lazyFilterSelect instances can't use the 'filter_in_list' style. Using 'default' style instead."),r.style=TS.ui.lazy_filter_select.default);var s=TS.templates.lazy_filter_select_container({instance:r,aria_labelledby:t.attr("aria-labelledby"),STYLES:TS.ui.lazy_filter_select.STYLES});return a.html(s),r.append?a.appendTo(t):a.insertAfter(t),a.addClass(r.style+"_style"),r.single&&a.addClass("single"),r.width&&a.css("width",r.width),r.css&&a.css(r.css),r.$container=a,r.$select=t,r.$input_container=a.find(".lfs_input_container"),r.$lfs_value=a.find(".lfs_value"),r.$input=a.find(".lfs_input"),r.$list_container=a.find(".lfs_list_container"),r.$list=a.find(".lfs_list"),r.$status=a.find(".lfs_status"),r.$status_loading_indicator=r.$status.find(".lfs_status_loading_indicator"),r.$status_content=r.$status.find(".lfs_status_content"),J(r)?r.$filter_input=a.find(".lfs_filter_input"):r.$filter_input=r.$input,r._page_number=1,r._slug_id_counter=1,r.run=I,r.data_promise?(P(r)&&r._running_promise.cancel("Uhhh..."),r._running_promise=A(r,"").then((function(e){r.data=e,r.run(),i(r)}),(function(e){i(r),TS.interop.utility.getLogger({getState:TS.redux.getState}).error(e,"LFS error"),X(r,e,"Something failed while trying to return the initial data for lazyFilterSelect.")}))):(r.data&&(r.data=r.data.slice()),_.forEach(r.data,(function(e,t,n){e&&e._is_interop_channel_object&&(n[t]=_.assign({},e))})),r.run(),i(r)),r.current_items_in_view_signal=new signals.Signal,r},convertHTMLDataToRLFSData:function(e){var t=b(e);return t=t.map((function(e,t){return e instanceof HTMLOptionElement&&(e={id:String(e.lfs_id||t),original_item:e,label:$(e).text(),value:e.value,preselected:e.selected}),e}))},is_list_open:!1});var e={allow_item_unselect:!1,allow_list_position_above:!1,always_visible:!1,append:!1,approx_divider_height:28,approx_item_height:30,data_promise:null,data_qa:"lfs",disabled:!1,filter:function(e,t){var n=e.toString();if(t=t.toLowerCase(),e instanceof jQuery||e instanceof HTMLElement){n=$(e).text();var i=$(e).attr("data-additional-search-field");if(i&&i.toLowerCase().indexOf(t)>-1)return!0}return n.toLowerCase().indexOf(t)>-1},input_debounce_wait_time:void 0,listItemClass:null,max_selected_items:1/0,min_query_length:0,monkey_scroll:!0,no_default_selection:!1,noResultsTemplate:function(e){return Q(this)&&e.length<this.min_query_length?TS.interop.i18n.t("{query_length, plural, =0 {Start typing to see results\u2026} other {Keep typing to see results\u2026}}","lazy_filter_select")({query_length:e.length}):TS.interop.i18n.t("No items matched {query}","lazy_filter_select")({query:TS.interop.i18n.safeString("<strong>"+_.escape(e)+"</strong>")})},errorTemplate:function(e){return e||TS.interop.i18n.t("Couldn't load results.","lazy_filter_select")()},onInputBlur:_.noop,onInputFocus:_.noop,onReady:function(){},onItemAdded:function(){},onItemRemoved:function(){},onKeyDown:function(){},onMaxItemsSelected:function(){},onListShown:_.noop,onListHidden:_.noop,adjustAvailableSpaceAbove:_.identity,adjustAvailableSpaceBelow:_.identity,placeholder_text:TS.interop.i18n.t("Choose an option\u2026","lazy_filter_select")(),filter_placeholder_text:TS.interop.i18n.t("Search","lazy_filter_select")(),renderDividerFunc:null,render_item_func:null,restrict_input_container_height:!1,restrict_preselected_item_removal:!1,scroll_threshold:1e3,set_height:!0,should_graphic_replace_emoji:!1,single:!1,sluggify:{enabled:!1,delimiter:null,key_name:null,validator:null},style:TS.ui.lazy_filter_select.STYLES.default,template:function(e){var t,n,i=e.toString();return(e instanceof jQuery||e instanceof HTMLElement)&&(i=$(e).text(),t=K($(e).attr("data-additional-search-field"),this),n=K($(e).attr("data-ts-icon"),this)),i=K(i,this),t&&(i+=' <span class="addl_text">'+t+"</span>"),n&&(i+=' <ts-icon class="addl_icon '+n+'"></ts-icon>'),new Handlebars.SafeString(i)},tokenClass:null,tokenTemplate:null,tokenTemplateSingle:null,use_data_attributes:!1,_$active:null,_all_done_fetching:!1,_list_built:!1,_list_visible:!1,_mouse:{},_page_number:1,_prevent_blur:!1,_previous_val:"",_running_promise:null,_scroll_callback_was_called:!1,_selected:[],_showing_status:!1};$.widget("TS.lazyFilterSelect",{_create:function(){this.instance=TS.ui.lazy_filter_select.create(this.element,this.options)},_destroy:function(){this.instance.$container.remove(),delete this.instance},blur:function(){this.instance.$filter_input.blur()},clearValue:function(){if(this.instance.single){if(this.instance._selected.length){var e=this.instance.$input_container.find(".lfs_item");C(this.instance,e)}}else k(this.instance)},container:function(){return this.instance.$container},disable:function(){c(this.instance)},disabled:function(){return this.instance.disabled},enable:function(){m(this.instance)},focus:function(){this.instance.$filter_input.focus()},getInstance:function(){return this.instance},hideList:function(){f(this.instance,{force:!0}),ne(this.instance)},recomputeHeight:function(){z(this.instance)},setValue:function(e,t){var n=this.element[0].selectedIndex;this.element.val(e),this.element[0].selectedIndex<0&&(this.element[0].selectedIndex=0);var i=this.element[0].options[this.element[0].selectedIndex];if(this.instance.single){if(this.element[0].selectedIndex==n&&!t)return}else k(this.instance);var r=p(this.instance,$(i));j(this.instance,r)},forceSelectItem:function(e){this.instance.$lfs_value.html(r(this.instance,e,{force_selected:!0})),this.instance.$container.addClass("value")},showList:function(){B(this.instance)},update:function(e){G(this.instance,e)},updatePlaceholder:function(e){this.instance.placeholder_text=e,this.instance.$input.prop("placeholder",e)},updateFilterPlaceholder:function(e){J(this.instance)&&(this.instance.filter_placeholder_text=e,this.instance.$filter_input.prop("placeholder",e))},value:function(){return this.instance._selected}});var t=function(e,t){if(h(e)&&t.trim()&&d(e)){var i={};i[e.sluggify.key_name]=t.trim(),i.lfs_id=null,i.lfs_slug_id=e._slug_id_counter,e._slug_id_counter+=1,e._selected.push(i);var r=TS.templates.lazy_filter_select_item({content:e.tokenTemplate(i),applied_classes:"lfs_token",slug_id:i.lfs_slug_id,data_qa:e.data_qa}).replace(/(\r\n|\n|\r)/gm,""),a=$(r);a.insertBefore(e.$input),e.sluggify.validator&&e.sluggify.validator(a),v(e,e.data),B(e),e.$filter_input.val(""),e._previous_val="",n(e),e.onItemAdded(i),d(e)||e.onMaxItemsSelected()}},n=function(e){e.single||(e.$input.prop("size",e.$filter_input.val().length+1),e.$filter_input.val().length+e._selected.length===0?N(e):(e.$input_container.removeClass("empty"),e.$input_container.removeClass("error"),V(e)))},i=function(e){var t;e.$container.on("mouseleave",ie.bind(null,e)),e.$container.on("click",re.bind(null,e)),e.$container.parents("label").on("click",ae.bind(null,e)),e.$input_container.on("focus",se.bind(null,e)),e.$input.on("focus",oe.bind(null,e)),t=_.isUndefined(e.input_debounce_wait_time)?le:_.debounce(le,e.input_debounce_wait_time),e.$filter_input.on("input",t.bind(null,e)),e.$filter_input.on("keydown",de.bind(null,e)),e.$filter_input.on("blur",ce.bind(null,e)),e.$lfs_value.on("click",fe.bind(null,e)),e.$lfs_value.on("mousedown",he.bind(null,e)),e.$input_container.on("click",".lfs_token",ge.bind(null,e)),e.$input_container.on("mousedown",".lfs_token",Se.bind(null,e)),e.$list_container.on("mousedown",Te.bind(null,e)),e.$list_container.on("mouseup",be.bind(null,e)),e.$list_container.on("mousemove",".lfs_item",ve.bind(null,e)),e.$list_container.on("mouseleave",".lfs_item.active",ye.bind(null,e)),e.$list_container.on("click",".lfs_item",we.bind(null,e)),e.onReady()},r=function(e,t,n){var i,r=$(t),a=(n=n||{}).force_selected||g(e,t),s=t.disabled||t.lfs_disabled;e.restrict_preselected_item_removal&&t.preselected&&(s=!0),i=n.should_tokenize&&_.isFunction(e.tokenTemplate)?e.tokenTemplate(t):e.single&&_.isFunction(e.tokenTemplateSingle)?e.tokenTemplateSingle(t):e.template(t);var o=K(r.data("lfs-item-desc"),e),l={active:""!==e._previous_val&&!a&&!s,disabled:s,lfs_token:n.should_tokenize,selected:a,single:e.single,group_item:r.hasClass("group_item")};return _.isFunction(e.tokenClass)&&(l[e.tokenClass(t)]=!0),TS.templates.lazy_filter_select_item({content:i,icon:r.data("lfs-item-icon"),desc:new Handlebars.SafeString(o),applied_classes:TS.utility.getAppliedClasses(l),lfs_id:t.lfs_id,data_qa:e.data_qa}).replace(/(\r\n|\n|\r)/gm,"")},a="position_above",s="show_status",o=function(e){if(e._list_built||e._showing_status){e.$list_container.removeClass(a);var t=e.$list.css("max-height");e.$list.css({"max-height":0});var n=e.$list[0].scrollHeight,i=parseInt(e.$list_container.css("padding-top"),10)+parseInt(e.$list_container.css("padding-bottom"),10)+parseInt(e.$list_container.css("border-top-width"),10)+parseInt(e.$list_container.css("border-bottom-width"),10)+parseInt(e.$list_container.css("margin-top"),10)+parseInt(e.$list_container.css("margin-bottom"),10);J(e)&&(i+=e.$filter_input.outerHeight()+parseInt(e.$filter_input.css("margin-bottom"),10));var r=parseInt(e.$list_container.css("max-height"),10),s=2*e.approx_item_height+i,o=Math.min(n+i,r),l=$(window).height(),d=e.$input_container[0].getBoundingClientRect().bottom+parseInt(e.$input_container.css("margin-bottom"),10),c=e.adjustAvailableSpaceBelow(l-d);if(e.allow_list_position_above){var u=e.$input_container[0].getBoundingClientRect().top+parseInt(e.$input_container.css("margin-top"),10),_=e.adjustAvailableSpaceAbove(u);_>=o&&!(c>=o&&c>s)&&(c=_,e.$list_container.addClass(a))}var m=Math.floor(Math.min(c,o)-i);e.$list.css({"max-height":m||t})}},l=function(e,t,n){P(e)&&e._running_promise.cancel("Scrolling happened"),e._all_done_fetching||(e._running_promise=e.data_promise(t,n).then((function(t){var n=t;if(n.items&&(n=n.items),n&&n.length){var i;e._page_number+=1,e._current_data||(e._current_data=e.data.slice()),void 0!==t.all_items_fetched&&(e._all_done_fetching=!!t.all_items_fetched),void 0!==t.num_remaining&&0===t.num_remaining&&(e._all_done_fetching=!0);var r=parseInt(t.num_new,10)||0;(i=n.slice(-r)).length?(t._replace_all_items||t.replace_all_items?e._current_data=i:e._current_data=e._current_data.concat(i),u(e,e._current_data)):e._all_done_fetching=!0}else e._all_done_fetching=!0}),(function(t){TS.interop.utility.getLogger({getState:TS.redux.getState}).error(t,"LFS error"),X(e,t,"Something failed while trying to return the next batch of data for lazyFilterSelect.")})))},d=function(e){return e._selected.length<e.max_selected_items},c=function(e){e.disabled||(e.disabled=!0,e.$container.addClass("disabled"),e.$input.prop("disabled",!0),e.$filter_input.prop("disabled",!0))},u=function(e,t){w(e,t),v(e,t),e._list_built&&(!e.data||0===e.data.length||e.always_visible)&&B(e,!0),n(e)},m=function(e){e.disabled&&(e.disabled=!1,e.$container.removeClass("disabled"),e.$input.prop("disabled",!1),e.$filter_input.prop("disabled",!1))},p=function(e,t,n){var i,r=function(e){return e.attr("data-lfs-id")||e.prop("lfs_id")||null}(t);if(n)i=e._selected;else if(i=e.data_promise&&e._current_data?e._current_data:e.data,-1!==r.indexOf(".")){var a=parseInt(r.split(".")[0],10);i=i[a]?i[a].children:i[0].children}var s=i.filter((function(e){return e.lfs_id===r}));return s.length?s[0]:null},f=function(e,t){t=t||{},(!e._list_visible||e.always_visible||e.disabled)&&!t.force||(e._list_visible=!1,e.$list_container.removeClass("visible"),e.$container.removeClass("list_visible"),e.$input_container.removeClass("active"),e._list_built&&e.$list.longListView("setHidden",!0),e._$active=null,e.onListHidden())},h=function(e){return!!e.sluggify.enabled&&(e.sluggify.delimiter?e.sluggify.key_name?!e.single||(TS.error("Sluggify only works in multi-select versions of lazyFilterSelect."),!1):(TS.error("You must pass a key name to use sluggify with lazyFilterSelect."),!1):(TS.error("You must pass a delimiter regular expression to use sluggify with lazyFilterSelect."),!1))},g=function(e,t){return!!e._selected.length&&!!e._selected.filter((function(e){return e.lfs_id===t.lfs_id})).length},S=function(e){return e instanceof jQuery?!!e.attr("data-lfs-slug-id"):void 0!==e.lfs_slug_id},T=function(e,t,i){if(h(e)&&S(t)){var r,a=$(t),s=K(a.data("lfs-item-desc"),e);e._slug_id_counter=Math.max(t.lfs_slug_id,e._slug_id_counter)+1,e._selected.push(t);var o=TS.templates.lazy_filter_select_item({content:e.tokenTemplate(t),icon:a.data("lfs-item-icon"),desc:new Handlebars.SafeString(s),applied_classes:"lfs_token",slug_id:t.lfs_slug_id,data_qa:e.data_qa}).replace(/(\r\n|\n|\r)/gm,"");return(r=$(o)).insertBefore(e.$input),n(e),e.sluggify.validator&&e.sluggify.validator(r),e.data=i.filter((function(e){return e.lfs_slug_id!==t.lfs_slug_id})),e.data}},b=function(e){var t=e.children("option, optgroup"),n=t.length>0?[]:void 0;return t.each((function(){if("OPTGROUP"===$(this).prop("tagName")){var e=$(this).children("option").toArray();$(this).prop("disabled")&&(e=e.map((function(e){return e.lfs_disabled=!0,e}))),n.push({is_divider:!0,lfs_group:!0,label:$(this).prop("label"),children:e})}else n.push(this)})),n};var v=function(e,t){if(t||(t=e.data),t)if(0!==t.length){if(ne(e,{keep_input_active:!0}),e._list_built){var n=y(t);e.$list.longListView("setItems",n,!0),e._current_data=t,z(e)}else e.data&&0!==e.data.length||(e.data=t),R(e);o(e)}else Z(e);else X(e)},y=function(e){var t=[];return e.forEach((function(e){if(t.push(e),e.children&&e.children.length)for(var n=0;n<e.children.length;n+=1)t.push(e.children[n])})),t},w=function(e,t){if(t||(t=e.data),t){for(var n="",i=!e.single,a=0;a<t.length;){var s=t[a];if(S(s))t=T(e,s,t);else{if(s.children&&s.children.length&&(s.lfs_group=!0),s.lfs_group||s.is_divider){s.is_divider=!0;for(var o=a,l=0;l<s.children.length;l+=1){var d=s.children[l];if(d.lfs_id=d.lfs_id||o+"."+l,(d.selected||d.preselected)&&!1===e.no_default_selection){if(e.single&&e._selected.length>0||g(e,d))continue;e._selected.push(d),n+=r(e,d,{should_tokenize:i})}}}else if(s.lfs_id=s.lfs_id||String(a),(s.selected||s.preselected)&&!1===e.no_default_selection){if(e.single&&e._selected.length>0||g(e,s)){a+=1;continue}e._selected.push(s),n+=r(e,s,{should_tokenize:i})}a+=1}}n.length>0&&(e.$container.addClass("value"),e.single?e.$lfs_value.html(n):($(n).insertBefore(e.$input),e.$input_container.removeClass("empty"),e.$input_container.removeClass("error"),V(e)))}},k=function(e){for(;e.$input_container.find(".lfs_token").length>0;)x(e)},x=function(e){var t=e.$input_container.find(".lfs_token").last();t.length&&C(e,t)},C=function(e,t){if(!e.disabled)if(S(t))M(e,t);else{var n=p(e,t,!0);if(!(n.disabled||e.restrict_preselected_item_removal&&n.preselected))e._selected=e._selected.filter((function(e){return e!==n})),e.$list.find('[data-lfs-id="'+n.lfs_id+'"]').removeClass("selected"),t.remove(),W(e),e.$filter_input.val().length+e._selected.length===0&&N(e),0===e._selected.length&&e.$container.removeClass("value"),e.onItemRemoved(n)}},M=function(e,t){if(h(e)){var n=function(e,t){var n=parseInt(t.attr("data-lfs-slug-id"),10),i=e._selected.filter((function(e){return e.lfs_slug_id===n}));return i.length?i[0]:null}(e,t);e._selected=e._selected.filter((function(e){return e!==n})),t.remove(),W(e),e.$filter_input.val().length+e._selected.length===0&&N(e),e.onItemRemoved(n)}},I=function(){this.data&&0===this.data.length&&TS.warn("Data passed to lazyFilterSelect is empty."),G(this,this.data),this.always_visible&&B(this),this.restrict_input_container_height&&(this.$container.addClass("has_restricted_input_container_height"),TS.environment.supports_custom_scrollbar||this.$input_container.monkeyScroll())},E=function(e,t,i){if(!e.disabled&&t!==e._previous_val)if(e._all_done_fetching=!1,e._previous_val=t,e._$active=null,n(e),e._page_number=1,e._list_built&&e.$list.longListView("scrollToTop",!0),e.data_promise)P(e)&&e._running_promise.cancel("User entered more text"),e._running_promise=A(e,t).then((function(t){u(e,t),B(e,i)}),(function(t){TS.interop.utility.getLogger({getState:TS.redux.getState}).error(t,"LFS error"),X(e,t,"Something failed while trying to return the filtered data for lazyFilterSelect.")}));else{B(e,i);var r=function(e,t){for(var n=e.data,i=[],r=0;r<n.length;r+=1){var a=n[r];if(a.lfs_group||a.is_divider){for(var s=[],o=0;o<a.children.length;o+=1){var l=a.children[o];e.filter(l,t)&&s.push(l)}s.length>0&&i.push({is_divider:!0,lfs_group:!0,label:a.label,children:s})}else e.filter(a,t)&&i.push(a)}return i}(e,t);v(e,r),n(e)}},A=function(e,t){return new Promise((function(n,i){t.length<e.min_query_length?(e._all_done_fetching=!0,n([])):(_.delay((function(){P(e)&&ee(e)}),650),e.data_promise(t).then((function(t){t=t||{},_.isUndefined(t.all_items_fetched)||(e._all_done_fetching=!!t.all_items_fetched),0===t.num_remaining&&(e._all_done_fetching=!0);var i=(t.items||t).slice();n(i),ne(e,{keep_input_active:!0})}),(function(t){i(t),ne(e)})))}))},P=function(e){return e._running_promise&&e._running_promise.isPending()},O=function(e,t){var n;e.disabled||(e._list_visible?(n=e._$active?e._$active[t](".lfs_item:not(.disabled, .hidden)").first():e.$list.find(".lfs_item:not(.disabled, .hidden)").first()).length&&(n.scrollintoview({duration:0}),e._$active&&e._$active.removeClass("active"),n.addClass("active"),e._$active=n):B(e))},F=function(e){return!(e.hasClass("selected")||e.hasClass("disabled"))},j=function(e,t){if(d(e)){if(e.single&&e._selected.length)e.$list.find('[data-lfs-id="'+e._selected[0].lfs_id+'"]').removeClass("selected"),e._selected.length=0,e.$lfs_value.empty();e._selected.push(t),W(e);var n=$(r(e,t,{should_tokenize:!e.single}));_.isFunction(e.tokenClass)&&n.addClass(e.tokenClass(t)),e.single?e.$lfs_value.html(n):(n.addClass("lfs_token"),n.insertBefore(e.$input)),e.single||(e.$input_container.removeClass("empty"),e.$input_container.removeClass("error"),V(e)),e.$container.addClass("value"),e.onItemAdded(t),d(e)||e.onMaxItemsSelected(),e.single||e.$filter_input.focus()}},H=function(e){return O(e,"nextAll")},D=function(e){if(!e.disabled){var t=e._$active;if(t.length&&F(t)&&d(e)){t.addClass("selected"),t.removeClass("active"),e._$active=null;var n=p(e,t);j(e,n)}}},L=function(e){return O(e,"prevAll")},N=function(e){e.$input_container.addClass("empty"),Y(e)},B=function(e,t){e.disabled||(TS.utility.rAF((function(){e.$filter_input.focus()})),e._list_visible||e._showing_status&&e.always_visible||(e._list_built||R(e),(e._list_built||e._showing_status)&&(e._list_visible=!0,e.$list_container.addClass("visible"),e.$container.addClass("list_visible"),J(e)||e.$input_container.addClass("active"),e._list_built&&e.$list.longListView("setHidden",!1)),e.single&&!t&&(e.$filter_input.val(""),e._previous_val="",e.$filter_input.focus(),Q(e)&&(e.data=[]),v(e)),e.set_height&&(o(e),e.monkey_scroll&&!TS.environment.supports_custom_scrollbar&&e.$list.monkeyScroll()),e.onListShown()))},R=function(e){if(e.data&&0!==e.data.length){var t=y(e.data);e._list_built=!0;var n={items:t,approx_item_height:e.approx_item_height,approx_divider_height:e.approx_divider_height,preserve_dom_order:!0,calcDividerHeight:function(e){return e.outerHeight()},makeDivider:function(){return $('<div class="lfs_group"></div>')},makeElement:function(){return $(TS.templates.lazy_filter_select_item().replace(/(\r\n|\n|\r)/gm,""))},renderDivider:function(t,n,i){if(e.renderDividerFunc)return e.renderDividerFunc(t,n,i);t.html(K(n.label,e))},renderItem:function(t,n,i){if(e.render_item_func)return e.render_item_func(t,n,i);var r=$(n),a={disabled:n.disabled||n.lfs_disabled,selected:g(e,n),single:e.single,group_item:r.hasClass("group_item")};_.isFunction(e.listItemClass)&&(a[e.listItemClass(n)]=!0);var s=TS.utility.getAppliedClasses(a),o={"data-qa":e.data_qa+"-item-"+n.lfs_id,"data-lfs-id":n.lfs_id,title:n.title};if(t.attr(o).removeClass("active selected disabled single group_item lfs_token").addClass(s).html(e.template(n).string),r.data("lfs-item-icon")){var l="url("+r.data("lfs-item-icon")+")",d=$('<span class="lfs_item_icon">').css("background-image",l);t.prepend(d)}if(r.data("lfs-item-desc")){var c=K(r.data("lfs-item-desc"),e),u=$('<span class="lfs_item_desc">').html(c);t.append(u)}}};e.$list.longListView(n),function(e){e.data_promise&&e.$list.on("scroll",(function(){var t=$(this).scrollTop(),n=e.$list.height(),i=e.$list.find(".list_items").height()-t-n;i<=e.scroll_threshold&&!e._scroll_callback_was_called&&!e._all_done_fetching?(l(e,e._previous_val,e._page_number+1),e._scroll_callback_was_called=!0):i>e.scroll_threshold&&e._scroll_callback_was_called&&(P(e)&&e._running_promise.cancel("User scrolled back and we do not need to add more data"),e._scroll_callback_was_called=!1)}))}(e),e.$list_items=e.$container.find(".list_items"),TS.utility.rAF((function(){e.monkey_scroll&&!TS.environment.supports_custom_scrollbar&&e.$list.monkeyScroll(),e.$list.longListView("resizeImmediately"),TS.utility.rAF((function(){e.current_items_in_view_signal.dispatch(e.$list.longListView("getCurrentItemsInView")||[])}))})),e.$list.longListView("getCurrentItemsInViewSignal")&&e.$list.longListView("getCurrentItemsInViewSignal").add((function(t){e.current_items_in_view_signal.dispatch(t)}))}},U=function(e){e.stopPropagation(),e.preventDefault()},q=function(e,t){if(!e.single&&e.allow_item_unselect){var n=p(e,t,!0);t.removeClass("selected"),e._selected=e._selected.filter((function(e){return e!==n})),e.$input_container.find('.lfs_item[data-lfs-id="'+n.lfs_id+'"]').remove(),W(e),e.$filter_input.val().length+e._selected.length===0&&N(e),0===e._selected.length&&e.$container.removeClass("value"),e.onItemRemoved(n)}},G=function(e,t){if(e.data=t||b(e.$select),e.data&&(e._selected=[],w(e),e.$filter_input.val().length)){var n=e.$filter_input.val();e._previous_val="",E(e,n)}},z=function(e){e.restrict_input_container_height&&TS.ui.utility.updateClosestMonkeyScroller(e.$input_container,!0),e.monkey_scroll&&!TS.environment.supports_custom_scrollbar&&(o(e),TS.utility.rAF((function(){TS.ui.utility.updateClosestMonkeyScroller(e.$list,!0)})))},W=function(e){if(!e.append){var t=e._selected.filter((function(e){return e instanceof HTMLOptionElement})).map((function(e){return $(e).val()}));e.$select.val(t).trigger("change")}},K=function(e,t){return e=_.escape(e),_.get(t,"should_graphic_replace_emoji")&&(e=TS.emoji.graphicReplace(e)),e},V=function(e){e.$input.attr("placeholder",""),J(e)&&e.$filter_input.attr("placeholder","")},Y=function(e){e.$input.attr("placeholder",e.placeholder_text),J(e)&&e.$filter_input.attr("placeholder",e.filter_placeholder_text)},J=function(e){return e.style===TS.ui.lazy_filter_select.STYLES.filter_in_list},Q=function(e){return _.isFunction(e.data_promise)&&e.min_query_length},X=function(e,t,n){te(e,e.errorTemplate(t),{internal_error_message:n,clear_active_items:!0})},Z=function(e){var t=e.noResultsTemplate(e.$filter_input.val());te(e,t,{clear_active_items:!0})},ee=function(e){var t=TS.interop.i18n.t("Loading results\u2026","lazy_filter_select")();te(e,t,{show_loading_indicator:!0})},te=function(e,t,n){n=n||{},e._showing_status=!0,n.internal_error_message&&TS.error(n.internal_error_message),J(e)||e.$input_container.addClass("active"),n.show_loading_indicator&&e.$status_loading_indicator.removeClass("hidden"),n.clear_active_items&&(e._$active=null),e.$status_content.html(t),e.$list_container.addClass(s)},ne=function(e,t){t=t||{},e._showing_status=!1,t.keep_input_active||e.$input_container.removeClass("active"),e.$status_loading_indicator.addClass("hidden"),e.$list_container.removeClass(s)},ie=function(e){e._prevent_blur=!1},re=function(e){e.disabled||B(e)},ae=function(e,t){e.disabled||(t.preventDefault(),B(e))},se=function(e){e.$input_container.click(),e.$input.focus()},oe=function(e){e._input_is_focused||(e._input_is_focused=!0,e.$input_container.click(),e.onInputFocus()),e.single||e.$input_container.addClass("active")},le=function(e){var n=e.$filter_input.val();h(e)&&n.match(e.sluggify.delimiter)?n.split(e.sluggify.delimiter).forEach((function(n){n.length&&t(e,n)})):E(e,n,!0)},de=function(e,t){if(!e.disabled){switch(t.keyCode){case TS.utility.keymap.down:U(t),H(e);break;case TS.utility.keymap.up:U(t),L(e);break;case TS.utility.keymap.enter:ue(e,t);break;case TS.utility.keymap.del:_e(e,t);break;case TS.utility.keymap.tab:me(e,t);break;case TS.utility.keymap.esc:pe(e,t)}e.onKeyDown(t,t.isDefaultPrevented())}},ce=function(e){e._prevent_blur||(f(e),ne(e)),e._input_is_focused=!1,e.onInputBlur()},ue=function(e,t){if(e._$active&&e._$active.length&&e._list_visible){U(t);var n=e._$active;if(!e.single&&e.allow_item_unselect&&g(e,p(e,n)))q(e,n);else{if(!d(e))return;D(e);var i=$(t.currentTarget);""!==i.val()&&(i.val(""),e._previous_val="",v(e)),e.single&&(f(e),ne(e))}}},_e=function(e,t){if(""===e.$filter_input.val()){U(t);var i=e.$input_container.find(".lfs_token").last();h(e)&&S(i)?function(e,t){if(h(e)&&S(t)){var i=t.text().trim();t.length&&M(e,t),e.$filter_input.val(i),n(e),e.$filter_input.select()}}(e,i):x(e)}},me=function(e,n){e.$filter_input.val().trim()&&h(e)?(U(n),t(e,e.$filter_input.val())):e.tab_to_nav&&(U(n),n.shiftKey?L(e):H(e))},pe=function(e,t){U(t),f(e),ne(e),e.$filter_input.blur()},fe=function(e,t){e.disabled||(t.stopPropagation(),B(e),e._prevent_blur=!1)},he=function(e,t){1===t.which&&(e._prevent_blur=!0)},ge=function(e,t){e.disabled||(C(e,$(t.currentTarget)),e._prevent_blur=!1)},Se=function(e,t){1===t.which&&(e._prevent_blur=!0)},Te=function(e,t){1===t.which&&(e._prevent_blur=!0)},be=function(e){e._prevent_blur&&e.$filter_input.focus()},ve=function(e,t){if(!e.disabled&&(t.clientX!=e._mouse.lastX||t.clientY!=e._mouse.lastY)){var n=$(t.currentTarget);e._$active&&e._$active.removeClass("active"),!n.hasClass("active")&&F(n)&&(n.addClass("active"),e._$active=n),e._mouse.lastX=t.clientX,e._mouse.lastY=t.clientY}},ye=function(e,t){$(t.currentTarget).removeClass("active"),e._$active=null},we=function(e,t){if(!e.disabled){t.preventDefault();var n=$(t.currentTarget);if(e._$active=n,!e.single&&e.allow_item_unselect&&g(e,p(e,n)))q(e,n);else{var i=F(n);if(!i&&!e.single)return;if(!d(e))return;if(!i&&e.single)return f(e),void t.stopPropagation();D(e),""!==e.$filter_input.val()&&(e.$filter_input.val(""),e._previous_val="",v(e)),e.single&&(f(e),t.stopPropagation())}e._prevent_blur=!1}}}()},Ijbi:function(e,t,n){var i=n("WkPL");e.exports=function(e){if(Array.isArray(e))return i(e)}},J4zp:function(e,t,n){var i=n("wTVA"),r=n("m0LI"),a=n("ZhPi"),s=n("wkBT");e.exports=function(e,t){return i(e)||r(e,t)||a(e,t)||s()}},J7dF:function(e,t){!function(){TS.registerModule("permissions.members",{onStart:function(){},canPostInChannel:function(e){return!!e&&TS.interop.rules.user.canPostInChannel(e.id)},canPostInModelOb:function(e){return TS.permissions.members.canPostInChannel(e)},canNonAdminsAtMentionEveryoneBySettings:function(){var e=TS.shared.legacyGetActiveModelOb();return!!e&&TS.interop.rules.user.canNonAdminsAtMentionEveryoneBySettings(e.id)},canAtMentionEveryone:function(e){var t=TS.redux.channels.getEntityById(e)||TS.shared.legacyGetActiveModelOb();return!!t&&TS.interop.rules.user.canAtMentionEveryone(t.id)},canNonAdminsAtChannelOrGroupBySettings:function(e){return TS.interop.rules.user.canNonAdminsAtMentionEveryoneBySettings(e)},canAtChannelOrGroup:function(e){var t=TS.redux.channels.getEntityById(e)||TS.shared.legacyGetActiveModelOb();return!!t&&TS.interop.rules.user.canAtChannelOrGroup(t.id)},canArchiveChannels:function(){return TS.interop.rules.user.canUserArchiveChannels()},canCreateChannels:function(){return TS.interop.rules.user.canUserCreatePublicChannels()},canCreateGroups:function(){return TS.interop.rules.user.canUserCreatePrivateChannels()},canCreateAndDeleteUserGroups:function(){return TS.interop.userGroups.canCreateAndDeleteUserGroups()},canUserSeeMember:function(e){return!TS.model.user.is_restricted||(!!e.is_self||(!!TS.interop.rules.members.isSlackbot(e)||!!_.find(TS.members.getMembersForUser(),(function(t){return e.id===t.id}))))},canKickFromChannels:function(){return TS.interop.rules.user.canKickFromPublicChannels()},canKickFromGroups:function(){return TS.interop.rules.user.canKickFromPrivateChannels()},canManageOrgSharedChannels:function(){if(!TS.prefs.getTeamPref("who_can_manage_shared_channels"))return!0;if(!TS.boot_data.page_needs_enterprise)return!1;var e=TS.model.user;if(e.is_restricted)return!1;if(void 0!==TS.prefs.getTeamPref("can_user_manage_shared_channels"))return TS.prefs.getTeamPref("can_user_manage_shared_channels");var t=TS.prefs.getTeamPref("who_can_manage_shared_channels").type[0];return"regular"===t||("admin"===t?e.is_admin||e.is_owner||!(!e.enterprise_user||!e.enterprise_user.is_admin&&!e.enterprise_user.is_owner):"owner"===t&&(!(!e.enterprise_user||!e.enterprise_user.is_admin&&!e.enterprise_user.is_owner)||!!(TS.prefs.getTeamPref("who_can_manage_shared_channels").user&&TS.prefs.getTeamPref("who_can_manage_shared_channels").user.indexOf(TS.model.user.id)>-1)))},canRequestSharedChannel:function(){return TS.interop.rules.teams.isSharedChannelsEnabled(TS.redux.getState(),TS.model.team)},canDisconnectSharedChannels:function(){return TS.interop.rules.user.canUserDisconnectExternalSharedChannel(TS.redux.getState())},canNonAdminInviteToWorkspace:function(){return!(!TS.model.team||!TS.model.user)&&(!TS.model.user.is_restricted&&(!TS.prefs.getTeamPref("invites_only_admins")||TS.boot_data.page_needs_enterprise&&TS.prefs.getTeamPref("who_can_manage_guests")&&TS.interop.rules.teams.canOrgUserManageGuests(TS.model.team,TS.model.user)))},test:function(){var t={};return Object.defineProperty(t,"_checkPrefCascade",{get:function(){return e},set:function(t){e=t}}),t}});var e=function(e,t,n){return void 0===n&&(n=!0),t.is_restricted?"ra"===TS.prefs.getTeamPref(e):"ra"===TS.prefs.getTeamPref(e)||("regular"===TS.prefs.getTeamPref(e)||("admin"===TS.prefs.getTeamPref(e)?!!t.is_admin:"owner"===TS.prefs.getTeamPref(e)?!!t.is_owner:n))}}()},Jzty:function(e,t){!function(){TS.registerModule("ui.inline_msg_input",{onStart:_.noop,make:function(r,a){var s=TS.templates.inline_message_input({input_id:_.uniqueId("inline_message_input_"),include_emo:!1,include_plus_button:a.include_plus_button}),o=$(s);o.appendTo(r);var l=o.find(".message_input");return a.placeholder&&TS.utility.contenteditable.placeholder(l,a.placeholder),e(o,l,a),t(o,l),a.include_plus_button&&n(o,a),a.scrollIntoView&&i(o,l),o}});var e=function(e,t,n){var i=n.onSubmit||_.noop,r=n.onCancel||_.noop;TS.utility.contenteditable.create(t,{modules:{keyboard:{onUpArrow:function(){if(!TS.prefs.getPref("arrow_history"))return s(t,!1,n)},onUpArrowCmd:function(){s(t,!0,n)}},tabcomplete:{searchOptions:{model_ob:n.model_ob,in_thread:!!n.in_thread},completers:n.completers,positionMenu:function(e){var i=t.offset(),r=$(window).width()-i.left-2;e.style.width=Math.min(t.outerWidth(),r)+"px",e.style.minWidth=0,TS.tabcomplete.positionUIRelativeToInput(e,t,n.autocomplete_below_input)}}},placeholder:n.placeholder,ariaLabel:n.aria_label,isJumbomojiEnabled:!!n.jumbomoji&&TS.utility.contenteditable.isJumbomojiEnabled,enableBroadcastKeywords:n.enableBroadcastKeywords,onEnter:function(){return a(t,e,i),n.onEnter&&n.onEnter(),!1},onEscape:function(){n.onEscape&&n.onEscape()},onTab:function(){return n.onTab&&n.onTab(),!0},onTextChange:function(){TS.msg_edit.checkLengthAndUpdateMessage(t),n.onTextChange&&n.onTextChange(t)}}),TS.utility.contenteditable.enable(t),e.bind("destroyed",(function(){r(e)})),e.bind("submit",(function(n){n.preventDefault(),a(t,e,i)}))},t=function(e,t){var n=e.find(".emo_menu");n.removeClass("hidden"),n.bind("click.open_dialog",(function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:t})}))},n=function(e,t){var n=t.model_ob,i=t.thread_ts;e.find(".inline_file_upload").click((function(e){e.preventDefault(),TS.menu.file.startWithNewFileOptions(e,$(this),{model_ob_id:n.id,thread_ts:i})}))},i=function(e,t){e.scrollintoview({duration:500,px_offset:100,complete:function(){TS.utility.contenteditable.focus(t),TS.utility.contenteditable.setCursorAtEnd(t)}})},r=function(e,t){var n=e.closest("ts-message");if(t&&n.length){var i=n.data("ts"),r=TS.utility.msgs.getMsg(i,t.msgs);if(r&&TS.interop.messages.canEditMessage(TS.model.user.id,r,t,TS.prefs.getTeamPref("msg_edit_window_mins")))return r}return null},a=function(e,t,n){var i=TS.utility.contenteditable.value(e);(function(e,t){return!TS.msg_edit.isMessageTooLong(e)&&!!$.trim(t)})(e,i=TS.utility.contenteditable.legacySynchronouslyReplacePotentialMentions(i,{enableBroadcastKeywords:!1}))&&n(t,i)},s=function(e,t,n){var i=jQuery.Event("keydown",{altKey:!1,shiftKey:!1,which:TS.utility.keymap.up});t&&(TS.model.is_mac?i.metaKey=!0:i.ctrlKey=!0),o(e,n)},o=function(e,t){var n=t.getMsgDivForEditing||r,i=t.model_ob,a=n(e,i);if(a&&a.length){var s=a.data("ts"),o=a.data("model-ob-id");i=TS.redux.channels.getEntityById(o);var l=a.closest("#convo_container").length>0?"convo":null;TS.msg_edit.startEdit(s,i,l)}}}()},L48h:function(e,t){!function(){var e,t,n;TS.registerModule("ui.admin_edit_team_profile",{onStart:function(){$("body").on("click",'[data-action="edit_team_profile_modal"]',TS.ui.admin_edit_team_profile.start)},start:function(){w()&&r()}});var i=[],r=function(){var e={body_template_html:TS.templates.admin_edit_team_profile_modal(),onShow:a,onCancel:s};TS.ui.fs_modal.start(e)},a=function(){e=$("#edit_team_profile_container"),t=$("body"),e.on("click",'[data-action="edit_team_profile_to_custom"]',g),e.on("click",'[data-action="edit_team_profile_to_add"]',h),e.on("click",'[data-action="edit_team_profile_to_edit"]',S),e.on("click",'[data-action="edit_team_profile_to_hide"]',T),e.on("click",'[data-action="edit_team_profile_to_delete"]',b),e.on("click",'[data-action="edit_team_profile_cancel"]',f),e.on("click",'[data-action="edit_team_profile_confirm_edit"]',m),e.on("click",'[data-action="edit_team_profile_confirm_hide"]',c),e.on("click",'[data-action="edit_team_profile_confirm_delete"]',d),e.on("click",'[data-action="edit_team_profile_remove_option"]',M),e.on("click",'[data-action="edit_team_profile_add_option"]',I),e.on("focusin",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',P),e.on("focusout",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',O),e.on("input",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',A),e.on("click",'[data-action="edit_team_profile_list_menu"]',D),e.on("input","input",G),t.on("keydown.admin_submit",o),l().then(f).catch(TS.error)},s=function(){k(!0),e=null,i=[],n=null,t.off("keydown.admin_submit"),t=null},o=function(e){if(e.which==TS.utility.keymap.enter)return $(n).find('button[type="submit"]').trigger("click"),!1},l=function(){return TS.team.ensureTeamProfileFields()},d=function(e){var t=$(e.target),n=t.data("id");(n||(t=t.closest("[data-id]")),n=t.data("id"))&&(TS.team.getTeamProfileFieldById(n)&&p("team.profile.delete",[n]).then(f,_.noop))},c=function(e){u(e,!0)},u=function(e,t){var n=$(e.target),i=n.data("id");if(i||(n=n.closest("[data-id]")),i=n.data("id")){var r=TS.team.getTeamProfileFieldById(i);r&&((r=$.extend({},r)).is_hidden=t,t&&(r.ordering=r.ordering||H()),p("team.profile.set",[r]).then((function(){f(),q(i)}),_.noop))}},m=function(t){var n=e.find("#edit_team_profile_edit");if(!TS.ui.validation.validate(n,{quiet:!0,fast:!0}))return TS.ui.validation.validate(n),Ladda.stopAll(),void $("#edit_team_profile_confirm_edit_btn").addClass("disabled");var i=$(t.target),r=i.data("id");r||(i=i.closest("[data-id], [data-type]")),r=i.data("id");var a=e.find('input[name="label"]'),s=e.find('input[name="hint"]'),o=TS.team.getTeamProfileFieldById(r)||{},l=JSON.stringify(o);function d(){f(),q(r)}(o=$.extend({},o)).type=o.type||i.data("type")||"text",o.label=a.val().trim(),o.hint=s.val().trim(),o.ordering=o.ordering||H(),"options_list"===o.type&&(o.possible_values=e.find('input[name^="option_"]').map((function(){return $(this).val().trim()})).toArray()),JSON.stringify(o)==l?(d(),Ladda.stopAll()):p("team.profile.set",[o]).then(d,_.noop)},p=function(e,t){return t=t&&t.length?t:TS.model.team.profile.fields,function(e,t){if(e)return TS.interop.api.call(e,t).then((function(n){return"team.profile.delete"===e?TS.interop.members.deleteProfileFields(TS.model.team.id,JSON.parse(t.profile).fields):"team.profile.reorder"===e?TS.interop.teams.reorderTeamProfileFields(TS.model.team.id,_.get(n,"data.profile.fields")):TS.interop.members.updateProfileFields(TS.boot_data.team_id,_.get(n,"data.profile.fields")),Promise.resolve(n)}),(function(e){return Promise.reject(e)}))}(e,{profile:JSON.stringify({fields:t})}).catch((function(e){if("no_perms"!==e.data.error&&"missing_scope"!==e.data.error)return"field_bad_order"===e.data.error?(TS.error("Failed to create profile field: "+e.data.error),TS.generic_dialog.alert(TS.interop.i18n.t("Apologies, but the maximum number of profile fields you can add is {max_no_of_fields, number}. Please remove some existing fields if you\u2019d like to add different ones.","team_profile")({max_no_of_fields:50}))):(TS.error("Failed to customize profile: "+e.data.error),TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","team_profile")()));var t=TS.boot_data.page_needs_enterprise?TS.interop.i18n.t("Sorry! An organization owner or admin is required to update this setting.","team_profile","21d269f8b1a2802d90b32308195ac5b67c9413f6")():TS.interop.i18n.t("Sorry! An owner in your workspace has restricted who can customize your members\u2019 profile.","team_profile")();TS.generic_dialog.start({body:t,show_cancel_button:!1,esc_for_ok:!0,fullscreen:!1,onEnd:TS.ui.fs_modal.close})})).finally(Ladda.stopAll)},f=function t(){i.length=0,i.push({back:t});var n={};n.team_profile_fields=B(),n.hidden_team_profile_fields=R(),n.default_team_profile_fields=U(),n.hide_default_title="treatment"===TS.interop.experiments.getGroupForUser("rimeto_profile_p0_webapp")&&(TS.model.team.profile.fields||[]).some((function(e){return"title"===e.field_name&&e.options&&e.options.is_scim})),n.hide_default_phone="treatment"===TS.interop.experiments.getGroupForUser("rimeto_profile_p0_webapp")&&"on"!==TS.interop.experiments.getGroupForUser("rimeto_profile_show_default_phone_webapp")&&(TS.model.team.profile.fields||[]).some((function(e){return"primaryPhone"===e.field_name&&e.options&&e.options.is_scim})),n.show_pronoun_field=TS.prefs.getTeamPref("display_pronouns");var r,a=TS.templates.admin_edit_team_profile_list(n);e.find("#edit_team_profile_header").text(TS.interop.i18n.t("Customize profile","team_profile")()).removeClass("hidden center_and_narrow"),r=TS.model.team.profile&&TS.model.team.profile.fields.length>=50?'<div class="alert alert_info"><i class="ts_icon ts_icon_info_circle"></i>'+TS.interop.i18n.t("You have reached the maximum number of fields that can be added to profiles.","team_profile")()+"</div>":TS.interop.i18n.t("Expand your members\u2019 profiles by adding additional fields below","team_profile")(),e.find("#edit_team_profile_value_note").html(r).removeClass("hidden center_and_narrow"),e.find("#edit_team_profile_list").html(a),N("#edit_team_profile_list"),j(),y(),k(!0)},h=function t(){i.push({back:t});var n={};n.default_team_profile_fields=U();var r=TS.templates.admin_edit_team_profile_add(n);e.find("#edit_team_profile_header").text(TS.interop.i18n.t("Select a field type","team_profile")()).removeClass("center_and_narrow"),e.find("#edit_team_profile_value_note").addClass("hidden"),e.find("#edit_team_profile_add").html(r),N("#edit_team_profile_add"),y(),k()},g=function t(){i.push({back:t});var n=TS.templates.admin_edit_team_profile_custom();e.find("#edit_team_profile_header").text(TS.interop.i18n.t("Create a new field","team_profile")()).removeClass("center_and_narrow"),e.find("#edit_team_profile_value_note").text(TS.interop.i18n.t("Which type of field would you like to create?","team_profile")()).removeClass("hidden center_and_narrow"),e.find("#edit_team_profile_custom").html(n),N("#edit_team_profile_custom"),y(),k(),F()},S=function t(n){var r=$(n.target);if(r.hasClass("ts_icon_grabby_patty"))return!1;var a=r.data("id");a||(r=r.closest("[data-id], [data-type]"));var s,o={};if(a=r.data("id")){if(!(o=TS.team.getTeamProfileFieldById(a)))return;s=TS.interop.i18n.t("Edit profile field","team_profile")()}else o.type=r.data("type"),o.label=r.data("label"),s=TS.interop.i18n.t("Customize profile field","team_profile")();n.stopPropagation(),i.push({back:t,event:n});var l=TS.templates.admin_edit_team_profile_edit(o);e.find("#edit_team_profile_header").text(s).removeClass("center_and_narrow"),e.find("#edit_team_profile_value_note").addClass("hidden"),e.find("#edit_team_profile_edit").html(l),N("#edit_team_profile_edit"),x(),C(),F(),Ladda.bind("#edit_team_profile_confirm_edit_btn"),y(),k(),G()},T=function t(n){var r=$(n.target),a=r.data("id");if(a||(r=r.closest("[data-id]")),a=r.data("id")){var s=TS.team.getTeamProfileFieldById(a);if(s){n.stopPropagation(),i.push({back:t,event:n});var o=TS.templates.admin_edit_team_profile_hide({id:s.id,can_delete:!_.get(s,"options.is_scim",!1)}),l=TS.interop.i18n.t('Hide "{field_label}"',"team_profile")({field_label:s.label});e.find("#edit_team_profile_header").text(l).addClass("center_and_narrow");var d=TS.interop.i18n.t("All data entered for this field will no longer be visible on your members\u2019 profiles. You can un-hide it later.","team_profile")();e.find("#edit_team_profile_value_note").text(d).addClass("center_and_narrow").removeClass("hidden"),e.find("#edit_team_profile_hide").html(o),N("#edit_team_profile_hide"),Ladda.bind("#edit_team_profile_confirm_hide_btn"),v(),k()}}},b=function t(n){var r=$(n.target),a=r.data("id");if(a||(r=r.closest("[data-id]")),a=r.data("id")){var s=TS.team.getTeamProfileFieldById(a);if(s){n.stopPropagation(),i.push({back:t,event:n});var o=TS.templates.admin_edit_team_profile_delete(s),l=TS.interop.i18n.t('Delete "{field_label}"',"team_profile")({field_label:s.label});e.find("#edit_team_profile_header").text(l).addClass("center_and_narrow");var d=TS.interop.i18n.t("<strong>Are you sure?</strong> All data associated with this field will be permanently deleted. This <strong>cannot be undone</strong>.","team_profile")();e.find("#edit_team_profile_value_note").html(d).addClass("center_and_narrow").removeClass("hidden"),e.find("#edit_team_profile_delete").html(o),N("#edit_team_profile_delete"),Ladda.bind("#edit_team_profile_confirm_delete_btn"),v(),k()}}},v=function(){e.closest(".contents").addClass("display_flex flex_direction_column").css("height","70vh"),e.css({margin:"auto 0",height:"auto","padding-top":0})},y=function(){e.closest(".contents").removeClass("display_flex flex_direction_column").css("height",""),e.css({margin:"",height:"","padding-top":""})},w=function(){if(!TS.model.team)return!1;var e=TS.model.user;return!!e&&("admin"===TS.prefs.getTeamPref("who_can_change_team_profile")?e.is_admin:"owner"!==TS.prefs.getTeamPref("who_can_change_team_profile")||e.is_owner)},k=function(e){e?(TS.ui.fs_modal.unbindBackButton(),TS.ui.fs_modal.hideBackButton()):(TS.ui.fs_modal.bindBackButton((function(){i.pop();var e=i.pop();e.back(e.event)})),TS.ui.fs_modal.showBackButton())},x=function(){var t=e.find(".option_row");t.length>=3?t.addClass("show_remove_action"):t.removeClass("show_remove_action")},C=function(){A({target:e.find('.option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]')})},M=function(e){$(e.target).closest(".row.option_row").remove(),G(),x(),C(),E()},I=function(){var t=TS.templates.admin_edit_team_profile_option_row({index:e.find(".row.option_row").length});e.find("#option_rows").append(t).find(".row.option_row").last().find("input").focus(),G(),x(),E()},E=function(){50===e.find(".row.option_row").length?e.find('[data-action="edit_team_profile_add_option"]').addClass("hidden").next().removeClass("hidden"):e.find('[data-action="edit_team_profile_add_option"]').removeClass("hidden").next().addClass("hidden")},A=function(t){var n=$(t.target),i=n.val();i&&(i=i.trim()),void 0===i||i.length||(i=n.data("default")),e.find('.profile_field_preview [data-id="'+n.data("target")+'"]').text(i)},P=function(t){var n=e.find('.profile_field_preview [data-id="'+$(t.target).data("target")+'"]'),i=n.closest("select");i.length&&(n=i),n.addClass("highlight_yellow_bg")},O=function(t){var n=e.find('.profile_field_preview [data-id="'+$(t.target).data("target")+'"]'),i=n.closest("select");i.length&&(n=i),n.removeClass("highlight_yellow_bg")},F=function(){var t=e.find(".edit_team_profile_lazy_filter_select");if(t.length){var n="USLACKBOT";TS.boot_data.feature_deprecate_get_member_by_name||(n=TS.interop.members.getMemberByName("slackbot").id);var i={append:!0,classes:"disabled",preselected_ids:[n]};TS.ui.people_picker.make(t,i)}},j=function(){e.find("#edit_team_profile_list_drag_and_drop_area").sortable({items:".visible_row[data-id]",handle:".ts_icon_grabby_patty",forcePlaceholderSize:!0}).on("sortupdate",(function(e){e.stopPropagation();var t=[];$(this).find(".row[data-id]").each((function(e){var n=TS.team.getTeamProfileFieldById($(this).data("id"));n&&n.ordering!=e&&(n.ordering=e,t.push({id:n.id,ordering:e}))}));var n=TS.team.sortTeamProfileFieldsByOrdering(TS.model.team.profile.fields);TS.redux.teams.upsertTeam(_.assign({},TS.model.team,{profile:{fields:n}})),p("team.profile.reorder",t)}))},H=function(){return TS.model.team.profile.fields.length?_.max(TS.model.team.profile.fields.map((function(e){return e.ordering})))+1:0},D=function(e){e.stopPropagation();var t=$(e.target).closest("[data-id]").get(0),n={};n.is_scim=$(e.target).closest("[data-is-scim]").data("is-scim");var i=jQuery.Event("click",{target:t,currentTarget:t});TS.menu.startWithEditTeamProfileListActions(i,L,n)},L=function(e){e.preventDefault();var t=$(e.target).closest("[data-id]");t.is('[data-action="edit_team_profile_to_show"]')?function(e){u(e,!1)}(e):t.is('[data-action="edit_team_profile_to_hide"]')?T(e):t.is('[data-action="edit_team_profile_to_delete"]')&&b(e),TS.menu.end()},N=function(t){var i=["#edit_team_profile_loading","#edit_team_profile_list","#edit_team_profile_add","#edit_team_profile_custom","#edit_team_profile_edit","#edit_team_profile_hide","#edit_team_profile_delete"].filter((function(e){return e!==t})).join(", ");e.find(i).addClass("hidden"),e.find(t).removeClass("hidden"),n=t},B=function(){var e=TS.team.getVisibleTeamProfileFields();return e.length?e:null},R=function(){var e=TS.team.getHiddenTeamProfileFields();return e.length?e:null},U=function(){var e=TS.model.team.profile.fields.reduce((function(e,t){return e[t.label.toLowerCase()]=!0,e}),{}),t=[{type:"text",label:TS.interop.i18n.t("Address","team_profile")()},{type:"date",label:TS.interop.i18n.t("Birthdate","team_profile")()},{type:"user",label:TS.interop.i18n.t("Direct Reports","team_profile")()},{type:"link",label:TS.interop.i18n.t("Facebook","team_profile")()},{type:"link",label:TS.interop.i18n.t("Flickr","team_profile")()},{type:"link",label:TS.interop.i18n.t("GitHub","team_profile")()},{type:"link",label:TS.interop.i18n.t("Instagram","team_profile")()},{type:"link",label:TS.interop.i18n.t("LinkedIn","team_profile")()},{type:"user",label:TS.interop.i18n.t("Manager","team_profile")()},{type:"link",label:TS.interop.i18n.t("Pinterest","team_profile")()},{type:"text",label:TS.interop.i18n.t("Skype","team_profile")()},{type:"link",label:TS.interop.i18n.t("SoundCloud","team_profile")()},{type:"date",label:TS.interop.i18n.t("Start Date","team_profile")()},{type:"link",label:TS.interop.i18n.t("Tumblr","team_profile")()},{type:"link",label:TS.interop.i18n.t("Twitter","team_profile")()},{type:"link",label:TS.interop.i18n.t("YouTube","team_profile")()}].filter((function(t){return!e[t.label.toLowerCase()]}));return t.length?t:[]},q=function(t){var n=t?"[data-id="+t+"]":".visible_row[data-id]",i=e.find("#edit_team_profile_list").find(n).last(),r=-2*i.outerHeight();i.highlight(1500,"",null,0),i.scrollintoview({duration:200,px_offset:r,direction:"y"})},G=function(){$("#edit_team_profile_confirm_edit_btn").toggleClass("disabled",!TS.ui.validation.validate(e.find("#edit_team_profile_edit"),{quiet:!0,fast:!0}))}}()},LzIY:function(e,t){!function(){TS.registerModule("compression",{compress:function(e,t,n,r){var s=Date.now();if(n){var o=LZString.compress(t),l=Date.now()-s;return TS.has_pri[a]&&TS.log(a,e+" took "+l+"ms to _compress immediately str.length: "+t.length),r({k:e,str:o})}i(e,t,(function(t,n){var i=Date.now()-s;TS.has_pri[a]&&TS.log(a,e+" took "+i+"ms for the compression worker to callback ("+n+"ms spent within the worker) result.length: "+t.length),r({k:e,str:t})}))},deCompress:function(e,t){return""},terminate:function(){e&&e.terminate(),e=null}});var e=null,t=0,n={},i=function(i,a,s){e||r();var o="job_key"+(t+=1);n[o]=function(e,t){s(e,t),delete n[o]},e.postMessage({request:"compress",input:a,job_key:o,k:i})},r=function(){if(e)TS.error("_makeWorker but there is a _worker");else{var t=_.get(TS,"boot_data.vvv_paths.lz_string","/js/libs/lz-string-1.4.4.js"),i=TS.environment.is_dev;(TS.qs_args.local_assets||i)&&0!==t.indexOf("http")&&(t=location.protocol+"//"+location.host+t),e=TS.utility.makeWebWorker("function() {\t\t\tself.importScripts('"+t+"');\t\t\tself.onmessage = function(e) {\t\t\t\tvar start = Date.now();\t\t\t\tvar result;\t\t\t\tif (e.data.request === 'compress') {\t\t\t\t\tresult = LZString.compress(e.data.input)\t\t\t\t}\t\t\t\tvar elapsed = Date.now() - start;\t\t\t\tpostMessage({\t\t\t\t\trequest: e.data.request,\t\t\t\t\tresult: result,\t\t\t\t\tjob_key: e.data.job_key,\t\t\t\t\tk: e.data.k,\t\t\t\t\telapsed: elapsed\t\t\t\t});\t\t\t}\t\t}",(function(e){var t=n[e.data.job_key];t?t(e.data.result,e.data.elapsed):TS.error("e.data.job_key:"+e.data.job_key+" had no record in _callbacks??")}))}},a=488}()},Nwtb:function(e,t){!function(){TS.registerModule("tips.texty",{onStart:function(){e.delegate(".ts_tip_texty","mouseenter",n),e.delegate(".ts_tip_texty","mouseleave",i)},show:function(e,t){r(e,t)},hide:function(){a()},isShowing:function(){return t}});var e=$("BODY"),t=!1,n=function(e){r(e.target)},i=function(){a()},r=function(n,i){var r=$(n).closest(".ql-container");if(r.length&&!r.hasClass("texty_hide_tooltips")){var a=n.getAttribute("data-title")||null,s=n.getAttribute("data-id")&&"UNVERIFIED"!==n.getAttribute("data-id")?TS.interop.members.getMemberById(n.getAttribute("data-id")):null;if($("#ts_tip_texty_tip").remove(),a||s){var o=$('<div id="ts_tip_texty_tip"'+(i?' class="ts_tip_texty_slow"':"")+"></div>"),l=n.getBoundingClientRect();TS.interop.mountTooltipTip(TS.boot_data.team_id,o[0],s?s.id:null,{children:a,position:"top",className:s?"c-tooltip__tip--member":""}),e.append(o);var d=e.height()-l.top,c=l.left;c-=o.width()/2,c+=l.width/2,o.css({bottom:d+"px",left:c+"px",opacity:1}),t=!0}}},a=function(){var e=document.getElementById("ts_tip_texty_tip");if(e){var n=$(e).hasClass("ts_tip_texty_slow")?200:100;$(e).fadeOut(n,(function(){TS.interop.unmountTooltipTip(e),$(e).remove(),t=!1}))}}}()},Nyv6:function(e,t){TS.registerModule("utility.enterprise",{getSelf:function(){return _.get(TS.enterprise.model.get(),"org.user")},splitQueryIntoTerms:function(e,t,n){var i,r=t;return(e=e.trim()).length>=2&&(r=_.isArray(t)?_.slice(t):[],i=e.split(/\s+/),_.each(i,(function(e){r.push({type:n||"fuzzy_with_email",value:e})}))),r},doFormatSearchQuery:function(e,t,n){t=t||"";var i=[];switch(e){case"members":i.push({type:"is",value:"user"}),n&&!_.isEqual(n,"all")&&i.push(TS.utility.enterprise.doFormatMemberFilterClauses(n));break;case"groups":i.push({type:"is",value:"group"});break;case"teams":i.push({type:"is",value:"team"})}return{query:TS.utility.enterprise.splitQueryIntoTerms(t,i)}},doFormatMemberFilterClauses:function(e){switch(e){case"admins":return{type:"or",clauses:[{type:"level",value:"admin"},{type:"level",value:"owner"},{type:"level",value:"primary_owner"}]};case"guests":return{type:"or",clauses:[{type:"level",value:"restricted"},{type:"level",value:"ultra_restricted"},{type:"level",value:"invited_guest"}]};case"invited":return{type:"or",clauses:[{type:"level",value:"invited"},{type:"level",value:"invited_guest"}]};case"members":default:return{type:"level",value:"regular"}}},getSSOProviderLabel:function(e,t){if(!e)return t;var n=_.get(e,"type",""),i=_.get(e,"name","");return""===n||"saml"===n?t:i||t},getProviderLabel:function(e,t){var n=t||"IDP";return e?("saml"===(t=_.get(e,"saml_provider")||n).toLowerCase()&&(t=n),TS.utility.enterprise.getSSOProviderLabel(_.get(e,"sso_provider"),t)):n},getWorkspaceVisibilityLabel:function(e){switch(e){case"open":return TS.interop.i18n.t("Open","enterprise_dashboard")();case"unlisted":return TS.interop.i18n.t("Hidden","enterprise_dashboard")();case"closed":return TS.interop.i18n.t("By Request","enterprise_dashboard")();case"invite_only":return TS.interop.i18n.t("Invite Only","enterprise_dashboard")();default:return e}},getGroupsTitle:function(e){var t=TS.utility.enterprise.getProviderLabel(e);return"IDP"===t?TS.interop.i18n.t("IDP Groups","enterprise_dashboard")():TS.interop.i18n.t("{provider_label} Groups","enterprise_dashboard")({provider_label:t})},wrapWithStrongTags:_.wrap(_.escape,(function(e,t){return"<strong>"+e(t)+"</strong>"})),buildTeamUrl:function(e){return"https://"+(e||"my")+"."+TS.boot_data.abs_root_url.replace(/(http:\/\/|https:\/\/)/,"")},buildOrgUrl:function(e){return"https://"+e+".enterprise."+TS.boot_data.abs_root_url.replace(/(http:\/\/|https:\/\/)/,"")},getSanitizedIdpLabel:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.locale,i=void 0===n?TS.interop.i18n.locale:n;return{simple:"IDP"!==e&&e?e:"",your:"IDP"!==e&&e?e:TS.interop.i18n.t("your IdP","enterprise_utility")(),possessive:"IDP"!==e&&e?TS.interop.i18n.fullPossessiveString(e,{locale:i}):TS.interop.i18n.t("your IdP\u2019s","enterprise_utility")()}},formatChannelsData:function(e){var t=[];return e.private_channels&&(e.private_channels=_.isArray(e.private_channels)?e.private_channels:[e.private_channels],t=_.map(e.private_channels,(function(e){var t=TS.interop.members.getMemberById(e.creator)||{},n=e.members,i=Array.isArray(n)?n.length:e.members,r={creator_display:t.real_name?t.real_name:t.name,creator_id:e.creator,creator_username:t.name,date_created:e.created,member_count:e.member_count||i,purpose:e.purpose.value,topic:e.topic.value,private:!0};return _({}).assign(e,r).omit("members").value()}))),e.channels&&(t=t.concat(_.map(e.channels,(function(e){var t=TS.interop.members.getMemberById(e.creator)||{},n=e.members,i=Array.isArray(n)?n.length:e.members,r={creator_display:t.real_name?t.real_name:t.name,creator_id:e.creator,creator_username:t.name,date_created:e.created,member_count:i||0,purpose:_.get(e,"purpose.value",""),topic:_.get(e,"topic.value",""),private:!1};return _({}).assign(e,r).omit("members").value()})))),t},pollUntilCondition:function(e){return new Promise((function(t,n){e=_.merge({api_method:null,api_params:{},condition_method:null,interval:5e3,interval_backoff:1e3,attempts_max:10,call_immediately:!0},e||{});var i={attempts:0,last_api_response:null,interval:parseInt(e.interval,10)||1e3,interval_backoff:parseInt(e.interval_backoff,10)||0};function r(){if(i.attempts>=e.attempts_max)return n(new Error("Giving up on "+e.api_method+", reached max attempts of "+e.attempts_max));i.attempts+=1,i.interval+=i.interval_backoff,TS.interop.api.call(e.api_method,e.api_params).then((function(n){return i.last_api_response=n,e.condition_method(n)?t(n):a()})).catch((function(e){return i.last_api_response=e,a()}))}function a(){window.setTimeout(r,i.interval)}return e.api_method?e.condition_method?void(e.call_immediately?r():a()):n(new Error("missing required condition_method in params")):n(new Error("missing required api_method in params"))}))},getUserRoleLabel:function(e,t){var n;return n=t?{primary_owner:TS.interop.i18n.t("Primary Org Owner","enterprise_dashboard")(),owner:TS.interop.i18n.t("Org Owner","enterprise_dashboard")(),admin:TS.interop.i18n.t("Org Admin","enterprise_dashboard")(),single_channel_guest:TS.interop.i18n.t("Single-Channel Guest","enterprise_dashboard")(),multi_channel_guest:TS.interop.i18n.t("Multi-Channel Guest","enterprise_dashboard")(),member:TS.interop.i18n.t("Member","enterprise_dashboard")()}:{primary_owner:TS.interop.i18n.t("Primary Owner","enterprise_dashboard")(),owner:TS.interop.i18n.t("Owner","enterprise_dashboard")(),admin:TS.interop.i18n.t("Admin","enterprise_dashboard")(),single_channel_guest:TS.interop.i18n.t("Single-Channel Guest","enterprise_dashboard")(),multi_channel_guest:TS.interop.i18n.t("Multi-Channel Guest","enterprise_dashboard")(),member:TS.interop.i18n.t("Member","enterprise_dashboard")()},e.is_ultra_restricted?n.single_channel_guest:e.is_restricted?n.multi_channel_guest:e.is_primary_owner?n.primary_owner:e.is_owner?n.owner:e.is_admin?n.admin:n.member},buildAnalyticsApiOptionsFor:function(e){var t=function(e){return _.reduce(e,(function(e,t,n){var i=TS.enterprise.model.get(["analytics",t]);return i&&(e[n]=i),e}),{})};switch(e){case"teams":return t({query:"teams_search_term",sort_prefix:"teams_sort_prefix",sort_dir:"teams_sort_dir",cursor_mark:"teams_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});case"team_overview":return t({date_range:"current_date_range",start_date:"start_date",end_date:"end_date",team_id:"team_overview_id"});case"members":return t({query:"members_search_term",sort_prefix:"members_sort_prefix",sort_dir:"members_sort_dir",cursor_mark:"members_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});case"channels":return t({query:"channels_search_term",sort_prefix:"channels_sort_prefix",sort_dir:"channels_sort_dir",cursor_mark:"channels_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});default:return t({date_range:"current_date_range",start_date:"start_date",end_date:"end_date"})}},maybeGetUpdatedAtTime:function(e){return e?TS.interop.datetime.toTimeAgo(e):null},getObjectsForIds:function(e,t){return _.isEmpty(e)||_.isEmpty(t)?[]:_.intersectionWith(e,t,(function(e,t){return e.id===t}))},getQueryForIds:function(e){if(!_.isEmpty(e))return 1===e.length?{query:{type:"id",value:_.head(e)}}:{query:{type:"or",clauses:_.map(e,(function(e){return{type:"id",value:e}}))}}},buildApiOptionsForAnalyticsCSVExport:function(e){var t={};if(e.type&&(t.type=e.type),e.date_range&&(t.date_range=e.date_range),_.get(e.selected_columns,"length")&&(t.cols=e.selected_columns.join(",")),e.team_id&&(t.team_id=e.team_id),e.sort_prefix&&(t.sort_prefix=e.sort_prefix,e.sort_dir&&(t.sort_dir=e.sort_dir)),e.search_term){var n=TS.utility.enterprise.splitQueryIntoTerms(e.search_term,[],"fuzzy_with_email");if(n.length){var i=1===n.length?_.head(n):{type:"and",clauses:n};t.query=JSON.stringify(i)}}return t},recordAnalyticsPricingEvents:function(e,t,n){n=n||{};var i={};switch(t){case"overview_impression":i.action="impression",i.step="team_stats_overview";break;case"coachmark_impression":i.action="impression",i.step="team_stats_overview_"+_.get(n,"callout_module")+"_coachmark";break;case"coachmark_resolve":i.action="click",i.step="team_stats_overview_"+_.get(n,"callout_module")+"_coachmark",i.ui_element="learn_more_btn";break;case"coachmark_reject":i.action="dismiss",i.step="team_stats_overview_"+_.get(n,"callout_module")+"_coachmark",i.ui_element="skip_this";break;case"msg_files_pricing_btn_click":i.action="click",i.step="team_stats_overview",i.ui_element="msg_files_chart_link_btn";break;case"single_callout_upgrade_link_impression":i.action="impression",i.step="team_stats_overview",i.ui_element=_.get(n,"callout_module")+"_upgrade_link";break;case"multi_callout_upgrade_link_impression":i.action="impression",i.step="team_stats_overview",i.ui_element="multi_lim_upgrade_link";break;case"data_table_upsell_banner_impression":i.action="impression",i.step="team_stats_"+_.get(n,"report_name");break;case"data_table_upsell_banner_click":i.action="click",i.step="team_stats_"+_.get(n,"report_name"),i.ui_element="see_pricing_plans_btn"}TS.interop.clog.track(e,{contexts:{ui_context:i}})},recordAnalyticsImpression:function(e,t,n,i,r){var a={},s={};a.action="impression",a.ui_element=t,s.entity_key=n,s.tracking_code=i,s.anchor_page=e,s.target_team_id=r||TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id"),TS.interop.clog.track("ENTERPRISE_ANALYTICS",_.assign({},s,{contexts:{ui_context:a}}))},recordAnalyticsTooltipHover:function(e){var t={},n={};t.action="hover",t.ui_element="NOTING_BADGE",n.entity_key=e;var i=TS.enterprise.model.get("org.enterprise.id"),r=TS.enterprise.model.get("analytics.overview_open");i&&!r?(n.anchor_page="organization_overview",n.target_team_id=i):r?(n.anchor_page="workspace_overview",n.target_team_id=TS.enterprise.model.get("analytics.team_overview_id")):(n.anchor_page="workspace_overview",n.target_team_id=_.get(TS.boot_data,"team_id")),TS.interop.clog.track("ENTERPRISE_ANALYTICS",_.assign({},n,{contexts:{ui_context:t}}))},recordAnalyticsSearchEvent:function(e,t,n){var i={},r={};i.action="impression",i.action_status=n?2:1,i.ui_element="SEARCH_BAR",r.entity_key=t,r.anchor_page=e,r.target_team_id=TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id"),TS.interop.clog.track("ENTERPRISE_ANALYTICS",_.assign({},r,{contexts:{ui_context:i}}))},convertDateRangeToThriftID:function(e){switch(e){case"30d":return"FILTER_LAST_30DAYS";case"all":return"FILTER_ALL_TIME"}},convertTimeseriesTabToClogKey:function(e){switch(e){case"active-users_weekly_active_users":return"wau_ts";case"active-users_daily_active_users":return"dau_ts";case"messages-and-files_messages_sent":return"messages_sent_ts";case"messages-and-files_files_uploaded":return"files_uploaded_ts";case"transparency_where_messages_sent":return"transparency_sent_ts";case"transparency_where_messages_read":return"transparency_read_ts"}},getNumberAnnotation:function(e){var t="";if("ja-JP"===TS.interop.i18n.locale)switch(e){case"channels":case"messages":t="\u4ef6";break;case"users":t="\u4eba";break;case"files":case"apps":t="\u500b"}return t}})},OHyl:function(e,t){!function(){TS.registerModule("ui.react_emoji_menu",{is_showing:!1,onStart:function(){TS.prefs.emoji_mode_changed_sig.add(h)},start:function(e){o(e)}});var e,t,n,i,r,a="reactroot_emoji_picker",s="#msg_input",o=function(e){n=e.rxn_key,i=n?function(t){var n=!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(e.rxn_key),t);TS.rxns.changeRxnsFromUserAction(e.rxn_key,t,n),e.callback&&e.callback()}:e.callback,s=!n&&(e.input_to_fill||s);var a=e.position;t=$(e.e&&e.e.target),d({open:!0,is_rxn:!!n}),TS.tips.hideAll(),r=e.target_bounds||t.dimensions_rect();var o=window.pageYOffset;r.top+=o,r.bottom+=o,TS.ui.react_emoji_menu.is_showing=!0;var c={position:a,offset_x:e.offset_x,offset_y:e.offset_y,should_return_focus_after_close:e.should_return_focus_after_close};l({},c),TS.model.is_our_app&&TS.interop.desktop.legacyAreDragRegionsRequired()&&_.get(window,"desktop.app.updateDragRegion")&&window.desktop.app.updateDragRegion([])},l=function(t,n){var i=c(t),r=u(n);TS.telemeter.mark("react_emoji_menu_render_mark"),e||(e=g()),TS.interop.mountEmojiPicker(TS.boot_data.team_id,e,i,r)},d=function(e){e.is_rxn?(t.closest(".menu_rxn").toggleClass("active",e.open),t.closest(".rxn_panel").toggleClass("active",e.open),t.closest("ts-message").toggleClass("active",e.open),t.toggleClass("active",e.open)):(t.closest(".emo_menu").toggleClass("active",e.open),t.closest(".handy_rxns_row").toggleClass("active",e.open),t.closest(".current_status_emoji_picker").toggleClass("active",e.open))},c=function(){return{onSkinToneChanged:f,groups:TS.model.emoji_groups,onSelected:m,onClosed:p,emojiMap:TS.model.emoji_map,showHandyReactions:!!n}},u=function(e){return{targetBounds:r,allowanceX:15,allowanceY:15,position:(e=e||{}).position||"top-left",offsetX:_.isUndefined(e.offset_x)?0:e.offset_x,offsetY:_.isUndefined(e.offset_y)?-6:e.offset_y,isOpen:TS.ui.react_emoji_menu.is_showing,onClose:p,ariaRole:"dialog",ariaLabel:TS.interop.i18n.t("Emoji picker dialog","emoji_picker")(),shouldReturnFocusAfterClose:e.should_return_focus_after_close}},m=function(e,t,n){TS.boot_data.feature_sonic_emoji&&(t={name:":"+t+":"});if(function(e,t){if(!TS.boot_data.feature_sonic_emoji){var n=_.find(TS.model.emoji_map,{name_with_colons:TS.emoji.stripLocalizedSkinTone(e.name)});t&&(t=t.replace(/^:/,"")),n&&TS.ui.frecency.record(n,t)}}(t,n),!i)return s?void function(e,t){var n=$(s),i=t.display_name||t.name,r=!(e&&e.shiftKey);if(TS.interop.utility.isContentEditableElement(n))if(TS.utility.contenteditable.inlineEmojiIsEnabled()){var a=TS.interop.texty.convertContentsStringToContents(t.name,{shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});setTimeout(TS.utility.contenteditable.insertContentsAtCursor,0,n,a,r)}else setTimeout(TS.utility.contenteditable.insertTextAtCursor,0,n,i,r);else{var o=TS.utility.contenteditable.cursorPosition(n).start,l=o+i.length,d=TS.utility.contenteditable.value(n),c=d.substr(0,o)+i+d.substr(o);TS.utility.populateInput(n,c),r&&setTimeout(TS.utility.contenteditable.cursorPosition,0,s,l)}}(e,t):TS.error("Could not find an _input_to_fill.");setTimeout(i,0,t.name)},p=function(){d({open:!1,is_rxn:!!n}),t=null,s="#msg_input",n=null,i=null,_handy_rxns=null,TS.tips.unhideAll(),TS.ui.react_emoji_menu.is_showing=!1,l()},f=function(e){(TS.prefs.legacyOnPrefChanged({name:"preferred_skin_tone",value:e}),TS.prefs.setPrefByAPI({name:"preferred_skin_tone",value:e}),TS.ui.react_emoji_menu.is_showing)&&l({skin_tone_id:e})},h=function(){TS.ui.react_emoji_menu.is_showing&&_.defer(l)},g=function(){if(!document.getElementById(a)){var e=document.createElement("div");e.setAttribute("id",a),document.body.appendChild(e)}return document.getElementById(a)}}()},Oszc:function(e,t){TS.registerModule("channels.read_only",{list_updated_sig:new signals.Signal,refetching_channel_info_ids:{},stashAndFetchChannelPostingUpdates:function(e,t,n){if(!TS.channels.read_only.refetching_channel_info_ids[e]){TS.channels.read_only.refetching_channel_info_ids[e]=!0;var i={id:e},r=!0;switch(t){case 6:i.is_read_only=!0,i.is_thread_only=!1,i.is_non_threadable=!1;break;case 7:i.is_read_only=!1,i.is_thread_only=!0,i.is_non_threadable=!1;break;case 8:i.is_read_only=!1,i.is_thread_only=!1,i.is_non_threadable=!0;break;default:r=!1}r&&(TS.interop.channels.upsertChannel(i),TS.channels.read_only.list_updated_sig.dispatch()),TS.shared.promiseToRefetchModelOb(e,n).then((function(){delete TS.channels.read_only.refetching_channel_info_ids[e],TS.channels.read_only.list_updated_sig.dispatch()}))}},addChannelToList:function(e){TS.model.read_only_channels=_.uniq(_.concat(TS.model.read_only_channels,e)),TS.channels.read_only.list_updated_sig.dispatch()},removeChannelFromList:function(e){TS.model.read_only_channels=TS.model.read_only_channels.filter((function(t){return t!==e})),TS.channels.read_only.list_updated_sig.dispatch()},isReadOnly:function(e){if(TS.boot_data.page_needs_enterprise){if(TS.model.user.enterprise_user&&TS.model.user.enterprise_user.is_owner)return!1}else if(TS.model.user.owner)return!1;if(!TS.interop.utility.looksLikeChannelId(e))return!1;var t=TS.redux.channels.getEntityById(e,!1);return!!t&&!t.is_im&&!t.is_mpim&&(_.isUndefined(t.is_read_only)?TS.model.read_only_channels.indexOf(e)>-1:t.is_read_only)}})},PU4x:function(e,t){!function(){var e,t;TS.registerModule("ui.react_message_menu",{onStart:function(){e=document.getElementById(r)},showMessageMenu:function(n,i){var r=i.channel,s=i.message,o=i.message_container_type;t=$(n&&n.target);var l="";o===TS.interop.constants.MessageContainers.THREADS_FLEXPANE&&(l="convo"),TS.interop.messages.addMessages([s]);var d={channelId:r.id,ts:s.ts,messageContainerType:o,onSelectAction:function(e,t){var n=TS.interop.mountMessageActionsMenu.actionIds;return t.id===n.editMessage&&(TS.msg_edit.startEdit(s.ts,r,l),!0)},onTriggerClose:TS.ui.react_message_menu.closeMessageMenu,onMenuItemSelected:TS.ui.react_message_menu.closeMessageMenu},c=a();t.closest("ts-message").addClass("active"),TS.interop.mountMessageActionsMenu(TS.interop.selfTeamIds.getTeamId(TS.redux.getState()),e,d,c)},closeMessageMenu:function(){t&&(t.closest("ts-message").removeClass("active"),t=null),TS.interop.mountMessageActionsMenu(TS.interop.selfTeamIds.getTeamId(TS.redux.getState()),e,{},{isOpen:!1})}});var n=4,i=-8,r="message_actions_menu_mount_point",a=function(){return{targetBounds:t?t.dimensions_rect():{},position:"right-bottom",allowanceX:46,allowanceY:15,offsetX:n,offsetY:i,isOpen:!0,onClose:TS.ui.react_message_menu.closeMessageMenu}}}()},PhMi:function(e,t,n){var i=n("lSNA");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(){TS.registerModule("stars",{member_stars_fetched_sig:new signals.Signal,member_stars_being_fetched_sig:new signals.Signal,channel_starred_sig:new signals.Signal,channel_unstarred_sig:new signals.Signal,has_more:!1,fetched_once:!1,onStart:function(){TS.files.team_file_changed_sig.add(r),TS.channels.message_changed_sig.add(i),TS.ims.message_changed_sig.add(i),TS.mpims.message_changed_sig.add(i),TS.groups.message_changed_sig.add(i),e=$("#member_stars_more_btn")},getAllStars:function(){return n},fetchUserStarredItems:function(){var e=l();return TS.stars.fetched_once||(TS.stars.fetched_once=!0),TS.interop.api.call("stars.list",e).then((function(e){var t=e.data,n=e.args,i=e.request_id;return s&&s(!0,t,n,i),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return s&&s(!1,t,n,i),{data:t,args:n,request_id:i}}))},userStarStatusHasChanged:function(e,t,n){d(e,t,n);var i=!1;if("message"===t.type)c(t.message.ts,t.channel,e,!1),TS.redux.messages.wasMessageDeleted(t.channel,t.message.ts)||TS.redux.messages.replaceMessage(TS.interop.messages.preprocessImsg(t.message,t.channel));else if("file"===t.type)t.file.is_starred!=e&&m(t.file.id,e);else if("file_comment"===t.type)t.comment.is_starred!=e&&u(t.comment.id,t.file.id,e);else if("channel"===t.type){var r=TS.interop.channels.getPublicChannelById(t.channel,i);r?r.is_starred!=e&&p(t.channel,e):TS.warn("userStarStatusHasChanged channel_id:"+t.channel+" not found")}else if("group"===t.type){var a=TS.interop.channels.getGroupById(t.channel,i);a||(a=TS.interop.channels.getMpimById(t.channel,i)),a?a.is_starred!=e&&(a.is_mpim?g(t.channel,e):f(t.channel,e)):TS.warn("userStarStatusHasChanged group_id:"+t.channel+" not found")}else if("im"===t.type){var s=TS.interop.channels.getImById(t.channel,i);s?s.is_starred!=e&&h(t.channel,e):TS.warn("userStarStatusHasChanged im_id:"+t.channel+" not found")}else TS.error("userStarStatusHasChanged needs to handle star item type:"+t.type)},checkForStarClick:function(e,t){if(!e.target)return!1;var n,i=$(e.target);_.isFunction(t)||(t=_.noop);var r=!1;i.closest(".star").length?n=i.closest(".star"):(n=i.closest(".star_link"),r=!0);var a=!1;if(n&&n.length||(i.is("button.file_star")?n=i.children(".star"):i.closest(".starred_icon").length&&(a=!0,n=i.closest(".starred_icon"))),!n||!n.length)return!1;if(n.hasClass("not-clickable"))return!1;var s,o=n.hasClass("starred"),l={};if(a){var d=TS.redux.channels.getEntityById(n.data("c-id"));d&&(l.channel=d.id,o=d.is_starred,s=function(e){d.is_channel?p(l.channel,e):d.is_im?h(l.channel,e):d.is_mpim?g(l.channel,e):d.is_group&&f(l.channel,e)})}else if(n.hasClass("star_message"))l.channel=n.data("c-id"),l.timestamp=n.data("msg-id"),s=function(e){c(l.timestamp,l.channel,e,!0)};else if(n.hasClass("star_file"))l.file=n.data("file-id"),s=function(e){m(l.file,e,r)};else if(n.hasClass("star_file_comment"))l.file_comment=n.data("comment-id"),s=function(e){u(l.file_comment,n.data("file-id"),e)};else if(n.hasClass("star_channel"))l.channel=n.data("channel-id"),s=function(e){p(l.channel,e)};else if(n.hasClass("star_group"))l.channel=n.data("group-id"),s=function(e){f(l.channel,e)};else if(n.hasClass("star_im")||n.hasClass("star_app")){l.channel=n.data("im-id");var S=!1;n.hasClass("star_app")&&(S=!0),s=function(e){h(l.channel,e,S)}}else{if(!n.hasClass("star_mpim"))return TS.error("checkForStarClick doesn't know what to do with a click on "+n[0].outerHTML),!1;l.channel=n.data("mpim-id"),s=function(e){g(l.channel,e)}}if(e.preventDefault(),s(!o),t(!o),o){var T=function(e,n){e||("not_starred"===n.error?(s(!1),t(!1)):(s(!0),t(!0)))};TS.interop.api.call("stars.remove",l).then((function(e){var t=e.data,n=e.args,i=e.request_id;return T(!0,t),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return T(!1,t),{data:t,args:n,request_id:i}}))}else{var b=function(e,n){e||("already_starred"===n.error?(s(!0),t(!0)):(s(!1),t(!1)))};TS.interop.api.call("stars.add",l).then((function(e){var t=e.data,n=e.args,i=e.request_id;return b(!0,t),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return b(!1,t),{data:t,args:n,request_id:i}}))}return!0},updateMsgStar:function(e,t,n,i){c(e,t,n,i)},updateFileStar:function(e,t){m(e,t)},updateFileCommentStar:function(e,t,n){u(e,t,n)},updateChannelStar:function(e,t){p(e,t)},toggleStarOnMsg:function(e,t,n){if(e&&t){var i=TS.utility.msgs.findMsg(e,t.id);if(i){var r={channel:t.id,timestamp:e},a=i.is_starred?"stars.remove":"stars.add",s=function(e,i){e?n&&n(t):i.error&&TS.error(i.error)};TS.interop.api.call(a,r).then((function(e){var t=e.data,n=e.args,i=e.request_id;return s(!0,t),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return s(!1,t),{data:t,args:n,request_id:i}}))}}},toggleStar:function(e,t){var n=t?TS.redux.channels.getEntityById(t):TS.shared.legacyGetActiveModelOb();if(n){var i=n.is_starred,r={};if(r.channel=n.id,i){var a=function(t,i){t?e&&e(n):i.error&&TS.error(i.error)};TS.interop.api.call("stars.remove",r).then((function(e){var t=e.data,n=e.args,i=e.request_id;return a(!0,t),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return a(!1,t),{data:t,args:n,request_id:i}}))}else{var s=function(t,i){t?e&&e(n):i.error&&TS.error(i.error)};TS.interop.api.call("stars.add",r).then((function(e){var t=e.data,n=e.args,i=e.request_id;return s(!0,t),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return s(!1,t),{data:t,args:n,request_id:i}}))}}}});var e,t=1,n=[],i=function(e,t){!0===t.is_starred&&TS.stars.maybeUpdateUserStarredList()},r=function(e){if(e.hasOwnProperty("is_starred")){var t=$(".star_item"),n=TS.files.containerHasFileListItem(e,t);if(!TS.interop.files.isObjectFresh(e.id)&&n)return void TS.files.getFileById(e.id);n&&(m(e.id,e.is_starred,e.id),TS.files.updateFileListItem(e,t,TS.interop.constants.MessageContainers.STARS_FLEXPANE))}},s=function(i,r,a){if(TS.stars.member_stars_being_fetched_sig.dispatch(TS.model.user,!1),i){for(var s=0;s<r.items.length;s+=1){var l=r.items[s];TS.stars.userStarStatusHasChanged(!0,l,"stars.list")}1==a.page?n=r.items:(n=n.concat(r.items),n=_.uniqWith(n,_.isEqual)),e.data("ladda")&&e.data("ladda").stop(),o(),TS.stars.has_more=r.paging.pages>r.paging.page,a._update||(t+=1),TS.stars.member_stars_fetched_sig.dispatch(null,TS.model.user)}else TS.stars.member_stars_fetched_sig.dispatch({error:"api_not_ok"})},o=function(){if("treatment"==TS.stars.badge_star_menu){var e=Date.now()/1e3-259200,t=_.countBy(n,(function(t){return t.date_create>e})),i=_.get(t,!0,0);0===i?$("#star_badge").hide():$("#star_badge").show().text(i>=20?"20+":i)}},l=function(){return{user:TS.model.user.id,exclude:"Ch,Gh,Dh",page:t,count:20}},d=function(e,t,n){if("message"===t.type)t.message._rxn_key=TS.rxns.getRxnKey("message",t.message.ts,t.channel),"channel_topic"!==t.message.type&&"channel_purpose"!==t.message.type&&"channel_join"!==t.message.type&&"channel_leave"!==t.message.type||(t.message.subtype=t.message.type),t.message.type="message";else if("file"===t.type||"file_comment"===t.type){if(!t.file)return TS.error("WTF no file in type "+t.type+" in "+n),!1;if(t.file_id){var i=TS.files.getFileById(t.file_id);if(!i)return!1;TS.files.upsertAndSignal(a(a({},i),{},{is_starred:e}),"slurpStarItem")}else TS.files.upsertAndSignal(t.file,"slurpStarItemFilesInfo");var r=t.file&&t.file.id;if(Object.defineProperty(t,"file",{enumerable:!0,configurable:!0,get:function(){return TS.files.getFileById(r)},set:function(){return!1}}),"file_comment"===t.type){if(!t.comment)return TS.error("WTF no comment in type "+t.type+" in "+n),!1;t.comment=TS.files.addCommentToFile(t.comment,t.file)}}else if("channel"===t.type);else if("group"===t.type);else if("im"!==t.type)return TS.error("need to handle star item type:"+t.type+" in "+n),!1;return!0},c=function(e,t,n,i){var r;TS.redux.channels.getEntityById(t)&&(r=TS.utility.msgs.findMsg(e,t));var a=$('.star_message[data-msg-id="'+e+'"][data-c-id="'+t+'"]');if(i){var s=n?"STAR_ADD_CLICKED":"STAR_REMOVE_CLICKED";TS.interop.clog.track(s,{})}S(a,n,r)},u=function(e,t,n){var i,r=TS.files.getFileById(t);r?i=TS.files.getFileCommentById(r,e):TS.warn("updateFileCommentStar file_id:"+t+" not found"),S($('.star_comment[data-comment-id="'+e+'"]'),n,i)},m=function(e,t,n){var i=TS.files.getFileById(e);i||TS.warn("updateFileStar file_id:"+e+" not found"),S($('.star_file[data-file-id="'+e+'"]'),t,i,n)},p=function(e,t){var n=TS.interop.channels.getPublicChannelById(e);n||TS.warn("updateChannelStar channel_id:"+e+" not found"),n.is_starred=t,S($('.star_channel[data-channel-id="'+e+'"]'),t,n)},f=function(e,t){var n=TS.interop.channels.getGroupById(e);n||TS.warn("updateGroupStar group_id:"+e+" not found"),n.is_starred=t,S($('.star_group[data-group-id="'+e+'"]'),t,n)},h=function(e,t,n){var i=TS.interop.channels.getImById(e);i||TS.warn("updateImStar im_id:"+e+" not found"),i.is_starred=t;var r="";r=n?'.star_app[data-im-id="'+e+'"]':'.star_im[data-im-id="'+e+'"]',S($(r),t,i)},g=function(e,t){var n=TS.interop.channels.getMpimById(e);n||TS.warn("updateMpimStar mpim_id:"+e+" not found"),n.is_starred=t,S($('.star_mpim[data-mpim-id="'+e+'"]'),t,n)},S=function(e,t,n,i){t?e.hasClass("starred")||e.addClass("starred ts_icon_star").removeClass("ts_icon_star_o"):e.removeClass("starred ts_icon_star").addClass("ts_icon_star_o"),i&&e.each((function(t){TS.tips.manuallyToggleTipTitle(e.eq(t))}));var r=e.find(".ts_tip_multiline_inner"),a=r&&r.length?r.text():"";a&&e.attr("aria-label",a),n&&(n.is_starred=t)}}()},Pv2O:function(e,t){TS.registerModule("utility.teams",{isMemberGuest:function(e){return!(!_.isObject(e)||!e.isExternal&&!e.is_restricted)},isMsgFromOtherTeam:function(e){return!!_.isObject(e)&&!!e.source_team_id&&!(!e.source_team_id||TS.model.team.id==e.source_team_id)},getMembersForTeam:function(e){if(_.isObject(e)&&e.id)return _.filter(TS.model.members,{team_id:e.id})}})},QqCU:function(e,t){!function(){TS.registerModule("inline_file_previews",{expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function(){_(),this.collapse_sig.add(s),this.expand_sig.add(o),$("#messages_container").on("keydown",".preview_show_more .preview_show_btn",a),$("#messages_container").on("keydown",".preview_show_less .preview_show_btn",a)},checkForInlineFilePreviewClick:function(e){var t,n=$(e.target),i=n.closest(".message");if(0!==i.length&&!(n.hasClass("service_link")||n.closest(".service_link")>0)){var a=i.attr("id"),s=n.closest(".msg_inline_file_preview_toggler"),o=n.closest(".msg_inline_media_toggler");if(TS.boot_data.feature_file_threads?o.length>0:s.length>0){e.preventDefault(),t=s.data("file-id");var c=i.attr("data-ts");return s.hasClass("collapsed")?r(a,c,t):l(a,c,t),!0}var _=n.closest(".inline_file_preview_container, .file_container");if(0!==_.length){var m=n.closest("ts-message"),p=""+m.data("ts"),f=m.data("model-ob-id"),h={message_timestamp:p,channel_id:f,channel_type:f?f.charAt(0):"",member_id:m.data("member-id"),app_id:m.data("app-id"),bot_id:m.data("bot-id")};if(n.closest(".preview_show.preview_show_more").length>0)return e.preventDefault(),d(e,i,_),TS.interop.clog.track("PREVIEW_EXPAND",h),!0;if(n.closest(".preview_show.preview_show_less .preview_show_btn, .preview_show_less_header").length>0)return e.preventDefault(),u(e,i,_),TS.interop.clog.track("PREVIEW_COLLAPSE",h),!0;if(n.closest("a").length)return!1;t=_.data("file-id");var g=TS.files.getFileById(t);return!!g&&(!("space"!==g.mode&&"post"!==g.mode&&"docs"!==g.mode&&"email"!==g.mode&&"snippet"!==g.mode||!_.hasClass("inline_collapsed"))&&(e.preventDefault(),d(e,i,_),!0))}}},shouldTruncate:function(e){if(!e)return!1;if("snippet"===e.mode){if(e.lines_more>0||e.preview_is_truncated)return!0}else if("post"===e.mode||"space"===e.mode||"docs"===e.mode){if(!e.preview)return!1;if(e.preview.length>=400)return!0;if(e.preview.split(" ").length>=50)return!0;if(e.preview.split("\n").length>=4)return!0;var t=e.preview.match(/<\/(?:h\d|p|li|pre|blockquote)>/g)||[],n=e.preview.match(/<hr>/g)||[];if(t.concat(n).length>=4)return!0}else if("email"===e.mode)return!0;return!1},isTruncated:function(e,n){return!!n&&!t[e+"_"+n.id]},expandableState:function(e,t){return!!TS.model.expandable_state["inline_file_"+e+t]||!1!==TS.model.expandable_state["inline_file_"+e+t]&&void 0},shouldExpand:function(e,t){var n=TS.inline_file_previews.expandableState(e,t);return"boolean"!=typeof n||n},expandAllInCurrent:function(){n=!0,$(".msg_inline_file_preview_toggler").each((function(e,t){var n=$(t),i=n.data("file-id"),a=n.closest(".message").attr("id"),s=n.closest(".message").attr("data-ts");r(a,s,i)})),n=!1},collapseAllInCurrent:function(){$(".msg_inline_file_preview_toggler").each((function(e,t){var n=$(t),i=n.data("file-id"),r=n.closest(".message").attr("id"),a=n.closest(".message").attr("data-ts");l(r,a,i)}))},test:function(){return{actuallyExpandContent:c}}});var e,t={},n=!1,i=!1,r=function(e,t,i){var r="inline_file_msg_"+t.replace(".","_")+i;TS.model.expandable_state[r]=!0,TS.storage.storeExpandableState(TS.model.expandable_state);var a="#"+TS.utility.makeSafeForDomId(e),s=$(a);if(s.length){var o=function(){return!!(TS.boot_data.feature_file_threads&&$(this).find('a[data-file-id="'+i+'"]').length>0)||$(this).data("file-id")==i},l=s.find(".inline_file_preview_container, .file_container").filter(o);s.find(".msg_inline_file_title_hider").filter(o).addClass("hidden"),s.find('.msg_inline_file_preview_toggler[data-file-id="'+i+'"]').removeClass("collapsed").addClass("expanded"),l.removeClass("hidden"),l.css("opacity",0).stop().animate({opacity:1},300),n||l.scrollintoview({duration:200,offset:"bottom",px_offset:0,direction:"y"}),TS.inline_file_previews.expand_sig.dispatch(e)}},a=function(e){13!=e.which&&32!=e.which||(i=!0)},s=function(){i&&$(".preview_show_more .preview_show_btn").focus().addClass("focus-ring"),i=!1},o=function(){i&&$(".preview_show_less .preview_show_btn").focus().addClass("focus-ring"),i=!1},l=function(e,t,n){var i="inline_file_msg_"+t.replace(".","_")+n;TS.model.expandable_state[i]=!1,TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(e),a=$(r);if(a.length){var s=function(){return!!(TS.boot_data.feature_file_threads&&$(this).find('a[data-file-id="'+n+'"]').length>0)||$(this).data("file-id")==n},o=a.find(".inline_file_preview_container, .file_container").filter(s);a.find(".msg_inline_file_title_hider").filter(s).removeClass("hidden"),a.find('.msg_inline_file_preview_toggler[data-file-id="'+n+'"]').removeClass("expanded").addClass("collapsed"),o.addClass("hidden"),TS.inline_file_previews.collapse_sig.dispatch(e),setTimeout((function(){}),0)}},d=function(e,t,n){var i=n.data("file-id"),r=TS.files.getFileById(i);if(r)if("post"===r.mode||"space"===r.mode||"snippet"===r.mode||"docs"===r.mode){var a=n.find(".preview_show_more .preview_show_btn");a.data("stashed_text",a.html()).empty();var s=new Spinner({lines:9,length:0,width:4,radius:5,corners:1,rotate:0,direction:1,color:"#ffffff",speed:1,trail:25,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"-8px",left:"-4px",opacity:.1});s.spin(a.get(0)),n.addClass("loading"),TS.files.fetchFileInfo(i,(function(e,i){s.stop(),a.html(a.data("stashed_text")),n.removeClass("loading"),(i.content_html||i.content_highlight_html)&&c(t,i),TS.utility.welcome_post.clogWelcomePostExpand(i)}))}else if("email"===r.mode)if(r.simplified_html)c(t,r);else{t.find(".email_content").addClass("loading");var o=setTimeout((function(){t.find(".inline_file_preview_container, .file_container").addClass("expanded")}),1e3);TS.files.fetchFileInfo(i,(function(e,n){clearTimeout(o),c(t,n),t.find(".email_content").removeClass("loading")}))}},c=function(e,n){var i=e.attr("id"),r=i+"_"+n.id;if(t[r]=!0,!e.parent("body").length){var a=$("#"+i);a.length&&(e=a)}e.find(".inline_file_preview_container, .file_container").removeClass("inline_collapsed").addClass("inline_expanded"),TS.inline_file_previews.expand_sig.dispatch(e)},u=function(e,i,r){var a=i.attr("id"),s=r.data("file-id");if(TS.files.getFileById(s)){if(delete t[a+"_"+s],i.find(".inline_file_preview_container, .file_container").removeClass("inline_expanded").addClass("inline_collapsed"),!n)i[0].getBoundingClientRect().top<0&&i.scrollintoview({duration:0,offset:"top",px_offset:0,direction:"y"});TS.inline_file_previews.collapse_sig.dispatch(i)}},_=function(){e&&clearInterval(e);var t=function(){var e=$("#msgs_div .file_time_ago"),t=[];e.each((function(){var e=$(this).data("file-id"),n=TS.files.getFileById(e);n?(t.push(TS.interop.datetime.toTimeAgo(n.updated)),n=null):t.push($(this).text())})),e.each((function(e,n){$(n).text(t[e]),n=null})),e=null};t=TS.utility.throttleFunc(t,5e3),e=setInterval(t,6e4)}}()},R0Lu:function(e,t){!function(){TS.registerModule("ui.people_picker",{STYLES:{normal:"normal",small:"small"},onStart:function(){},preload:function(e){return t(e)(""),e},make:function(e,n){(n=n||{}).append||e.addClass("hidden"),n.style=_.get(TS.ui.people_picker.STYLES,n.style,TS.ui.people_picker.STYLES.normal),e.lazyFilterSelect({append:!!n.append,always_visible:!!n.always_visible,approx_item_height:n.approx_item_height||50,data_promise:t(n),placeholder_text:n.placeholder_text||TS.interop.i18n.t("Search by name","people_picker")(),classes:"people_picker",scroll_threshold:2500,single:!!n.single,style:n.style,sluggify:n.sluggify,disabled:n.disabled,template:n.template||function(e){var t=TS.templates.member_small({member:e.member});return new Handlebars.SafeString(t)},tokenTemplate:n.tokenTemplate||function(e){var t=TS.templates.member_token({member:e.member});return new Handlebars.SafeString(t)},tokenClass:function(e){return TS.templates.builders.getMemberTypeClass(e.member)},noResultsTemplate:n.noResultsTemplate||function(e){return e?TS.interop.i18n.t("No one found matching <strong>{query}</strong>","people_picker")({query:TS.interop.i18n.safeString(_.escape(e))}):TS.interop.i18n.t("No one found","people_picker")()},onItemAdded:n.onItemAdded,onItemRemoved:n.onItemRemoved})},value:function(e){return e.lazyFilterSelect("value")},clearValue:function(e){return e.lazyFilterSelect("clearValue")},recomputeHeight:function(e){return e.lazyFilterSelect("recomputeHeight")}});var e=["include_slackbot","include_self","include_bots","only_local_team","only_admins"],t=function(e){var t={},i={};e.preselected_ids&&e.preselected_ids.length&&_.forEach(e.preselected_ids,(function(e){e&&(i[e]=!0)}));var r={};e.omitted_ids&&e.omitted_ids.length&&_.forEach(e.omitted_ids,(function(e){e&&(r[e]=!0)}));return function(a,s){if("@"===a.charAt(0)&&(a=a.substring(1)),""===a&&e.empty_query_result)return s>0?Promise.resolve([]):Promise.resolve(e.empty_query_result.map((function(e){return{member:e,lfs_id:String(e.id),preselected:!!i[e.id]}})));if(""===a&&e.initial_load_promise)return _.isUndefined(s)||(e.initial_load_promise=n(e.initial_load_promise,i,r)),e.initial_load_promise;t.query!==a&&(t.query=a,t.include_org=TS.boot_data.page_needs_enterprise,t.include_slackbot=!!e.include_slackbot,t.include_self=e.include_self,t.full_profile_filter=!1,t.include_bots=!!e.include_bots,t.only_local_team=!!e.only_local_team,t.only_admins=!!e.only_admins);var o=TS.interop.members.ensureMembersArePresent(_.keys(i)).then((function(){return n(t,i,r)}));return""!==a||e.initial_load_promise||(e.initial_load_promise=o),o}},n=function(t,n,i){return Promise.resolve().then((function(){var e=[];return _.keys(n).forEach((function(t){TS.interop.members.getMemberById(t)||e.push(t)})),e.length?TS.interop.members.ensureMembersArePresent(e).catch(_.noop):Promise.resolve()})).then((function(){return TS.members.promiseToSearchMembers(t).then((function(r){var a=[];if(""===r.query){var s=_.pick(t,e);a=TS.members.getMembersWithOptions(s)}else a=r.items;return r.items=a.filter((function(e){return!i[e.id]})).map((function(e){return e.member&&void 0!==e.preselected?e:{member:e,lfs_id:String(e.id),preselected:!!n[e.id]}})),r}))}))}}()},RIqP:function(e,t,n){var i=n("Ijbi"),r=n("EbDI"),a=n("ZhPi"),s=n("Bnag");e.exports=function(e){return i(e)||r(e)||a(e)||s()}},RvrE:function(e,t){!function(){TS.registerModule("tabcomplete.emoji",{type:"emoji",getMatch:function(e,t){if(_.isString(e)){var n,i;if(e.replace(/(^|\n|[^+-])([+-]?[:|\uff1a][^~@#$%^&*()=[\]{}\\|!?`;:\uff1a",.<>/ ]*)$/i,(function(t,r,a,s){var o=r[r.length-1];TS.interop.texty.trimAllowedMatchPrefix(o)||(r.trim()&&/^[+-]/.test(a)&&(a=a.slice(1),s+=1),i=s+r.length,n=e.substr(i,a.length))})),n&&!TS.interop.utility.getEmoticonsRx().test(n)&&(t||d(n,TS.interop.i18n.locale)))return{match:n,index:i}}},shouldDisplayResults:function(e,t,n){return!(!e||_.isEmpty(t)||_.isEmpty(t.results))&&(1!==t.results.length||!n)},getResultAtIndex:function(e,t){if(e&&e.results&&_.isNumber(t)){var n=e.results[t];if(n)return{action:e.action,emoji:n}}},getInsertData:function(e){if(e&&e.emoji){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"emoji"}}});var t=e.emoji.name,n=e.emoji.display_name||e.emoji.name;TS.boot_data.feature_sonic_emoji&&(t=e.emoji.emojiBestNameMatchCanonical,n=TS.emoji.maybeGetLocalizedEmojiName(t));var i=":"+n+":";TS.utility.contenteditable.inlineEmojiIsEnabled()&&(i=":"+t+":");var r=e.emoji.is_skin;if(TS.boot_data.feature_sonic_emoji&&(r=TS.interop.emoji.isEmojiNameSkinToneModifiable(t)),r){var a=!TS.utility.contenteditable.inlineEmojiIsEnabled();i+=TS.emoji.getChosenSkinToneModifier(a)||""}var s=i,o="";return"add_rxn"===e.action?(s="+"+i,o="+"):"remove_rxn"===e.action&&(s="-"+i,o="-"),TS.utility.contenteditable.inlineEmojiIsEnabled()?{text:o,slackemoji:{text:i}}:{text:s}}},getNumResults:function(e){return e.results.length},getNextSelectedIndex:function(e){var a;switch(e.keyCode){case TS.utility.keymap.right:a="right";break;case TS.utility.keymap.left:a="left";break;case TS.utility.keymap.up:a="up";break;case TS.utility.keymap.down:a="down"}if(a){var s=t(e.menu);if(1===s.length)return 0;if("right"===a)return e.selectedIndex<s.length-1?e.selectedIndex+1:0;if("left"===a)return e.selectedIndex>0?e.selectedIndex-1:s.length-1;if(e.keyCode===TS.utility.keymap.home||"up"===a&&e.metaKey)return 0;if(e.keyCode===TS.utility.keymap.end||"down"===a&&e.metaKey)return s.length-1;var o=_.map(s,(function(e,t){var i=n(e);return i.index=t,i})),l=o[e.selectedIndex],d=i(l,o,"down"===a),c=r(l,d);if(!c){if("down"===a)return s.length-1;if("up"===a)return 0}return c.index}},search:function(t,n,i){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_typing",trigger:"emoji"}}});var r=/^(\+|-):/.test(t)?t[0]:"",o=n.index,l=TS.shared.legacyGetActiveModelOb(),d=e(l);if(t=TS.emoji.normalizeSearchTerm(t),t=TS.tabcomplete.trimTrailingCharacterModifier(t),TS.boot_data.feature_sonic_emoji)s(t).then((function(e){var t=null,n="search";e&&e.length&&(0===o&&r&&("+"===r?(e=_.differenceBy(e,d,(function(e){return e.name||e.item&&e.item.name})),n="add_rxn"):"-"===r&&(n="remove_rxn")),t={action:n,results:e}),i(null,t)}));else{var c,u=a(t);if(0===o&&r){if("-"===r)c={action:"remove_rxn",results:u};else if("+"===r){var m=_.difference(u,d);_.isEmpty(m)||(c={action:"add_rxn",results:m})}}else c={action:"search",results:u};"U02592DNU"===TS.model.user.id&&TS.interop.utility.getLogger({getState:TS.redux.getState}).error(JSON.stringify({query:t,results:c}),"emoji_tabcomplete_results"),c&&!c.results.length&&(c=null),i(null,c)}},render:function(e,t){var n=TS.templates.tabcomplete_emoji_header({text:e,action:t.action}),i=_.map(t.results,(function(e){var n=e;if(TS.boot_data.feature_sonic_emoji){var i=e.emojiBestNameMatchCanonical;n={name:i,display_name:TS.emoji.maybeGetLocalizedEmojiName(i)}}return l(n,t.action)})),r=TS.templates.tabcomplete_emoji_results({results:i});return TS.tabcomplete.renderMenu(n,r)},onSelect:function(e,t){if(e&&e.emoji)if(t||(t=""),t=t.replace(/^:/,""),TS.boot_data.feature_sonic_emoji){var n=TS.interop.emoji.getEmojiFrecencyIdFromName(e.emoji.name);TS.redux.dispatch(TS.interop.searcher.recordFrecencyEvent({id:n,text:t}))}else TS.ui.frecency.record(e.emoji,t)},onSelectedIndexChange:function(e){TS.tabcomplete.onSelectedIndexChange(e)},test:function(){var n={};return Object.defineProperty(n,"_getResultElements",{get:function(){return t},set:function(e){t=e}}),Object.defineProperty(n,"_getLocalResults",{get:function(){return a},set:function(e){a=e}}),Object.defineProperty(n,"_getPrevMsgRxns",{get:function(){return e},set:function(t){e=t}}),Object.defineProperty(n,"_sortResults",{get:function(){return o},set:function(e){o=e}}),n}});var e=function(e){if(e){var t=TS.utility.msgs.getDisplayedMsgs(e.msgs),n=_.find(t,(function(e){return!e.is_ephemeral}));if(n){var i=TS.rxns.getMemberRxnsFromMessage(n,TS.model.user.id),r=_.map(i,(function(e){var t=e.name.replace(/(:.+)$/,"");return TS.boot_data.feature_sonic_emoji?{name:t}:TS.emoji.getEmojiByName(t)}));return _.compact(r)}}},t=function(e){return e?_.toArray(e.querySelectorAll(".tab_complete_ui_item")):[]},n=function(e){var t=e.offsetLeft;return{left:t,right:t+e.offsetWidth,top:e.offsetTop}},i=function(e,t,n){if(e&&t&&t.length){var i=_.groupBy(t,"top"),r=_.map(_.keys(i),_.toNumber),a=r.indexOf(e.top);return i[r[n?a+1:a-1]]}},r=function(e,t){if(e&&t&&t.length){var n=t.filter((function(t){return!!_.inRange(t.left,e.left,e.right)||(!!_.inRange(t.right,e.left,e.right)||t.left<e.left&&t.right>e.right)}));if(n)return _.maxBy(n,(function(t){var n=Math.max(t.left,e.left);return Math.min(t.right,e.right)-n}))}},a=function(e){return o(e,TS.model.emoji_map)},s=function(e){var t=e.replace(/^(\+|-)?:/,"");return TS.redux.dispatch(TS.interop.searcher.search({query:t,options:{entities:{emoji:!0},sort:{frecency:!0},limit:50,returnMetadata:!0}}))},o=function(e,t){if(!t||!t.length)return[];var n={emoji:t},i=e.replace(/^(\+|-)?:/,"");return t=TS.sorter.search(i,n,{allow_empty_query:!0,frecency:!0,limit:50,prefer_exact_match:!0}),_.map(t,"model_ob")},l=function(e){var t=":"+e.name+":",n=":"+(e.display_name||e.name)+":",i={emoji_is_plain_text_only:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emoji_name_with_colons:t,emoji_display_name_with_colons:n},r=e.is_skin;return TS.boot_data.feature_sonic_emoji&&(r=TS.interop.emoji.isEmojiNameSkinToneModifiable(e.name)),r&&(i.show_skin_tone_variant=r,i.emoji_name_with_colons_and_skin=t+TS.emoji.getChosenSkinToneModifier(),i.emoji_display_name_with_colons_and_skin=n+TS.emoji.getChosenSkinToneModifier(!0)),i},d=function(e,t){switch(t){case"ja-JP":return e.length>=2;default:return e.length>=3}}}()},SaiC:function(e,t,n){var i=n("RIqP");!function(){TS.registerModule("members.view",{team_filter_changed_sig:new signals.Signal,filter_timer:null,onStart:function(){r=TS.web&&TS.web.admin;e=TS.utility.debounceWithPromise(T,500),t=TS.utility.debounceWithPromise(T,500),n=TS.utility.debounceWithPromise(T,500)},switchTabs:function(e){r&&"invites"===TS.web.admin.view?$("#"+e+"_invites_tab").trigger("click"):$("#"+e+"_members_tab").trigger("click")},bindTeamFilter:function(e,t,n){n=n||{};var i=$(e),r=i.find("input.member_filter"),s=i.find(".icon_close");m(t,n),a=null,n.full_profile_filter&&!n.is_long_list_view&&r.on("focus",(function(){TS.team.ensureTeamProfileFields()})),r.bind("keyup update-team-filter",(function(){var i=r.val();TS.members.view.filter_timer&&window.clearTimeout(TS.members.view.filter_timer);var o=function(){i.trim().toLocaleLowerCase()!==a&&TS.members.view.filterTeam(i,e,t,n),s.toggleClass("hidden",!i.trim())};n.is_long_list_view?o():TS.members.view.filter_timer=window.setTimeout(o,TS.members.getMembersForUser().length>500?250:50)})),s.bind("click",(function(){TS.members.view.clearFilter(e,t),a=null,setTimeout((function(){r.focus()}),0)}))},filterTeam:function(e,t,n,i){var r=p(n);return _.get(i,"full_profile_filter")||_.get(r,"full_profile_filter")?TS.team.ensureTeamProfileFields().then((function(){return u(r)?h(e,t,n,r):(b(e,t,n,i),Promise.resolve())})):(b(e,t,n),Promise.resolve())},getTeamFilter:function(){return a},selectMatch:function(e){var t=$(e).data("list-items-id"),n=$(t).find(".member_item").filter(".active");if(1==n.length){var i=n.first().data("member-id");i&&(TS.ims.legacyStartImByMemberId(i),TS.menu.end())}},clearFilter:function(e,t){var n=p(t),i=$(e),r=i.find("input.member_filter"),o=i.find(".icon_close"),l=i.data("list-items-id"),d=$(l),c=d.find(".member_item");a="",TS.storage.storeFilterState(a),TS.members.view.filter_timer&&(window.clearTimeout(TS.members.view.filter_timer),TS.members.view.filter_timer=null),r.val(""),o.addClass("hidden"),u(n)?(f(t),TS.members.view.filterTeam(a,e,t,n)):($(".restricted_header, .bot_header, .ra_invite_prompt, .restricted_info").removeClass("hidden"),d.find(".no_results").addClass("hidden"),c.addClass("active"),s[t]&&(s[t].detachEvents(),delete s[t]),d.find(".member_item.clone").remove(),d.find(".filter_header").remove(),TS.members.view.team_filter_changed_sig.dispatch("",TS.members.getMembersForUser().length))},findMatchesInMemberList:function(e,t,n){return C(e,t,n)},getHeaderLabelForMatchKey:function(e){return v(e)}});var e,t,n,r,a="",s={},o={},l={},d={},c={members:{},restricted:{},deleted:{}},u=function(e){return!!(TS.boot_data.page_needs_enterprise&&e&&e.is_long_list_view)||("list"===_.get(TS,"web.admin.view")||void 0)},m=function(e,t){l[e]=t},p=function(e){var t=l[e];if(t)return _.isFunction(t)&&(t=t()||{}),t.include_org=("list"!==_.get(TS,"web.admin.view")||!TS.boot_data.page_needs_enterprise)&&TS.boot_data.page_needs_enterprise,t;TS.error("Missing arguments for a bound filter")},f=function(){c.filter_p&&c.filter_p.cancel(),c.filtered_items&&(c.filtered_items={}),c.filter_last_query=null,c.filter_last_include_org=null,c.members.filter_cursor_mark="",c.members.filter_num_remaining=0,c.members.filter_num_found=0,c.members.filter_scroll_mark=0,c.restricted.filter_cursor_mark="",c.restricted.filter_num_remaining=0,c.restricted.filter_num_found=0,c.restricted.filter_scroll_mark=0,c.deleted.filter_cursor_mark="",c.deleted.filter_num_remaining=0,c.deleted.filter_num_found=0,c.deleted.filter_scroll_mark=0,TS.web&&$(window).off("scroll.filter").scrollTop(0)},h=function(e,t,n,i){var r=e.trim();a=r.toLocaleLowerCase(),TS.storage.storeFilterState(a);var s=c.filter_last_query!==a||c.filter_last_include_org!==i.include_org||c.filter_last_sort!==i.sort||c.filter_last_sort_dir!==i.sort_dir;s&&(f(n),c.filter_last_query=a,c.filter_last_include_org=i.include_org,i.sort&&(c.filter_last_sort=i.sort),i.sort_dir&&(c.filter_last_sort_dir=i.sort_dir)),function(e){var t=$(e).find(".ts_icon_search");if(!t.next().is(e+"_spinner")){var n=TS.templates.loading_indicator({id:e.substring(1)+"_spinner"});t.after(n),t.addClass("hidden")}}(t);var o=function(){return Promise.resolve().then((function(){return g(c,s,a,i)})).then((function(e){return function(e){$(e).find(".ts_icon_search").removeClass("hidden"),$(e+"_spinner").remove()}(t),S(e,c,s,a,r,t,n,i)})).finally((function(){TS.utility.rAF((function(){}))}))};return c.filter_p=s?o():c.filter_p.then(o),c.filter_p},g=function(r,a,s,o){var l=a||"active_members"===TS.model.ui_state.tab_name&&r.members.filter_num_remaining,d=a||"restricted_members"===TS.model.ui_state.tab_name&&r.restricted.filter_num_remaining,c=a||"disabled_members"===TS.model.ui_state.tab_name&&r.members.filter_num_remaining;if(!l&&!d&&!c)return Promise.resolve(r.filtered_items);var u=_.assign({},o,{restricted:!1});r.members.filter_p=l?e(r.members,s,u):Promise.resolve([]);var m=_.assign({},o,{restricted:!0});r.restricted.filter_p=d?t(r.restricted,s,m):Promise.resolve([]);var p=_.assign({},o,{include_deleted:2,include_restricted_and_full_members:!0});return r.deleted.filter_p=c?n(r.deleted,s,p):Promise.resolve([]),Promise.join(r.members.filter_p,r.restricted.filter_p,r.deleted.filter_p,(function(e,t,n){var s=(o.sort?x:TS.members.legacyAllocateTeamListMembers)(e.concat(t,n));return s.members=_.uniqBy(s.members,(function(e){return e.id})),s.disabled_members=_.uniqBy(s.disabled_members,(function(e){return e.id})),s.restricted_members=_.uniqBy(s.restricted_members,(function(e){return e.id})),s.ultra_restricted_members=_.uniqBy(s.ultra_restricted_members,(function(e){return e.id})),a?r.filtered_items=s:(r.filtered_items.members.push.apply(r.filtered_items.members,s.members),r.filtered_items.disabled_members.push.apply(r.filtered_items.disabled_members,s.disabled_members),r.filtered_items.deleted_bots.push.apply(r.filtered_items.deleted_bots,s.deleted_bots),r.filtered_items.bots.push.apply(r.filtered_items.bots,s.bots),r.filtered_items.restricted_members.push.apply(r.filtered_items.restricted_members,s.restricted_members),r.filtered_items.ultra_restricted_members.push.apply(r.filtered_items.ultra_restricted_members,s.ultra_restricted_members)),M([].concat(i(r.filtered_items.restricted_members),i(r.filtered_items.ultra_restricted_members))).then((function(){return Promise.resolve(r.filtered_items)}))}))},S=function(e,t,n,i,r,a,s,o){if(e){if(_.get(TS,"web.admin"))return TS.web.admin.setLongListAdminListItems({items:e,no_dividers:!!i,query:i,new_query:!!n,num_found:{members:c.members.filter_num_found||0,restricted:c.restricted.filter_num_found||0,disabled:c.deleted.filter_num_found||0},remaining:{members:c.members.filter_num_remaining||0,restricted:c.restricted.filter_num_remaining||0,disabled:c.deleted.filter_num_remaining||0}},(function(){h(i,a,s,o)}));var l=!1;"disabled_members"===TS.model.ui_state.tab_name&&0===(c.deleted.filter_num_found||0)&&(l=!0),"restricted_members"===TS.model.ui_state.tab_name&&0===(c.restricted.filter_num_found||0)&&(l=!0);var u=TS.model.user_groups.filter((function(e){return!e.date_delete}));"user_groups"===TS.model.ui_state.tab_name&&0===u.length&&(l=!0),l&&(TS.model.ui_state.tab_name="active_members",TS.storage.storeUIState(TS.model.ui_state),$("#active_members_tab").trigger("click"));var m=$("#active_members_list");m.length&&(m.longListView("setItems",d.active_members_list_items),n&&m.longListView("scrollToTop"));var p=$("#restricted_members_list");p.length&&(p.longListView("setItems",d.restricted_members_list_items),n&&p.longListView("scrollToTop"));var f=$("#deleted_members_list");f.length&&(f.longListView("setItems",d.deleted_members_list_items),n&&f.longListView("scrollToTop"));var g=e.members.concat(e.bots),S=e.restricted_members.concat(e.ultra_restricted_members),T=e.disabled_members.concat(e.deleted_bots);if([{name:"active",label:TS.interop.i18n.t("full members","members_view")(),matches:g},{name:"restricted",label:TS.interop.i18n.t("multi-channel guests","members_view")(),matches:S},{name:"disabled",label:TS.interop.i18n.t("deactivated accounts","members_view")(),matches:T}].forEach((function(e){var t,n,o=$("#"+e.name+"_no_results");e.matches.length>0||!i?o.addClass("hidden").empty():(t={query:r,tab:e,active_matches:g,show_active_matches:"active"!==e.name&&g.length>0,restricted_matches:S,show_restricted_matches:"restricted"!==e.name&&S.length>0,disabled_matches:T,show_disabled_matches:"disabled"!==e.name&&T.length>0},n=TS.templates.team_list_no_results(t),o.removeClass("hidden").html(n),o.find(".clear_members_filter").one("click",(function(){TS.members.view.clearFilter(a,s)})))})),n){"#team_list_scroller"===s&&TS.web&&$(window).off("scroll.filter").on("scroll.filter",_.throttle((function(){var e=0,n=0,r=0,l=null;"active_members"===TS.model.ui_state.tab_name&&(e=_.parseInt($("#active_members_list > .list_items").css("height")),n=_.reject(d.active_members_list_items,{is_divider:!0}).length,r=t.members.filter_num_remaining,l=t.members.filter_p),"restricted_members"===TS.model.ui_state.tab_name&&(e=_.parseInt($("#restricted_members_list > .list_items").css("height")),n=_.reject(d.restricted_members_list_items,{is_divider:!0}).length,r=t.restricted.filter_num_remaining,l=t.restricted.filter_p),"disabled_members"===TS.model.ui_state.tab_name&&(e=_.parseInt($("#disabled_members_list > .list_items").css("height")),n=_.reject(d.deleted_members_list_items,{is_divider:!0}).length,r=t.deleted.filter_num_remaining,l=c.deleted.filter_p);var u=.9*Math.min(n,100);e=_.isNaN(e)?0:e,(e-=116*u)&&r&&$(this).scrollTop()>e&&l&&l.isResolved()&&h(i,a,s,o)}),50,{leading:!0}));var b=(t.members.filter_num_found||0)+(t.restricted.filter_num_found||0)+(t.deleted.filter_num_found||0);TS.members.view.team_filter_changed_sig.dispatch(r,b)}}},T=function e(t,n,i){var r=function(e,t,n){var i=[];if(t&&(i=t.split(/\s*,\s*|\s+/).map((function(e){return"@"===e.charAt("0")?e.substring(1):e})).filter((function(e){return!!e})).map((function(e){if(1===e.length||!n.full_profile_filter){var t=TS.utility.search.makeClause("real_name",e),i=TS.utility.search.makeClause("display_name",e);return TS.utility.search.makeConjunction("OR",[t,i])}return TS.utility.search.makeClause("fuzzy_with_email",e)}))),i.push(TS.utility.search.makeClause("is","user")),n.restricted){var r=TS.utility.search.makeClause("level","restricted"),a=TS.utility.search.makeClause("level","ultra_restricted");i.push(TS.utility.search.makeConjunction("OR",[r,a]))}var s={query:i.length>1?TS.utility.search.makeConjunction("AND",i):i[0],count:100,include_bots:n.include_bots,exclude_slackbot:n.exclude_slackbot,include_deleted:n.include_deleted};return n.sort&&(s.sort=n.sort),n.sort_dir&&(s.sort_dir=n.sort_dir),n.include_org&&(s.all_of_org=n.include_org),e.filter_cursor_mark&&(s.cursor_mark=e.filter_cursor_mark),n.endpoint&&(s.endpoint=n.endpoint),TS.web&&(s.solr=!0),s}(t,n,i);return r.raw_query=n,TS.utility.search.promiseToSearch(r).then((function(r){if(t.filter_num_remaining||(t.filter_num_remaining=r.data.num_found,t.filter_num_found=r.data.num_found),t.filter_num_remaining-=r.data.items.length,t.filter_cursor_mark=r.data.next_cursor_mark,!r.data.items.length)return Promise.resolve([]);var a=r.data.items.map((function(e){var t=TS.interop.members.getMemberById(e.id);return t&&_.isEqual(t,e)||(t=TS.members.legacyUpsertMember(e).member),t}));return i.restricted||i.include_restricted_and_full_members||(a=a.filter((function(e){return!e.is_restricted}))),a.length?Promise.resolve(a):t.filter_num_remaining?e(t,n,i):Promise.resolve([])}))},b=function(e,t,n,i){var o=$(t),l=e.trim();a=l.toLocaleLowerCase();var d,c=o.data("list-items-id"),u=$(c),_=u.find(".member_item:not(.clone)"),m=_.filter(".active"),p=u.find(".member_item.clone"),f=u.find(".filter_header"),h=!TS.web&&"#team_filter"===t,g={};TS.storage.storeFilterState(a);var S;if(r&&"#team_filter"===t&&(S=u.find(".tab_pane.selected")),S||TS.web||"#team_filter"!==t||(S=$("#team_list_members")),S&&S.length&&S.addClass("hidden"),s[n]&&(s[n].detachEvents(),delete s[n]),p.remove(),f.remove(),m.removeClass("active"),u.find(".no_results").addClass("hidden"),r&&"invites"===TS.web.admin.view){var T,b=[],v=[];$.each(_,(function(e,t){var n;n=(t=$(t)).data("invite-id"),g[n]=t})),v=C(TS.web.admin.pending_invites,a).name||[],T=C(TS.web.admin.accepted_invites,a).name||[],(b=v.concat(T)).length>0&&($.each(b,(function(e,t){t&&t.member&&t.member.id&&g[t.member.id]&&g[t.member.id].addClass("active")})),n&&$(n).trigger("resize")),[{name:"pending",label:TS.interop.i18n.t("pending invitations","members_view")(),matches:v},{name:"accepted",label:TS.interop.i18n.t("accepted invitations","members_view")(),matches:T}].forEach((function(e){var i=$("#"+e.name+"_no_results");if(e.matches.length>0)i.addClass("hidden").empty();else{var r={query:l,tab:e,pending_matches:v,show_pending_matches:"pending"!==e.name&&v.length>0,accepted_matches:T,show_accepted_matches:"accepted"!==e.name&&T.length>0},a=TS.templates.team_list_no_results(r);i.removeClass("hidden").html(a),i.find(".clear_members_filter").on("click",(function(){TS.members.view.clearFilter(t,n)}))}})),d=b}else{var y,w=[],x=[],M=[];y=r?e.length?TS.members.getMembersForUser():TS.web.admin.getMembersForUser():TS.members.getMembersForUser(),$(".restricted_header, .bot_header, .ra_invite_prompt, .restricted_info").toggleClass("hidden",!!a),$.each(_,(function(e,t){var n;n=(t=$(t)).data("member-id"),g[n]=t})),b=C(y,a,i.full_profile_filter);var I=Object.keys(b);if(I.length>0){if(k(b,I,g,M,x,w,h?n:""),n){var E=$(n);E.trigger("resize"),TS.ui.utility.updateClosestMonkeyScroller(E)}}else"#file_member_filter"===t&&(u.find(".query").text(l),u.find(".no_results").removeClass("hidden"));"#team_filter"===t&&[{name:"active",label:TS.interop.i18n.t("full members","members_view")(),matches:w},{name:"restricted",label:TS.interop.i18n.t("multi-channel guests","members_view")(),matches:x},{name:"disabled",label:TS.interop.i18n.t("deactivated accounts","members_view")(),matches:M}].forEach((function(e){var i,r,a=$("#"+e.name+"_no_results");e.matches.length>0?a.addClass("hidden").empty():(i={query:l,tab:e,active_matches:w,show_active_matches:"active"!==e.name&&w.length>0,restricted_matches:x,show_restricted_matches:"restricted"!==e.name&&x.length>0,disabled_matches:M,show_disabled_matches:TS.web&&"disabled"!==e.name&&M.length>0},r=TS.templates.team_list_no_results(i),a.removeClass("hidden").html(r),a.find(".clear_members_filter").on("click",(function(){TS.members.view.clearFilter(t,n)})))})),d=w.concat(x,M)}S&&S.length&&S.removeClass("hidden"),TS.ui.utility.updateClosestMonkeyScroller($(n)),TS.members.view.team_filter_changed_sig.dispatch(l,d.length)},v=function(e){return o[e]||e},y=function(e,t){var n=document.createElement("div"),i=document.createElement("strong");return n.classList.add("filter_header"),i.appendChild(document.createTextNode(e)),t.length&&i.appendChild(document.createTextNode(": ")),n.appendChild(i),t.forEach((function(e,i){n.appendChild(e),i<t.length-1&&n.appendChild(document.createTextNode(", "))})),n},w=function(e,t){var n=document.createElement("span"),i=document.createElement("strong"),r=e.split(t);return i.appendChild(document.createTextNode(t)),n.appendChild(document.createTextNode(r.shift())),n.appendChild(i),n.appendChild(document.createTextNode(r.join(t))),n},k=function(e,t,n,i,a,l,d){var c,u,_,m=$(d),p=document.createDocumentFragment(),f=document.createDocumentFragment(),h=document.createDocumentFragment(),g=r&&TS.web.admin.isSubsetCase();if(t.sort((function(e,t){return TS.interop.i18n.sorter(o[e],o[t])})).forEach((function(t){var r=document.createDocumentFragment(),s=document.createDocumentFragment(),o=document.createDocumentFragment(),d=[],m=[],S=[],T={},b={},k={};g&&(_||(_=$("#active_members > div:first-of-type"),u=$("#restricted_members > div:first-of-type"),c=$("#disabled_members > div:first-of-type"))),e[t].forEach((function(e){var p,f=e.member,h=!1;f&&f.id&&(!(p=n[f.id])&&g&&(p=$(TS.web.admin.buildMemberHTML(f,!1,!1)),h=!0),p&&("name"!==t||h?f.deleted?(c||(c=p.parent()),e.value&&!T[e.value]&&(T[e.value]=d.push(w(e.value,e.match))),r.appendChild(p.clone().addClass("active clone").get(0))):f.is_restricted?(u||(u=p.parent()),e.value&&!b[e.value]&&(b[e.value]=m.push(w(e.value,e.match))),s.appendChild(p.clone().addClass("active clone").get(0))):(_||(_=p.parent()),e.value&&!k[e.value]&&(k[e.value]=S.push(w(e.value,e.match))),o.appendChild(p.clone().addClass("active clone").get(0))):p.addClass("active")),f.deleted?i.push(f):f.is_restricted?a.push(f):l.push(f))})),r.childNodes&&r.childNodes.length&&(p.appendChild(y(v(t),d)),p.appendChild(r)),s.childNodes&&s.childNodes.length&&(f.appendChild(y(v(t),m)),f.appendChild(s)),o.childNodes&&o.childNodes.length&&(h.appendChild(y(v(t),S)),h.appendChild(o)),r=null,s=null,o=null,d=null,m=null,S=null,T=null,b=null,k=null})),c&&c.append(p),u&&u.append(f),_&&_.append(h),m.length){var S=m.find(".member_item.clone");s[d]=S.find(".lazy").lazyload({container:m,ignore_when_hidden_element:m,all_images_same_size:!0}),S.one("remove",(function(){s[d]&&(s[d].detachEvents(),delete s[d])}))}g&&(TS.web.admin.lazyload&&TS.web.admin.lazyload.detachEvents&&(TS.web.admin.lazyload.detachEvents(),TS.web.admin.lazyload=null),TS.web.admin.lazyload||(TS.web.admin.lazyload=$("#admin_list").find(".lazy").lazyload())),p=null,f=null,h=null,c=null,u=null,_=null},x=function(e){return _.reduce(e,(function(e,t){return t.deleted?t.is_bot?e.deleted_bots.push(t):e.disabled_members.push(t):t.is_ultra_restricted?e.ultra_restricted_members.push(t):t.is_restricted?e.restricted_members.push(t):t.is_bot||TS.interop.rules.members.isSlackbot(t)?e.bots.push(t):e.members.push(t),e}),{members:[],disabled_members:[],deleted_bots:[],bots:[],restricted_members:[],ultra_restricted_members:[]})},C=function(e,t,n){var i=new RegExp("^"+TS.utility.regexpEscape(t),"i"),r=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(t),"i"),a={},s=n&&t?TS.team.getVisibleTeamProfileFields():[];return o={title:"What I Do",name:"Name"},e.forEach((function(e){var l;(l=e._real_name_lc&&(e._real_name_lc.match(i)||e._real_name_lc.match(r))||e.email&&(e.email.match(i)||e.email.match(r))||e.profile&&e.profile.email&&(e.profile.email.match(i)||e.profile.email.match(r))||e.profile&&e.profile.real_name_normalized&&(e.profile.real_name_normalized.match(i)||e.profile.real_name_normalized.match(r))||e.profile&&e.profile.real_name&&(e.profile.real_name.match(i)||e.profile.real_name.match(r))||e.profile&&e.profile.display_name_normalized&&(e.profile.display_name_normalized.match(i)||e.profile.display_name_normalized.match(r))||e.profile&&e.profile.preferred_name&&(e.profile.preferred_name.match(i)||e.profile.preferred_name.match(r)))&&(a.name||(a.name=[]),a.name.push({member:e})),n&&t&&(l=e.profile&&e.profile.title&&(e.profile.title.match(i)||e.profile.title.match(r)))&&(a.title||(a.title=[]),a.title.push({member:e})),s.length&&e.profile&&e.profile.fields&&s.forEach((function(t){var n=e.profile.fields[t.id];if(n){if(l=null,"user"===t.type){if(n.value){var s="";n.value.split(/\s*,\s*/).some((function(e){return(s=TS.interop.members.getPrefCompliantMemberNameById(e,!1)).match(i)||s.match(r)})),l&&(a[t.id]||(a[t.id]=[]),a[t.id].push({member:e,value:s,match:l[0]}))}}else(l=n.value&&(n.value.match(i)||n.value.match(r)))?(a[t.id]||(a[t.id]=[]),a[t.id].push({member:e,value:n.value,match:l[0]})):(l=n.alt&&(n.alt.match(i)||n.alt.match(r)))&&(a[t.id]||(a[t.id]=[]),a[t.id].push({member:e,value:n.alt,match:l[0]}));l&&!o[t.id]&&(o[t.id]=t.label)}}))})),a},M=function(e){if(!r)return Promise.resolve();var t=[];return _.map(e,(function(e){var n=_.get(TS.boot_data.channel_membership,e.id);if(n){var r=_.chain(n.channels).keys().concat(_.keys(n.groups)).value();t.push.apply(t,i(r)),e.channels=n.channels||{},e.groups=n.groups||{},e.more_groups=n.more_groups}})),TS.shared.ensureModelObsArePresent(t,"admin_guest_channels")}}()},SkS5:function(e,t){!function(){TS.registerModule("notifs",{onStart:function(){},canModelObHaveChannelMentions:function(e){return TS.redux.notifications.canChannelHaveAtChannelMentions(e)},hasUserSuppressedCorGChannelMentions:function(e){return TS.boot_data.feature_turn_mpdm_notifs_on?!!TS.redux.notifications.getNotificationsChannelPref(e.id,"suppress_at_channel"):-1!=TS.model.at_channel_suppressed_channels.indexOf(e.id)},isCorGMuted:function(e){return e?TS.redux.channels.isChannelMutedById(e):(TS.error('wtf no c_id "'+e+'"'),!1)},getCorGsNotUsingGlobalNotificationSetting:function(){var e={nothing:[],mentions:[],everything:[],muted:[],suppressed:[]},t=TS.interop.channels.getPublicChannelsUserIsIn();return _.forOwn(t,(function(t){TS.interop.rules.channels.isArchived(t)||t.is_member&&(i(t.id)&&e.nothing.push(t),r(t.id)&&e.mentions.push(t),a(t.id)&&e.everything.push(t),TS.notifs.isCorGMuted(t.id)&&e.muted.push(t),TS.notifs.hasUserSuppressedCorGChannelMentions(t)&&e.suppressed.push(t))})),_.forOwn(TS.model.groups,(function(t){TS.interop.rules.channels.isArchived(t)||(i(t.id)&&e.nothing.push(t),r(t.id)&&e.mentions.push(t),a(t.id)&&e.everything.push(t),TS.notifs.isCorGMuted(t.id)&&e.muted.push(t),TS.notifs.hasUserSuppressedCorGChannelMentions(t)&&e.suppressed.push(t))})),_.forOwn(TS.model.mpims,(function(t){TS.interop.rules.channels.isArchived(t)||(i(t.id)&&e.nothing.push(t),r(t.id)&&e.mentions.push(t),a(t.id)&&e.everything.push(t),TS.notifs.isCorGMuted(t.id)&&e.muted.push(t),TS.notifs.hasUserSuppressedCorGChannelMentions(t)&&e.suppressed.push(t))})),e},getCalculatedCorGNotifySetting:function(i){if(!i)return TS.error('wtf no c_id "'+i+'"'),!1;if(TS.boot_data.feature_turn_mpdm_notifs_on){var r=TS.redux.notifications.getCalculatedDesktopNotifySetting(i);return"mentions_dms"===r?"mentions":r}return n(i)?e(i)?"everything":t(i)?"nothing":"mentions":TS.prefs.getPref("growls_enabled")?TS.prefs.getPref("all_channels_loud")?"everything":"mentions":"nothing"},muteOrUnmuteCorG:function(e){if(e){var t=TS.redux.channels.getEntityById(e);if(t&&!t.is_im){TS.notifs.isCorGMuted(e)?TS.notifs.makeCorGNOTMuted(e):(TS.notifs.makeCorGMuted(e),t.is_mpim&&TS.mpims.legacyMarkMostRecentReadMsg(t,TS.model.marked_reasons.muted));var n=TS.redux.channels.getMutedChannelsAsArray().join(",");TS.prefs.legacyOnPrefChanged({name:"muted_channels",value:n}),TS.prefs.setPrefByAPI({name:"muted_channels",value:n})}}},makeCorGMuted:function(e){var t=TS.interop.channels.getPublicChannelById(e),n=TS.interop.channels.getGroupById(e),i=TS.interop.channels.getMpimById(e);if(!t&&!n&&!i)return TS.error('wtf no channel/group "'+e+'"'),!1;TS.redux.channels.setMutedChannelById(e,!0),TS.prefs.setMutedChannels(TS.redux.channels.getMutedChannelsAsArray().join(","))},makeCorGNOTMuted:function(e){var t=TS.interop.channels.getPublicChannelById(e),n=TS.interop.channels.getGroupById(e),i=TS.interop.channels.getMpimById(e);if(!t&&!n&&!i)return TS.error('wtf no channel/group "'+e+'"'),!1;TS.redux.channels.setMutedChannelById(e,!1),TS.prefs.setMutedChannels(TS.redux.channels.getMutedChannelsAsArray().join(","))},makeCorGDTopEverything:function(e){var t=TS.interop.channels.getPublicChannelById(e),n=TS.interop.channels.getGroupById(e),i=TS.interop.channels.getMpimById(e);if(!t&&!n&&!i)return TS.error('wtf no channel/group "'+e+'"'),!1;var r=TS.model.never_channels.indexOf(e);-1!=r&&TS.model.never_channels.splice(r,1),TS.prefs.setNeverChannels(TS.model.never_channels.join(",")),r=TS.model.loud_channels.indexOf(e),TS.prefs.getPref("growls_enabled")&&TS.prefs.getPref("all_channels_loud")?(-1!=r&&TS.model.loud_channels.splice(r,1),c(e)):(-1==r&&TS.model.loud_channels.push(e),d(e)),TS.prefs.setLoudChannels(TS.model.loud_channels.join(","))},makeCorGDTopMentions:function(e){var t=TS.interop.channels.getPublicChannelById(e),n=TS.interop.channels.getGroupById(e),i=TS.interop.channels.getMpimById(e);if(!t&&!n&&!i)return TS.error('wtf no channel/group "'+e+'"'),!1;var r=TS.model.loud_channels.indexOf(e);-1!=r&&TS.model.loud_channels.splice(r,1),TS.prefs.setLoudChannels(TS.model.loud_channels.join(",")),-1!=(r=TS.model.never_channels.indexOf(e))&&TS.model.never_channels.splice(r,1),TS.prefs.setNeverChannels(TS.model.never_channels.join(",")),TS.prefs.getPref("growls_enabled")&&!TS.prefs.getPref("all_channels_loud")?c(e):d(e)},getCalculatedCorGPushNotifySetting:function(e){if(!e)return TS.error('wtf no c_id "'+e+'"'),!1;if(TS.boot_data.feature_turn_mpdm_notifs_on){var t=TS.redux.notifications.getCalculatedMobileNotifySetting(e);return"mentions_dms"===t?"mentions":t}return l(e)?s(e)?"everything":o(e)?"mentions":"nothing":TS.prefs.getPref("push_everything")?"everything":TS.prefs.getPref("push_mention_alert")||TS.prefs.getPref("push_dm_alert")?"mentions":"nothing"},getGlobalNotificationSetting:function(){if(TS.boot_data.feature_turn_mpdm_notifs_on){var e=TS.redux.notifications.getGlobalDesktopNotifySetting();return"mentions_dms"===e?"mentions":e}return TS.prefs.getPref("growls_enabled")?TS.prefs.getPref("all_channels_loud")?"everything":"mentions":"nothing"},setGlobalNotificationPrefByKey:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"mentions"===t&&(t="mentions_dms"),TS.interop.api.call("users.prefs.setNotifications",{global:!0,name:e,value:t,sync:n}).then((function(t){var n=t.data;n&&n.all_notifications_prefs&&(TS.prefs.legacyOnPrefChanged({name:"all_notifications_prefs",value:JSON.stringify(n.all_notifications_prefs)}),"global_keywords"===e&&_.get(n.all_notifications_prefs,"global.global_keywords")&&TS.prefs.legacyOnPrefChanged({name:"highlight_words",value:n.all_notifications_prefs.global.global_keywords}))}))}});var e=function(e){return e?TS.model.loud_channels.indexOf(e)>-1:(TS.error('wtf no c_id "'+e+'"'),!1)},t=function(e){return e?TS.model.never_channels.indexOf(e)>-1:(TS.error('wtf no c_id "'+e+'"'),!1)},n=function(e){return e?!!(TS.model.loud_channels_set&&TS.model.loud_channels_set.indexOf(e)>-1):(TS.error('wtf no c_id "'+e+'"'),!1)},i=function(e){return!(!TS.prefs.getPref("growls_enabled")||"nothing"!==TS.notifs.getCalculatedCorGNotifySetting(e))},r=function(e){return"mentions"===TS.notifs.getCalculatedCorGNotifySetting(e)&&!(TS.prefs.getPref("growls_enabled")&&!TS.prefs.getPref("all_channels_loud"))},a=function(e){return!(TS.prefs.getPref("growls_enabled")&&TS.prefs.getPref("all_channels_loud")||"everything"!==TS.notifs.getCalculatedCorGNotifySetting(e))},s=function(e){return e?TS.model.push_loud_channels.indexOf(e)>-1:(TS.error('wtf no c_id "'+e+'"'),!1)},o=function(e){return e?TS.model.push_mention_channels.indexOf(e)>-1:(TS.error('wtf no c_id "'+e+'"'),!1)},l=function(e){return e?!!(TS.model.push_loud_channels_set&&TS.model.push_loud_channels_set.indexOf(e)>-1):(TS.error('wtf no c_id "'+e+'"'),!1)},d=function(e){-1==TS.model.loud_channels_set.indexOf(e)&&TS.model.loud_channels_set.push(e),TS.prefs.setLoudChannelsSet(TS.model.loud_channels_set.join(","))},c=function(e){var t=TS.model.loud_channels_set.indexOf(e);-1!=t&&TS.model.loud_channels_set.splice(t,1),TS.prefs.setLoudChannelsSet(TS.model.loud_channels_set.join(","))}}()},SmOH:function(e,t){!function(){TS.registerModule("format",{hex_rx:/(\W|^)(#[A-Fa-f0-9]{6})(\b)/g,onStart:function(){t()},replaceHighlightMarkers:function(e,t,n){return e?(t=t||"",n=n||"",e.replace(/\ue000/g,t).replace(/\ue001/g,n)):""},hasOnlyValidMemberIds:function(e){return!_.isString(e)||_.every(e.match(i),(function(e){return TS.interop.members.getMemberById(e)}))},cleanMsg:function(e){return TS.interop.format.cleanMessageTextWithState(TS.redux.getState(),e,{isInternalMessage:!1})},cleanInternalMsg:function(e){return TS.interop.format.cleanMessageTextWithState(TS.redux.getState(),e,{isInternalMessage:!0})},legacyDoEmoticonConversion:function(e){return c.length=0,e=(e=(e=e.replace(r,p)).replace(a,p)).replace(s,p),e=TS.emoji.legacyReplaceEmoticons(e),e=TS.format.deTokenizeStr(c,e)},tokenizeStr:function(e,t,n){if(!t)return"";n=n||"";var i=0===t.indexOf("\n")?"\n":"",r=S(i+m+(u+=1)+Date.now());return r=n+r+n,e.push({str:t,token:r}),r},deTokenizeStr:function(e,t){for(var n,i=e.length-1;i>-1;i-=1)n=e[i],t=t.replace(n.token,n.str.replace(/\$/g,"$$$$"));return t},unFormatMsg:function(e,t){return TS.format.formatWithOptions(e,t,{for_edit:!0})},formatJustText:function(e){return TS.format.formatWithOptions(e)},formatDefault:function(e,t){return TS.format.formatWithOptions(e,t)},formatNoHighlightsNoSpecials:function(e,t){return TS.format.formatWithOptions(e,t,{no_highlights:!0,no_specials:!0})},formatNoHighlightsNoSpecialsNoInlineImgs:function(e,t){return TS.format.formatWithOptions(e,t,{no_highlights:!0,no_specials:!0,do_inline_imgs:!1})},formatNoHighlightsNoInlineImgs:function(e,t){return TS.format.formatWithOptions(e,t,{do_inline_imgs:!1,no_highlights:!0})},formatNoSpecials:function(e,t){return TS.format.formatWithOptions(e,t,{no_specials:!0})},formatNotification:function(e,t){return TS.format.formatWithOptions(e,t,{for_growl:!0})},formatCurrentStatus:function(e,t,n){return n=n||{},TS.format.formatWithOptions(e,t,_.assign({no_jumbomoji:!0,no_linking:!0,no_specials:!0,no_highlights:!0,no_emoji_text:!0,prevent_copy_paste:!0},n))},formatBroadcastExcerpt:function(e,t){var n="&hellip;<br>",i='&hellip;<br><span class="multiline_block">',r="</span>",a=TS.format.formatWithOptions(e,t,{no_highlights:!0,no_hex_colors:!0,do_inline_imgs:!1,enable_slack_action_links:!1,do_theme_install_buttons:!1,no_jumbomoji:!0,no_linking:!0,custom_linebreak:n,token_overrides:{"<PRE:START>":i,"<PRE:END>":r,"<QUOTE:START>":i,"<QUOTE:END>":r,"<CODE:START>":"<span>","<CODE:END>":"</span>","<PARA:BREAK>":n}});return _.startsWith(a,n)&&(a=a.substring(n.length)),a},calculateOptions:function(e,t){return T(e,t)},formatWithOptions:function(e,t,n){if(!$.trim(e))return"";var i=T(t,n);return b(e,t,i)},applyStringifyTransformsToChildren:function(e,t,n){return!!e&&(_.isObject(t)||(t={}),!!e.childElementCount&&(!n&&1===e.childNodes.length&&1===e.firstChild.nodeType&&e.firstChild.hasAttribute("data-stringify-requires-siblings")?void 0:("PRE"!==e.tagName&&_.each(e.querySelectorAll("pre br"),(function(e){e.parentElement.replaceChild(document.createTextNode("\n"),e)})),_.filter(e.querySelectorAll("*"),(function(n){if(!O(n))return!1;if(_.isFunction(t.excludeFn)&&t.excludeFn(n))return!1;var i;n.childElementCount&&TS.format.applyStringifyTransformsToChildren(n,t,!0);var r=(i=_.isFunction(t.customFn)&&t.customFn(n)?t.customFn(n):TS.format.stringifyNode(n))!==n.textContent;return r&&("IMG"===n.tagName?e.replaceChild(document.createTextNode(i),n):n.textContent=i),r})).length>0)))},formatSelection:function(e,t){if(e&&e.rangeCount){_.isObject(t)||(t={});var n=TS.selection.combineRanges(e);if(n){var i;if(_.isElement(n.commonAncestorContainer)){if($(n.commonAncestorContainer).is(".ql-editor"))return e.toString();if(TS.model.is_safari_desktop)if(n.commonAncestorContainer.querySelectorAll("ts-message").length>1)return;var r=n.commonAncestorContainer.cloneNode();r.appendChild(n.cloneContents()),r.classList.add("offscreen","user_select_text"),n.commonAncestorContainer.parentElement.appendChild(r);r.innerHTML=r.innerHTML.replace(/&nbsp;/g,"\ufeff"),!r.lastChild||r.lastChild.textContent||O(r.lastChild)||r.removeChild(r.lastChild);var a=r.getElementsByClassName("para_break");a.length&&(_.eachRight(a,(function(e){var t=document.createElement("br");e.parentElement.replaceChild(t,e);var n=document.createElement("br");t.parentElement.insertBefore(n,t.nextSibling)})),r.innerHTML=r.innerHTML.replace(/<br>((<br>){2,})/g,"$1")),_.each(r.querySelectorAll([".ts_tip_tip",".c-message_list__unread_divider",".unread_divider",".c-message_list__day_divider__label",".c-reaction_bar",".c-message__reply_bar",".c-message__broadcast_repliers",".c-file__slide",".c-file__actions",".c-file_container__expand_container",".c-button",".c-message_attachment__row--actions",".c-message_attachment__border",".c-message_attachment__media_trigger",".c-message__label",".c-message--adjacent .c-message__gutter"].join(",")),(function(e){e&&e.parentNode&&e.parentNode.removeChild(e)})),TS.format.applyStringifyTransformsToChildren(r,t);var s=TS.selection.snapshot();i=(i=(e=TS.selection.selectNodeContents(r)).toString()).replace(/ {2}/g," ").replace(/\ufeff/g," "),r.parentElement.removeChild(r),s()}else i=e.toString();return i=(i=(i=TS.interop.format.replaceUnicodeDoppelgangers(i)).replace(/^\n+/,"")).replace(/\n+$/,"")}}},stringifyNode:function(e){if(!e)return"";if(!O(e))return e.textContent;var t=e.textContent;return _.each(o,(function(n,i){e.hasAttribute(i)&&(t=n(e,t))})),t},shouldAllowIntraWordFormatting:function(){return TS.boot_data.feature_allow_intra_word_formatting},test:function(){var e={encodeSpecialFormattingChars:g,encodeSpecialFormattingCharsAndColon:S,getTokenMap:l,getUserGroupDisplayName:x,doUserGroupHighlighting:f,doHighlighting:h,maybeRenderUnknownOrNonExistentUserGroup:C};return Object.defineProperty(e,"_hasStringifyTransformations",{get:function(){return O},set:function(e){O=e}}),Object.defineProperty(e,"doHighlighting",{get:function(){return h},set:function(e){h=e}}),Object.defineProperty(e,"doUserGroupHighlighting",{get:function(){return f},set:function(e){f=e}}),e}});var e=[],t=function(){TS.interop.broadcast_keywords.getAllBroadcastKeywords().forEach((function(t){e.push(t.ms_name),t.alias&&e.push(t.alias)}))},n=/((?:#[A-Fa-f0-9]{6} {0,}, {0,}){7})(#[A-Fa-f0-9]{6})(\b)/g,i=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|\u201c|\u2018|')(@([^~`!@#$%^&*()+=[\]{}\\|;:'"\u201d\u2019,<>/?\s]+))/g,r=/(^|\s|[_*?.,\-!^;:{([%$#+=\u2000-\u206F\u2E00-\u2E7F"])```([\s\S]*?)?```(?=$|\s|[_*?.,\-!^;:})\]%$#+=\u2000-\u206F\u2E00-\u2E7F\u2026"])/g,a=/(^|\s|[?.,\-!^;:{([%$#+=\u2000-\u206F\u2E00-\u2E7F"])`([^`]*?\S *)?`/g,s=/(^|\n)&gt;(?![\W_](?:&lt;|&gt;|[|/\\[\]{}()Dpb](?=\s|$)))(([^\n]*)(\n&gt;[^\n]*)*)/g,o={"data-stringify-text":function(e){return e.getAttribute("data-stringify-text")},"data-stringify-prefix":function(e,t){var n=e.getAttribute("data-stringify-prefix");return TS.interop.format.surroundTextWith({text:t,prefix:n})},"data-stringify-suffix":function(e,t){var n=e.getAttribute("data-stringify-suffix");return TS.interop.format.surroundTextWith({text:t,suffix:n})}},l=function(){var e={"<QUOTE:START>":'<div class="special_formatting_quote"><div class="quote_bar"><div class="shim"></div></div><div class="content dynamic_content_max_width">',"<QUOTE:PREFIX>":'<span class="copyonly">&gt;</span>',"<LONGQUOTE:PREFIX>":'<span class="copyonly">&gt;&gt;&gt;</span>',"<QUOTE:END>":"</div></div>","<LINK:END>":"</a>","<LINE:BREAK>":"<br>","<PARA:BREAK>":'<span class="para_break"><i class="copy_only"><br></i></span>',"<SPACE:HARD>":"&nbsp;"},t="ja-JP"===TS.interop.i18n.locale?"\uff0a":"*",n="ja-JP"===TS.interop.i18n.locale?"\uff3f":"_",i="ja-JP"===TS.interop.i18n.locale?"\uff40":"`",r="ja-JP"===TS.interop.i18n.locale?"\uff40\uff40\uff40":"```";return e["<B:START>"]='<b data-stringify-prefix="'+t+'" data-stringify-suffix="'+t+'" data-stringify-requires-siblings>',e["<B:END>"]="</b>",e["<STRIKE:START>"]='<strike data-stringify-prefix="~" data-stringify-suffix="~" data-stringify-requires-siblings>',e["<STRIKE:END>"]="</strike>",e["<CODE:START>"]='<code class="special_formatting" data-stringify-prefix="'+i+'" data-stringify-suffix="'+i+'" data-stringify-requires-siblings>',e["<CODE:END>"]="</code>",e["<I:START>"]='<i data-stringify-prefix="'+n+'" data-stringify-suffix="'+n+'" data-stringify-requires-siblings>',e["<I:END>"]="</i>",e["<PRE:START>"]='<pre class="special_formatting" data-stringify-prefix="'+r+'" data-stringify-suffix="'+r+'" data-stringify-requires-siblings>',e["<PRE:END>"]="</pre>",e},d=l(),c=[],u=0,m="^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}".split("").sort((function(){return.5-Math.random()})).join(""),p=function(e,t){var n=e.slice(t.length);return t+TS.format.tokenizeStr(c,n)},f=function(e){var t=e.id;return TS.interop.userGroups.isUserGroupMember(t)?'<span class="mention">@'+e.handle+"</span>":"@"+e.handle},h=function(e){var t=TS.interop.format.locateHighlightWords(e,TS.interop.prefs.getHighlightWords());return _.forEachRight(t,(function(t){var n=t.index,i=n+t.length,r=e.slice(n,i),a=e.slice(0,n),s='<span class="mention">'+r+"</span>",o=e.slice(i);e=a+s+o})),e},g=function(e){return e?e.replace(/\*/g,"&ast;").replace(/_/g,"&#95;").replace(/`/g,"&#96;"):""},S=function(e){return e?g(e).replace(/:/g,"&#58;"):""},T=function(e,t){var n=!!(t=t||{}).do_inline_imgs||void 0,i=!!t.for_growl||void 0,r=!!t.for_edit||void 0,a=!!t.no_highlights||void 0,s=!!t.no_specials||void 0,o=!!t.enable_slack_action_links||void 0,l=!!t.no_jumbomoji||void 0,d=!!t.no_preformatted||void 0,c=t.custom_linebreak||void 0,u=!!t.stop_animations||void 0,m=!!t.no_emoji_text||void 0,p=!!t.transform_missing_emoji||void 0,f=!!t.show_icon_for_emoji_in_as_text_mode||void 0,h=!!t.ignore_emoji_mode_pref||void 0,g=!!t.prevent_copy_paste||void 0,S=!!t.no_linking||void 0,T=t.token_overrides||void 0,b=t.emoji_mode;!_.isString(b)&&TS.prefs.prefs_loaded&&(b=TS.interop.rules.emoji.getEmojiMode()),!0!==l&&(l=!TS.prefs.getPref("jumbomoji")),a=e&&"no_highlights"in e?!!e.no_highlights:!!a,_.isBoolean(s)||(s=!(!e||!("mrkdwn"in e))&&!1===e.mrkdwn),r&&(s=!0);var v=e&&e.no_emoji,y=!(n&&(!e||"bot_message"!==e.subtype));!0!==y&&(y=!!TS.prefs.getPref("hide_hex_swatch"));var w="NORMAL";return s&&(w="NOMRKDWN"),i&&(w="GROWL"),r&&(w="EDIT"),{tsf_mode:w,no_highlights:a,no_emoji:v,no_hex_colors:y,do_inline_imgs:n,enable_slack_action_links:o,do_theme_install_buttons:!1,no_jumbomoji:l,no_preformatted:d,custom_linebreak:c,stop_animations:u,no_emoji_text:m,transform_missing_emoji:p,show_icon_for_emoji_in_as_text_mode:f,ignore_emoji_mode_pref:h,prevent_copy_paste:g,no_linking:S,token_overrides:T,emoji_mode:b}},b=function(e,t,i){var r=i.tsf_mode,a=i.no_highlights,s=i.no_emoji,o=i.no_hex_colors,l=i.do_inline_imgs,c=i.enable_slack_action_links,u=i.do_theme_install_buttons,m=i.no_jumbomoji,p=i.no_preformatted,f=i.custom_linebreak,g=i.stop_animations,S=i.no_emoji_text,T=i.transform_missing_emoji,b=i.show_icon_for_emoji_in_as_text_mode,x=i.ignore_emoji_mode_pref,C=i.prevent_copy_paste,P=i.no_linking,O=i.token_overrides,j=i.emoji_mode,H=d;if(f||O){var D=O||{};f&&(D["<LINE:BREAK>"]=f),H=_.extend({},H,D)}var L=[];if(u){var N=n,B=(e.match(N)||[]).length,R=[],U=0;e=e.replace(N,(function(e,t,n){U+=1;var i=B>1?I(e,U):I(e);R.push(i);var r=B>1?" ("+U+")\t":"";return t+TS.format.tokenizeStr(L,"<nobr>",",")+n+r+TS.format.tokenizeStr(L,"</nobr>")})),e+=TS.format.tokenizeStr(L,E(R))}var q=TSF.getTokensArray($.trim(e),r,{jumbomoji:!m,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});p&&(q=q.map(A)),P&&(q=_.reject(q,F));var G,z,W,K="";if("GROWL"===r||"EDIT"===r)for(z=0;z<q.length;z+=1)if(0===(G=q[z]).indexOf("<"))H[G]?TS.error('unexpected: mode == "GROWL" || "EDIT", and yet we got something in the formatting map? '+G):0===G.indexOf("<!")?K+=k(r,G):0===G.indexOf("<@")?K+=w(r,G):0===G.indexOf("<#")?K+=v(r,G):TS.error('unexpected: mode == "GROWL" || "EDIT", and yet we got '+G);else if(-1==G.indexOf("<"))if("EDIT"===r)TS.interop.i18n.locale===TS.interop.i18n.DEFAULT_LOCALE||TS.utility.contenteditable.inlineEmojiIsEnabled()||(G=TS.emoji.maybeGetLocalizedEmojiString(G)),K+=_.unescape(G);else if(TS.utility.platformSupportsHtmlNotifications())K+=TS.emoji.graphicReplace(G,{force_img:!0,stop_animations:g});else{var V=_.unescape(G);V=TS.emoji.maybeUnifiedReplace(V),TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&(G=TS.emoji.maybeGetLocalizedEmojiString(G)),K+=V}else TS.error("token has a < in it but it is not the first character!\n"+G);else{var Y,J,Q="";for(z=0;z<q.length;z+=1)if(0===(G=q[z]).indexOf("<"))if(H[G])K+=H[G],G==TSF.LINK_END&&(K+=Q,Q="");else if(0===G.indexOf("<!"))K+=k(r,G,a,P);else if(0===G.indexOf("<@"))K+=w(r,G,a,P);else if(0===G.indexOf("<#"))K+=v(r,G,P);else if(0===G.indexOf(TSF.LINK_START.split(" ")[0])){var X,Z,ee=function(e){var t=$.trim(e.replace(TSF.LINK_START.split(" ")[0],""));return t.substr(0,t.length-1)}(G),te=TS.interop.utility.getBotIdFromUrl(ee),ne="",ie="";if(te&&((Z=TS.interop.bots.getBotById(te))||(TS.warn("No bot found for "+te),TS.interop.rules.channels.isExternallySharedChannel(TS.shared.legacyGetActiveModelOb())&&t.user&&(X=_.get(TS.interop.members.getMemberById(t.user),"profile.team"),Z={id:te,name:TS.interop.bots.getBotNameByBotLink(t.text)?TS.interop.bots.getBotNameByBotLink(t.text):"",source_team_id:X}))),!te||!Z||Z.is_unknown||Z.isUnknown||Z.isNonExistent)if(0===ee.indexOf(""+TS.utility.msgs.old_api_url_prefix))K+='<a class="api_url muted">(Disabled) ';else if(0===ee.indexOf(TS.utility.msgs.new_api_url_prefix))K+=c?'<a onclick="TS.utility.msgs.doNewApiUrl('+_.escape(JSON.stringify(""+ee))+')" class="api_url">':'<a class="api_url muted">(Disabled) ';else if(0===ee.indexOf("javascript:"))K+="<a>";else{var re=TS.utility.getFileIDFromURL(ee),ae=!1;if(re&&TS.model&&TS.model.user&&TS.model.user.is_primary_owner){var se=!!TS.files&&TS.files.getFileById(re);se&&TS.utility.welcome_post&&se.name==TS.utility.welcome_post.WELCOME_POST_NAME&&(ae=!0)}var oe,le=re?' class="no_jumbomoji '+(ae?"file_new_window_link welcome_post_slackbot_message":"file_preview_link")+'"':"",de=re?' data-file-id="'+re+'"':"";K+="<a "+TS.utility.makeRefererSafeLink(ee)+' target="_blank"'+le+de+">",Q&&TS.error("WTF we should have no attach_html"),Q="",t&&t.ts&&l&&(oe=TS.inline_attachments.getAttachmentByFromUrl(t.attachments,ee))&&(TS.boot_data.feature_attachments_inline||TS.templates.builders.shouldDoSimpleAttachment(oe,t))&&(Q=TS.templates.builders.buildAttachmentHTML({attachment:oe,url:ee,msg:t,show_initial_caret:!0}))}else J=!0,W=TS.utility.shouldLinksHaveTargets()?'target="'+ee+'" ':"",Y=a?Z.name:h(Z.name),q[z+1]&&q[z+1]==ee&&(Y=ee),Y=Y.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Z.app_id&&(ne=Z.app_id),Z.source_team_id&&(ie="data-team-id="+Z.source_team_id+" "),K+='<a href="'+ee+'" '+W+'data-bot-id="'+te+'" data-app-id="'+ne+'" '+ie+'class="internal_bot_link app_preview_link">'+Y}else 0===G.indexOf(TSF.JUMBOMOJI_COLONS.split(" ")[0])?K+=y(G,{tsf_mode:r,no_emoji:s,do_jumbomoji:!m,stop_animations:g,no_emoji_text:S,transform_missing_emoji:T,show_icon_for_emoji_in_as_text_mode:b,ignore_emoji_mode_pref:x,emoji_mode:j}):0===G.indexOf(TSF.EMOJI_COLONS.split(" ")[0])?K+=y(G,{tsf_mode:r,no_emoji:s,do_jumbomoji:!1,stop_animations:g,no_emoji_text:S,transform_missing_emoji:T,show_icon_for_emoji_in_as_text_mode:b,ignore_emoji_mode_pref:x,emoji_mode:j}):0===G.indexOf(TSF.HEX_BLOCK.split(" ")[0])?K+=M(r,G,o):TS.error("markup token not handled:"+G);else-1===G.indexOf("<")?J?J=!1:(a||(G=h(G)),C&&(G=_.map($.parseHTML(G),(function(e){return e.nodeType===Node.TEXT_NODE?'<span class="prevent_copy_paste" aria-label="'+_.escape(e.textContent)+'"></span>':e.outerHTML})).join("")),K+=G):TS.error("token has a < in it but it is not the first character!\n"+G)}if(t&&("sh_room_created"===t.subtype||"sh_room_shared"===t.subtype)){K="sh_room_created"===t.subtype?TS.interop.i18n.t("{from_name} Started a call","string_format")({from_name:""}):TS.interop.i18n.t("{from_name} Shared a call","string_format")({from_name:""})}return K=TS.format.deTokenizeStr(L,K)},v=function(e,t,n){var i,r,a,s,o=t.replace(/<|>|#/g,"").split("|"),l=o[0],d=o[1],c=TS.redux.channels.getEntityById(l);if(c&&TS.interop.rules.channels.isUnknown(c)&&"EDIT"!==e&&"GROWL"!==e)return TS.templates.unknown_channel({id:l});if(c){var u=TS.interop.rules.channels.isPrivateChannel(c);a=TS.interop.rules.channels.isPublicChannel(c),r=TS.interop.rules.channels.isNonExistent(c),s=TS.interop.rules.channels.isFromAnotherTeam(c),(u||a)&&(i=c.name)}var _=TS.interop.format.formatChannelName({fallbackName:d,channelName:i,isNonExistent:r});if(!c||!a||r||"GROWL"===e||"EDIT"===e||n||s)return _;var m=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+c.id+'"':"";return'<a href="/archives/'+c.id+'" '+m+' data-channel-name="'+c.name+'" data-channel-id="'+c.id+'" class="internal_channel_link">'+_+"</a>"},y=function(e,t){t=t||{};var n,i=e.split(" ")[1].replace(">","");if(t.no_emoji)return i;var r=TS.emoji.isValidName(i);return(n=t.transform_missing_emoji&&!r?TS.emoji.MISSING_EMOJI_HTML:t.show_icon_for_emoji_in_as_text_mode&&"as_text"===t.emoji_mode?TS.emoji.graphicReplace(i,{show_icon_for_emoji_in_as_text_mode:!0}):TS.emoji.graphicReplace(i,{obey_emoji_mode_pref:!t.ignore_emoji_mode_pref,include_title:!0,include_text:!t.no_emoji_text,jumbomoji:t.do_jumbomoji,stop_animations:t.stop_animations}))&&-1!==n.indexOf(">>")&&TS.warn("TS.emoji.graphicReplace may be malformed: "+n),n},w=function(e,t,n,i){var r=t.replace(/<|>/g,""),a=TS.utility.msgs.getMemberIdFromMemberMarkup(r);if(!TS.interop.utility.looksLikeMemberId(a))return r;var s=TS.utility.msgs.getMemberFromMemberMarkup(r);if(s&&"EDIT"!==e&&"GROWL"!==e){if(s.is_unknown)return TS.templates.unknown_member({id:s.id});if(s.is_non_existent&&TS.interop.utility.looksLikeMemberId(s.id))return TS.templates.message_member_non_existent({id:s.id})}if(!s){if("GROWL"===e)return t;var o=r.split("|");return o.length>1&&o[1]?"@"+o[1]:r}var l=["internal_member_link"],d={"member-id":s.id,"stringify-text":"@"+s.id};if(s.is_bot&&s.profile){var c=_.get(s.profile,"bot_id");if(c){d["bot-id"]=c;var u=TS.interop.bots.getBotById(c);_.get(u,"app_id")&&(d["app-id"]=u.app_id)}(l=_.pull(l,"internal_member_link")).push("app_preview_link"),l.push("app_preview_link_slug")}var m="";_.forEach(d,(function(e,t){m+="data-"+t+'="'+e+'" '}));var p=_.escape("@"+TS.interop.members.getMemberMentionName(s));if(l.push("ts_tip ts_tip_top ts_tip_lazy ts_tip_float ts_tip_member"),m+='data-tip-member="'+s.id+'" ',"EDIT"===e)return"<@"+s.id+"|"+p+">";if("GROWL"===e||!TS.permissions.members.canUserSeeMember(s))return"@"+TS.interop.members.getMemberMentionName(s);var f=TS.utility.shouldLinksHaveTargets()?'target="/team/'+s.id+'" ':"";return s.id==TS.model.user.id&&l.push("mention"),i?p:(m+='data-member-label="'+p+'" ','<a href="/team/'+s.id+'" '+f+m+'class="'+l.join(" ")+'">'+p+"</a>")},k=function(t,n,i,r){if(TS.boot_data.page_needs_enterprise){var a=TS.shared.legacyGetActiveModelOb()||{};TS.interop.rules.channels.isOrgShared(a)&&TS.interop.rules.channels.isOrgDefaultChannel(a)&&(i=!0,r=!0)}var s=n.replace(/<|>/g,"").split("|"),o=s[0].substr(1);if(_.includes(e,o)){var l=TS.interop.format.formatBroadcastCommand({type:o,tsfMode:t});return"GROWL"===t||"EDIT"===t||r?l:'<b class="mention" data-broadcast-id="BK'+o+'" data-stringify-text="'+l+'">'+l+"</b>"}var d=s[1]?s[1]:o;if(-1===o.indexOf("^"))return"GROWL"===t||"EDIT"===t?"<"+d+">":"&lt;"+d+"&gt;";var c=o.split("^");if("date"===(o=c.shift())&&c.length>=2){var u=c[0],m=c[1],p=TS.interop.datetime.formatDate(u,m,{fallbackString:d}),f=c.length>2?c[2]:"";return"GROWL"===t||"EDIT"===t||!f||r?p:"<a "+TS.utility.makeRefererSafeLink(f)+' target="_blank">'+p+"</a>"}if("subteam"!==o||1!==c.length)return"GROWL"===t||"EDIT"===t?"<"+d+">":"&lt;"+d+"&gt;";var h=TS.interop.userGroups.getUserGroupById(c[0]),g=C({user_group:h,tsf_mode:t,cmd_label:d});if(g)return g;if(h&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(h)&&h.handle){var S=TS.utility.shouldLinksHaveTargets()?'target="/usergroups/'+h.id+'" ':" ",T=_.escape(h.handle),b=x({no_highlights:i,tsf_mode:t,userGroup:h}),v=["internal_user_group_link"];return"GROWL"===t||"EDIT"===t?"EDIT"===t?"<@"+h.id+"|"+b+">":"@"+h.handle:r?b:(b="@"+T,TS.interop.userGroups.isUserGroupMember(h.id)&&v.push("mention"),'<a data-qa="user_group_message_mention" href="/usergroups/'+h.id+'" '+S+'data-user-group-id="'+h.id+'" class="'+v.join(" ")+'" data-stringify-text="@'+T+'">'+b+"</a>")}return"GROWL"!==t&&"EDIT"!==t?d:""},x=function(e){var t=e.no_highlights,n=e.tsf_mode,i=e.userGroup,r=void 0===i?{}:i,a=_.escape(r.handle);return t||"EDIT"===n?"@"+a:f(r)},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.user_group,n=e.tsf_mode,i=e.cmd_label;if(t&&"EDIT"!==n&&"GROWL"!==n){if(TS.interop.rules.user_groups.isUnknown(t))return TS.templates.unknown_usergroup({id:t.id,handle:i});if((TS.interop.rules.user_groups.isNonExistent(t)||TS.interop.userGroups.isUserGroupFromAnotherTeam(t.id)||!TS.interop.userGroups.isUserGroupActive(t))&&TS.interop.utility.looksLikeUserGroupId(t.id))return TS.templates.nonexistent_usergroup({id:t.id,label:t.handle?"@"+t.handle:i})}return""},M=function(e,t,n){var i=t.split(" ")[1].replace(">","");return n?"":' <div class="inline_color_block" style="background:'+i+';"></div>'},I=function(e,t){var n=TS.interop.i18n.t("Switch sidebar theme","string_format")();return t&&(n+=" ("+t+")"),'<a data-theme="'+_.escape(e)+'" class="btn btn_small btn_outline very_small_top_margin very_small_bottom_margin tiny_right_margin theme_installer_btn">'+n+"</a>"},E=function(e){return e&&e.length?'<br/><span class="theme_install_btns">'+e.join(" ")+"</span>":""};function A(e){switch(e){case TSF.PRE_START:return TSF.CODE_START;case TSF.PRE_END:return TSF.CODE_END}return e}var P,O=function(e){return!(!e||e instanceof Text)&&_.some(o,(function(t,n){return e.hasAttribute(n)}))},F=function(e){return P||(P=TSF.LINK_START.split(" ")[0]),!!_.startsWith(e,P)||e===TSF.LINK_END}}()},T0l3:function(e,t){TS.registerModule("automount",{onStart:function(){var e=TS.redux.getStoreInstance();TS.interop.automount.mountAllWithStore(e)}})},UP61:function(e,t){!function(){TS.registerModule("ui.validation",{completed_sig:new signals.Signal,onStart:function(){s(),$("body").on("input.validation paste.validation change.validation","[data-validation]",TS.utility.debounce((function(e){$(e.target).is(".ql-editor")||$(e.target).is(".ql-clipboard")?c($(e.target).closest(".ql-container"),{},e):c($(e.target),{},e)}),500)),$("body").on("input.channel-name-validation paste.channel-name-validation change.channel-name-validation",'[data-validation*="channel_name"]',(function(e){var t=$(e.target);if(t.is('input[type="text"]')){var n={query:j(t),count:1};TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:n})}})),$("body").on("submit.validation","form[data-validation-form]",(function(e){var t=$(e.target),n=TS.ui.validation.validate(t);n||e.preventDefault(),TS.ui.validation.completed_sig.dispatch(t,{event:e,passed:n})}))},validate:function(e,t){t=t||{};var n=document;if(e){if(e.is("[data-validation]"))return 1===e.length?c(e,t):e.toArray().every((function(e){return c($(e),t)}));n=e.get(0)}var i=Array.prototype.slice.call(n.querySelectorAll("[data-validation]"));if(t&&t.fast)return i.every((function(e){return c($(e),t)}));if(t&&t.verbose){var r={};return i.forEach((function(e){r[e.name]=c($(e),t)})),r}return i.reduce((function(e,n){return c($(n),t)&&e}),!0)},register:function(e,t){d[e]?TS.warn(e+" cannot be registered because that key is already in use."):"function"==typeof t?d[e]=t:TS.warn("Only functions can be registered as validators.")},showCustomValidation:function(e,t,n,i){x(e,n.error_message||t,n.class,n,i)},getErrorMessage:function(e,i){switch(e){case"invalid_name_required":return t.required;case"invalid_name_punctuation":return t.punctuation;case"invalid_name_maxlength":return t.maxlength;case"invalid_name_specials":return t.specials;case"name_taken":return t.name_taken({name:i.name});case"restricted_action":return a.restricted_action;case"name_invalid_name_required":return r.required;case"invalid_starts_with_at":return r.at_sign;case"name_invalid_name_maxlength":case"too_long":return r.maxlength;case"invalid_reserved_word":return r.reserved;case"name_invalid_name_specials":return r.specials;case"invalid_emoji_not_allowed":return H(i.name||"");case"display_name_not_allowed":return r.sso_display_name;case"invalid_email":return o.invalid;case"url_in_message":return l.url_in_message;case"invalid_target_domain":return n.invalid_target_domain;case"invalid_target_domain_sameorg":return n.invalid_target_domain_sameorg;case"invalid_target_domain_self":return n.invalid_target_domain_self;default:return TS.interop.i18n.t("For some weird reason, that didn\u2019t work. Please try again to continue.","ui_validation")()}},maybeConvertNameErrorCode:function(e){return"invalid_name_specials"===e?"name_invalid_name_specials":"invalid_name_maxlength"===e?"name_invalid_name_maxlength":"invalid_name_required"===e?"name_invalid_name_required":e},showError:function(e,t,n,i){x(e,n.error_message||t,"validation_error",n,i)},showWarning:function(e,t,n,i){x(e,n.warning_message||t,"validation_warning",n,i)},showSuccess:function(e,t,n,i){x(e,n.success_message||t,"validation_success",n,i)},test:function(){return{validations:d}}});var e=TS.interop.i18n.t("Channel names can\u2019t be longer than {maxLength} characters.","ui_validation")({maxLength:80}),t={name_taken:TS.interop.i18n.t("{name} is already taken by a channel, username, or user group.","ui_validation"),lowercase:TS.interop.i18n.t("Channel names must be all lowercase. Try again?","ui_validation")(),maxlength:e,required:TS.interop.i18n.t("Don\u2019t forget to name your channel.","ui_validation")(),specials:TS.interop.i18n.t("Channel names can\u2019t contain spaces, periods, or most punctuation. Try again?","ui_validation")(),punctuation:TS.interop.i18n.t("Names can\u2019t consist solely of punctuation. Please elaborate!","ui_validation")()},n={invalid_target_domain:TS.interop.i18n.t("{targetDomain}.slack.com\xa0doesn\u2019t appear to be in use.","shared"),invalid_target_domain_sameorg:TS.interop.i18n.t("{targetDomain} is a part of your organization.","shared"),invalid_target_domain_self:TS.interop.i18n.t("You\u2019ll need to enter the Slack URL of the other organization.","shared")()},i={firstalphanumeric:TS.interop.i18n.t("Usernames must start with a letter or number. Sorry about that!","ui_validation")(),lowercase:TS.interop.i18n.t("Sorry, usernames must be lowercase!","ui_validation")(),maxlength:TS.interop.i18n.t("Sorry, that\u2019s a bit too long! Usernames must be fewer than {max_length_plus_one} characters.","ui_validation","10f62c929475d76c2b47d666c9703843310ef356")({max_length_plus_one:22}),required:TS.interop.i18n.t("Please fill in a username.","ui_validation")(),specials:TS.interop.i18n.t("Usernames can\u2019t contain special characters. Sorry about that!","ui_validation")()},r={required:TS.interop.i18n.t("Unfortunately, you can\u2019t leave this blank.","ui_validation")(),at_sign:TS.interop.i18n.t("Names can\u2019t start with the @ sign \u2014\xa0that\u2019s how your teammates will mention you in conversation.","ui_validation")(),maxlength:TS.interop.i18n.t("Unfortunately, names can\u2019t be longer than {maxlength} characters.","ui_validation")({maxlength:80}),reserved:TS.interop.i18n.t("That name\u2019s already being used by Slack.","ui_validation")(),specials:TS.interop.i18n.t("Mostly, names can\u2019t contain punctuation. (Apostrophes, spaces, and periods are fine.)","ui_validation")(),emoji:TS.interop.i18n.t("For all manner of complex reasons, names simply cannot contain emoji. Try again?","ui_validation")(),sso_display_name:TS.interop.i18n.t("Display names are automatically set by your organization.","ui_validation")()},a={},s=function(){a={restricted_action:TS.interop.i18n.t("Sorry! An admin in your workspace has restricted who can create private channels.","ui_validation")()}},o={invalid:TS.interop.i18n.t("This doesn\u2019t seem like an email address. Sorry!","ui_validation")()},l={url_in_message:TS.interop.i18n.t("Unfortunately, custom messages can\u2019t contain URLs.","ui_validation")()},d={dateandformat:function(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return!0;if(P(e)){var i,r,a,s,o=O(e).trim();if(!o)return!0;switch(n){case"Y-m-d":i="YYYY-MM-DD",r=o.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/),(a=r&&1===r.length&&r[0]===o)&&(s=w(o+"T00:00:00.000Z"));break;case"m-d":i="MM-DD",r=o.match(/^[0-9]{2}-[0-9]{2}$/),(a=r&&1===r.length&&r[0]===o)&&(s=w("0000-"+o+"T00:00:00.000Z"));break;default:return void TS.error("Error: cannot validate")}if(a&&s)return!0;a?s||TS.ui.validation.showWarning(e,TS.interop.i18n.t("{value} doesn\u2019t appear to be a valid date. Sorry!","ui_validation")({value:TS.interop.i18n.safeString(_.escape(o))}),t):TS.ui.validation.showWarning(e,TS.interop.i18n.t("This needs to be in the format {pattern}. Sorry!","ui_validation")({pattern:i}),t)}else TS.error("Error: cannot validate")},firstalphanumeric:v,hasnourl:function(e,t){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return!0;if(P(e)){var n=O(e);if(!n)return!0;if(!TS.interop.url.findUrlsInString(n).length)return!0;TS.ui.validation.showWarning(e,l.url_in_message,t)}else TS.error("Error: cannot validate")},isurl:f,isouathredirecturl:function(e,t,n){if(f(e,t,n)){if(-1==O(e).indexOf("#"))return!0;var i=TS.interop.i18n.t("Oauth redirect URLs should not contain a fragment component (#)","ui_validation")();TS.ui.validation.showWarning(e,i,t)}},lowercase:T,maxcsv:function(e,t,n){return S(e,"maxcsv",t,n)},maxlength:h,mincsv:function(e,t,n){return S(e,"mincsv",t,n)},minlength:function(e,t,n,i){return g(e,"minlength",t,n,i)},nospace:b,required:m,reservedwords:p,keywords:function(e,t){return p(e,t,TS.model.RESERVED_KEYWORDS.join(","))},username:function(e,t){var n=$.extend({},t,{quiet:!0});if(m(e,n))if(h(e,n,21,!0))if(b(e,n))if(y(e,n,/^[\w._-]+$/))if(v(e,n)){if(T(e,n))return!!p(e,t,TS.interop.constants.RESERVED_USERNAMES.join(","));TS.ui.validation.showWarning(e,i.lowercase,t)}else TS.ui.validation.showWarning(e,i.firstalphanumeric,t);else TS.ui.validation.showWarning(e,i.specials,t);else TS.ui.validation.showWarning(e,i.specials,t);else TS.ui.validation.showWarning(e,i.maxlength,t);else TS.ui.validation.showWarning(e,i.required,t)},channel_name:function(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return!0;if(!P(e))return void TS.error("Error: cannot validate");var i=O(e),r=F(n);_.includes(r,"fix")&&(i=j(e));var a=TS.validation.channel_name_with_errors(i);if(!0!==a)return t.should_truncate=!1,TS.ui.validation.showWarning(e,a.error_message,t),!1;return!0},team_name:function(e,t){t=t||{};var n=O(e).trim(),i=TS.validation.team_name(n);if(!0!==i)return t.should_truncate=!1,"empty"===i.error_key?TS.ui.validation.showCustomValidation(e,i.error_message,t):TS.ui.validation.showError(e,i.error_message,t),!1;return!0},is_email:function(e,t){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return!0;if(P(e)){var n=O(e);if(!n)return!0;var i=n.match(TS.utility.email_regex);if(i&&1===i.length&&i[0]===n)return!0;TS.ui.validation.showWarning(e,o.invalid,t)}else TS.error("Error: cannot validate")},membername:function(e,n,i){var a=$.extend({},n,{quiet:!0});if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return!0;if(!P(e))return void TS.error("Error: cannot validate");var s=_.trim(O(e)),o=TS.interop.i18n.deburr(s.toLowerCase()),l=F(i);if(_.includes(l,"required")&&!m(e,a))return TS.ui.validation.showWarning(e,r.required,n),!1;if(!h(e,a,80,!0))return TS.ui.validation.showWarning(e,r.maxlength,n),!1;if(-1!==TS.interop.constants.RESERVED_USERNAMES.concat(TS.model.RESERVED_KEYWORDS).map((function(e){return TS.interop.i18n.deburr(e)})).indexOf(o))return TS.ui.validation.showWarning(e,r.reserved,n),!1;if("@"===s.charAt(0))return TS.ui.validation.showWarning(e,r.at_sign,n),!1;if(y(e,a,/^[-_.'\u2018\u2019",(){}[\]/;]+$/))return TS.ui.validation.showWarning(e,t.punctuation,n),!1;if(y(e,a,/[`~!@#$%^&*+=\\:"<>?|]/))return TS.ui.validation.showWarning(e,r.specials,n),!1;if(TS.emoji.hasUnifiedEmoji(s))return TS.ui.validation.showWarning(e,H(s),n),!1;return!0},is_time:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return!0;if(P(e)){var n=O(e);if(!n)return!0;var i=RegExp(/((1[0-2]|0?[1-9]):([0-5][0-9]) ?([ap][m]))/i),r=i.test(n);if(r)return!0;TS.ui.validation.showWarning(e,"Try the format 10:30am",t)}}},c=function(e,t,n){t=t||{},e.is("[data-validation-for]")&&(t.custom_for=e.attr("data-validation-for")),t.success_message=TS.interop.i18n.t("Nice, thanks!","ui_validation")(),e.is("[data-validation-success]")&&(t.success_message=e.attr("data-validation-success")),e.is("[data-validation-warning]")&&(t.warning_message=e.attr("data-validation-warning")),e.is("[data-validation-error]")&&(t.error_message=e.attr("data-validation-error")),e.is("[data-validation-trim-value]")&&(t.trim_value=!0),P(e)&&A(e,t);var i=u(e).every((function(n){if(-1===n.indexOf("="))return d[n.trim()](e,t);var i=n.split("=");return d[i[0]](e,t,i[1])}));return TS.ui.validation.completed_sig.dispatch(e,{event:n,passed:i}),k(e,i,t)&&TS.ui.validation.showSuccess(e,t.success_message,t,3e3),e.attr("aria-invalid",!i),i},u=function(e){return e.is("[data-validation]")?_.compact(e.attr("data-validation").replace(/\s*(,|=)\s*/g,"$1").split(/\s+/)):[]};function m(e,t){if(e.is('input[type="radio"]')){if($(document.querySelectorAll('[name="'+e.prop("name")+'"][data-validation]')).filter(":checked").length)return!0;TS.ui.validation.showWarning(e,TS.interop.i18n.t("Please select an option","ui_validation")(),t)}else if(e.is('input[type="checkbox"]')){if($(document.querySelectorAll('[name="'+e.prop("name")+'"][data-validation]')).filter(":checked").length)return!0;TS.ui.validation.showWarning(e,TS.interop.i18n.t("Please select at least one option","ui_validation")(),t)}else if(e.is("select")){var n=_.get(e.data(),"TSLazyFilterSelect",!1);if(n&&!_.isEmpty(n.value()))return!0;if(!n&&!_.isEmpty(e.val()))return!0;TS.ui.validation.showWarning(e,TS.interop.i18n.t("Please select an option","ui_validation")(),t)}else if(P(e)){if(O(e).trim())return!0;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field can\u2019t be empty","ui_validation")(),t)}else TS.error("Error: cannot validate")}function p(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return!0;if(P(e)){var i=O(e).trim().toLowerCase();if(-1===n.split(",").indexOf(i))return!0;TS.ui.validation.showWarning(e,TS.interop.i18n.t('"{word}" is a reserved word. Try something else!',"ui_validation")({word:TS.interop.i18n.safeString(_.escape(i))}),t)}else TS.error("WTF: cannot validate")}function f(e,t,n){var i=O(e);t&&t.trim_value&&(i=i.trim());var r,a=TS.interop.i18n.t("This doesn\u2019t seem like a proper link. Sorry!","ui_validation")(),s=!1;if(!i)return!0;if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return!0;if(P(e)){if(n){-1!=(r=n.split(",")).indexOf("http")&&-1==r.indexOf("https")&&r.push("https");for(var o=0;o<r.length;o+=1)0===i.indexOf(r[o]+"://")&&(s=!0);s||-1==r.indexOf("https")||(a=TS.interop.i18n.t("Please use https (for security).","ui_validation")())}else s=!0,-1==i.indexOf("://")&&(i="http://"+i);if(TS.interop.url.simpleIsUrl(i)&&s)return!0;TS.ui.validation.showWarning(e,a,t)}else TS.error("Error: cannot validate")}function h(e,t,n,i){return g(e,"maxlength",t,n,i)}function g(e,t,n,i,r){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return!0;if(P(e)){var a=O(e);if(i=+i,void 0===a||isNaN(i))return void TS.error("Error: no length to validate");if("minlength"===t){if(TS.interop.utility.getStringLength(a)>=i)return!0;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t be less than {minlength, plural, =1{# character}other{# characters}}","ui_validation")({minlength:i}),n)}else if("maxlength"===t){if(r||I(e,a.length,i,n),TS.interop.utility.getStringLength(a)<=i)return!0;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t be more than {maxlength, plural, =1{# character}other{# characters}}","ui_validation")({maxlength:i}),n)}}else TS.error("Error: cannot validate")}function S(e,t,n,i){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return!0;if(P(e)){var r=O(e).trim();if(i=+i,void 0===r||isNaN(i))return void TS.error("Error: no length to validate");if("mincsv"===t){if(r.split(/\s*,\s*/).length>=i)return!0;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t have less than {minlength, plural, =1{# value}other{# values}}","ui_validation")({minlength:i}),n)}else if("maxcsv"===t){if(r.split(/\s*,\s*/).length<=i)return!0;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t have more than {maxlength, plural, =1{# value}other{# values}}","ui_validation")({maxlength:i}),n)}}else TS.error("Error: cannot validate")}function T(e,t){var n=P(e)?O(e):e.val();if(n===n.toLocaleLowerCase())return!0;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field must be lowercase only","ui_validation")(),t)}function b(e,t){var n=P(e)?O(e):e.val();if(!/\s/.test(n))return!0;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field can\u2019t contain spaces","ui_validation")(),t)}function v(e,t){var n=P(e)?O(e):e.val();if(/^[^\W_]/.test(n))return!0;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This first character must be a letter or number","ui_validation")(),t)}function y(e,t,n){var i=P(e)?O(e):e.val();if(n.test(i))return!0;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field contains invalid characters","ui_validation")(),t)}var w=function(e){if(!isNaN(Date.parse(e)))return!new Date(e).toISOString().indexOf(e)},k=function(e,t,n){var i=$(document.querySelector('label[for="'+(n.custom_for||e.attr("name"))+'"]'));if(i.length)return!(n&&n.quiet)&&t&&!1===i.data("validation-ephemeral")},x=function(e,t,n,i,r){if(i=i||{},_.isUndefined(i.should_truncate)&&(i.should_truncate=!0),!i||!i.quiet){var a=$(document.querySelector('label[for="'+(i.custom_for||e.attr("name"))+'"]'));if(a.length){var s=a.data("validation-timeout");clearTimeout(s);var o=a.find(".validation_message");o.length||(o=$("<span />").addClass("validation_message").toggleClass("overflow_ellipsis",i.should_truncate),e.is("select")&&a.find("select").length?o.insertBefore(a.find("select")):o.appendTo(a)),M(e,a,n),t?(o.get(0).title=t,o.fadeIn(100),a.data("validation-ephemeral",!!r),r&&a.data("validation-timeout",setTimeout((function(){a.removeData("validation-ephemeral").removeData("validation-timeout"),o.fadeOut(100,(function(){M(e,a),o.remove()}))}),r))):o.remove()}}},C=["validation_error","validation_warning","validation_success"],M=function(e,t,n){t.hasClass(n)||(e.removeClass(C.join(" ")),e.addClass(n),t.removeClass(C.join(" ")),t.addClass(n))},I=function(e,t,n,i){n-t<=6?E(e,t,n,i):A(e,i)},E=function(e,t,n,i){var r=document.querySelector('label[for="'+(i.custom_for||e.attr("name"))+'"]');if(r){var a=[t,n].join("/");$(r).attr("data-countdown",a).addClass("countdown");var s=window.getComputedStyle(r,":after"),o=parseFloat(s.width)||9*a.length;e.hasClass("no_validation_padding")||(e.data("countdown-padding-right")||e.data("countdown-padding-right",parseFloat(e.css("padding-right"))),e.css("padding-right",o+parseFloat(s.right)+e.data("countdown-padding-right")))}},A=function(e,t){var n=document.querySelector('label[for="'+(t.custom_for||e.attr("name"))+'"]');n&&($(n).removeClass("countdown"),e.removeData("countdown-padding-right"),e.css("padding-right",""))},P=function(e){return TS.interop&&TS.interop.utility?e.is("input")||e.is("textarea")||TS.interop.utility.isContentEditableElement(e):e.is("input")||e.is("textarea")},O=function(e){return TS.utility&&TS.utility.contenteditable?TS.utility.contenteditable.value(e):e.val()},F=function(e){return _.isString(e)?_(e).split(",").map(_.trim).compact().value():[]},j=function(e){var t=O(e),n=t.toLowerCase().replace(/^#+/,"");if((n=(n=(n=n.replace(/^\s+/,"")).replace(/\s+$/,"")).replace(/\s/g,"-"))&&t!==n){var i=TS.utility.contenteditable.cursorPosition(e).start;n.length<t.length&&(i-=t.length-n.length),e.val(n),TS.utility.contenteditable.cursorPosition(e,i)}return n},H=function(e){var t=[TS.interop.i18n.t("For all manner of complex reasons, names simply cannot contain emoji. Try again?","ui_validation")(),TS.interop.i18n.t("Using emoji for names makes some sense, but sadly, not enough. Try again?","ui_validation","29a0641ffb224418f796bb16c7f79013ec377a4c")(),TS.interop.i18n.t("For technical reasons, emoji are not allowed in names. Try again?","ui_validation")(),TS.interop.i18n.t("Of course you want a name with an emoji. Sadly, it is not to be. Try letters?","ui_validation")()];return e.match(/(?:\uD83D\uDCA9)/)?TS.interop.i18n.t("For reasons of party-pooping, names cannot contain emoji. Try again?","ui_validation")():_.sample(t)}}()},"V+wu":function(e,t,n){var i=n("J4zp");!function(){var e;TS.registerModule("menu.channel",{onStart:function(){},startWithChannelPickerForChange:function(e,n){if(!TS.menu.isRedundantClick(e)){TS.menu.buildIfNeeded(),TS.menu.clean();var i=TS.interop.members.getMemberById(n),r=_.partition(TS.interop.channels.getUnarchivedPublicAndPrivateChannels().filter((function(e){return!i.channels.hasOwnProperty(e.id)&&!i.groups.hasOwnProperty(e.id)})),TS.interop.rules.channels.isPublicChannel),a={user_id:n,channels:r[0],groups:r[1]};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(a)),TS.menu.$menu_items.html(TS.templates.menu_channel_picker(a)).css("max-height",274),TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelPickerItemClickChangeChannel),TS.menu.start(e);var s=$(e.target).closest(".pill");"mobile"===TS.boot_data.app?TS.menu.positionAt(s,16-s.offset().left,0):TS.menu.positionAt(s,-TS.menu.$menu.width()+s.outerWidth(),s.height()+4),TS.menu.$menu.scrollintoview({duration:500,offset:"bottom",px_offset:-25}),t(n),TS.kb_nav.setAllowHighlightWithoutBlurringInput(!0)}},onChannelPickerItemClickChangeChannel:function(){var e=$(this).data("user-id"),t=$(this).data("channel-id"),n=$(this).data("group-id");t?TS.interop.api.call("users.admin.changeURAChannel",{user:e,channel:t}).then((function(e){var t=e.data,n=e.args,i=e.request_id;return TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(!0,t,n,i),{data:t,args:n,request_id:i}}),(function(e){var t=e.data,n=e.args,i=e.request_id;return TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(!1,t,n,i),{data:t,args:n,request_id:i}})):n&&TS.interop.api.call("users.admin.changeURAChannel",{user:e,channel:n}).then((function(e){var t=e.data,n=e.args,i=e.request_id;return TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(!0,t,n,i),{data:t,args:n,request_id:i}}),(function(e){var t=e.data,n=e.args,i=e.request_id;return TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(!1,t,n,i),{data:t,args:n,request_id:i}})),TS.menu.channel.end()},startWithChannelPickerForInvite:function(e,n){if(!TS.menu.isRedundantClick(e)){TS.menu.buildIfNeeded(),TS.menu.clean();var i=TS.interop.members.getMemberById(n),r=_.partition(TS.interop.channels.getUnarchivedPublicAndPrivateChannels().filter((function(e){return!i.channels.hasOwnProperty(e.id)&&!i.groups.hasOwnProperty(e.id)})),TS.interop.rules.channels.isPublicChannel),a={user_id:n,channels:r[0],groups:r[1]};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(a)),TS.menu.$menu_items.html(TS.templates.menu_channel_picker(a)).css("max-height",274),TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelPickerItemClickInviteChannel),TS.menu.start(e);var s=$(e.target).closest(".pill");"mobile"===TS.boot_data.app?TS.menu.positionAt(s,16-s.offset().left,0):TS.menu.positionAt(s,10-s.width(),s.height()+4),TS.menu.$menu.scrollintoview({duration:500,offset:"bottom",px_offset:-25}),t(n),TS.kb_nav.setAllowHighlightWithoutBlurringInput(!0)}},onChannelPickerItemClickInviteChannel:function(){var e=$(this).data("user-id"),t=$(this).data("channel-id"),n=$(this).data("group-id"),i=t||n;i&&TS.interop.api.call("conversations.invite",{users:e,channel:i}).then((function(e){var i=e.data,r=e.args,a=e.request_id;return t&&TS.web.admin.onMemberInviteChannel?TS.web.admin.onMemberInviteChannel(true,i,r,a):n&&TS.web.admin.onMemberInviteGroup&&TS.web.admin.onMemberInviteGroup(true,i,r,a),{data:i,args:r,request_id:a}}),(function(e){var i=e.data,r=e.args,a=e.request_id;return t&&TS.web.admin.onMemberInviteChannel?TS.web.admin.onMemberInviteChannel(false,i,r,a):n&&TS.web.admin.onMemberInviteGroup&&TS.web.admin.onMemberInviteGroup(false,i,r,a),{data:i,args:r,request_id:a}})),TS.menu.channel.end()},end:function(){TS.menu.end()}});var t=function(t){var i=TS.menu.$menu.find(".no_matches"),r=TS.menu.$menu.find(".icon_close"),a=TS.menu.$menu.find(".menu_filter");r.click((function(){a.val("").trigger("input"),a.focus()})),a.on("input",(function(){var a=$(this).val();e&&e.cancel(),e=n(t,a).then((function(e){var n=e.channels,s=e.groups,o=!(!n.length&&!s.length);r.removeClass("hidden");var l={user_id:t,channels:n,groups:s};TS.menu.$menu_items.html(TS.templates.menu_channel_picker(l)),o?i.addClass("hidden"):(i.find(".query").text(a),i.removeClass("hidden")),TS.ui.utility.updateClosestMonkeyScroller(TS.menu.$menu.find("#menu_items_scroller"),!0)})),TS.kb_nav.clearHighlightedItem(),r.toggleClass("hidden",!a)})),a.focus()},n=function(e,t){var n=TS.interop.members.getMemberById(e),r={prefer_exact_match:!1,frecency:!1,allow_empty_query:!0,prefer_channels_user_belongs_to:!1};return TS.searcher.search(t,{channels:{include_archived:!1},groups:{include_archived:!1},sort:!1}).then((function(e){var a=_(TS.sorter.search(t,e,r)).filter((function(e){return!(n&&n.channels&&(n.channels[e.id]||n.groups[e.id]))})).partition(TS.interop.rules.channels.isPublicChannel).value(),s=i(a,2),o=s[0];return{groups:s[1],channels:o}}))}}()},VACg:function(e,t,n){var i=n("lSNA");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(){TS.registerModule("redux.members",{onStart:function(){TS.boot_data.no_login||(e=TS.utility.enableFeatureForUser(1),s(),Object.defineProperty(TS.model,"members",{get:function(){return TS.redux.members.getAllMembers()},set:function(){return TS.boot_data.feature_tinyspeck&&TS.warn("TS.redux.members: Set TS.model.members"),!1}}),Object.defineProperty(TS.model,"user",{get:function(){return TS.interop.members.getCurrentMember()}}))},getPotentiallyUnknownMemberById:function(t){if(t&&"@"===t[0]&&(t=t.substring(1)),!TS.interop.utility.looksLikeMemberId(t)){if(e&&TS.console.logStackTraceToBackEnd("non-ID passed into getPotentiallyUnknownMemberById","member_name_as_id_lookup",1),TS.boot_data.feature_deprecate_get_member_by_name)return null;var n=TS.interop.members.getMemberByName(t);if(n)return n}var i=TS.interop.members.getPotentiallyUnknownMemberById(t);return i?i.isUnknown?(TS.members.legacySetMemberUnknown(t),_.omit(a(a({},i),{},{is_unknown:!0}),"isUnknown")):i.isNonExistent?_.omit(a(a({},i),{},{is_non_existent:!0}),"isNonExistent"):i:null},getMemberByEmail:function(e){var t=TS.interop.members.getMemberByEmail(e);return t&&t.profile?t:null},getAllMembers:function(){var e=TS.interop.members.getAllMembers();return _.values(e)},hasMemberWithId:function(e){return TS.interop.members.hasMemberWithId(e)},addMember:function(e){e&&(TS.interop.members.markObjectsAsFresh([e.id]),TS.interop.members.dangerouslyAddMember(e))},addToBulkUpsertPayload:function(e){t.push(e)},bulkUpsertMembers:function(e){_.isArray(e)&&e.length&&(TS.interop.members.markObjectsAsFresh(e.map((function(e){return e.id}))),TS.interop.members.dangerouslyBulkAddMembers(e))},logStats:function(){var e=_(n).keys().union(_.keys(i)).value(),t={};_.forEach(e,(function(e){t[e]={gets:n[e]||0,sets:i[e]||0}})),TS.console.table(t)},test:function(){var e={_addSignalListeners:s};return Object.defineProperty(e,"_bulk_upsert_payload",{get:function(){return t},set:function(e){t=e}}),e}});var e,t=[],n={},i={},r=function(){t.length&&(TS.interop.members.markObjectsAsFresh(t.map((function(e){return e.id}))),TS.interop.members.dangerouslyBulkAddMembers(t),t=[])},s=function(){TS.members.batch_upserted_sig.add(r)}}()},VTIS:function(e,t){!function(){TS.registerModule("ui.a11y",{focus_stack:[],unread_message_strings:{},$aria_live_div:null,zoom_level_changed_sig:new signals.Signal,zoomPercentToLevel:function(e){return n[e]},zoomLevelToPercent:function(e){return i[e]},onStart:function(){a(),m(),f(),TS.channels.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup),TS.ims.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup),TS.groups.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup),TS.mpims.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup),TS.prefs.a11y_animations_changed_sig.add(TS.ui.a11y.replaceAnimatedImages),$(document).on("focus","input[placeholder],textarea[placeholder]",(function(e){r($(e.target))})),$(document).on("blur","input[placeholder],textarea[placeholder]",(function(e){r($(e.target))}))},focusAndAddTabindex:function(e){e&&(e.attr("tabindex")&&e.data("previous-tabindex",e.attr("tabindex")),e.attr("tabindex","0"),e.focus())},cleanUpTabindex:function(e){e&&(e.data("previous-tabindex")?e.attr("tabindex",e.data("previous-tabindex")):e.removeAttr("tabindex"))},saveCurrentFocus:function(){return TS.ui.a11y.focus_stack.push(document.activeElement),document.activeElement},saveCurrentFocusAndFocusOnElement:function(e){var t=TS.ui.a11y.saveCurrentFocus();return TS.ui.a11y.focusAndAddTabindex(e),t},restorePreviousFocus:function(){var e=TS.ui.a11y.focus_stack.pop();if(e&&"function"==typeof e.focus)return e.focus(),e},restorePreviousFocusAndCleanUpElement:function(e){var t=TS.ui.a11y.restorePreviousFocus();return TS.ui.a11y.cleanUpTabindex(e),t},ariaLiveAnnounce:function(e,t){TS.ui.a11y.$aria_live_div.empty(),TS.ui.a11y.$aria_live_div.attr("aria-live",t?"assertive":"polite"),TS.ui.a11y.$aria_live_div.text(e)},assembleActiveModelName:function(){var e,t=TS.shared.legacyGetActiveModelOb();if(TS.model.unread_view_is_showing)e=TS.interop.i18n.t("All unreads","a11y")();else if(TS.model.threads_view_is_showing)e=TS.interop.i18n.t("Threads","a11y")();else{if(!t)return"";if(t.is_channel)e=TS.interop.i18n.t("Channel #{model_name}","a11y")({model_name:t.name});else if(t.is_im)e=TS.interop.i18n.t("Direct message with {model_name}","a11y")({model_name:TS.interop.members.getPrefCompliantMemberNameById(t.user)});else if(t.is_mpim)e=TS.interop.i18n.t("Direct message with {model_name}","a11y")({model_name:TS.mpims.legacyGetDisplayName(t)});else{if(!t.is_group)return"";e=TS.interop.i18n.t("Private Channel {model_name}","a11y")({model_name:t.name})}}return e},saveUnreadCountMessage:function(e,t){e&&e.name&&t&&(TS.ui.a11y.unread_message_strings[e.name]=t)},annouceCurrentChannelOrImOrGroup:function(){var e=TS.ui.a11y.assembleActiveModelName(),t=TS.shared.legacyGetActiveModelOb();t&&(TS.ui.a11y.unread_message_strings[t.name]&&(e+=", "+TS.ui.a11y.unread_message_strings[t.name],delete TS.ui.a11y.unread_message_strings[t.name]),TS.ui.a11y.ariaLiveAnnounce(e,!0))},replaceAnimatedImages:function(){TS.ui.a11y.replaceAnimatedFiles(),TS.ui.a11y.replaceEmoji()},replaceAnimatedFiles:function(){var e,t,n,i=TS.prefs.getPref("a11y_animations"),r=TS.utility.msgs.getDisplayedMsgs(TS.shared.legacyGetActiveModelOb().msgs);if(!1===i)for(n=0;n<r.length;n+=1)r[n].file?"gif"===(e=r[n].file).filetype?(e.deanimate_gif?t=e.deanimate_gif:e.thumb_160&&(t=e.thumb_160),t&&d(e.id,t)):"space"===e.filetype&&u(r[n].ts):r[n].attachments&&c(r[n].ts,r[n].attachments[0]);else for(n=0;n<r.length;n+=1)r[n].file?"gif"===(e=r[n].file).filetype?(e.thumb_360_gif?t=e.thumb_360_gif:e.thumb_360&&(t=e.thumb_360),t&&d(e.id,t)):"space"===e.filetype&&u(r[n].ts):r[n].attachments&&c(r[n].ts,r[n].attachments[0])},replaceEmoji:function(){for(var e,t=emoji,n=$(".emoji:not(.stop_animations)"),i=0;i<n.length;i+=1){var r=t.replace_colons(n[i].innerText);if(!r){var a=":"+n[i].parentNode.getAttribute("data-emoji")+":";r=t.replace_colons(a)}r&&r.match(/.+background-image:url\((.+)\).*/)&&(e=r.match(/.+background-image:url\((.+)\).*/)[1]),n[i].style.backgroundImage='url("'+e+'")'}TS.emoji.makeMenuLists()},getContrastColor:function(e){var t=!1;(e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,i){return t+t+n+n+i+i})),e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))&&(t=(299*parseInt(e[1],16)+587*parseInt(e[2],16)+114*parseInt(e[3],16))/1e3>=128?"#000000":"#FFFFFF");return t},test:function(){return{createAriaLiveElement:a,destroyAriaLiveElement:s,getMessageInputElement:o,getMessageDivElement:l}}});var e,t,n={70:"-3",80:"-2",90:"-1",normal:"0",110:"1",125:"2",150:"3"},i=Object.keys(n).reduce((function(e,t){return e[n[t]]=t,e}),{}),r=function(e){var t=e.attr("placeholder"),n=e.attr("aria-label")||"",i=!!n.length,r=!!e.val().trim().length;r&&!i&&t.length?e.attr("aria-label",t):!r&&i&&n==t&&e.removeAttr("aria-label")},a=function(){return TS.ui.a11y.$aria_live_div=$('<div id="aria_live_announcer" role="status"></div>'),$("body").append(TS.ui.a11y.$aria_live_div),TS.ui.a11y.$aria_live_div},s=function(){TS.ui.a11y.$aria_live_div.remove(),delete TS.ui.a11y.$aria_live_div},o=function(){return $()},l=function(){return $()},d=function(e,t){var n=$('.image_gif[data-file-id="'+e+'"]');n.attr("data-src",t),n.find(".image_bg").attr("data-real-background-image",t),n.find(".image_bg").css("backgroundImage","url("+t+")"),n.find("img").data("real-src",t),n.find("img").attr("src",t)},c=function(e,t){if(t&&(t.is_animated||t.image_url&&t.image_url.match(/\.gifv?$/))){var n=$('.message[data-ts="'+e+'"]').find(".msg_inline_img img"),i=!1===TS.prefs.getPref("a11y_animations")?TS.utility.getImgProxyURL(t.image_url,t.image_width,t.image_height):t.image_url;_(n,i)}},u=function(e){var t=$('.message[data-ts="'+e+'"] .post_container .msg_inline_img img');$.each(t,(function(){var e=$(this),t=TS.utility.getImgProxyURL(e.attr("src"));_(e,t)}))},_=function(e,t){e.attr({"data-real-src":t,src:t});var n=e.closest(".msg_inline_img");n.attr("data-real-background-image",t),n.css("backgroundImage","url("+t+")")},m=function(){TS.model.is_electron&&(e=TS.interop.desktop.getZoom(),$(window).on("resize",p))},p=function(){var t=TS.interop.desktop.getZoom();e!=t&&(e=t,TS.ui.a11y.zoom_level_changed_sig.dispatch({zoom_level:t}))},f=function(){TS.model.is_electron&&($("body").append('<div class="zoom_level_indicator hidden"></div>'),TS.ui.a11y.zoom_level_changed_sig.add(h))},h=function(e){if(!$("body").hasClass("loading")){var n=$(".prefs_modal.active");if(!n.length||!n.find(".a11y_pref_zoom").length){var r,a,s,o;t&&(clearTimeout(t),t=null),r=e.zoom_level,a=i[r]||"100",s="normal"===a?"100":a,o=TS.interop.i18n.t("zoom: <strong>{zoom_percentage}%</strong>","a11y")({zoom_percentage:s}),$(".zoom_level_indicator").html(o);var l=$(".zoom_level_indicator");l.insertAfter(document.body.lastElementChild),l.removeClass("hidden").show(0);var d="calc(50vw - "+l.outerWidth()/2+"px)";l.css("left",d),t=setTimeout((function(){l.fadeOut(100)}),1e3)}}}}()},W17R:function(e,t){!function(){TS.registerModule("shared",{onStart:function(){},test:function(){var e={};return Object.defineProperty(e,"_queried_usernames",{get:function(){return t},set:function(e){t=e}}),e},legacySetOldestUnreadTsForId:function(t,n){t&&(e[t]=n)},legacySendMsg:function(e,t,n,i){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!t)return!1;var s=TS.redux.channels.getEntityById(e);if(!s)return!1;var o=TS.shared.legacyGetControllerForModelOb(s);if(a)if(o===TS.groups||o===TS.ims){var l=r(s,t,o,n);if(!l)return!1}else if(o===TS.channels){var d=TS.channels.legacyEnsureWeCanSendMessageToChannel(s,t,n);if(!d)return!1}return TS.redux.dispatch(TS.interop.redux.actions.prepareAndSendMessage({channelId:e,text:t,replyToTs:n?n.thread_ts||n.ts:null,shouldBroadcast:i})),TS.redux.dispatch(TS.interop.typing.currentUserEndedTyping({channelId:e})),!0},legacyGetControllerForModelOb:function(e){return e?e.is_im?TS.ims:e.is_mpim&&e.is_group?TS.mpims:e.is_group?TS.groups:TS.channels:{}},legacyGetActiveModelOb:function(){var e;return TS.boot_data.channel_id?e=TS.interop.channels.getPublicChannelById(TS.boot_data.channel_id):TS.boot_data.im_id?e=TS.interop.channels.getImById(TS.boot_data.im_id):TS.boot_data.mpim_id?e=TS.interop.channels.getMpimById(TS.boot_data.mpim_id):TS.boot_data.group_id?e=TS.interop.channels.getGroupById(TS.boot_data.group_id):(TS.warn("error getActiveModelOb found no ob"),TS.warn("TS.boot_data.channel_id: "+TS.boot_data.channel_id),TS.warn("TS.boot_data.im_id: "+TS.boot_data.im_id),TS.warn("TS.boot_data.group_id: "+TS.boot_data.group_id)),e},legacyGetShareModelObId:function(e,t){if(TS.boot_data.feature_file_threads)return e?void TS.redux.dispatch(TS.interop.redux.actions.getChannelIdForSharing({channelOrMemberId:e})).then(t):void t(e);var n,i;if(e&&TS.interop.utility.looksLikeMemberId(e))if(n=TS.redux.channels.getImByMemberId(e))e=n.id,t(e);else{var r=function(i,r,a){i?(TS.ims.legacyOnOpened(i,r,a),(n=TS.redux.channels.getImByMemberId(e))?t(n.id):TS.web?t(r.channel.id):TS.error("legacyGetShareModelObId opened an IM, but it is not in the model? data.channel.id: "+r.channel.id)):TS.error("legacyGetShareModelObId try to open an IM, but failed data: "+JSON.stringify(r||null))};TS.interop.api.call("conversations.open",{users:e,return_im:!0,reason:"TS.shared.legacyGetShareModelObId"}).then((function(e){var t=e.data,n=e.args,i=e.request_id;return r(!0,t,n),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return r(!1,t,n),{data:t,args:n,request_id:i}}))}else e&&"C"===e.charAt(0)?(i=TS.interop.channels.getPublicChannelById(e)).is_member||TS.interop.rules.channels.isArchived(i)?t(e):TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:i.id})).catch(_.noop).finally((function(){t(e)})):t(e)},legacyCloseArchivedChannel:function(e){var t=TS.redux.channels.getEntityById(e);t&&TS.interop.rules.channels.isArchived(t)&&(t.was_archived_this_session=!1)},promiseToRefetchModelOb:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.shared.promiseToRefetchModelOb";if(!e||"string"!=typeof e)return Promise.resolve();var n=[e];return TS.interop.channels.fetchAndUpsertChannelsFromFlannel({ids:n}).then((function(e){var i=e.channels;return _.isEmpty(i)?TS.interop.channels.fetchAndUpsertChannelsFromAPI({ids:n,reason:t}):{channels:i}})).then((function(e){var t=e.channels;return t&&t[0]}))},ensureModelObsArePresent:function(e,t){return e&&e.length?TS.interop.channels.fetchAndUpsertChannelsById({ids:e,reason:t}).then((function(e){var t=e.missing;return _.isEmpty(t)||t.forEach((function(e){return TS.interop.channels.upsertChannel({id:e,isNonExistent:!0})})),Promise.resolve()})):Promise.resolve()},legacyEnsureModelObsInDataArePresent:function(e,t){var n=TS.interop.utility.extractAllModelObIds(e);return"search.messages"===t&&TS.boot_data.page_needs_enterprise&&function(e,t){var n=TS.model.team.id;_.remove(t,(function(t){var i=_.find(e.messages.matches,(function(e){return e.channel.id==t}),this),r=_.get(i,"channel"),a=TS.interop.rules.channels.isOrgShared(r)||TS.interop.rules.channels.isExternallySharedChannel(r);if(i&&_.get(i,"team")!=n&&_.startsWith(t,"C")&&!a)return t}))}(e,n),TS.shared.ensureModelObsArePresent(n,t)},legacyRemoveMsgFromModern:function(e,t){return TS.shared.legacyGetControllerForModelOb(e).legacyRemoveMsg(e.id,t)},legacyKickMember:function(e,t){if(e.is_channel||e.is_group&&!e.is_mpim){if(TS.interop.rules.channels.isPrivateChannel(e)){if(!TS.permissions.members.canKickFromGroups())return}else if(!TS.permissions.members.canKickFromChannels())return;var n=TS.interop.members.getMemberById(t);if(n){var i=TS.interop.i18n.safeString(TS.interop.members.getPrefCompliantMemberName(n,!0,!0)),r=TS.interop.rules.channels.getDisplayNameForChannel(e);TS.interop.membership.ensureChannelMembershipIsKnownForUsers(e.id,[t]).then((function(){var a;if(!TS.interop.membership.getCachedChannelMembershipInfoForUser(e.id,t).is_member)return TS.generic_dialog.alert(TS.interop.i18n.t("<strong>{user_name}</strong> is not a member of {channel_name}.","shared")({user_name:i,channel_name:r})),null;a=TS.interop.rules.channels.isPrivateChannel(e)?"<p>"+TS.interop.i18n.t("If you remove <strong>{user_name}</strong> from {channel_name}, they will no longer be able to see any of its messages. To rejoin the private channel, they will have to be re-invited.</p><p>Are you sure you wish to do this?","shared")({user_name:i,channel_name:r})+"</p>":"<p>"+TS.interop.i18n.t("Are you sure you wish to remove <strong>{user_name}</strong> from {channel_name}?","shared")({user_name:TS.interop.i18n.safeString(i),channel_name:r})+"</p>";var s="conversations.kick";return TS.generic_dialog.start({title:TS.interop.i18n.t("Remove {user_name}","shared")({user_name:i}),body:a,go_button_text:TS.interop.i18n.t("Yes, remove them","shared")(),onGo:function(){TS.interop.api.call(s,{channel:e.id,user:t}).catch((function(e){TS.info("Removing user failed; api="+s+"; error="+e.data.error),setTimeout((function(){var t=n.is_ultra_restricted?TS.interop.i18n.t("Single-channel guests","shared")():TS.interop.i18n.t("Multi-channel guests","shared")();if("cant_kick_from_last_channel"===e.data.error&&TS.model.user.is_admin)TS.generic_dialog.start({title:TS.interop.i18n.t("Removing {member_display_name} failed","shared")({member_display_name:i}),body:TS.interop.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can\u2019t be removed from channels.</p><p>If <strong>{member_display_name}</strong> should no longer have access to your workspace, we suggest deactivating their account.</p>","shared")({account_type:t,member_display_name:i}),go_button_text:TS.interop.i18n.t("Manage Members","shared")(),show_cancel_button:!0,onGo:function(){TS.utility.openInNewTab("/admin#restricted",TS.templates.builders.newWindowName())}});else{var a;switch(e.data.error){case"cant_kick_from_last_channel":a=TS.interop.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can\u2019t be removed from channels.</p><p>Please contact a Workspace Admin if <strong>{member_display_name}</strong> should no longer have access to your workspace.</p>","shared")({account_type:t,member_display_name:i});break;case"restricted_action":a=TS.interop.i18n.t("<p>Hmm, looks like you don\u2019t have permission to kick from channels.</p><p>Please contact a Workspace Admin if <strong>{member_display_name}</strong> should no longer have access to your workspace.</p>","shared")({member_display_name:i});break;default:a=TS.interop.i18n.t("<p>Something\u2019s gone wrong, and we couldn\u2019t remove <strong>{member_display_name}</strong> from {channel}. We suspect this is only temporary. Try again in a bit?</p>","shared")({member_display_name:i,channel:r})}TS.generic_dialog.alert(a,TS.interop.i18n.t("Removing {member_display_name} failed","shared")({member_display_name:i}))}}),500)}))}}),null}))}}},legacyBatchUpsertObjects:function(e){TS.has_pri[i]&&TS.log(i,"Flannel: upserting batch of "+e.length+" objects");var t=[],r=[],a=[];_.forEach(e,(function(e){TS.interop.utility.looksLikeMemberId(_.get(e,"id"))?TS.redux.members.hasMemberWithId(e.id)?t.push(e):r.push(e):n(e)&&a.push(e)}));var s=!!r.length,o=[];return t.forEach((function(e){TS.has_pri[i]&&TS.log(i,"Flannel: upserting and signaling user "+e.id+" from query results");var t=TS.members.legacyUpsertAndSignal(e).member;o.push(t)})),s&&(TS.members.legacyStartBatchUpsert(),r.forEach((function(e){TS.has_pri[i]&&TS.log(i,"Flannel: upserting user "+e.id+" from query results");var t=TS.members.legacyUpsertMember(e).member;o.push(t)})),TS.members.legacyFinishBatchUpsert()),a.length&&(TS.redux.bots.bulkUpsertBots(a),a.forEach((function(e){TS.has_pri[i]&&TS.log(i,"Flannel: upserting bot "+e.id+" from query results");var t=TS.interop.bots.getBotById(e.id);o.push(t)}))),o}});var e={},t={},n=function(e){return"B"===_.get(e,"id[0]")};var i=1989,r=function(e,t,n,i){var r=e.is_mpim?TS.interop.i18n.t("conversation","shared")():TS.interop.i18n.t("channel","shared")(),a=e.is_mpim?"conversation":"channel";if(!e)return!1;if(TS.interop.rules.channels.isArchived(e))return!1;var s,o=TS.interop.channels.getGeneralChannel(),l=function(e){TS.generic_dialog.alert(e).then((function(){}))},d=TS.format.cleanMsg(t),c=!!i;if(TS.interop.messages.atEveryoneRegExp.test(d)&&!c){if(!TS.permissions.members.canAtMentionEveryone())return s=TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings()?"<p>"+TS.interop.i18n.t("Usage of <strong>{everyone}</strong> is restricted to Workspace Admins in the large general channel.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>":"<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>",TS.permissions.members.canAtChannelOrGroup(e.id)?s+="channel"===a?'<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this channel, use <strong>{at_label}</strong> instead.","shared")({at_label:TS.templates.builders.atLabel(a)})+"</p>":'<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this conversation, use <strong>{at_label}</strong> instead.","shared")({at_label:TS.templates.builders.atLabel(a)})+"</p>":TS.model.user.is_restricted&&(s="<p>"+TS.interop.i18n.t("Your account is restricted, and you cannot send <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>"),l(s),!1;if(o&&o.is_member){var u;u=e.is_mpim?TS.interop.i18n.t('<p class="bold">Would you like to switch to {general_channel} and send your message?</p><p class="">Using <strong>{everyone}</strong> in a message is a way to address your entire workspace, but it must be done in the {general_channel} channel.</p><p class="no_bottom_margin">If you just want to address everyone in this conversation, use <strong>{channel}</strong> instead.</p>',"shared"):TS.interop.i18n.t('<p class="bold">Would you like to switch to {general_channel} and send your message?</p><p class="">Using <strong>{everyone}</strong> in a message is a way to address your entire workspace, but it must be done in the {general_channel} channel.</p><p class="no_bottom_margin">If you just want to address everyone in this channel, use <strong>{channel}</strong> instead.</p>',"shared"),TS.generic_dialog.start({title:TS.interop.i18n.t("Send {everyone} a message","shared")({everyone:TS.templates.builders.atLabel("everyone")}),body:u({general_channel:TS.interop.i18n.safeString("#"+_.escape(o.name)),conversation_or_channel:r,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}),show_cancel_button:!0,show_go_button:!0,go_button_text:TS.interop.i18n.t("Yes, send it","shared")(),onGo:function(){TS.channels.legacyDisplayChannel({id:o.id,and_send_txt:t})},onCancel:function(){}})}else{if(s="<p>"+TS.interop.i18n.t("You cannot send <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>",TS.permissions.members.canAtChannelOrGroup()){var m=TS.templates.builders.atLabel(a);s+='<p class="no_bottom_margin">'+(e.is_mpim?TS.interop.i18n.t("If you just want to address everyone in this conversation, use <strong>{at_label}</strong> instead.","shared")({at_label:m}):TS.interop.i18n.t("If you just want to address everyone in this channel, use <strong>{at_label}</strong> instead.","shared")({at_label:m}))+"</p>"}l(s)}return!1}var p=TS.interop.messages.atHereRegExp.test(d);if(((TS.interop.messages.atChannelRegExp.test(d)||TS.interop.messages.atGroupRegExp.test(d))&&!c||p)&&!TS.permissions.members.canAtChannelOrGroup()){var f=p?TS.templates.builders.atLabel("here"):TS.templates.builders.atLabel("channel");return l(s="<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{key_word}</strong> messages.","shared")({key_word:f})+"</p>"),!1}return!(!c&&TS.ui.needToShowAtChannelWarning(e.id,t))}}()},WkPL:function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}},XUc0:function(e,t){TS.registerModule("api",{})},YZHV:function(e,t){!function(){TS.registerModule("channels",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,left_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,created_sig:new signals.Signal,deleted_sig:new signals.Signal,renamed_sig:new signals.Signal,archived_sig:new signals.Signal,unarchived_sig:new signals.Signal,onStart:function(){TS.channels.deleted_sig.add((function(e){TS.channels.temp_list_of_removed_channels[e]=!0})),TS.channels.joined_sig.add((function(e){delete TS.channels.temp_list_of_removed_channels[e.id]}))},temp_list_of_removed_channels:{},legacyRemoveMsg:function(e,t){var n=TS.interop.channels.getPublicChannelById(e,!1);if(n){if(TS.redux.messages.removeMessage(t),TS.interop.messages.isReply(t)){n._archive_msgs&&TS.utility.msgs.spliceMsg(n._archive_msgs,t);var i=n.msgs;TS.utility.msgs.spliceMsg(i,t)}TS.channels.message_removed_sig.dispatch(n,t)}else TS.error('unknown channel "'+e+'"')},legacyEnsureWeCanSendMessageToChannel:function(e,t,n){var i;if(!e)return!1;if(TS.interop.rules.channels.isArchived(e))return!1;if(!e.is_member)return!1;var r=TS.interop.channels.getGeneralChannel(),a=function(e,t){t||TS.generic_dialog.alert(e).then((function(){}))};if(!TS.interop.rules.user.canPostInChannel(e.id))return a(TS.interop.i18n.t("Posting to #*{channel_name}* has been restricted to select members.","channels")({channel_name:e.name}),"general_posting_restricted"),!1;var s=TS.format.cleanMsg(t),o=!!n,l=TS.interop.messages.atHereRegExp.test(s)||s.match(/(^|\s)@here(\b|$)/i),d=TS.interop.messages.atChannelRegExp.test(s)&&!o||TS.interop.messages.atGroupRegExp.test(s)&&!o;if(TS.interop.messages.atEveryoneRegExp.test(s)&&!o||TS.interop.rules.channels.isRequired(e)&&d){if(!TS.permissions.members.canAtMentionEveryone(e.id))return TS.model.user.is_restricted?(a(i="<p>"+TS.interop.i18n.t("Your account is restricted, and you cannot send <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>"),!1):(TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings(e.id)?(i="<p>"+TS.interop.i18n.t("Usage of <b>{everyone}</b> is restricted to Workspace Admins in the large general channel.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>",TS.telemeter.count("stopped_loud_channel_mention")):i="<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>",!TS.interop.rules.channels.isRequired(e)&&TS.permissions.members.canAtChannelOrGroup(e.id)&&(i+='<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this channel, use <b>{channel}</b> instead.","channels")({channel:TS.templates.builders.atLabel("channel")})+"</p>"),a(i),!1);if(!TS.interop.rules.channels.isRequired(e)&&!l)return r&&r.is_member?TS.generic_dialog.start({title:TS.interop.i18n.t("Send {everyone} a message","channels")({everyone:TS.templates.builders.atLabel("everyone")}),body:TS.interop.i18n.t('<p class="bold">Would you like to switch to #{general_channel} and send your message?</p>\t\t\t\t\t\t\t<p class="">Using <b>{everyone}</b> in a message is a way to address your entire workspace, but it must be done in the #{general_channel} channel.</p>\t\t\t\t\t\t\t<p class="no_bottom_margin">If you just want to address everyone in this channel, use <b>{channel}</b> instead.</p>',"channels")({general_channel:r.name,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}),show_cancel_button:!0,show_go_button:!0,go_button_text:TS.interop.i18n.t("Yes, send it","channels")(),onGo:function(){TS.channels.legacyDisplayChannel({id:r.id,and_send_txt:t})},onCancel:function(){}}):(i="<p>"+TS.interop.i18n.t("You cannot send <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>",TS.permissions.members.canAtChannelOrGroup(e.id)&&(i+='<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this channel, use <b>{channel}</b> instead.","channels")({channel:TS.templates.builders.atLabel("channel")})+"</p>"),a(i)),!1}if((d||l)&&!TS.permissions.members.canAtChannelOrGroup(e.id)){var c=l?TS.templates.builders.atLabel("here"):TS.templates.builders.atLabel("channel");return TS.permissions.members.canNonAdminsAtChannelOrGroupBySettings(e.id)?(i="<p>"+TS.interop.i18n.t("Usage of <b>{key_word}</b> is restricted to Workspace Admins in this large channel.","channels")({key_word:c})+"</p>",TS.telemeter.count("stopped_loud_channel_mention")):i="<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <b>{key_word}</b> messages.","channels")({key_word:c})+"</p>",a(i),!1}return!(!o&&TS.ui.needToShowAtChannelWarning(e.id,t))},legacyDisplayChannel:function(e){var t=_.defaults({},e,{from_history:!1,replace_history_state:!1}),n=t.id;if(n){var r=t.and_send_txt,a=t.replace_history_state,s=t.last_active_primary_view;TS.telemeter.mark("start_channel_change_"+n),TS.redux.dispatch(TS.interop.redux.models.channelsMeta.prqMetrics.updateChannelLastFocus({lastFocus:TS.interop.redux.models.window.getWindowLastFocusEvent(TS.redux.getState()),objId:n}));var o=TS.interop.channels.getPublicChannelById(n,!1);if(o){if(TS.utility.msgs.maybeClearPrevLastRead(),TS.utility.msgs.maybeClearPrevLastRead(o),n===(s||TS.model.active_channel_id)&&!a)return TS.warn('channel "'+n+'" already displayed'),void(r&&TS.shared.legacySendMsg(n,_.trim(r)));if(TS.has_pri[i]&&TS.log(i,"legacyDisplayChannel: "+o.id),!o.is_member&&r)return TS.model.requested_channel_joins[n]={and_send_txt:r},void TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:n})).catch(_.noop);TS.console.info("TS.channels.legacyDisplayChannel",n),r&&TS.shared.legacySendMsg(n,_.trim(r))}else TS.error('channel "'+n+'" unknown')}else TS.error("no channel id supplied")},legacyMarkMostRecentReadMsg:function(e,t){e?TS.interop.channels.markMostRecentMsgRead({channelId:e.id,reason:t}):TS.error("channel unknown")},legacyOnJoin:function(e,t,n){var i,r;e?(t.channel&&(r=TS.interop.channels.upsertChannel(t.channel),i=t.channel.id),i?(TS.model.requested_channel_joins[i]&&delete TS.model.requested_channel_joins[i],r?n._in_background||TS.interop.channels.getNeedsCreatedMessageState(r.name)||r.never_needs_joined_msg||(r.needs_joined_message=!0):TS.error("no channel?!!")):TS.error("no channel_id?!!")):"name_taken"===t.error||("is_archived"===t.error?TS.channels.legacyDisplayChannel({id:TS.redux.channels.getPublicChannelByName(n.name).id}):"restricted_action"===t.error?TS.generic_dialog.alert(TS.interop.i18n.t("<p>You don\u2019t have permission to create new channels.</p><p>Talk to your Workspace Owner.</p>","channels")()):(TS.error("failed to join channel"),TS.generic_dialog.alert(TS.interop.i18n.t("Oops, something went wrong.","client")())))},leave:function(i){var r=TS.interop.channels.getPublicChannelById(i,false)||TS.interop.channels.getGroupById(i,false);return r?TS.interop.rules.channels.getLeaveAction(TS.redux.dispatch,TS.redux.getState,r).then((function(a){var s=TS.interop.rules.channels.LEAVE_ACTIONS;switch(a){case s.CONFIRM_AND_LEAVE:return n(r).then((function(t){if(t)return e(r)}));case s.CONFIRM_LEAVE_AND_ARCHIVE:return Promise.resolve(TS.channels.ui.showArchiveGroupDialog(r,!0));case s.CLOSE:return Promise.resolve(TS.shared.legacyCloseArchivedChannel(r.id));case s.LEAVE:return e(r);case s.NONE:return t({channel:r,reason:"restricted_action"});default:TS.error("Failed to leave channel "+i+'. No case for a leave action "'+a+'" is defined.')}})):t({channel:r,reason:"no_channel"})},legacyAlertSetPurposeError:function(e){var t=_.get(e,"data.error"),n=TS.interop.i18n.t("Oooops!","channels")(),i=TS.interop.channels.getChannelPurposeError(t);TS.generic_dialog.alert(i,n)},legacyAlertSetTopicError:function(e){var t=_.get(e,"data.error"),n=TS.interop.i18n.t("Oooops!","channels")(),i=TS.interop.channels.getChannelTopicError(t);TS.generic_dialog.alert(i,n)},legacyUpdateTopicFromAPI:function(e){var t=_.get(e,"channel.id"),n=_.get(e,"channel.topic");t&&n&&TS.interop.channels.setChannelTopic({id:t,topic:n})},legacyKickMember:function(e,t){var n=TS.redux.channels.getEntityById(e);if((!TS.interop.rules.channels.isPublicChannel(n)||TS.permissions.members.canKickFromChannels())&&(!TS.interop.rules.channels.isPrivateChannel(n)||TS.permissions.members.canKickFromGroups()))return TS.shared.legacyKickMember(n,t)},test:function(){var e={};return Object.defineProperty(e,"_confirmIntentToLeaveChannel",{get:function(){return n},set:function(e){n=e}}),e}});var e=function(e){return TS.channels.legacyMarkMostRecentReadMsg(e,TS.model.marked_reasons.left),TS.redux.dispatch(TS.interop.channels.submitLeave({channelId:e.id})).then((function(){e.msgs&&(e.msgs.length=0),e.is_limited&&(e.is_limited=!1)})).catch((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.message,r=n.data,a=_.get(r,"error")||i;return t({channel:e,reason:a})}))},t=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.channel,i=t.reason;switch(i){case"last_member":TS.interop.rules.channels.isExternallySharedChannel(n)?e=TS.model.user.is_admin?TS.interop.i18n.t('<h3 class="top_margin">To leave this channel, it needs to be unshared</h3><p>Since you\u2019re the last person from <strong>{team_name}</strong>, you\u2019ll need to stop sharing this channel before you can leave it.</p>',"channels")({team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(TS.model.team)))}):TS.interop.i18n.t('<h3 class="top_margin">To leave this channel, it needs to be unshared</h3><p>Since you\u2019re the last person from <strong>{team_name}</strong>, you\u2019ll need an admin\u2019s help to leave. It\u2019s just a couple steps:</p><ul><li>Invite an admin to this channel.</li><li>Ask them to unshare and archive the channel.</li></ul>',"channels")({team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(TS.model.team)))}):TS.shared.legacyCloseArchivedChannel(n.id);break;case"restricted_action":e=TS.interop.i18n.t("Sorry, you can\u2019t leave <strong>#{channel_name}</strong>!","channels")({channel_name:n.name})}return e?TS.generic_dialog.alert(e):Promise.resolve()},n=function(e){return new Promise((function(t){TS.generic_dialog.start({title:TS.interop.i18n.t("Leave {group}","groups")({group:TS.model.group_prefix+e.name}),body:TS.interop.i18n.t("<p>If you leave the private channel, you will no longer be able to see any of its messages. To rejoin the private channel, you will have to be re-invited.</p><p>Are you sure you wish to leave?</p>","groups")(),go_button_text:TS.interop.i18n.t("Yes, leave the private channel","groups")(),onGo:function(){return t(!0)},onCancel:function(){return t(!1)}})}))},i=999}()},"Ysd/":function(e,t){!function(){TS.registerModule("redux.files",{onStart:function(){Object.defineProperty(TS.model,"files",{get:function(){return TS.redux.files.getAllFiles()},set:function(){return TS.boot_data.feature_tinyspeck&&TS.warn("TS.redux.files: Set TS.model.files"),!1}})},getFileById:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=i(e,t);return n&&n.id===e?n:null},getFileByProp:function(e,t){var n=TS.redux.files.getAllFiles();return _.find(n,(function(n){return n[e]===t}))},getAllFiles:function(){var i=n();return i===e||(t=_.values(i),e=i),t},addFile:function(e){e&&TS.redux.dispatch(TS.interop.redux.models.files.addFile(e))},bulkAddFiles:function(e){_.isArray(e)&&TS.redux.dispatch(TS.interop.redux.models.files.bulkAddFiles(e))},logStats:function(){var e=_(r).keys().union(_.keys(a)).value(),t={};_.forEach(e,(function(e){t[e]={gets:r[e]||0,sets:a[e]||0}})),TS.console.table(t)}});var e,t,n=TS.redux.bindSelectorToStore("TS.interop.redux.models.files.getAllFiles"),i=TS.redux.bindSelectorToStore("TS.interop.redux.models.files.getFileById"),r={},a={}}()},ZhPi:function(e,t,n){var i=n("WkPL");e.exports=function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}},Zt5a:function(e,t){!function(){TS.registerModule("pins",{pins_fetched_sig:new signals.Signal,pinned_status_changed_sig:new signals.Signal,pinned_message_changed_sig:new signals.Signal,pinned_message_deleted_sig:new signals.Signal,onStart:function(){TS.files.team_file_comment_deleted_sig.add(p),TS.files.team_file_deleted_sig.add(f),TS.channels.left_sig.add(h)},fetchPins:function(e){if(e)return t[e.id]=!0,TS.interop.api.call("pins.list",{channel:e.id}).then((function(t){TS.pins.onFetchPins(t,e)})).catch((function(t){TS.interop.utility.getLogger({getState:TS.redux.getState}).error("Failed to fetch pins for model ob: "+e.id,t)})).finally((function(){delete t[e.id]}))},onFetchPins:function(t,n){var i=t.data.items;TS.pins.upsertPinnedItems(i),n.pinned_items=i,n.pinned_items_count=i.length,n.has_pins=!!n.pinned_items_count,n.is_channel&&!n.is_member||(e[n.id]=!0),TS.pins.pins_fetched_sig.dispatch(n,i)},arePinsCurrentlyBeingFetched:function(e){return!!t[e.id]},havePinsBeenFetched:function(t){return!!e[t.id]},clearHavePinsBeenFetched:function(n){n&&n.id&&(n.pinned_items=[],delete e[n.id],delete t[n.id])},startPinFile:function(e,t){var n=TS.files.getFileById(e);n&&l("file",t,{file:n,type:"file"})},unPinFile:function(e,t){var n=i(e,t);if(n){var r={file:n,type:"file"};m(r,t,(function(){c(t,r)}))}},startPinFileComment:function(e,t,n){var i=TS.files.getFileById(t);if(i){var r=TS.files.getFileCommentById(i,e);r&&l("comment",n,{file:i,comment:r,type:"file_comment"})}},unPinFileComment:function(e,t,n){var i=r(e,t,n),a=TS.files.getFileById(t);if(i&&a){var s={file:a,comment:i,type:"file_comment"};m(s,n,(function(){c(n,s)}))}},startPinMessage:function(e,t){e=e.toString();var n=TS.utility.msgs.findMsg(e,t.id);n&&("file_comment"===n.subtype?TS.pins.startPinFileComment(n.comment.id,n.file.id||n.file,t):n.file?TS.pins.startPinFile(n.file.id||n.file,t):l("message",t,{message:n,type:"message"}))},unPinMessage:function(e,t){e=e.toString();var n=a(e,t);if(n)if("file_comment"===n.subtype)TS.pins.unPinFileComment(n.comment.id,n.file.id||n.file,t);else if(n.file)TS.pins.unPinFile(n.file.id||n.file,t);else{var i={message:n,type:"message"};m(i,t,(function(){c(t,i)}))}},isMessagePinned:function(e,t){return"file_comment"===e.subtype?!!e.comment&&!!r(e.comment.id,e.file.id||e.file,t):e.file?!!i(e.file.id||e.file,t):!!a(e.ts,t)},pinStatusHasChanged:function(e,t,i,r,a,l){var d,c,u,_,m,p;e&&l&&(p={pinnedBy:l.pinned_by,pinnedTs:l.pinned_ts});var f=t.file;f&&1===Object.keys(f).length&&(f=TS.files.getFileById(t.file.id)),"message"===i&&r?(d=TS.utility.msgs.findMsg(t.message.ts,r.id))&&(t.message=d,u=s(e,d,r)):f&&"file_comment"===i?(m=TS.files.upsertFile(f,"pinStatusHasChangedComment"),n(f.id,t),(c=TS.files.getFileCommentById(f,t.comment.id))?(t.comment=c,u=s(e,c,r)):(c=TS.files.addCommentToFile(t.comment,f),t.comment=c),u=u||"CHANGED"===m.status):f&&"file"===i&&(f=TS.interop.rules.files.extendFileWithPinnedInfo(f,r.id,p),m=TS.files.upsertFile(f,"pinStatusHasChangedFile"),n(f.id,t),u=(u=s(e,f,r))||"CHANGED"===m.status),_=o(e,t,i,r,a),(u||_)&&TS.pins.pinned_status_changed_sig.dispatch(r,t,e),u&&"message"===i&&(d=TS.interop.rules.messages.extendMessageWithPinnedInfo(d,p),TS.redux.messages.replaceMessage(d))},upsertPinnedItems:function(e){_.isEmpty(e)||e.forEach((function(e){if("message"===e.type&&e.message&&TS.interop.messages.shouldRenderFileThread(e.message)){var t=e.message;t.files&&t.files.forEach((function(e){TS.files.upsertFile(e,"upsertPinnedItems")}))}if("file"===e.type||"file_comment"===e.type){var i=e.file&&e.file.id;TS.files.upsertFile(e.file,"upsertPinnedItems"),n(i,e)}if("file_comment"===e.type){var r=TS.files.getFileCommentById(e.file,e.comment.id);r||(r=TS.files.addCommentToFile(e.comment,e.file)),e.comment=r}}))},replaceMsg:function(e,t){t.pinned_items&&t.pinned_items.forEach((function(n){"message"===n.type&&n.message.ts===e.ts&&(n.message=e,TS.pins.pinned_message_changed_sig.dispatch(t,n))}))},legacyRemoveMsg:function(e,t){t.pinned_items&&(o(!1,{message:{ts:e}},"message",t),TS.pins.pinned_message_deleted_sig.dispatch(t))},canUserPinHere:function(){return!1},updateCount:function(e,t){if(e){var n=e.pinned_items_count;e.pinned_items_count=TS.pins.havePinsBeenFetched(e)?_.get(e,"pinned_items.length"):t,n!==e.pinned_items_count&&(e.has_pins=!!e.pinned_items_count,TS.pins.pinned_status_changed_sig.dispatch(e))}},getUnreadPins:function(e){var t,n=[];if(!e)return n;var i=e._marked_reason;if("0000000000.000000"===e.last_read&&"back"!==i)return n;if(TS.model.ui.is_window_focused)if("back"===i){var r=TS.utility.msgs.getDisplayedMsgAfterTS(e.last_read,e.msgs);t=r?parseFloat(r.ts)-1:e.last_read}else t=!e._prev_last_read||i&&"viewed"!==i?e.last_read:e._prev_last_read;else t=e.last_read;var a=e.pinned_items;return _.isEmpty(a)||_.forEach(a,(function(e){var r=TS.interop.members.getMemberById(e.created_by);r&&e.created>Math.ceil(t)&&(r.is_self&&"back"===i?n.push(e):r.is_self||n.push(e))})),n},test:function(){return{fileDeleted:f,fileCommentDeleted:p,have_pins_been_fetched:e}}});var e={},t={},n=function(e,t){t&&e&&TS.files.getFileById(e)&&Object.defineProperty(t,"file",{enumerable:!0,configurable:!0,get:function(){return TS.files.getFileById(e)},set:function(){return!1}})},i=function(e,t){var n=TS.files.getFileById(e);return n&&n.pinned_to&&-1!==n.pinned_to.indexOf(t.id)?n:null},r=function(e,t,n){var i=TS.files.getFileById(t);if(!i)return null;var r=TS.files.getFileCommentById(i,e);return r&&r.pinned_to&&-1!==r.pinned_to.indexOf(n.id)?r:null},a=function(e,t){if(t.pinned_items)for(var n,a=0;a<t.pinned_items.length;a+=1)if("message"===(n=t.pinned_items[a]).type&&n.message.ts===e)return n.message;var s=TS.utility.msgs.findMsg(e,t.id);if(!s)return null;if("file_comment"===s.subtype){if(r(s.comment.id,s.file.id||s.file,t))return s}else if(s.file){if(i(s.file.id||s.file,t))return s}else if(s.pinned_to&&-1!==s.pinned_to.indexOf(t.id))return s;return null},s=function(e,t,n){var i=!1;if(t.pinned_to||(t.pinned_to=[]),e)-1===t.pinned_to.indexOf(n.id)&&(t.pinned_to.push(n.id),i=!0);else{var r=t.pinned_to.indexOf(n.id);-1!==r&&(t.pinned_to.splice(r,1),i=!0)}return i},o=function(e,t,n,i,r){var a=!1;i.pinned_items||(i.pinned_items=[]);var s=-1;if(i.pinned_items.some((function(e,i){var r=!1;return"message"===n&&"message"===e.type?e.message.ts===t.message.ts&&(r=!0):"file"===n&&"file"===e.type?e.file.id===t.file.id&&(r=!0):"file_comment"===n&&"file_comment"===e.type&&e.comment.id===t.comment.id&&(r=!0),r&&(s=i),r})),TS.pins.havePinsBeenFetched(i))e||-1===s?e&&-1===s&&(i.pinned_items.unshift(t),i.pinned_items_count=i.pinned_items.length,a=!0):(i.pinned_items.splice(s,1),i.pinned_items_count=i.pinned_items.length,a=!0);else{i.pinned_items_count=i.pinned_items_count||0;var o=_.parseInt(r,10);_.isNaN(o)?e?i.pinned_items_count+=1:e||(i.pinned_items_count=Math.max(i.pinned_items_count-1,0)):i.pinned_items_count=o,a=!0}return i.has_pins=!!i.pinned_items_count,a},l=function(e,t,n){var i="",r="",a="";switch(e){case"file":i=TS.interop.i18n.t("Are you sure you want to pin this file to {pin_to_label}?","pins")({type:e,pin_to_label:Handlebars.helpers.pinToLabel(t)}),r=TS.interop.i18n.t("Pin file","pins")(),a=TS.interop.i18n.t("Yes, pin this file","pins")();break;case"comment":i=TS.interop.i18n.t("Are you sure you want to pin this comment to {pin_to_label}?","pins")({type:e,pin_to_label:Handlebars.helpers.pinToLabel(t)}),r=TS.interop.i18n.t("Pin comment","pins")(),a=TS.interop.i18n.t("Yes, pin this comment","pins")();break;case"message":i=TS.interop.i18n.t("Are you sure you want to pin this message to {pin_to_label}?","pins")({type:e,pin_to_label:Handlebars.helpers.pinToLabel(t)}),r=TS.interop.i18n.t("Pin message","pins")(),a=TS.interop.i18n.t("Yes, pin this message","pins")()}var s="<p>"+i+"</p>";TS.generic_dialog.start({title:r,body:s,go_button_text:a,onGo:function(){d(t,n)}})},d=function(e,t){var n=u(e,t),i=TS.interop.datetime.makeTsStamp(null,{padder:"0"}),r=function(n,r){if(!n){if("too_many_pins"===r.error){var a="message";"file"===t.type&&(a="file"),"file_comment"===t.type&&(a="comment"),TS.generic_dialog.start({title:TS.interop.i18n.t("Couldn\u2019t pin {type}","pins")({type:a}),body:"<p>"+TS.interop.i18n.t("Sorry! You\u2019ve hit the limit on how many pins you can have in this channel.","pins")()+"</p>",show_cancel_button:!1})}else TS.info("pins.add got a not ok rsp: "+r.error);if("already_pinned"!==r.error)return}TS.interop.redux.features.socket.isConnected(TS.redux.getState())||TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:e.id})),TS.pins.havePinsBeenFetched(e)&&(t.created=i,t.created_by=TS.boot_data.user_id,TS.pins.pinStatusHasChanged(!0,t,t.type,e))};TS.interop.api.call("pins.add",n).then((function(e){var t=e.data,n=e.args,i=e.request_id;return r(!0,t),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return r(!1,t),{data:t,args:n,request_id:i}}))},c=function(e,t){var n=u(e,t),i=function(n,i){(n||"not_pinned"===i.error)&&(TS.interop.redux.features.socket.isConnected(TS.redux.getState())||TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:e.id})),TS.pins.havePinsBeenFetched(e)&&TS.pins.pinStatusHasChanged(!1,t,t.type,e))};TS.interop.api.call("pins.remove",n).then((function(e){var t=e.data,n=e.args,r=e.request_id;return i(!0,t),{data:t,args:n,request_id:r}})).catch((function(e){var t=e.data,n=e.args,r=e.request_id;return i(!1,t),{data:t,args:n,request_id:r}}))},u=function(e,t){var n={channel:e.id};return"message"===t.type?n.timestamp=t.message.ts:"file"===t.type?n.file=t.file.id:"file_comment"===t.type&&(n.file_comment=t.comment.id),n},m=function(e,t,n){TS.generic_dialog.start({title:TS.interop.i18n.t("Remove Pinned Item","pins")(),body:"<p>"+TS.interop.i18n.t("Are you sure you want to remove this pinned item?","pins")()+"</p>",go_button_text:TS.interop.i18n.t("Yes, remove this pinned item","pins")(),onGo:n})},p=function(e,t,n){n&&n.pinned_to&&n.pinned_to.forEach((function(e){var t=TS.redux.channels.getEntityById(e);t&&(o(!1,{comment:n},"file_comment",t)&&TS.pins.pinned_status_changed_sig.dispatch(t))}))},f=function(e){e&&(e.pinned_to&&e.pinned_to.forEach((function(t){var n=TS.redux.channels.getEntityById(t);n&&(o(!1,{file:e},"file",n)&&TS.pins.pinned_status_changed_sig.dispatch(n))})),e.comments&&e.comments.forEach((function(t){p(e,t.id,t)})))},h=function(n){var i=n||TS.shared.legacyGetActiveModelOb();i&&i.id&&(delete e[i.id],delete t[i.id])}}()},aLMH:function(e,t,n){var i=n("cDf5"),r=n("J4zp");!function(){var e,t,n,a,s;TS.registerModule("utility",{onStart:function(){TS.utility.makeRefererSafeLink=_.memoize(TS.utility.makeRefererSafeLink),TS.prefs&&TS.prefs.team_hide_referers_changed_sig&&TS.prefs.team_hide_referers_changed_sig.add(TS.utility.resetRefererSafeLinkCache),a=TS.interop.i18n.t("me","utility")(),s=TS.interop.i18n.t("you","utility")(),g=TS.utility.normalizeDevHost("https://"+document.location.hostname+"/files"),S=TS.utility.normalizeDevHost("https://"+document.location.hostname+"/team")},keymap:{alt:18,ctrl:17,cmd_ff:224,cmd_other:91,cmd_right:93,esc:27,shift:16,tab:9,del:8,delete:46,enter:13,left:37,up:38,right:39,down:40,pageup:33,pagedown:34,end:35,home:36,space:32,semicolon:59,equals_sign:187,minus_sign:189,comma:188,period:190,left_square_bracket:219,right_square_bracket:221,V:86,a:65,e:69,b:66,k:75,i:73,z:90,y:89,insert:45,slash:191,f6:117,num_lock:144,insert_extended:96,caps_lock:20},email_regex:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,regexpEscape:function(e,t){return t=Math.min(t||5e5,5e5),e.length>t&&(e=e.slice(0,t)),_.escapeRegExp(e)},ensureInArray:function(e,t){return!(e.indexOf(t)>-1)&&(e.push(t),!0)},makeComparableVersion:function(e){var t=e.split("-")[0];return _.reduce(t.split("."),(function(e,t){return 1e3*e+parseInt(t,10)}),0)},compareSemanticVersions:function(e,t){var n=TS.utility.makeComparableVersion(e),i=TS.utility.makeComparableVersion(t);return n===i?0:n>i?1:-1},isAppVersionBefore:function(e){if(!TS.model.is_our_app){if("dev"===TS.boot_data.version_ts)throw new Error("Cannot check app version because we are not in the app, silly goose.");return!1}return-1===TS.utility.compareSemanticVersions(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor+"."+TS.model.desktop_app_version.patch,e)},doRectsOverlap:function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},doesRectContainRect:function(e,t,n,i){return n=n||0,!(t.top<e.top-n)&&(!(t.bottom>e.bottom+n)&&(!!i||!(t.left<e.left-n)&&!(t.right>e.right+n)))},shouldLinksHaveTargets:function(){return!1},parseJSONOrElse:function(e,t){if(""===e)return t;try{return JSON.parse(e)}catch(e){return t}},stringifyJSONOrElse:function(e,t,n,i){try{return JSON.stringify(e,t,n)}catch(e){return"function"==typeof i?i(e):i}},ordinalNumber:function(e){return TS.interop.i18n.t("{number_str, selectordinal, one{#st}two{#nd}few{#rd}other{#th}}","utilities")({number_str:e.toString()})},getTeamUrl:function(){return S},getHistoryRetryDelay:function(e,t){e=_.isInteger(e)?e:1;var n=_.random(2500,5e3);if("fatal_error"===t){n*=Math.pow(1.3,e)}return n},getChannelNameFromUrl:function(e){var t=TS.utility.getPathFromSlackUrl(e);return t&&("messages"==t[0]||"archives"==t[0])?decodeURIComponent(t[1]):""},removeUrlParam:function(e,t){var n=t.split("?")[0],i=-1!==t.indexOf("?")?t.split("?")[1]:"",r=[];if(""!==i){for(var a=(r=i.split("&")).length-1;a>=0;a-=1)r[a].split("=")[0]===e&&r.splice(a,1);n=r.length?n+"?"+r.join("&"):n}return n},isUnreadViewPath:function(e){return 0===e.indexOf("/unreads")},isThreadsViewPath:function(e){return 0===e.indexOf("/threads")},isAppSpaceViewPath:function(e){return 0===e.indexOf("/app-space")},isSearchViewPath:function(e){return 0===e.indexOf("/search")},isPageViewPath:function(e){return 0===e.indexOf("/page")},isSlackUrl:function(e){return p.test(e)},getPathFromSlackUrl:function(e){var t=e.match(p),n=t&&t[2];if(n)return(n+e.split(n)[1].split("?")[0]).split("/")},getTeamFromSlackUrl:function(e){var t=e.match(p);return t&&t[1]},refashionUrl:function(e,t,n,i){var a=document.createElement("a");a.href=e;var s=a.pathname.slice(1).split("/").slice(0,2),o=r(s,2),l=o[0],d=o[1];return a.pathname=_.compact([t||"/"+l+"/"+d,n,i]).join("/"),"/"!==a.pathname[a.pathname.length-1]&&(a.pathname+="/"),a.toString()},dataURItoBlob:function(e){return TS.utility.base64StrtoBlob(TS.utility.base64StrFromDataURI(e))},base64StrFromDataURI:function(e){return e.split(",")[1]},base64StrtoBlob:function(e){for(var t=atob(e),n=new ArrayBuffer(t.length),i=new Uint8Array(n),r=0;r<t.length;r+=1)i[r]=t.charCodeAt(r);var a=new DataView(n);return new Blob([a])},ellipsize:function(e,t){if(!e)return e;if(t&&parseInt(t,10)||(t=50),e.length>t){var n=e.substr(0,t/2),i=e.substr(-t/2,e.length);e=n+"..."+i}return e},makeSafeForDomId:function(e){return String(e).replace(/\./g,"_")},makeSafeForDomClass:function(e){return e.replace(/\s/g,"_")},getImageIconClass:function(e,t){var n=t;return e&&(e.thumb_360_w<80||e.thumb_360_h<80)&&(n=e.thumb_360_w>e.thumb_360_h?"landscape":e.thumb_360_w<e.thumb_360_h?"portrait":"square"),n},getAppliedClasses:function(e){return _.reduce(e,(function(e,t,n){return t&&e.push(n),e}),[]).join(" ")},numberWithK:function(e){return e>999?(e=Math.round(e/1e3*10)/10,(TS.interop.i18n.number(e)||"")+"K"):TS.interop.i18n.number(e)||""},openInNewTab:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.dontEncodeHash,r=void 0!==i&&i;if(0===e.indexOf("/")&&TS.boot_data.team_url){var a=TS.boot_data.team_url;a=a.substr(0,a.length-1),e=a+e}var s=e,o="",l=s.indexOf("?"),d=TS.interop.utility.urlNeedsRefererHiding(e);if(-1!==l){d&&(e=_.escape(e.substring(0,l)));var c=s.substring(l+1,s.length);if(s=s.substring(0,l),c.length){var u=TS.interop.url.queryStringParse(c),m=TS.interop.url.parseUrl(e),p=!1;m&&"accounts.google.com"==m.hostname&&"/o/oauth2/auth"==m.pathname&&(p=!0),_.forEach(u,(function(t,n){d?(e=TS.interop.url.setUrlQueryStringValue(e,n,t||"",p),r&&(e=e.replace("%23","#"))):o+='<input type="hidden" name="'+_.escape(n)+'" value="'+_.escape(t||"")+'">'}))}}d&&(o='<input type="hidden" name="url" value="'+_.escape(e)+'">',s="https://"+TS.boot_data.redir_domain+"/link"),$("<form>"+o+"</form>").attr({method:"GET",action:s,target:t}).appendTo("body").submit().remove()},isScalar:function(e){return/boolean|number|string/.test(i(e))},sanitizeHTML:function(e,t,i,r){var a=(n=n||new DOMParser).parseFromString(e,"text/html")||n.parseFromString(e,"text/xml"),s=a.body;if(1!=s.children.length)return"";var o=function e(n){var r=n.tagName.toLowerCase();return t.indexOf(r)<0?null:(Array.prototype.slice.apply(n.attributes).forEach((function(e){i.indexOf(e.name)<0&&n.attributes.removeNamedItem(e.name)})),Array.prototype.slice.apply(n.children).forEach((function(t){e(t)||n.removeChild(t)})),n)}(s.children[0]);return s=null,a=null,o?r?o:o.outerHTML:""},getChildTextNodes:function(e){var t=[];if(!e)return t;if(e instanceof Text)return t.push(e),t;for(var n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),i=n.nextNode();i;)t.push(i),i=n.nextNode();return t},getAttributesFromHTMLString:function(e){var t=(n=n||new DOMParser).parseFromString(e,"text/html")||n.parseFromString(e,"text/xml"),i=t.body;if(1!=i.children.length)return{};var r={};return[].slice.apply(i.children[0].attributes).forEach((function(e){r[e.name]=e.value})),i=null,t=null,r},linkify:function(e,t,n,i){return e?e=e.replace(TS.interop.url.URL_REGEXP,(function(e){var r;if(0===e.toLowerCase().indexOf("www.")){if(!n)return e;r="http://"+e}else r=e;return i?"<"+r+"|"+e+">":"<a "+TS.utility.makeRefererSafeLink(r)+' target="'+(t||"")+'">'+e+"</a>"})):e},linkifyInternal:function(e,t){return TS.utility.linkify(e,"",t,!0)},preg_quote:function(e){return(""+e).replace(/([\\.+*?[^\]$(){}=!<>|:])/g,"\\$1")},getActiveElementProp:function(e){return document.activeElement?"NODENAME"===e?document.activeElement.nodeName?document.activeElement.nodeName.toUpperCase():"":document.activeElement[e]:""},isTabCompleteShowing:function(){return!!$("#chat_input_tab_ui").length},isFocusOnInput:function(){return TS.interop.utility.isInputElement(document.activeElement)},unformatTopicOrPurpose:function(e){return TS.format.unFormatMsg(e)},formatTopicOrPurpose:function(e,t){return e=(e=TS.format.formatWithOptions(e,{},{no_preformatted:!!t})).replace(/(<br[^>]*>)/,'<span class="hidden br_ellipsis">\u2026</span>$1')},removeLinksFromTabFlow:function(e){return e.replace(f,'$1 tabindex="-1"$2')},populateInput:function(e,t,n){t||(t="");var i=$(e);TS.utility.contenteditable.value(i,t),_.isNumber(n)&&TS.utility.contenteditable.cursorPosition(i,n)},populateThreadInputs:function(e,t,n){TS.interop.threads.populateReplyInput(e,t,n)},referer_safe_url_map:{},makeRefererSafeLink:function(e){if("string"==typeof e){e=TS.format.replaceHighlightMarkers(e),m(e);var t=e.replace(/&amp;/g,"&");t.match(/javascript(:|&colon;)/gi)&&(t="#");var n=TS.utility.sanitizeHTML('<a href="'+t+'"></a>',["a"],["href"],!0)||null;n&&(t=n.href),t=_.escape(t).replace(/&amp;/g,"&").replace(/(%27|&#39;)/g,"'"),e&&e.lastIndexOf("/")!==e.length-1&&t&&t.lastIndexOf("/")===t.length-1&&(t=t.slice(0,-1));var r='href="'+(t=t||"#")+'"',a="onclick",s=TS.interop.utility.getRefererPolicy();if(TS.model&&TS.model.is_our_app||s&&s.rewrite_on_right_click&&(a="onmousedown"),!TS.interop.utility.urlNeedsRefererHiding(e))return r;if(TS.utility.externalURLsNeedRedirecting()){var o=encodeURIComponent(t),l="https://"+TS.boot_data.redir_domain+"/link?url="+o+(s&&s.redirect_type?"&v="+s.redirect_type:""),d="url-"+Math.random()+"-"+performance.now();TS.utility.referer_safe_url_map[d]=t,r+=' data-referer-safe="1" '+a+'="this.href=&quot;'+l+'&quot;" onmouseover="this.href=TS.utility.referer_safe_url_map[&quot;'+d+'&quot;]" data-referer-original-href="'+t+'" rel="noreferrer"'}else r+=' rel="noreferrer"';return r}TS.error("Expected url to be a string, got: "+i(e))},resetRefererSafeLinkCache:function(){TS.utility.makeRefererSafeLink&&TS.utility.makeRefererSafeLink.cache&&TS.utility.makeRefererSafeLink.cache.clear()},makeSureAllExternalLinksAreRefererSafe:function(e){var t=Date.now(),n=[];TS.utility.externalURLsNeedRedirecting()?(e.find("a[href]:not([data-referer-safe])").each((function(){var e=$(this),t=e.attr("href");if(TS.interop.utility.urlNeedsRefererHiding(t)){n.push(this.outerHTML),e.removeAttr("href");var i=this.outerHTML.replace("<a",(function(){return"<a "+TS.utility.makeRefererSafeLink(t)+" "}));e.replaceWith(i),n[n.length-1]+="\n->\n"+i}})),TS.model&&TS.model.team&&TS.has_pri[h]&&TS.boot_data.feature_tinyspeck&&(n.length?(TS.log(h,"#"+e.attr("id")+" had "+n.length+" LINKS WITH EXT HREFS BUT NOT data-referer-safe! to fix it took "+(Date.now()-t)+"ms"),TS.dir(h,n)):TS.log(h,"#"+e.attr("id")+" had "+n.length+" LINKS WITH EXT HREFS BUT NOT data-referer-safe! to check it took "+(Date.now()-t)+"ms"))):(e.find("a[href]:not([rel])").each((function(){var e=$(this),t=e.attr("href");0!==t.indexOf("mailto")&&0!==t.indexOf("skype")&&(t&&"#"!==t?TS.interop.utility.urlNeedsRefererHiding(t)&&(n.push(this.outerHTML),e.attr("rel","noreferrer"),n[n.length-1]+="\n->\n"+this.outerHTML):e.removeAttr("href"))})),TS.model&&TS.model.team&&TS.has_pri[h]&&TS.boot_data.feature_tinyspeck&&(n.length?(TS.log(h,"#"+e.attr("id")+" had "+n.length+' LINKS WITH EXT HREFS BUT WITHOUT rel="noreferrer"! to add rel it took '+(Date.now()-t)+"ms"),TS.dir(h,n)):TS.log(h,"#"+e.attr("id")+" had "+n.length+' LINKS WITH EXT HREFS BUT WITHOUT rel="noreferrer"! to check it took '+(Date.now()-t)+"ms")))},makeSureAllLinksHaveTargets:function(e){var t=Date.now(),n=[];e.find("a[href]:not([target])").each((function(){var e=$(this),t=e.attr("href");0!==t.indexOf("mailto")&&0!==t.indexOf("skype")&&(t&&"#"!==t?(n.push(this.outerHTML),e.attr("target",t),n[n.length-1]+="\n->\n"+this.outerHTML):e.removeAttr("href"))})),TS.model&&TS.model.team&&TS.has_pri[h]&&TS.boot_data.feature_tinyspeck&&(n.length?(TS.log(h,"#"+e.attr("id")+" had "+n.length+" LINKS WITH HREFS BUT WITHOUT TARGETS! to add targets it took "+(Date.now()-t)+"ms"),TS.dir(h,n)):TS.log(h,"#"+e.attr("id")+" had "+n.length+" LINKS WITH HREFS BUT WITHOUT TARGETS! to check it took "+(Date.now()-t)+"ms")),TS.utility.makeSureAllExternalLinksAreRefererSafe(e)},sortTable:function(e,t,n,i,r){function a(e,t){return $(e).children("td").eq(t).attr("data-sort-val")}n="desc"===n?"desc":"asc",r="desc"===r?"desc":"asc";var s,o=e.find("tr:gt(0)").toArray().sort((s=t,function(e,t){var o=a(e,s),l=a(t,s);return $.isNumeric(o)&&$.isNumeric(l)?o==l&&i?(o=a(e,i),l=a(t,i),$.isNumeric(o)&&$.isNumeric(l)?r!=n?l-o:o-l:r!=n?TS.interop.i18n.sorter(l,o):TS.interop.i18n.sorter(o,l)):o-l:TS.interop.i18n.sorter(o,l)}));"desc"===n&&(o=o.reverse());for(var l=0;l<o.length;l+=1)e.append(o[l])},getPercSmartly:function(e,t){if(!e||!t)return"0%";var n=e/t*100;return 100!=n&&100==Math.round(n)?"99%":n<.7?"<1%":Math.round(n)+"%"},isCursorWithinTBTs:function(e){var t=TS.utility.contenteditable.cursorPosition(e),n=TS.utility.contenteditable.value(e).substr(0,t.end).match(/```/g);return!!n&&!!(n.length%2)},hex2rgb:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:void 0},rgb2hex:function(e){if(/^#[0-9A-F]{6}$/i.test(e))return e;var t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(t||(t=e.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*\.?\d+)\)$/)),t)return"#"+n(t[1])+n(t[2])+n(t[3]);function n(e){return("0"+parseInt(e,10).toString(16)).slice(-2)}},setImmediate:function(e){l(e)},immediateDebounce:function(e){var t=!1;return function(){if(!t){var n=this,i=arguments;t=!0,l((function(){t=!1,e.apply(n,i)}))}}},debounce:function(e,t){var n;return function(){var i=this,r=arguments;clearTimeout(n),n=setTimeout((function(){e.apply(i,r)}),t)}},debounceWithPromise:function(e,t){var n;return function(){var i=this,r=arguments;return n&&n.cancel(),n=new Promise((function(e){setTimeout(e,t)})).then((function(){return e.apply(i,r)}))}},throttleFunc:function(e,t,n){var i={},r=function n(){var r=Array.prototype.slice.apply(arguments),a=_.some(r,_.isObject);a&&TS.error("You're passing non-scalar arguments to a function throttled with TS.utility.throttleFunc; it will likely not work as you want");var s="f-"+r.join("-");if(i[s]&&i[s].context!==this)throw new Error("Cannot use this function with different `this` contexts across different calls "+this+" "+i[s].context);i[s]=i[s]||{requested:Date.now(),timeout:0,context:this},i[s].timeout||n.always_wait?i[s].requested=Date.now():e.apply(i[s].context,r),i[s].timeout||(i[s].timeout=setTimeout((function n(){var a=Date.now()-i[s].requested;a>=t?(e.apply(i[s].context,r),delete i[s]):i[s].timeout=setTimeout(n,t-a)}),t))};return r.always_wait=!!n,r},looksLikeKeyboardShortcut:function(e){if(!(e.ctrlKey||e.altKey||e.metaKey))return!1;if(e.keyCode===TS.utility.keymap.alt||e.keyCode===TS.utility.keymap.ctrl||e.keyCode===TS.utility.keymap.cmd_ff||e.keyCode===TS.utility.keymap.cmd_other||e.keyCode===TS.utility.keymap.cmd_right)return!1;var t=String.fromCharCode(e.keyCode);return/^(\w|[$-/:-?{-~!"^_`[\]])$/i.test(t),!0},isForwardDeleteKey:function(e){return e.keyCode===TS.utility.keymap.delete||!(!TS.model.is_mac||!e.ctrlKey||"d"!==e.key)},throttle:(e={delay:200,timer_group:"generic"},t={timers:{},queues:{}},{method:function(n,i,r){if(!n)return!1;i=i||e.timer_group,t.timers[i]||(r=r||e.delay,t.timers[i]=window.setTimeout((function(){!function(e){var n,i;if(t.timers[e]){if(t.queues[e])for(n=0,i=t.queues[e].length;n<i;n+=1)t.queues[e][n]&&t.queues[e][n]();t.queues[e]=null,t.timers[e]=null}}(i)}),r)),t.queues[i]||(t.queues[i]=[]),t.queues[i].indexOf?-1===t.queues[i].indexOf(n)&&t.queues[i].push(n):t.queues[i].push(n)}}),getImgProxyURL:function(e,t,n){return TS.utility.getImgProxyURLWithOptions(e,{width:t,height:n})},getImgProxyURLWithOptions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?TS.interop.utility.getImgProxyUrl({url:e,height:t.height,width:t.width,rotate:t.rotate,renderSvg:t.render_svg,stopAnimations:t.stop_animations,emoji:t.emoji,convertIco:t.convert_ico}):e},rAF:function(){var e,t=["ms","moz","webkit","o"],n=window.requestAnimationFrame;for(e=0;e<t.length&&!n;e+=1)n=window[t[e]+"RequestAnimationFrame"];if(!n){var i=0;return function(e){var t=Date.now(),n=Math.max(0,16-(t-i)),r=window.setTimeout((function(){e(t+n)}),n);return i=t+n,r}}return function(e){return n.call(window,e)}}(),cancelRAF:function(){var e,t=["ms","moz","webkit","o"],n=window.cancelAnimationFrame;for(e=0;e<t.length&&!n;e+=1)n=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];return n?function(e){n.call(window,e)}:function(e){clearTimeout(e)}}(),startAnimation:function(e){return u.subscribe(e)},getLocationHashString:function(e){var t=(e=e||document).location.hash;return t&&t.length?t.substr(1):t},getYoutubeIdFromURL:function(e){return void 0!==(e=e.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/))[2]?e[2].split(/[^0-9a-z_-]/i)[0]:e},loadUrlInWindowIfOnline:function(e,t){t=t||document;var n=function(n){n?($("body").addClass("hidden"),t.location=e):TS.generic_dialog.alert(TS.interop.i18n.t("You can\u2019t perform that action because you are not online :(","utility")())};return TS.interop.api.call("api.test",{}).then((function(e){var t=e.data,i=e.args,r=e.request_id;return n(!0),{data:t,args:i,request_id:r}})).catch((function(e){var t=e.data,i=e.args,r=e.request_id;return n(!1),{data:t,args:i,request_id:r}}))},externalURLsNeedRedirecting:function(){return!(!TS.model.team||!TS.prefs.getTeamPref("hide_referers")||TS.model.is_our_app)},swapInRedirUrlForIframe:function(e,t){if(!(t=t||TS.interop.utility.getRefererPolicy()))return e;if(!t.iframe_redirect_type)return e;var n=$(e),i=n.attr("src");return i?("1"==TS.qs_args.test_iframe_referers&&(i="https://"+document.location.host+"/referertester.html?"+Date.now()),i="https://"+TS.boot_data.redir_domain+"/link?v="+t.iframe_redirect_type+"&url="+encodeURIComponent(i),n.attr("src",i),e=n[0].outerHTML,"1"==TS.qs_args.test_iframe_referers&&TS.info("html with redir:"+e),e):e},setCssFromHeightAndWidthAttrs:function(e){if(e){var t=$(e);return t.css({height:t.attr("height"),width:t.attr("width")}),t[0].outerHTML}},isArrowKey:function(e){var t=TS.utility.keymap;return e==t.down||(e==t.up||(e==t.right||e==t.left))},isPageKey:function(e){var t=TS.utility.keymap;return e==t.pageup||(e==t.pagedown||(e==t.home||e==t.end))},isNumericKey:function(e){return e>=48&&e<=57},getFileIDFromURL:function(e){return TS.interop.url.getFileIdFromUrlWithState(TS.redux.getState(),e)},getMemberIdFromURL:function(e){if(!e)return null;var t;if(0===(e=TS.utility.normalizeDevHost(String(e))).indexOf("/team/"))t=e.split("/team/");else if(!(t=TS.utility.getPathFromSlackUrl(e))||t.length<2||"team"!==t[0])return null;var n=t[1];if(!n)return null;var i=TS.interop.members.getMemberById(n)||!TS.boot_data.feature_deprecate_get_member_by_name&&TS.interop.members.getMemberByName(n);return i?i.id:null},normalizeDevHost:function(e){return e.replace(/\.dev[0-9]*.slack.com/i,".dev.slack.com").replace(/\.staging.slack.com/i,".slack.com").replace(/\.staging-master.slack.com/i,".slack.com").replace(/\.staging-release.slack.com/i,".slack.com")},platformSupportsHtmlNotifications:function(){return!(!window.desktop||!window.desktop.app)&&(window.desktop.app.canShowHtmlNotifications?window.desktop.app.canShowHtmlNotifications():!1!==window.desktop.app.willUseHwAcceleration)},findAllTeamEmojiInStr:function(e,t){var n=[];if(!(e=$.trim(e)))return n;n=e.match(TS.emoji.legacyGetColonsRx())||n;var i=[];return n=(n=n.filter((function(e){return!!TS.emoji.isValidName(e)||(e.split("::").forEach((function(e){var t=TS.emoji.isValidName(e);t&&i.push(":"+t+":")})),!1)}))).concat(i),t&&(n=_.uniq(n)),TS.dir(248,n),n},areSimpleObjectsEqual:function e(t,n){if(t===n)return!0;if(void 0===t&&n)return!1;if(void 0===n&&t)return!1;if(i(t)!==i(n))return!1;if(null===t&&n)return!1;if(null===n&&t)return!1;if(t.length!==n.length)return!1;var r;for(r in n){if(void 0===t[r]&&void 0!==n[r])return!1;if(n[r])switch(i(n[r])){case"object":if(!e(t[r],n[r]))return!1;break;case"function":if(String(n[r])!=String(t[r]))return!1;break;default:if(n[r]!==t[r])return!1}else if(t[r])return!1}for(r in t)if(void 0===n[r]&&void 0!==t[r])return!1;return!0},deepDiffObjects:function(e,t){if(_.isEmpty(e))return{};if(_.isEmpty(t))return e;var n={};return _.each(e,(function(e,r){var a=t[r];if(a!==e)if(i(e)!==i(a))n[r]=e;else if(_.isArray(e))n[r]=_.difference(e,a);else if(_.isPlainObject(e)){var s=TS.utility.deepDiffObjects(e,a);_.isEmpty(s)||(n[r]=s)}else n[r]=e})),n},appendLogToUrlWithLimit:function(e,t){if(!e)return e;if(e+=-1==e.indexOf("?")?"?":"&",!t)return e;var n=2e3-e.length;return e+t.substr(0,n)},makeWebWorker:function(e,t){var n=URL.createObjectURL(new Blob(["(",e,")()"],{type:"application/javascript"})),i=new Worker(n);return URL.revokeObjectURL(n),i.onmessage=t,i},strGetWordCount:function(e){return e.trim().split(/\s+/).length},truncateToNearestWordBoundary:function(e,t){if(e.string&&(e=e.string),e.length<=t)return e;var n=e.substring(0,t),i=n.lastIndexOf(" ");return i>0&&i>t-15?n.substring(0,i)+"\u2026":n.substring(0,n.length-1)+"\u2026"},truncateAndEscape:function(e,t){return e.length<=t?_.escape(e):_.escape(e.substring(0,t-1))+"&hellip;"},truncateHTML:function(){var e;try{window.DOMParser&&((e=new DOMParser).parseFromString("","text/html")||(e=null))}catch(t){e=null}function t(e,n,i){var r=_.toArray(n.childNodes);return _.forEach(r,(function(r){if(e>=i)n.removeChild(r);else if(r.nodeType===Node.TEXT_NODE){var a=r.textContent;e+a.length>i?(r.textContent=a.substring(0,i-e),e+=i-e):e+=r.textContent.length}else e=t(e,r,i)})),e}return function(n,i){try{var r;if(e)r=e.parseFromString(n,"text/html").body;else r=jQuery.parseHTML("<div>"+n+"</div>")[0];if(t(0,r,i)>=i){var a=document.createTextNode("\u2026");r.appendChild(a)}return r.innerHTML}catch(e){return TS.error(e),n}}}(),isPostClickEventSafe:function(e,t){if(e.target){var n=$(e.target).closest("[href]");if(!n[0])return!0;if(!n.closest(".post_body").length)return!0;var i=n[0].protocol;if(i&&!1===/^https?:$/.test(i))return TS.warn("not following bad link from a post preview"),e.preventDefault(),!1;if(n.data("original-href")){TS.warn("not following possibly spoofed link from a post preview"),e.preventDefault();var r=n.data("referer-original-href")||n.attr("href");return t||o(n.data("original-href"),n.attr("href"),r),!1}}return!0},getCachedScript:function(e,t){return t=$.extend(t||{},{dataType:"script",cache:!0,url:e}),jQuery.ajax(t)},disableElement:function(e,t){(e=$(e)).attr("disabled",t),e.attr("aria-disabled",t)},enableFeatureForUser:function(e){return e<0||e>100?(TS.warn("TS.utility.enableFeatureForUser() expects a number between 0 and 100"),!1):_.random(0,100)<e},roundToThree:function(e){return+(Math.round(e+"e+3")+"e-3")},convertBytesToMegabytes:function(e){return e/1024/1024},convertKilobytesToMegabytes:function(e){return e/1024},queryIsMaybeSelf:function(e){return"me"===(e=_.toLower(e))||"you"===e||e===a||e===s},openAuthenticatedInBrowser:function(e){if(TS.interop.desktop.isDesktop){var t=TS.boot_data.team_url+"web/open"+e;TS.interop.desktop.openAuthenticatedInBrowser(t)}else window.open(e)},getFontDescriptorForElement:function(e){var t=e instanceof jQuery?e:$(e);return[t.css("font-style"),t.css("font-weight"),t.css("font-size"),t.css("font-family")].join(" ")},measureTextWidth:function(e,t){if(!e)return 0;this._measure_text_width_canvas=this._measure_text_width_canvas||document.createElement("canvas");var n=this._measure_text_width_canvas.getContext("2d");return n.font=t,n.measureText(e).width},exampleEmailAddress:function(e){return"you"===e?TS.interop.i18n.t("you@{example_com}","utility")({example_com:"example.com"}):TS.interop.i18n.t("name@{example_com}","utility")({example_com:"example.com"})},exampleWebAddress:function(){return"example.com"},test:function(){var e={};return Object.defineProperty(e,"_files_url",{get:function(){return g},set:function(e){g=e}}),Object.defineProperty(e,"_team_url",{get:function(){return S},set:function(e){S=e}}),e}});var o=function(e,t,n){var i="",r="";i+='<ts-icon class="ts_icon_warning yolk_orange small_right_margin"></ts-icon> ',i+=TS.interop.i18n.t("Caution: Tricky Link","utility")(),r+="<p>",r+='  <span class="inline_block">'+TS.interop.i18n.t("The link you clicked (<strong>{url}</strong>) is tricky.","utility")({url:TS.interop.i18n.safeString(_.escape(n))})+"</span>",r+='  <span class="inline_block">'+TS.interop.i18n.t("It has been formatted to look like another web address (<strong>{url}</strong>).","utility")({url:TS.interop.i18n.safeString(_.escape(e))})+"</span>",r+="</p>",r+="<p>"+TS.interop.i18n.t("Are you sure you want to follow it?","utility")()+"</p>",TS.generic_dialog.start({title:i,body:r,show_cancel_button:!1,show_secondary_go_button:!0,secondary_go_button_text:TS.interop.i18n.t("Let\u2019s risk it","utility")(),secondary_go_button_class:"btn_outline",onSecondaryGo:function(){window.open(t)},go_button_text:TS.interop.i18n.t("Take me back to safety","utility")(),esc_for_ok:!0,enter_always_gos:!0})},l=window.setImmediate;if(!l)if(window.MutationObserver){var d=document.createElement("div"),c=[];new MutationObserver((function(){var e=c.slice();c.length=0,e.forEach((function(e){e()}))})).observe(d,{attributes:!0}),l=function(e){c.length||d.setAttribute("yes","no"),c.push(e)}}else l=function(e){setTimeout(e,0)};var u=function(){var e=!1,t=[];function n(){e&&(t.forEach((function(e){e()})),TS.utility.rAF(n))}return{subscribe:function(i){var r={start:function(){t.push(i),e||(e=!0,TS.utility.rAF(n))},stop:function(){t.splice(t.indexOf(i),1),t.length||(e=!1)}};return r.start(),r},subscribers:t,isRunning:function(){return e}}}(),m=function(e){var t=TS.utility.getPathFromSlackUrl(e);if(t&&t.length>1){var n={messages:!0,archives:!0}[t[0]],i=decodeURIComponent(t[1]);n&&i&&TS.interop.utility.looksLikeChannelId(i)&&!TS.interop.channels.hasChannelWithId(i)&&TS.redux.channels.getEntityById(i)}},p=/([^.:/]+)(?:\.[^.]+)?\.slack\.com\/((?:messages|archives|unreads|threads|team|page)\/)/,f=/(<a\b[^>]*)(>)/gi,h=365,g=null,S=null}()},ae6w:function(e,t,n){var i=n("J4zp");!function(){TS.registerModule("tabcomplete.members",{type:"members",getMatch:function(e,t,n,i){var r,a;if(e.replace(/(^|\n|.)?((?:@|\uFF20)([^\n@\uFF20]*))$/i,(function(e,t,n,s,o){(""===TS.interop.texty.trimAllowedMatchPrefix(t)||i&&i.allowed_preceding_symbols&&-1!==i.allowed_preceding_symbols.indexOf(t))&&(s.length&&s.match(/^\s/)||(t&&(o+=t.length),r=n,a=o))})),!r&&t){var s=_.last(/(^|\s)([^\s\n@\uFF20]+)$/.exec(e));s=TS.interop.texty.trimAllowedMatchPrefix(s,{trimCJK:!1}),h(s,t)&&(r=s,a=e.length-s.length)}if(r){return r.split(" ").length-1>4?null:{match:r,index:a}}},shouldDisplayResults:function(e,t){return!(!e||_.isEmpty(t))},getResultAtIndex:function(e,t){if(e&&_.isNumber(t))return TS.log(90211,"Getting result at index: "+t+"; User: "+(e[t]?e[t].id:"")),e[t]},getInsertData:function(e){if(e){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"member"}}});var t=TS.interop.texty.getDisplayTextForSearchResult(e);TS.log(90211,"Getting insert data for result: "+e.id);var n=TS.interop.texty.shouldHighlightMention(e.id,t,TS.interop.prefs.getHighlightWords());return{text:t,format:{slackmention:{id:e.id,label:t,mention:n}}}}},search:function(e,i,r){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_typing",trigger:"member"}}});var a,s=S(e,i.isUserSolicited),d=g(s);i.no_model_ob||(a=i.model_ob||TS.shared.legacyGetActiveModelOb());var p=u(a,i.no_model_ob),f=TS.interop.userGroups.getActiveUserGroups().filter((function(e){return!TS.interop.userGroups.isUserGroupFromAnotherTeam(e.id)})),h=[];a&&i.enableBroadcastKeywords&&(h=TS.interop.broadcast_keywords.getBroadcastKeywordsForUser(a.id));var b=o(a,e,{members:p,usergroups:f,broadcast_keywords:h},i.include_deleted);if(d((function(){r(null,b)})),a){var y=_(p).map("id").without("USLACKBOT").value();if(y.length>t){var w=TS.boot_data.page_needs_enterprise?"W":"U",k=TS.ui.frecency.getMostCommonWithPrefix(w,t),x=_.map(k,"id"),C=_.intersection(y,x),M=_.difference(y,C);y=C.concat(M.slice(0,t-C.length))}TS.log(1990,"Ensuring we have membership for "+y.length+" users in "+a.id+": "+y),TS.interop.membership.ensureChannelMembershipIsKnownForUsers(a.id,y).then((function(e){TS.log(1990,"Got membership for "+y.length+" users in "+a.id+"; any fetches required? "+e),e&&d((function(){r(null,b)}))}))}if(TS.model.team&&"T025LDE84"===TS.model.team.id&&e&&0===e.indexOf("@helen")){var I=b.map((function(e){return e&&e.id}));if(-1===I.indexOf("U7T4Z7K8A")){var E=function(e){return e.id?{id:e.id,is_stranger:e.is_stranger,deleted:e.deleted,name:e.name.match(/helen/i),_display_name_lc:e._display_name_lc.match(/helen/i),_real_name_lc:e._real_name_lc.match(/helen/i)}:"NOT FOUND"},A=_.find(TS.model.members,(function(e){return e&&"U7T4Z7K8A"===e.id}))||{},P=_.filter(TS.model.members,(function(e){return e&&(e.name.match(/helen/i)||e._display_name_lc.match(/helen/i)||e._real_name_lc.match(/helen/i))}))||{},O=_.find(TS.members.getActiveMembersWithSelfAndSlackbot(),(function(e){return e&&"U7T4Z7K8A"===e.id}))||{},F=_.filter(TS.members.getActiveMembersWithSelfAndSlackbot(),(function(e){return e&&(e.name.match(/helen/i)||e._display_name_lc.match(/helen/i)||e._real_name_lc.match(/helen/i))}))||{},j=_.find(p,(function(e){return e&&"U7T4Z7K8A"===e.id}))||{},$=TS.shared.legacyGetActiveModelOb();TS.interop.utility.getLogger({getState:TS.redux.getState}).error({members:I.sort(),channel_id:$&&$.id,model_u7t:E(A),model_h:_.map(P,E),getter_u7t:E(O),getter_h:_.map(F,E),local_u7t:E(j)},"tabcomplete_missing_member TS.tabcomplete.members.search local_results",{subtype:"T025LDE84"})}}if(c(e,p,i)){var H={include_deleted:i.include_deleted,limit:n};l(a,e,H).then((function(t){var n=t.members;f=_.unionBy(f,t.usergroups,"id");var s=_(p).concat(n).compact().uniqBy("id").value();TS.boot_data.page_needs_enterprise&&(s=m(s));var l=o(a,e,{members:s,usergroups:f,broadcast_keywords:h},i.include_deleted),c=[];if(a){var u=_.filter(l,"is_usergroup");c=_.reduce(u,(function(e,t){var n=v(t.id,a.id);return n.isResolved()||e.push(n),e}),[]),TS.interop.membership.ensureChannelMembershipIsKnownForUsers(a.id,_.map(l,"id"))}return c.length?Promise.all(c).then((function(){d((function(){r(null,l)}))})):T(b,l)||d((function(){r(null,l)})),null}))}},render:function(e,t,n){"@"!==e[0]&&"\uff20"!==e[0]&&(e="@"+e);var i,r=TS.templates.tabcomplete_member_header({text:e});n.no_model_ob||(i=n.model_ob||TS.shared.legacyGetActiveModelOb());var a=t.map((function(t){return t.is_broadcast_keyword?t:t.is_usergroup||t.is_subteam?f(i,t):p(i,t,e)})),s=TS.templates.tabcomplete_member_results({results:a,is_client:!1});return TS.tabcomplete.renderMenu(r,s)},onSelect:function(e,t){e&&(t||(t=""),t=t.replace(/^@/,""),TS.ui.frecency.record(e,t))},onSelectedIndexChange:function(e){TS.log(90211,"Selected index changed to: "+e),TS.tabcomplete.onSelectedIndexChange(e)},test:function(){var t={IGNORED_SEARCH_TERMS:r,MIN_UNPREFIXED_MATCH_LENGTH:a,getAsyncResults:l};return Object.defineProperty(t,"IGNORED_SEARCH_TERMS",{get:function(){return r},set:function(e){r=e}}),Object.defineProperty(t,"_cached_fetch_remote_user_groups",{get:function(){return e},set:function(t){e=t}}),Object.defineProperty(t,"_shouldDoAsyncSearch",{get:function(){return c},set:function(e){c=e}}),Object.defineProperty(t,"_getLocalMembers",{get:function(){return u},set:function(e){u=e}}),Object.defineProperty(t,"_sortResults",{get:function(){return o},set:function(e){o=e}}),Object.defineProperty(t,"SEARCH_DELAY_MS",{get:function(){return s},set:function(e){s=e}}),Object.defineProperty(t,"_ensureUserGroupMembersInModelObNumIsKnown",{get:function(){return v},set:function(e){v=e}}),Object.defineProperty(t,"_getUserGroupMembersNotInModelObCount",{get:function(){return y},set:function(e){y=e}}),Object.defineProperty(t,"_fetchUserGroups",{get:function(){return d},set:function(e){d=e}}),t}});var e,t=100,n=25,r=["the","and"],a=3,s=500,o=function(e,t,i,r){var a={allow_empty_query:!0,frecency:!0,limit:n,prefer_exact_match:!0},s=e&&!e.is_im;s&&(a.model_ob=e,a.prefer_channel_members=s);var o=t.replace(/^@/,""),l=_.trimEnd(o),d=TS.sorter.search(l,i,a),c=_.map(d,"model_ob");if(r&&(c=_.sortBy(c,(function(e){return e.deleted}))),i&&i.broadcast_keywords){var u=_.findIndex(c,(function(e){return e.is_broadcast_keyword&&e.name===l}));if(u>0){var m=c[u];c.splice(u,1),c.unshift(m)}}return c},l=function(e,t,n){var r={query:t.replace(/^@/,""),max_api_results:n.limit,include_deleted:n.include_deleted,include_org:!0,include_slackbot:!0,include_self:!0,full_profile_filter:!1};n.include_deleted||(r.limit_by_model_relevancy=e),e&&!e.is_im&&(r.determine_membership_for_channel=e.id);var a=[d(t),TS.members.promiseToSearchMembers(r).then((function(e){return e&&e.items&&e.items.length?e.items:[]}))];return Promise.all(a).then((function(e){var t=i(e,2);return{usergroups:t[0]||[],members:t[1]}}))};function d(e){if(TS.model.user.is_restricted)return Promise.resolve([]);var t=e.replace(/^(@|@)/,"");return TS.searcher.search(t,{usergroups:{include_deleted:!1,include_from_another_team:!1},tiered:!0,sort:{prefer_exact_match:!0,frecency:!0,allow_empty_query:!0},limit:25}).then((function(e){return _.map(e,"model_ob")||[]}))}var c=function(e,t,n){return 0!==e.indexOf("@")?(-1!==r.indexOf(e)||e.length<a||n.member_prefix_required,!1):!t||!t.length||1!==t.length||"@"+t[0].name!==e},u=function(e,t){var n=TS.members.getActiveMembersWithSelfAndSlackbot();return TS.boot_data.page_needs_enterprise&&(n=m(n)),t||(n=n.filter((function(t){return TS.utility.members.isMemberRelevantToModel(t,e)}))),n},m=function(e){return e.filter((function(e){return!e.enterprise_user||!e.enterprise_user.teams||e.enterprise_user.teams.length}))},p=function(e,t){var n,i,r=[],a=[];n=TS.interop.members.getPrefCompliantMemberName(t,!1,!1),i=TS.interop.members.getMemberSecondaryName(t),r.push("primary_name"),a.push("secondary_name");var s,o,l,d,c=e&&(!e.is_im||t.is_app_user);if(c&&(o=(l=TS.interop.membership.getCachedChannelMembershipInfoForUser(e.id,t.id)).is_known)&&(s=!l.is_member),TS.interop.members.isExternal(t)){var u=TS.teams.getTeamById(t.team_id);u&&(d=TS.interop.rules.teams.getTeamDisplayName(u))}return{is_member:!0,member:t,primary_name_classes:r.join(" "),secondary_name_classes:a.join(" "),show_channel_membership:c,member_does_not_belong_to_channel:s,secondary_name:i,primary_name:n,membership_status_is_known:o,team_name:d}},f=function(e,t){var n=0;return e&&(n=y(t.id,e.id)),{description:t.description||t.name,is_usergroup:!0,members_not_in_channel:n,usergroup:t}},h=function(e,t){return!!e&&(!!t||!(e.length<a)&&!_.includes(r,e.toLowerCase()))},g=function(e){var t=Date.now()+e;return function(e){var n=Date.now(),i=Math.max(0,t-n);setTimeout(e,i)}},S=function(e,t){return 0===e.indexOf("@")||t?0:s},T=function(e,t){return!t&&!e||!(!t||!e)&&(e.length===t.length&&_.isEqualWith(e,t,(function(e,t){return e.id===t.id})))},b={},v=function(e,t){var n=TS.interop.userGroups.getUserGroupById(e),i=TS.interop.channels.getPublicChannelById(t,false)||TS.interop.channels.getGroupById(t,false);return n&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(n)&&i?_.isUndefined(n.users)?(b[e]||(b[e]=TS.interop.userGroups.promiseToGetUserGroupMembers(e).then((function(e){if(e&&e.users)return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(i.id,e.users)})).finally((function(){delete b[e]}))),b[e]):TS.interop.membership.ensureChannelMembershipIsKnownForUsers(i.id,n.users):Promise.resolve()},y=function(e,t){var n=TS.interop.userGroups.getUserGroupById(e),i=_.get(n,"users.length"),r=TS.interop.channels.getPublicChannelById(t,false)||TS.interop.channels.getGroupById(t,false);return n&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(n)&&r?_.isUndefined(n.users)||n.users.some((function(e){return!TS.interop.redux.models.membership.isMembershipKnownForUser(TS.redux.getState(),r.id,e)}))?0:i-n.users.filter((function(e){var t=TS.interop.membership.getCachedChannelMembershipInfoForUser(r.id,e);return t.is_known&&t.is_member})).length:0}}()},b1eP:function(e,t,n){var i=n("lSNA");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(){function e(e,t){var n=function(e){var t=TS.cmd_handlers.getAvailableUserCmds(e);return _.map(t,(function(e,t){return _.assign({name:t},e)}))}(t),i=TS.interop.i18n.deburr(e.toLowerCase());(i=TS.tabcomplete.trimTrailingCharacterModifier(i))&&(n=n.filter((function(e){if(0===(e.normalized||e.name).indexOf(i))return!0;if(e.canonical_name&&0===e.canonical_name.indexOf(i))return!0;var t=e.localized_aliases||e.aliases;return!!t&&t.some((function(e){return 0===TS.interop.i18n.deburr(e).indexOf(i)}))})));var r,a=_.map(n,"name"),s=TS.cmd_handlers.sortNames(a).map((function(e){return _.assign({name:e},TS.cmd_handlers[e])})),o=TS.cmd_handlers.groupCmdsByType(s);return r=0,o.forEach((function(e){e.cmds=e.cmds.map((function(e){var t=_.assign({index:r},e);return r+=1,t}))})),o}TS.registerModule("tabcomplete.commands",{type:"commands",getMatch:function(e,t,n){var i,r;if(_.isString(e)&&((!_.isNumber(n)||0===n)&&(e.startsWith("\uff0f")&&(e="/"+e.substring(1)),"/"===e&&TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autcomplete_start",trigger:"slash_command"}}}),TS.interop.i18n.deburr(e).replace(/^(\/\S*)$/i,(function(t,n,a){r=a,i=e.substr(r,n.length)})),i)))return{match:i,index:r}},getResultAtIndex:function(e,t){if(e&&_.isNumber(t)){var n=_.flatMap(e,"cmds");return _.find(n,{index:t})}},getInsertData:function(e){if(e)return TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autcomplete_select",trigger:"slash_command"}}}),"last"===e.type?TS.interop.texty.convertContentsStringToContents(e.cmd,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale}):{text:e.name}},getNumResults:function(e){return _.reduce(e,(function(e,t){return e+t.cmds.length}),0)},search:function(t,n,i){i(null,e(t,n));var r=TS.cmd_handlers.getCmdAppUserIds();r.length&&TS.interop.membership.ensureChannelMembershipIsKnownForUsers(TS.model.active_cid,r).then((function(r){r&&i(null,e(t,n))}))},render:function(e,t){TS.interop.rules.channels.isExternallySharedChannel(TS.shared.legacyGetActiveModelOb())&&t[0]&&t[0].cmds&&(t[0].cmds=t[0].cmds.map((function(e){switch(e.name){case"/topic":return a(a({},e),{},{desc:TS.interop.i18n.t("Set the channel topic for your workspace","cmd_handlers")()});case"/rename":return a(a({},e),{},{desc:TS.interop.i18n.t("Rename this channel for your workspace","cmd_handlers")()});default:return e}})));var n=TS.templates.tabcomplete_command_header({text:e}),i=TS.templates.tabcomplete_command_results({results:t});return TS.tabcomplete.renderMenu(n,i)},onSelectedIndexChange:function(e){TS.tabcomplete.onSelectedIndexChange(e)},onSelect:function(e,t){"client"===e.type&&TS.interop.clog.track("BUILTIN_CHAT_COMMAND_AUTOCOMPLETE",{locale:TS.interop.i18n.locale,search_term:t,slash_command_canonical_name:e.canonical_name||e.name,slash_command_name:e.name})}})}()},bFS3:function(e,t){TS.registerModule("inline_attachments",{no_scrolling:!1,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,shouldExpand:function(e,t){return!!TS.model.expandable_state["attach_"+e+t.from_url]||!1!==TS.model.expandable_state["attach_"+e+t.from_url]},legacyShouldShow:function(e,t){if(e.is_share)return!0;if(t&&"reply_broadcast"===t.subtype)return!0;if("twitter"===e.service_name&&"bot_message"===t.subtype)return!0;if(!e.from_url)return!0;if(t.standalone_attachment)return!0;if(t&&t.text&&-1==t.text.indexOf(e.from_url)){if(!TS.model.ampersands_are_inconsistent_in_from_urls)return!0;if(-1==t.text.indexOf(e.from_url.replace(/&/g,"&amp;")))return!0}if(TS.prefs.getPref("expand_inline_imgs")){if(e.audio_html)return!0;if(e.other_html)return!0;if(e.video_html)return!0;if(e.image_url)return!0;if(e.service_name&&"twitter"===e.service_name.toString().toLowerCase())return!0}return!!TS.prefs.getPref("expand_non_media_attachments")},expandAllInCurrent:function(){TS.inline_attachments.no_scrolling=!0,$(".msg_inline_attachment_expander").trigger("click"),TS.inline_attachments.no_scrolling=!1},collapseAllInCurrent:function(){$(".msg_inline_attachment_collapser").trigger("click")},expand:function(e,t){TS.model.expandable_state["attach_"+e+t]=!0,TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(e),i=$(n);if(i.length){var r=function(){return $(this).data("real-src")==t},a=i.find(".inline_attachment").filter(r);a.removeClass("hidden"),i.find(".msg_inline_attachment_expander").filter(r).addClass("hidden"),i.find(".msg_inline_attachment_collapser").filter(r).removeClass("hidden"),a.css("opacity",0).stop().animate({opacity:1},300),TS.inline_attachments.no_scrolling||a.scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"}),TS.inline_attachments.expand_sig.dispatch(e)}},collapse:function(e,t){TS.model.expandable_state["attach_"+e+t]=!1,TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(e),i=$(n);if(i.length){var r=function(){return $(this).data("real-src")==t},a=i.find(".inline_attachment").filter(r);a.length||(a=i.find(".msg_inline_attachment_holder").filter(r)),a.css("visibility","hidden"),i.find(".msg_inline_attachment_expander").filter(r).removeClass("hidden"),i.find(".msg_inline_attachment_collapser").filter(r).addClass("hidden"),TS.inline_attachments.collapse_sig.dispatch(e),setTimeout((function(){a.addClass("hidden"),a.css("visibility","visible")}),200)}},checkForInlineAttachmentClick:function(e){if(e.target){var t,n,i=$(e.target),r=i.closest(".message");n=r.data("ts"),t=r.attr("id");var a=i.closest(".msg_inline_attachment_expander");if(a.length){if(e.preventDefault(),!t)return;TS.inline_attachments.expand(t,a.data("real-src"))}var s=i.closest(".msg_inline_attachment_collapser");if(s.length){if(e.preventDefault(),!t)return;TS.inline_attachments.collapse(t,s.data("real-src"))}var o=i.closest(".rest_text_expander");if(o.length){e.preventDefault();var l,d=o.parent().find(".short_text"),c=o.parent().find(".more_text");if(o.data("show-text"))c.length&&(c.addClass("hidden"),l=o.find("a span"),o.data("hide-text",l.text()),l.text(o.data("show-text")),o.data("show-text",""),o.find("a .ts_icon").removeClass("ts_icon_caret_down").addClass("ts_icon_caret_right"));else{var u=d.attr("data-all-text");u&&(d.html(u),d.data("all-text","")),c.length&&c.removeClass("hidden"),c.length&&o.data("hide-text")?(l=o.find("a span"),o.data("show-text",l.text()),l.text(o.data("hide-text")),o.data("hide-text",""),o.find("a .ts_icon").removeClass("ts_icon_caret_right").addClass("ts_icon_caret_down")):o.css("display","none")}d.css("opacity",0).transition({opacity:1},300),TS.inline_attachments.rest_texts_expanded[o.attr("id")]=!0}var _=i.closest(".delete_attachment_link");if(_.length){e.preventDefault();var m=_.data("attachment-id").toString(),p=r.attr("data-model-ob-id");TS.inline_attachments.promptForDeletingAttachment(p,n,m)}}},promptForDeletingAttachment:function(e,t,n){var i=TS.redux.channels.getEntityById(e);if(i)if(n){var r=i.id,a=TS.utility.msgs.findMsg(t,e);if(a){var s="";if(TS.model.user.is_admin){var o=_.find(a.attachments,{id:n});if(o&&o.from_url){var l=TS.inline_attachments.makeBlackListSelect(o.from_url);s='<p class="large_left_margin '+(l&&"no_bottom_margin")+'">',s+='<label class="checkbox normal" style="font-size: 16px;">',s+='<input id="attachment_blacklist_cb" type="checkbox" class="small_right_margin" />',s+=TS.interop.i18n.t("Disable future attachments from this website?","inline_attachments")(),s+="</label>",l&&(s+=l),s+="</p>"}}var d='<p class="'+(s?"small_bottom_margin":"")+'">'+TS.interop.i18n.t("Are you sure you wish to remove this attachment from the message?","inline_attachments")()+"</p>"+s;TS.generic_dialog.start({title:TS.interop.i18n.t("Remove attachment","inline_attachments")(),body:d,go_button_text:TS.interop.i18n.t("Yes, remove","inline_attachments")(),onShow:function(){$("#attachment_blacklist_cb").bind("change",(function(){$("#attachment_blacklist_cb").prop("checked")?$("#attachment_blacklist_select").prop("disabled",!1):$("#attachment_blacklist_select").prop("disabled",!0)}))},onGo:function(){if(a.is_ephemeral)a.attachments=TS.inline_attachments.removeAttachmentById(a.attachments,n),TS.utility.msgs.replaceMsg(i,a,!1,!0);else{var e=!!$("#attachment_blacklist_cb").prop("checked"),s=e?$("#attachment_blacklist_select").val():"none",o=e?$("#attachment_blacklist_select").find(":selected").data("url"):"",l={channel:r,ts:t,attachment:n,blacklist_type:s,blacklist_url:o};TS.dir(0,l);var d=function(e){if(e)TS.web&&(a.attachments=TS.inline_attachments.removeAttachmentById(a.attachments,n),TS.utility.msgs.replaceMsg(i,a));else{var t={title:TS.interop.i18n.t("Couldn't remove attachment","inline_attachments")(),body:TS.interop.i18n.t("Only Org Admins can remove attachments from a shared channel.","inline_attachments")(),cancel_button_text:TS.interop.i18n.t("Close","inline_attachments")(),go_button_text:TS.interop.i18n.t("View {orgName} admins","inline_attachments")({orgName:TS.model.team.name}),onGo:function(){}};TS.generic_dialog.start(t)}};TS.interop.api.call("chat.deleteAttachment",l).then((function(e){var t=e.data,n=e.args,i=e.request_id;return d(!0),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return d(!1),{data:t,args:n,request_id:i}}))}}})}else{TS.error("Attachment removing failed: msg not found anywhere!");var c=TS.interop.i18n.t("Attachment removing failed!","inline_attachments")();TS.generic_dialog.alert(c)}}else TS.warn("missing attachment-id");else TS.warn("missing model_ob")},makeBlackListSelect:function(e){if(!e)return"";var t="",n=(e=_.escape(e).replace("https://","").replace("http://","")).split("/"),i=n[0],r=n[n.length-1];if(t+='<label class="select small full_width">\r',t+='<select id="attachment_blacklist_select" disabled="disabled" class="small" style="margin-bottom: 4px;">\r',t+='<option value="all" data-url="'+i+'">'+TS.interop.i18n.t("All links from {host}","inline_attachments")({host:i})+"</option>\r",t+='<option value="just" data-url="'+e+'">'+TS.interop.i18n.t("Just the link {url}","inline_attachments")({url:e})+"</option>\r",r!=i){TS.info(r);var a=n.concat();a.length-=1;var s=a.join("/");s!=i&&(t+='<option value="under" data-url="'+(s+="/")+'">'+TS.interop.i18n.t("All links under {host_path}","inline_attachments")({host_path:s})+"</option>\r")}return t+="</select>\r",t+="</label>\r"},rest_texts_expanded:{},shouldExpandText:function(e){return!!TS.inline_attachments.rest_texts_expanded[e]},renderStandaloneAttachment:function(e){TS.inline_attachments.massageAttachment(e,0),e.image_url&&!TS.model.inline_imgs[e.from_url]&&(e.from_url||(e.from_url=e.image_url),TS.inline_imgs.makeInternalInlineImg(e.from_url,{link_url:e.from_url,bytes:e.image_bytes,src:e.image_url,width:isNaN(e.image_width)?null:e.image_width,height:isNaN(e.image_height)?null:e.image_height,should_expand:!0})),e.video_html&&!TS.model.inline_videos[e.from_url]&&TS.inline_videos.makeInternalInlineVideo(e.from_url,{src:e.thumb_url,html:e.video_html,proxied_src:e.proxied_thumb_url,title:e.title,display_h:e.video_html_height,display_w:e.video_html_width,thumbnail:{link_url:e.from_url,url:e.thumb_url,height:e.thumb_height,width:e.thumb_width}});var t=TS.interop.datetime.makeTsStamp(),n=TS.templates.builders.buildAttachmentHTML({attachment:e,msg:{enable_slack_action_links:!1,text:e.from_url,ts:t,url:e.from_url,standalone_attachment:e.standalone_attachment||!1},can_delete:!1,maybe_show_file_viewer:!1,has_content:TS.utility.attachments.hasContent(e),from_post:!0,model_ob:TS.redux.channels.getEntityById(e.channel_id)});return'<div class="message standalone-attachment" id="'+TS.templates.makeMsgDomId(t)+'" data-ts="'+t+'">'+n+"</div>"},massageAttachment:function(e,t){e._index=t,"id"in e&&(e.id=e.id.toString()),e.text&&(e._short_text=TS.inline_attachments.legacyTruncateAttachmentText(e.text)),e._floated_thumb_display_height=75,e._floated_thumb_display_width=75,e.thumb_height&&e.thumb_width&&(e.thumb_height>e.thumb_width?e._floated_thumb_display_width=parseInt(e.thumb_width*(e._floated_thumb_display_height/e.thumb_height),10):e._floated_thumb_display_height=parseInt(e.thumb_height*(e._floated_thumb_display_width/e.thumb_width),10));var n=TS.utility.getImgProxyURL(e.thumb_url,e._floated_thumb_display_width,e._floated_thumb_display_height);n!=e.thumb_url?e.proxied_thumb_url=n:delete e.proxied_thumb_url},legacyTruncateAttachmentText:function(e){for(var t,n="",i=0,r="",a="",s="",o=0,l=!1,d=0;d<e.length;d+=1)if(t=e.charAt(d),a||"<"===t)a+=t,(s||"|"===t)&&(s+=t),">"===t&&(n+=a,(i+=s.length-2)>500&&(l=!0),a="",s="");else{if("\n"===t&&(o+=1),o>4){r=e.replace(n,"");break}if(n+=t,(i+=1)>500&&(l=!0),l&&" "===t){r=e.replace(n,"");break}}var c=n.trim()==e.trim()?"":n,u=n.match(/```/g),_=r.match(/```/g);return u&&_&&(c+="```"),c},getAttachmentByFromUrl:function(e,t){if(!e)return null;for(var n=0;n<e.length;n+=1)if(e[n]){if(e[n].from_url){if(e[n].from_url==t)return e[n];if(TS.model.ampersands_are_inconsistent_in_from_urls&&e[n].from_url.replace(/&/g,"&amp;")==t)return e[n]}}else TS.info(t),TS.dir(0,e);return null},getAttachmentBySlackFileId:function(e,t){if(!e)return null;if(!t)return null;for(var n=0;n<e.length;n+=1)if(e[n]&&e[n].slack_file_id==t)return e[n];return null},removeAttachmentById:function(e,t){if(!e)return null;for(var n=[],i=0;i<e.length;i+=1)e[i].id!=t&&n.push(e[i]);return n}})},"bdn/":function(e,t){!function(){TS.registerModule("sorter",{onStart:function(){},search:function(e,t,n){return u(e,t,n)},printTest:function(e,t){var n=TS.members.getActiveMembersWithSelfAndSlackbot(),i=_.partition(TS.interop.channels.getUnarchivedPublicAndPrivateChannels(),"is_group"),r=i[0],a={members:n,channels:i[1],groups:r,mpims:TS.redux.channels.dangerouslyGetMpims().filter(TS.interop.rules.channels.isVisibleMpim),teams:_.values(TS.boot_data.other_accounts),usergroups:TS.interop.userGroups.getActiveUserGroups(),emoji:TS.model.emoji_map,broadcast_keywords:TS.utility.members.getBroadcastKeywordsForUser(),views:TS.model.NAMED_VIEWS};TS.sorter.search(e,a,_.extend({print:!0},t))},scoreEmoji:function(e,t){return s(e,t)},test:function(){var t={sortFuzzy:h,frecencyBonusPoints:S,getFilteredMatchesForFrecency:m,scoreMember:l,_scoreUserGroup:d,getSubQueryMatchers:o,_scoreEmoji:s,_makeFuzzySearcher:e,_getMetaFieldForId:r,search:u,getNameForComparison:f};return Object.defineProperty(t,"_meta_fields",{get:function(){return n},set:function(e){n=e}}),t}});var e=function(e,t){var n=null!=(t=t||{}).fuzzy_limit?t.fuzzy_limit:10,r=e=TS.interop.i18n.deburr(e.toLocaleLowerCase()),a="@"===e.charAt(0),u="#"===e.charAt(0),m=":"===e.charAt(0);(a||u||m)&&(e=e.substring(1));var p={fuzzy_limit:n},f={fuzzy_limit:n,search_forward_only:!0},h=TS.fuzzy.makeFuzzyMatcher(e,p),g=TS.fuzzy.makeFuzzyMatcher(r,p),S=TS.fuzzy.makeFuzzyMatcher(e,f),T=o(e,f);return{query:e,full_query:r,only_channels:u,only_members:a,only_emoji:m,matchesChannel:function(r){if(TS.interop.rules.channels.isUnknownOrNonExistent(r))return!1;if(a||m)return!1;if((t.allow_empty_query||u)&&!e)return i(r.id,"jumper_score",0),!0;var s=h.score(r.name_normalized||r.name);if(i(r.id,"jumper_score",s),s>n&&t.search_previous_channel_names&&r.previous_names&&r.previous_names.length){var o=_.map(r.previous_names,(function(e){return{score:h.score(e),name:e}}));i(r.id,"jumper_previous_name_scores",o);var l=_.some(o,(function(e){return e.score<=n}));if(l&&s>n){var d=_.minBy(o,"score");r._jumper_previous_name_match=d&&d.name}else r._jumper_previous_name_match=null;return s<=n||l}return r._jumper_previous_name_match&&(r._jumper_previous_name_match=null),s<=n},matchesGroup:function(r){if(u||a||m)return!1;if(t.allow_empty_query&&!e)return i(r.id,"jumper_score",0),!0;var s=h.score(r.name_normalized||r.name);return i(r.id,"jumper_score",s),s<=n},matchesMember:function(r){if(r.is_non_existent||r.isNonExistent||r.is_unknown||r.isUnknown)return!1;if(u||m)return!1;if((t.allow_empty_query||a)&&!e)return i(r.id,"jumper_score",0),!0;var s=l(r,S,e);return i(r.id,"jumper_score",s),s<=n},matchesMpim:function(r){if(u||a||m)return!1;if(t.allow_empty_query&&!e)return i(r.id,"jumper_score",0),!0;var s=TS.mpims.legacyGetMembersInDisplayOrder(r);s=_.chain(s).reject((function(e){return!e||e.is_non_existent||e.isNonExistent||e.is_unknown||e.isUnknown})).value();var o=T.map((function(e){var t=s.map((function(t){return l(t,e)}));return _.min(t)})),d=_.sum(o);return i(r.id,"jumper_score",d),d<=n},matchesTeam:function(e){if(TS.interop.rules.teams.isUnknownOrNonExistent(e))return!1;var t=e.team_name||e.name||"",r=g.score(t.toLocaleLowerCase());return i(e.id,"jumper_score",r),r<=n},matchesUserGroup:function(r){if(u||m)return!1;if((t.allow_empty_query||a)&&!e)return i(r.id,"jumper_score",0),!0;var s=d(r,h);return i(r.id,"jumper_score",s),s<=n},matchesEmoji:function(n){if(u||a)return!1;if(t.allow_empty_query&&!e)return i(n.id,"emoji_score",0),!0;var r,o,l=TS.interop.i18n.deburr(n.display_name||n.name);return r=s(l,e),n.display_name&&n.display_name!==n.name&&(o=s(n.name,e))!==1/0&&o<r&&(r=o,l=n.name),r!==1/0&&(i(n.id,"emoji_score",r),!0)},matchesBroadcastKeyword:function(r){if(u||m)return!1;if((t.allow_empty_query||a)&&!e)return i(r.id,"jumper_score",0),!0;var s=c(r,h);return i(r.id,"jumper_score",s),s<=n},matchesView:function(e){if(u||m)return!1;var t=h.score(e.name.toLocaleLowerCase());return 1/0===t&&e.alt_names&&(t=_.reduce(e.alt_names,(function(e,t){return Math.min(e,h.score(t.toLocaleLowerCase()))}),t)),i(e.id,"jumper_score",t),t<=n}}},t=/\s+/g,a=/[-]+/g,s=function(e,n){var i=2,r=6;if(n.length<3?(i=0,r=0):3===n.length?(i=1,r=1):4===n.length?(i=1,r=5):r=5,"ok_hand"===e&&"ok"===n)return 0;var s=TS.interop.searcher.emojiSkiplist;if(s[n]&&-1!==s[n].indexOf(e))return 1/0;var o=1/0,l=e.indexOf(n);if(-1===l&&(l=e.indexOf(n[0])),-1!==l){n=n.replace(t,"").replace(a,"_"),e=e.replace(a,"_");for(var d=n.split(""),c=0,u=0,_=0,m=!0,p=l;p<e.length;p++){if(e[p]===d[0]){if(m=!0,d.shift(),_>u&&(u=_),_=0,0===d.length)break}else m&&(c+=1),m=!1,_+=1;if(c>i)return o;if(_>r)return o}if(d.length>0)return o;o=1-n.length/e.length,c>0&&(o+=c)}return o},o=function(e,t){return e.split(/[,| ]/).filter((function(e){return!!e})).map((function(e){return e="@"===e.charAt("0")?e.substring(1):e,TS.fuzzy.makeFuzzyMatcher(e,t)}))},l=function(e,t,n){if(TS.utility.queryIsMaybeSelf(n)&&e.is_self)return 0;var i,r=1/0,a=1/0,s=1/0;return i=t.score(e._real_name_lc),e._real_name_lc!==e._real_name_normalized_lc&&(r=t.score(e._real_name_normalized_lc)),e._display_name_lc&&(a=t.score(e._display_name_lc),e._display_name_lc!==e._display_name_normalized_lc&&(s=t.score(e._display_name_normalized_lc))),Math.min(i,r,a,s)},d=function(e,t){var n,i;return n=t.score(e.name),i=t.score(e.handle),Math.min(n,i)},c=function(e,t){var n,i=1/0;if(n=t.score(e.name),e.ms_name!==e.name&&(i=t.score(e.ms_name)),!e.alias)return Math.min(n,i);var r;return r=t.score(e.alias),Math.min(n,i,r)},u=function(t,n,a){var o,l,d,c,u=e(t,a||{}),p=[],f=[],T=[],b=[],v=[],y=[],w=[],k=[],x=[],C=[],M=[],I=a.match_emoji_keywords?TS.emoji.findByKeyword(t):[],E=[];if(n.members=n.members||[],n.channels=n.channels||[],n.groups=n.groups||[],n.mpims=n.mpims||[],n.teams=n.teams||[],n.usergroups=n.usergroups||[],n.emoji=n.emoji||[],n.broadcast_keywords=n.broadcast_keywords||[],n.views=n.views||[],n.enterprise_channels=n.enterprise_channels||[],n.enterprise_groups=n.enterprise_groups||[],n.app_actions=n.app_actions||[],TS.telemeter.mark("ts-sorter-matching-mark"),u.only_channels||u.only_emoji||u.only_app_actions||(f=n.members.filter((function(e){return!(e.is_non_existent||e.isNonExistent||e.is_unknown||e.isUnknown)&&(_.isString(TS.interop.members.getMemberProfileFieldDisplayName(e))||TS.interop.utility.getLogger({getState:TS.redux.getState}).error(e.id+": memberProfileFieldDisplayName is not a string."),_.isString(TS.interop.members.getMemberRealName(e))||TS.interop.utility.getLogger({getState:TS.redux.getState}).error(e.id+": memberRealName is not a string"),a.prefer_exact_match&&u.query&&(TS.interop.members.getMemberProfileFieldDisplayName(e)&&_.isString(TS.interop.members.getMemberProfileFieldDisplayName(e))&&TS.interop.members.getMemberProfileFieldDisplayName(e).toLocaleLowerCase()===u.query||TS.interop.members.getMemberRealName(e)&&_.isString(TS.interop.members.getMemberRealName(e))&&TS.interop.members.getMemberRealName(e).toLocaleLowerCase()===u.query)?(i(e.id,"jumper_exact_match",!0),p.push(e),!1):(i(e.id,"jumper_exact_match",!1),u.matchesMember(e)))})),x=n.usergroups.filter((function(e){return a.prefer_exact_match&&e.handle===u.query||e.name_lc===u.query?(p.push(e),!1):u.matchesUserGroup(e)})),M=n.broadcast_keywords.filter((function(e){return a.prefer_exact_match&&e.name===u.query?(p.push(e),!1):u.matchesBroadcastKeyword(e)}))),!u.only_members&&!u.only_emoji&&!u.only_app_actions){var A=function(e){if(!TS.interop.rules.channels.isUnknownOrNonExistent(e)){if(a.prefer_exact_match&&e.name===u.query)return i(e.id,"jumper_exact_match",!0),void p.push(e);i(e.id,"jumper_exact_match",!1),u.matchesChannel(e)&&(e.is_member?T.push(e):TS.interop.rules.channels.isArchived(e)?v.push(e):b.push(e))}};n.channels.forEach(A),n.enterprise_channels.forEach(A)}if(!(u.only_channels||u.only_members||u.only_emoji||u.only_app_actions)){var P=function(e){if(a.prefer_exact_match&&e.name===u.query)return i(e.id,"jumper_exact_match",!0),void p.push(e);i(e.id,"jumper_exact_match",!1),u.matchesGroup(e)&&(TS.interop.rules.channels.isArchived(e)?w.push(e):y.push(e))};n.groups.forEach(P),n.enterprise_groups.forEach(P),k=n.mpims.filter((function(e){return u.matchesMpim(e)}))}o=n.teams.filter((function(e){if(TS.interop.rules.teams.isUnknownOrNonExistent(e))return!1;if(!_.isObject(e))return!1;var t=e.team_name||e.name||"";return a.prefer_exact_match&&t.toLocaleLowerCase()===u.full_query?(i(e.id,"jumper_exact_match",!0),p.push(e),!1):(i(e.id,"jumper_exact_match",!1),u.matchesTeam(e))})),u.only_channels||u.only_members||u.only_app_actions||(C=n.emoji.filter((function(e){if(a.prefer_exact_match&&((e.display_name||e.name)===u.query||"ok_hand"===e.name&&"ok"===u.query))return i(e.id,"jumper_exact_match",!0),i(e.id,"emoji_exact_match",!0),p.push(e),!1;if(i(e.id,"jumper_exact_match",!1),a.match_emoji_keywords&&I.length){var n=TS.emoji.nameToBaseName(e.display_name||e.name);if(-1!==I.indexOf(n))return i(e.id,"emoji_score",s(n,t)),!0}return u.matchesEmoji(e)}))),u.only_channels||u.only_emoji||u.only_members||(E=n.app_actions.filter((function(e){if(!_.isObject(e))return!1;var t=e.name;return a.prefer_exact_match&&t.toLocaleLowerCase()===u.full_query?(i(e.id,"jumper_exact_match",!0),p.push(e),!1):(i(e.id,"jumper_exact_match",!1),!1)}))),TS.telemeter.measureAndClear("ts-sorter-matching-mark","ts-sorter-matching"),TS.telemeter.mark("ts-sorter-sorting-mark"),l=f.concat(T,y,k,C,x,M,[],E),a.flat||l.sort(_.partial(h,!0)),d=b.concat(o),a.flat||d.sort(_.partial(h,!0)),c=w.concat(v),a.flat||c.sort(_.partial(h,!0));var O=l.concat(d,c);a.flat&&O.sort(_.partial(h,!0));var F,j=O;a.prefer_exact_match&&p.length>0&&(p.sort(_.partial(g,!0)),(F=j).unshift.apply(F,p));if(a.frecency&&(a.normalize=!0,TS.telemeter.mark("ts-sorter-frecency-sort-mark"),j=TS.ui.frecency.query(j,t,S,a)),a.limit&&(j=_.take(j,a.limit)),a.frecency&&(j=m(j),TS.telemeter.measureAndClear("ts-sorter-frecency-sort-mark","ts-sorter-frecency-sort")),a.print){var $="\n";_.forEach(j,(function(e){var t=a.frecency?e.model_ob:e;a.frecency&&($+="["+e.score+"] "),null!=r(t.id,"jumper_score")&&($+="["+r(t.id,"jumper_score")+"] "),t.is_mpim?$+=TS.mpims.legacyGetDisplayName(t):t.is_channel?$+="#"+t.name:t.is_group?$+=t.name:t.team_name?$+=t.team_name:t.is_usergroup||t.presence?$+="@"+t.name:$+=e.model_ob?e.model_ob.name:e.name,$+="\n"})),TS.info($)}return TS.telemeter.measureAndClear("ts-sorter-sorting-mark","ts-sorter-sorting"),j},m=function(e){var t=[];return TS.boot_data.page_needs_enterprise&&(e=_.uniqBy(e,(function(e){return e.id}))),_.forEach(e,(function(e){var n;if(TS.interop.utility.looksLikeMemberId(e.id)){var i=TS.interop.members.getMemberById(e.id);i&&t.push({model_ob:i,score:e.score})}else{var r=0===e.id.indexOf("BK"),a=0===e.id.indexOf("V");(n=r?TS.model.getBroadcastKeywordById(e.id):a?TS.model.getViewById(e.id):p(e.id))&&t.push({model_ob:n,score:e.score})}})),t},p=function(e){return"E"===e[0]?TS.emoji.getEmojiById(e):"S"===e[0]?TS.interop.userGroups.getUserGroupById(e):"T"===e[0]?TS.redux.teams.getTeamById(e):TS.redux.channels.getEntityById(e)},f=function(e){return e.is_mpim?_.toLower(TS.mpims.legacyGetDisplayName(e)):e.is_usergroup?e.handle||e.name:TS.interop.members.isMember(e)?TS.interop.members.getPrefCompliantMemberName(e):e._name_lc?e._name_lc:e.team_name?e.team_name.toLocaleLowerCase():e.name},h=function(e,t,n){if(t.is_mpim&&!n.is_mpim)return 1;if(n.is_mpim&&!t.is_mpim)return-1;if(!t.is_mpim&&!n.is_mpim){var i=r(t.id,"jumper_score")-r(n.id,"jumper_score");if(0!==i)return i}if(t.is_mpim&&n.is_mpim){var a=r(t.id,"jumper_score")-r(n.id,"jumper_score");if(0!==a)return a;var s=TS.mpims.getMemberCount(t)-TS.mpims.getMemberCount(n);if(0!==s)return s}return g(e,t,n)},g=function(e,t,n){var i=f(t),r=f(n);return e?TS.interop.i18n.sorter(i,r):i>r?1:r>i?-1:0},S=function(e,t){if(e.is_mpim){if(t.prefer_mpims_with_active_members){var n=TS.mpims.legacyGetMembersInDisplayOrder(e);return _.some(n,(function(e){return e.deleted||e.is_suspended}))?TS.ui.frecency.bonus_points.mpim_with_deactivated_member:0}return 0}var i=0;if(r(e.id,"jumper_exact_match")?(i+=TS.ui.frecency.bonus_points.exact_match,r(e.id,"emoji_exact_match")&&(i+=TS.ui.frecency.bonus_points.exact_match)):r(e.id,"emoji_score")?i+=T(e,"emoji_score",TS.ui.frecency.bonus_points.emoji_match):TS.interop.rules.channels.isArchived(e)||TS.interop.rules.members.isDeleted(e)||TS.interop.rules.members.isSuspended(e)||(i+=T(e,"jumper_score",TS.ui.frecency.bonus_points.fuzzy_match)),r(e.id,"jumper_previous_name_scores")&&(i+=TS.ui.frecency.bonus_points.matches_previous_name),t.prefer_channel_members&&e.presence&&t.model_ob&&b(e.id,t.model_ob)&&(i+=TS.ui.frecency.bonus_points.member_of_this_channel),e.is_starred&&(i+=TS.ui.frecency.bonus_points.starred_channel),TS.interop.members.isMember(e)){var a=TS.redux.channels.getImByMemberId(e.id);a&&a.is_starred&&(i+=TS.ui.frecency.bonus_points.starred_channel)}return e.is_emoji&&("thumbsup"!==e.name&&"point_up"!==e.name||(i+=1)),t.self_first&&e.is_self&&(i=1/0),(e.is_channel||e.is_group)&&(TS.interop.rules.channels.isArchived(e)&&(i+=TS.ui.frecency.bonus_points.archived_channel_or_group),e.is_channel&&t.prefer_channels_user_belongs_to&&(TS.interop.rules.channels.isArchived(e)||b(TS.model.user.id,p(e.id))||(i+=TS.ui.frecency.bonus_points.not_in_channel)),TS.interop.rules.channels.isFromAnotherTeam(e)&&(i+=TS.ui.frecency.bonus_points.foreign_channel_or_group)),TS.interop.members.isMember(e)&&(TS.interop.rules.members.isDeleted(e)||TS.interop.rules.members.isSuspended(e))&&(i+=TS.ui.frecency.bonus_points.deactivated_member),(e.is_usergroup||e.is_broadcast_keyword)&&(i+=TS.ui.frecency.bonus_points.usergroup_or_keyword),i},T=function(e,t,n){var i=r(e.id,t);if(!_.isFinite(i))return 0;var a=Math.pow(.5,i);return Math.round(n*a)},b=function(e,t){if(t.is_channel&&e===TS.model.user.id)return t.is_member;var n=TS.interop.membership.getCachedChannelMembershipInfoForUser(t.id,e);return n.is_known&&n.is_member}}();var n={},i=function(e,t,i){e&&t&&(n[e]||(n[e]={}),n[e][t]=i)},r=function(e,t){if(e&&t&&e&&n[e])return n[e][t]}},cDf5:function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},e9QI:function(e,t){!function(){TS.registerModule("menu.file",{onStart:function(){},startWithNewFileOptions:function(e,t,n){TS.ui.react_file_menu.showFileMenu(e,t,n)},onGDriveCreateComplete:function(){e.find(".ts_icon").remove(),e.toggleClass("active",!1).append(t)},file_list_menu_up:!1,startWithFileActions:function(e,t){if(!TS.menu.isRedundantClick(e)&&!TS.model.menu_is_showing){TS.menu.buildIfNeeded(),TS.menu.file.clean();var n=TS.files.getFileById(t);if(n){var i=TS.files.getFileActions(n);TS.boot_data.feature_file_threads&&(i.comment=!1,i.rxn_file=!1,i.pin_file=!1,i.unpin_file=!1);var r=$(e.target),a=r.closest(".file_actions");i.comment&&a.data("exclude-comment")&&(i.comment=!1),i.download&&a.data("exclude-download")&&(i.download=!1),i.open_original&&a.data("exclude-original")&&(i.open_original=!1),i.rxn_file&&a.data("exclude-rxn")&&(i.rxn_file=!1),i.pin_file&&(a.data("exclude-pin")||a.data("exclude-pin-file"))&&(i.pin_file=!1),i.unpin_file&&(a.data("exclude-pin")||a.data("exclude-unpin-file"))&&(i.unpin_file=!1),i.edit&&a.data("exclude-edit")&&(i.edit=!1),i.edit_title&&a.data("exclude-edit-title")&&(i.edit_title=!1),i.print&&a.data("exclude-print")&&(i.print=!1),i.create_public_link&&a.data("exclude-create-public-link")&&(i.create_public_link=!1),i.revoke_public_link&&a.data("exclude-revoke-public-link")&&(i.revoke_public_link=!1),i.star=!0,i.open_in_flexpane=!0,a.data("include-open-file-page")&&(i.open_file_page=!0),a.data("include-view-public-link")&&(i.view_public_link=!0),r.closest(".file_list_item").length>0&&("details"!==TS.model.ui_state.flex_name&&(i.share=!1),TS.menu.file.file_list_menu_up=!0);var s=r.closest(".inline_file_preview_container, .file_container");s.length>0&&(s.addClass("file_menu_open"),i.new_window=!1),TS.menu.$menu_header.addClass("hidden").empty();var o=!1;(i.edit||i.create_public_link||i.revoke_public_link||i.print||i.save_to_dropbox||i.refresh)&&(o=!0);var l={file:n,actions:i,is_refreshing:TS.files.waiting_for_refresh[n.id],model_ob:TS.shared.legacyGetActiveModelOb(),show_workflow_divider:o,external_file_author:TS.files.isFileAuthorExternal(n)};TS.model.unread_view_is_showing&&(l.source_model_ob_id=r.closest(".unread_group").data("modelId"),l.source_model_ob_id&&(l.model_ob=TS.redux.channels.getEntityById(l.source_model_ob_id))),TS.menu.$menu_items.html(TS.templates.menu_file_action_items(l)),TS.menu.$menu.addClass("no_icons"),TS.web&&TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileActionClickWeb),TS.menu.start(e),r.closest(".file_list_item").addClass("active"),TS.menu.positionAt(r,-(TS.menu.$menu.width()+6),0),TS.menu.keepInBounds()}}},onFileActionClickWeb:function(e){var t=$(this).attr("id"),n=$(this).data("rxn-key"),i=TS.files.getFileById($(this).data("file-id")),r=TS.shared.legacyGetActiveModelOb();if(i){if("share_file"===t)e.preventDefault(),TS.ui.share_dialog.start(i.id);else if("share_private_file"===t)e.preventDefault(),TS.ui.share_dialog.start(i.id);else if("edit_file_snippet"===t);else if("edit_file_post"===t);else if("edit_file_space"===t||"open_new_window"===t);else if("edit_file_title"===t);else if("delete_file"===t)e.preventDefault(),TS.web.file.deleteFile(i.id);else if("create_public_link"===t){if(e.preventDefault(),!TS.prefs.getTeamPref("disallow_public_file_urls")){var a=function(e,t){if(e){var n=$(".file_public_link_shared");n.slideToggle(100),TS.files.upsertAndSignal({id:i.id,public_url_shared:!0},"createPublicLink"),0===n.length&&TS.ui.file_share.fileShowPublicUrlDialog(i)}else if(t.error&&"not_allowed"===t.error){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",!0);var r=TS.interop.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this file.","menu_file")();TS.generic_dialog.alert(r)}};TS.interop.api.callExpedited("files.sharedPublicURL",{file:i.id}).then((function(e){var t=e.data,n=e.args,i=e.request_id;return a(!0,t),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return a(!1,t),{data:t,args:n,request_id:i}}))}}else if("revoke_public_link"===t)e.preventDefault(),TS.web.file?TS.web.file.revokePublicURL(i):TS.ui.file_share.fileRevokePublicLink(i.id);else if("view_public_link"===t)e.preventDefault(),TS.ui.file_share.fileShowPublicUrlDialog(i);else{if("refresh_file"===t)return e.preventDefault(),TS.files.refreshFile(i.id),void TS.menu.$menu.find("#refresh_file .item_label").text("Refreshing...").end();if("download_file"===t);else if("print_file"===t)window.print(),e.preventDefault();else if("open_original_file"===t);else if("comment_file"===t)e.preventDefault(),TS.utility.contenteditable.focus($("#file_comment"));else{if("save_to_dropbox"===t){var s=function(e,t){e&&Dropbox.save(t.url,i.name)};return TS.interop.api.callExpedited("files.getTempURL",{file:i.id}).then((function(e){var t=e.data,n=e.args,i=e.request_id;return s(!0,t),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return s(!1,t),{data:t,args:n,request_id:i}}))}if("rxn_file"===t)e.preventDefault(),TS.ui.react_emoji_menu.start({e:e,rxn_key:n});else if("pin_file"===t&&r)e.preventDefault(),TS.pins.startPinFile(i.id,r);else if("unpin_file"===t&&r)e.preventDefault(),TS.pins.unPinFile(i.id,r);else if("copy_file_link"===t){e.preventDefault(),TS.clipboard.writeText(i.permalink);var o=TS.interop.members.getMemberById(i.user),l={};if(o&&o.is_bot){var d=o.profile.bot_id,c=TS.interop.bots.getBotById(d);l.app_id=c?c.app_id:"",l.bot_id=d}TS.interop.clog.track("MSG_LINK_COPY",l)}else if("open_file_page"!==t)return e.preventDefault(),void TS.warn("not sure what to do with clicked element id:"+t)}}TS.menu.file.end()}else TS.error("no file id:"+$(this).data("file-id"))},clean:function(){TS.menu.clean()},end:function(){TS.menu.end()}});var e=$('[data-js="primary_file_button"]'),t=e.find(".ts_icon_plus_thick")}()},fK9Z:function(e,t){!function(){TS.registerModule("membership",{membership_counts_need_refetch_sig:new signals.Signal,onStart:function(){TS.members.changed_deleted_sig.add(e,this,Infinity)}});var e=function(){TS.interop.memberCounts.markAllMemberCountsAsStale()}}()},ftdm:function(e,t){TS.registerModule("redux.all_unreads",{updateHasUnreads:function(e){"boolean"==typeof e&&TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateHasUnreads(e))},updateHasUnreadThreads:function(e){"boolean"==typeof e&&TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateHasUnreadThreads(e))},updateThreadsMentionCount:function(e){_.isInteger(e)&&TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateThreadsMentionCount(e))}})},gYX6:function(e,t){!function(){TS.registerModule("redux.channels",{onStart:function(){e=!0,i=TS.interop.rules.channels.isIm||t,Object.defineProperty(TS.model,"channels",{get:function(){return g("channels")}}),Object.defineProperty(TS.model,"groups",{get:function(){return g("groups")}}),Object.defineProperty(TS.model,"mpims",{get:function(){return g("mpims")}}),Object.defineProperty(TS.model,"ims",{get:function(){return g("ims")}})},clearAllShowInListEvenThoughUnreadsFlags:function(){TS.interop.channels.clearAllShowInListEvenThoughUnreadsFlags()},dangerouslyGetEntityById:function(e){return s(e)},dangerouslyGetPublicChannels:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.includeFromAnotherTeam,n=void 0!==t&&t;return TS.interop.channels.getPublicChannels({includeFromAnotherTeam:n})},dangerouslyGetPrivateChannels:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.includeFromAnotherTeam,n=void 0!==t&&t;return TS.interop.channels.getPrivateChannels({includeFromAnotherTeam:n})},dangerouslyGetMpims:function(){return TS.interop.channels.getMpims()},dangerouslyGetIms:function(){return TS.interop.channels.getIms()},setMarkingState:function(e,t){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.setMarkingState({id:e,needsApiMarking:t}))},clearAllMarkingFlags:function(){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.clearAllMarkingFlags())},clearMarkingFlagsForIds:function(e){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.clearMarkingFlagsForIds(e))},getAllIdsNeedingMarking:function(){return d()},getAllUnmutedIdsNeedingMarking:function(){return u()},getAllMutedIdsNeedingMarking:function(){return c()},bulkAddEntities:function(e){TS.interop.channels.bulkAddChannels({channels:e})},bulkUpdateEntities:function(e){TS.interop.channels.bulkUpdateChannels({channels:e})},addEntity:function(e){if(e)if(e._is_interop_channel_object){var t="Attempting to add a channel interop object, not a channel. Only raw channel objects can be added. Take this to #dhtml.";if(h())throw new Error(t);TS.error(t)}else TS.interop.channels.addChannel({channel:e})},removeEntity:function(e){e&&e.id&&TS.interop.channels.removeChannels({ids:[e.id]})},replaceEntity:function(e){if(e)if(e._is_interop_channel_object){var t="Attempting to replace a channel object with a channel interop object. If you are trying to update a property for this channel you should change the property directly. Take this to #dhtml.";if(h())throw new Error(t);TS.error(t)}else TS.redux.channels.addEntity(e)},updateMutedChannels:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=_.reduce(e,(function(e,t){return e[t]=!0,e}),{});TS.redux.dispatch(TS.interop.redux.models.channelsMeta.mutedChannels.setMutedChannels(t))},getMutedChannelsAsArray:function(){return _.reduce(m(),(function(e,t,n){return e.push(n),e}),[])},setMutedChannelById:function(e,t){if(e&&!_.isUndefined(t)){var n={id:e,muted:t};TS.redux.dispatch(TS.interop.redux.models.channelsMeta.mutedChannels.setMutedChannel(n))}},isChannelMutedById:function(e){return!!e&&r(e)},getEntityById:function(e,t){return TS.interop.channels.getEntityById(e,t)},getPublicChannelByName:function(e){var t=o(e);if(TS.interop.rules.channels.isPublicChannel(t))return t},getPublicOrPrivateChannelByName:function(e){var t=o(e);if(TS.interop.rules.channels.isPublicChannel(t)||TS.interop.rules.channels.isPrivateChannel(t))return t},getChannelByName:function(e){return o(e)},getImByMemberId:function(e){var t=l(e),n=TS.redux.channels.getEntityById(t);return i(n)?n:null},test:function(){return{}}});var e=!1;function t(){TS.interop.utility.getLogger({getState:TS.redux.getState}).error("missing-isIm: onStartDidRun="+e+", i("+_.has(window,"TS.interop")+"), i.r("+_.has(window,"TS.interop.rules")+"), i.r.c("+_.has(window,"TS.interop.rules.channels")+"), i.r.c.i("+_.has(window,"TS.interop.rules.channels.isIm")+")");var t=Date.now()-(window.localStorage.isImBugLastEncountered||0);throw localStorage.isImBugLastEncountered=Date.now(),t>6e4&&TS.reload(null,"isIM bug detected"),new Error("TS.interop.rules.channels.isIm not present on page, not sure how to proceed")}var n,i=t,r=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.mutedChannels.isChannelMutedById"),a=TS.interop.channels.getAllChannels,s=TS.interop.channels.getChannelById,o=TS.interop.channels.getChannelByName,l=TS.interop.channels.getImIdByMemberId,d=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllIdsNeedingMarking"),c=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllMutedIdsNeedingMarking"),u=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllUnmutedIdsNeedingMarking"),m=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.mutedChannels.getMutedChannels"),p={},f={channels:void 0,groups:void 0,mpims:void 0,ims:void 0},h=function(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)},g=function(e){var t,r=a();switch(e){case"channels":t=function(e){return e.is_channel&&!e.fromAnotherTeam};break;case"groups":t=function(e){return e.is_group&&!e.is_mpim&&!e.fromAnotherTeam};break;case"ims":t=i;break;case"mpims":t=function(e){return e.is_group&&e.is_mpim}}return r===n&&p[e]||(r!==n&&(n=r,p={}),p[e]=_.filter(r,t),p[e]=_.map(p[e],TS.redux.channels.interop.maybeWrapEntity),f[e]||(f[e]=_.defer((function(){delete p[e],delete f[e],n=null})))),p[e]}}()},gj8S:function(e,t){!function(){var e,t,n;TS.registerModule("ui.admin_user_groups",{user_groups_fetched:new signals.Signal,onStart:function(){$("body").on("click",'[data-action="admin_user_groups_modal"]',(function(){l()})),$("body").on("click",'[data-action="admin_user_groups_modal_new"]',(function(){TS.ui.admin_user_groups.add()}))},start:function(){l()},add:function(){l(),s=!0,y()},editInfo:function(e){l(),s=!0,y(e)},editMembers:function(e){l(),s=!0,C(e,!1)},disable:function(e){l(),s=!0,b(e,"disable_user_group")},enable:function(e){l(),s=!0,b(e,"enable_user_group")},interopFunctions:function(e){var t=e.action,n=e.userGroup;switch(t){case"add":y();break;case"enable":b(n,"enable_user_group");break;case"disable":b(n,"disable_user_group");break;case"editInfo":y(n);break;case"editMembers":C(n,!1)}},test:function(){var e={_isFullLocalMember:O};return Object.defineProperty(e,"_isFullLocalMember",{get:function(){return O},set:function(e){O=e}}),e}});var i,r,a=[],s=!1,o=!1,l=function(){var e={body_template_html:TS.templates.user_group_modal({show_info_pane:!TS.prefs.getPref("hide_user_group_info_pane"),show_user_groups_add:TS.permissions.members.canCreateAndDeleteUserGroups()}),onShow:d,onCancel:c,full_height_contents:!0,modal_contents_container_class:"overflow_hidden"};i="",TS.interop.userGroups.setSearchQuery(i),TS.ui.fs_modal.start(e)},d=function(){e=$("#all_user_groups"),t=$("#user_groups_form_div"),n=$("#user_groups_toggle_div"),S(),$("#user_groups_create_btn").on("click",(function(){y()}))},c=function(){e=null,t=null,n=null,s=!1,r=null,$(window).off("resize",g),TS.ui.admin_user_groups.user_groups_fetched.dispatch(a),F(TS.model.user_groups),j()},u=function(e){e&&e.preventDefault(),s?TS.ui.fs_modal.close():S(),F(TS.model.user_groups)},m=function(){s?TS.ui.fs_modal.close():S(),TS.ui.admin_user_groups.user_groups_fetched.dispatch(a),F(TS.model.user_groups)},p=function(){s||(TS.ui.fs_modal.bindBackButton(S),TS.ui.fs_modal.showBackButton())},f=function(e){if(!a||!e)return!1;for(var t=0,n=a.length;t<n;t+=1)if(a[t].auto_type===e)return a[t];return!1},h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e){var n=$("#user_group_name_input").val()||"",i=$("#user_group_handle_input").val()||"";if(t.group_name=n,t.group_handle=i,t.error&&("forbidden_handle"===t.error||"forbidden_name"===t.error)){var r=n+i;if(r){var a=f("owner"),s=f("admin"),o=!!r.match(/admins/i),l=!!r.match(/owners/i);t.suggest_auto_group=!0,t.can_create_auto_owners=l&&TS.model.user.is_admin&&!a,t.can_enable_auto_owners=l&&a&&a.date_delete,t.can_create_auto_admins=o&&TS.model.user.is_admin&&!s,t.can_enable_auto_admins=o&&s&&s.date_delete}}return $("#user_group_alerts").html(TS.templates.user_group_alerts(t)),!0}return!1},g=function(){var e=$("#user_groups_header");if(e.length){var t=$("#user_groups_list_scroller");if(t.length){var n=e[0].offsetHeight,i=$(window).height(),r=.15*i,a=Math.max(250,i-n-r);t.css("height",a)}}},S=function(){var i=$("#user_groups_list_div");i&&!o&&(TS.interop.mountUserGroupsList(TS.boot_data.team_id,i[0],{isLegacy:!0,isUserGroupBrowser:!0,includeDeactivated:!0,onClearSearch:function(){return P()}}),i.addClass("ug_modern_list"),o=!0),e.removeClass("hidden"),t.addClass("hidden"),n.addClass("hidden"),T(),TS.ui.fs_modal.hideBackButton()},T=function(){$(window).on("resize",g),g(),$("#user_group_modal_search").on("keydown keyup change",A),(r=$("#user_groups_header .user_groups_search .icon_close")).off("click").on("click",P),e.off("click");var n=function(e,t){e&&(s=!1,S(t.subteam&&t.subteam.id?t.subteam.id:null))},i={owners:{create:function(){TS.interop.api.call("subteams.createAuto",{type:"owner"}).then((function(e){var t=e.data,i=e.args,r=e.request_id;return n&&n(!0,t),{data:t,args:i,request_id:r}})).catch((function(e){var t=e.data,i=e.args,r=e.request_id;return n&&n(!1,t),{data:t,args:i,request_id:r}}))},enable:function(){var e=f("owner");e&&TS.redux.dispatch(TS.interop.userGroups.enableUserGroup({subteam:e.id})).then((function(e){n(!0,e)}))}},admins:{create:function(){TS.interop.api.call("subteams.createAuto",{type:"admin"}).then((function(e){var t=e.data,i=e.args,r=e.request_id;return n&&n(!0,t),{data:t,args:i,request_id:r}})).catch((function(e){var t=e.data,i=e.args,r=e.request_id;return n&&n(!1,t),{data:t,args:i,request_id:r}}))},enable:function(){var e=f("admin");e&&TS.redux.dispatch(TS.interop.userGroups.enableUserGroup({subteam:e.id})).then((function(e){n(!0,e)}))}}};t.off("click").on("click","a.user_group_auto_action",(function(e){var t=$(e.target),n=t.data("auto-type"),r=t.data("auto-action");if(i[n]&&i[n][r])return i[n][r](),e.preventDefault(),!1}))},b=function(t,i){t?(j(),n.html(TS.templates.user_group_toggle({action:i,user_group:t})),n.find('[data-action="cancel"]').on("click",u),n.find(".user_group_toggle_btn").on("click",(function(){var e=$(this).data("action");_.includes(["enableUserGroup","disableUserGroup"],e)&&TS.redux.dispatch(TS.interop.userGroups[e]({subteam:t.id})).then((function(){"enableUserGroup"===e&&v(t),m()})).catch((function(e){var t=e.data;return h(!1,t)}))})),e.addClass("hidden"),n.removeClass("hidden"),p()):TS.warn("Cannot switch toggle view to undefined User Group")},v=function(e){var t=TS.interop.userGroups.getUserGroupById(e.id);t&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(t)||TS.interop.userGroups.upsertUserGroup(e),TS.interop.userGroups.searchLocalUserGroups()},y=function(n){j(),t.html(TS.templates.user_group_settings_form(n)),$("#user_group_default_channels").lazyFilterSelect(k(n)),x(n),e.addClass("hidden"),t.removeClass("hidden"),p()},w=function(e){return function(t){return function(e,t){var n=_.get(t,"prefs.channels",[]),i=n.length?TS.shared.ensureModelObsArePresent(n):Promise.resolve(),r={prefer_exact_match:!1,frecency:!1,allow_empty_query:!0,prefer_channels_user_belongs_to:!1,flat:!0},a={channels:{include_archived:!1},groups:{include_archived:!1},sort:!!e&&r};return i.then((function(){return TS.searcher.search(e,a)})).then((function(t){return e?t:TS.sorter.search(e,t,r)}))}(t,e).then((function(t){return{replace_all_items:!0,all_items_fetched:!0,items:_.map(t,(function(t){return{model_ob:t,lfs_id:t.id,preselected:function(e,t){if(!e||!t)return!1;var n=e&&e.id,i=t.prefs.channels.concat(t.prefs.groups);return _.includes(i,n)}(t,e)}}))}}))}},k=function(e){return{data_promise:w(e),template:function(e){var t=e.model_ob,n="";return n+=TS.interop.rules.channels.isPublicChannel(t)?"#":'<ts-icon class="ts_icon_lock ts_icon_inherit"></ts-icon>',n+=_.escape(t.name),TS.interop.rules.channels.isOrgShared(t)?n+=' <ts-icon class="ts_icon_shared_channel ts_icon_inherit"></ts-icon>':TS.interop.utility.isModelObjectExternal(t)&&(n+=TS.templates.shared_channels_icon({model_ob:t,tooltip:!0,connectedTeamIds:TS.interop.rules.channels.getConnectedTeamIds(TS.redux.getState(),t),inherit:!0})),new Handlebars.SafeString(n)},placeholder_text:""}},x=function(e){var n,i,r;e?(n=TS.interop.userGroups.updateUserGroup,i=!1,r=e.id):(n=TS.interop.userGroups.createUserGroup,i=!0);var a=$("#user_group_handle_input");a.on("input",(function(){$(this).closest(".handle_input").toggleClass("empty",!this.value.length)})),t.find(".user_group_settings_form").on("submit",(function(e){e.preventDefault();var t=$('input[name="name"]').val(),a=$('input[name="handle"]').val(),s=$('input[name="description"]').val(),o=$("#user_group_default_channels").lazyFilterSelect("value"),l={name:t,handle:a,description:s,channels:o=_.map(o,"model_ob.id")};r&&(l.subteam=r),TS.redux.dispatch(n(l)).then((function(e){v(e.subteam),i?C(e.subteam,i):m(),TS.user_groups.updated_info_sig.dispatch(e.subteam.id)})).catch((function(e){var t=e.data;return h(!1,t)}))})),t.find(".user_group_settings_form").on("reset",u);var s=$("#save_user_group"),o=$("#user_group_name_input");function l(){var e=o.val(),t=a.val();_.isEmpty(e)||_.isEmpty(t)?s.attr("disabled",!0):s.removeAttr("disabled")}s.length&&o.length&&a.length&&(o.on("change",l),o.on("keyup",l),a.on("change",l),a.on("keyup",l),l())},C=function(n,i){var r=!!n.is_external||!!n.auto_type,a=function(){t.html(TS.templates.user_group_members_form({is_new:i,is_locked:r,user_group:n}))},s=function(){var r=$("#member_count"),a=n.user_count||0,s=function(){var e=$(i?"#create_group":"#save_group");e.length&&(a<1?e.prop("disabled",!0):e.prop("disabled",!1))},o={approx_item_height:36,template:function(e){var t=TS.templates.user_group_invite_member_small(e);return new Handlebars.SafeString(t)},onItemAdded:function(){a+=1,r.html(a),s()},onItemRemoved:function(){a-=1,r.html(a),s()},filter:function(e,t){var n=e.member;"@"===t.charAt(0)&&(t=t.substr(1));var i=new RegExp("^"+TS.utility.regexpEscape(t),"i"),r=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(t),"i");return TS.utility.members.checkMemberMatch(n,i)||TS.utility.members.checkMemberMatch(n,r)},disabled:!!n.is_external||!!n.auto_type,data_promise:M(n)};$("#user_group_members_select").lazyFilterSelect(o),E(n),e.addClass("hidden"),t.removeClass("hidden"),j(),s()};if(i)a(),TS.ui.fs_modal.hideBackButton(),s();else{var o=function(){a(),p(),s()};if(!TS.user_groups.legacyNeedsToFetchMembership(n)){var l=_.get(n,"users",[]);return TS.interop.members.ensureMembersArePresent(l).then(o)}TS.interop.userGroups.getUserGroupMembers(n.id,(function(e){if(e&&e.users){n=e;var t=_.get(n,"users",[]);return TS.interop.members.ensureMembersArePresent(t).then(o)}}))}},M=function(e){var t=!0;return function(n,i){"@"===n.charAt(0)&&(n=n.substring(1));var r=!1;if(t&&(t=!1,_.get(e,"users.length")&&(r=!0)),r){var a=e.users.map((function(e){return TS.interop.members.getMemberById(e)}));a.sort(TS.interop.members.memberSorterByName);var s=a.map((function(e){return e?{member:e,lfs_id:String(e.id),preselected:!0}:{}}));return Promise.resolve(s)}return i>0?Promise.resolve([]):I({query:n,include_org:!1,include_slackbot:!1,include_self:!0,full_profile_filter:!1,include_bots:!0})}},I=function(e){return Promise.resolve().then((function(){return TS.members.promiseToSearchMembers(e).then((function(e){var t=[];return t=""===e.query?TS.utility.teams.getMembersForTeam(TS.model.team):e.items,e.items=t.filter(O).map((function(e){return{member:e,lfs_id:String(e.id)}})),e}))}))},E=function(e){t.find(".user_group_members_form").on("submit",(function(t){t.preventDefault();var n=$("#user_group_members_select").lazyFilterSelect("value");n=n.map((function(e){return e.member.id})),TS.redux.dispatch(TS.interop.userGroups.updateMembersOfUserGroup({subteam:e.id,users:n})).then((function(e){m(),TS.user_groups.updated_info_sig.dispatch(e.subteam.id)})).catch((function(e){var t=e.data;h(!1,t)}))})),t.find(".user_group_members_form").on("reset",(function(e){e.preventDefault(),u(e)}))},A=function(e){var t=$(e.target).val();t!==i&&(i=t,r.toggleClass("hidden",""===t),TS.interop.userGroups.setSearchQuery(i))},P=function(){var e=$("#user_group_modal_search");i="",e.val(""),setTimeout((function(){e.focus()}),0),r.addClass("hidden"),TS.interop.userGroups.setSearchQuery(i)},O=function(e){return!!e&&!(!TS.interop.rules.members.isMemberOnTeam(e,TS.model.team.id)||e.deleted||e.is_ultra_restricted||e.is_restricted||e.is_bot||TS.interop.rules.members.isSlackbot(e))},F=function(e){$("#user_groups_tab .count").html(e.length)},j=function(){o=!1;var e=$("#user_groups_list_div");TS.interop.unmountUserGroupsList(e[0])}}()},gm7A:function(e,t){!function(){TS.registerModule("ims",{switched_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,onStart:function(){TS.prefs.display_real_names_override_changed_sig.add(n),TS.prefs.team_display_real_names_changed_sig.add(n),TS.members.changed_profile_sig.add(t)},legacyRemoveMsg:function(e,t){var n=TS.interop.channels.getImById(e,!1);if(n){if(TS.redux.messages.removeMessage(t),TS.interop.messages.isReply(t)){n._archive_msgs&&TS.utility.msgs.spliceMsg(n._archive_msgs,t);var i=n.msgs;TS.utility.msgs.spliceMsg(i,t)}TS.ims.message_removed_sig.dispatch(n,t)}else TS.error('unknown im "'+e+'"')},legacyStartImByMemberId:function(e,t,n,i){TS.console.info("TS.ims.legacyStartImByMemberId",e),TS.shared.legacyGetActiveModelOb()&&TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessagesInChannel());var r=TS.interop.members.getMemberById(e);if(TS.interop.rules.members.isUnavailable(TS.redux.getState(),r))return TS.redux.dispatch(TS.interop.redux.actions.showUnavailableMemberToast({teamId:r.team_id})),Promise.resolve(!1);var a=TS.redux.channels.getImByMemberId(e);if(TS.ui.fs_modal.is_showing&&TS.ui.fs_modal.close(),a){if(TS.ims.legacyDisplayIm(a.id,t,"",i),a.is_open)return n&&TS.shared.legacySendMsg(a.id,$.trim(n)),Promise.resolve()}return TS.redux.dispatch(TS.interop.redux.features.pendingOpenChannel.addPendingOpenChannel({memberId:e,msgText:n})),TS.interop.channels.openConversationBetweenMembers({memberIds:[e],reason:"TS.ims.legacyStartImByMemberId"}).then((function(t){var n=t.data,i=t.args,r=t.request_id;if(TS.ims.legacyOnOpened&&(TS.ims.legacyOnOpened(!0,n,i,r),i.return_im&&TS.redux.channels.getImByMemberId(e))){var a=TS.redux.channels.getImByMemberId(e);TS.interop.channels.setConversationOpen(a.id,e)}return{data:n,args:i,request_id:r}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(!1,t,n,i),{data:t,args:n,request_id:i}}))},promiseToStartImByMemberId:function(e){var t;t=TS.redux.dispatch(TS.interop.actions.displayModelOrViewById({id:e})).catch((function(e){throw e&&"editing-message"===e.message&&TS.ui.fs_modal.close(),e}));var n=function(){var t=TS.shared.legacyGetActiveModelOb();return t&&t.is_im&&t.user===e};return n()?Promise.resolve():t.then((function(){return n()?Promise.resolve():new Promise((function(e){t=function(){if(n())return e()},TS.ims.switched_sig.add(t)})).timeout(3e4).finally((function(){TS.redux.dispatch(TS.interop.redux.features.pendingOpenChannel.clearPendingOpenChannel({memberId:e})),TS.ims.switched_sig.remove(t)}));var t})).catch(_.noop)},legacyOnOpened:function(e,t,n){e&&n.return_im&&t.channel&&TS.interop.channels.upsertChannel(t.channel)},legacyDisplayIm:function(e,t,n,i){TS.console.info("TS.ims.legacyDisplayIm",e),TS.telemeter.mark("start_channel_change_"+e),TS.redux.dispatch(TS.interop.redux.models.channelsMeta.prqMetrics.updateChannelLastFocus({lastFocus:TS.interop.redux.models.window.getWindowLastFocusEvent(TS.redux.getState()),objId:e}));var a=TS.interop.channels.getImById(e,!1);if(a){if(TS.utility.msgs.maybeClearPrevLastRead(),TS.utility.msgs.maybeClearPrevLastRead(a),e==(i||TS.model.active_im_id))return n&&TS.shared.legacySendMsg(a.id,$.trim(n)),void TS.console.info("TS.ims.legacyDisplayIm: im_id == TS.model.active_im_id",e,TS.model.active_im_id);TS.has_pri[r]&&TS.log(r,"legacyDisplayChannel (im): "+e),n&&TS.shared.legacySendMsg(a.id,$.trim(n))}else TS.error('im "'+e+'" unknown')},legacyMarkMostRecentReadMsg:function(e,t){e?TS.interop.channels.markMostRecentMsgRead({channelId:e.id,reason:t}):TS.error("im unknown")},getDisplayNameOfUserForIm:function(t){return e(t)}});var e=function(e){if(e._display_name)return e._display_name;var t=TS.interop.members.getMemberById(e.user);if(!t)return e.name;var n=TS.interop.members.getPrefCompliantMemberName(t);return n===e.user||n===t.id?e.name:(e._display_name=n,e._display_name)},t=function(e){var t=_.find(TS.model.ims,{user:e.id});t&&i(t)},n=function(){TS.model.ims.forEach(i)},i=function(e){e._display_name=void 0},r=999}()},j9dp:function(e,t,n){var i=n("cDf5");!function(){function e(e,t,n,i){if(!e)return{};if(!t||"string"!=typeof t||"channel"!==e&&"group"!==e&&"mpim"!==e&&"im"!==e||(t=TS.redux.channels.getEntityById(t)),!t)return{};if("message"===e&&n&&"string"==typeof n){var r=n;(n=TS.interop.channels.getPublicChannelById(r))||(n=TS.interop.channels.getImById(r)),n||(n=TS.interop.channels.getGroupById(r))}var a={},s=[],o=[];o=["star","ts_icon","ts_icon_star_o","ts_icon_inherit"];var l="ts_tip_top",d=t.id||t.ts,c=n?n.id:null;if("message"===e){if(!c)return{};a["data-msg-id"]=d,a["data-c-id"]=c,TS.interop.rules.messages.isTempMsg(t)&&o.push("invisible")}else if("file"===e)a["data-file-id"]=d;else if("file_comment"===e)a["data-comment-id"]=d,a["data-file-id"]=c,o.push("star_comment");else if("channel"===e)l="ts_tip_bottom",a["data-channel-id"]=d;else if("group"===e)l="ts_tip_bottom",a["data-group-id"]=d;else if("im"===e)l="ts_tip_bottom",a["data-im-id"]=d;else{if("mpim"!==e)return TS.error("buildStar needs to handle star item type:"+e),{};l="ts_tip_bottom",a["data-mpim-id"]=d}o=_.concat(o,l),t.is_starred&&(o.push("starred","ts_icon_star"),o.splice(o.indexOf("ts_icon_star_o"),1)),o.push("star_"+e),$.each(a,(function(e,t){s.push(e+'="'+t+'"')}));var u,m,p={message:TS.interop.i18n.t("message","templates_builders")(),file:TS.interop.i18n.t("file","templates_builders")(),file_comment:TS.interop.i18n.t("file comment","templates_builders")(),channel:TS.interop.i18n.t("channel","templates_builders")(),group:TS.interop.i18n.t("channel","templates_builders")(),im:TS.interop.i18n.t("direct message","templates_builders")(),app:TS.interop.i18n.t("app","templates_builders")(),mpim:TS.interop.i18n.t("direct message","templates_builders")()};switch(e){case"message":i?(u=TS.interop.i18n.t("Star message","templates_builders","34b1d30c4ba28fdac168af2100272fd9aeac1ad5")(),m=TS.interop.i18n.t("Unstar message","templates_builders","1e8aec29618ad627c4756e1922c40c8fcb3aea86")()):(u=TS.interop.i18n.t("Star this message","templates_builders")(),m=TS.interop.i18n.t("Unstar this message","templates_builders")());break;case"file":i?(u=TS.interop.i18n.t("Star file","templates_builders","42dd9b61d10f324bfe3bb8f2a5e7dc13ae2d8fea")(),m=TS.interop.i18n.t("Unstar file","templates_builders","92e7358e95824d6d7d58ad708dbb20e47656ad6d")()):(u=TS.interop.i18n.t("Star this file","templates_builders")(),m=TS.interop.i18n.t("Unstar this file","templates_builders")());break;case"file_comment":i?(u=TS.interop.i18n.t("Star file comment","templates_builders","23db127e219e9451f6f2cc9adbc4cc57ba9f8b07")(),m=TS.interop.i18n.t("Unstar file comment","templates_builders","6981fc4436ea029ab4dd573937de729fc0f7a50b")()):(u=TS.interop.i18n.t("Star this file comment","templates_builders")(),m=TS.interop.i18n.t("Unstar this file comment","templates_builders")());break;case"channel":case"group":i?(u=TS.interop.i18n.t("Star channel","templates_builders","f314f33a825d5dc3ac1683638acc464b2aae62fc")(),m=TS.interop.i18n.t("Unstar channel","templates_builders","1f6e79ac454ab33de1d19b242a90c340317ae97e")()):(u=TS.interop.i18n.t("Star this channel","templates_builders")(),m=TS.interop.i18n.t("Unstar this channel","templates_builders")());break;case"im":case"mpim":i?(u=TS.interop.i18n.t("Star direct message","templates_builders","a04b360e228e052a9853fbe7203ab22697daade3")(),m=TS.interop.i18n.t("Unstar direct message","templates_builders","d7d5187810a018277ffe3561a0e29edcc5b3528d")()):(u=TS.interop.i18n.t("Star this direct message","templates_builders")(),m=TS.interop.i18n.t("Unstar this direct message","templates_builders")());break;case"app":i?(u=TS.interop.i18n.t("Star app","templates_builders","74f6a6535ed4abed0178d1f93f41429ea6a3ed6a")(),m=TS.interop.i18n.t("Unstar app","templates_builders","fc640532bd4741f719542e97c41e2a68db1b3b52")()):(u=TS.interop.i18n.t("Star this app","templates_builders")(),m=TS.interop.i18n.t("Unstar this app","templates_builders")());break;default:u=TS.interop.i18n.t("Star","templates_builders")(),m=TS.interop.i18n.t("Unstar","templates_builders")()}return{attributes:s,class_names:o,html_attrs:a,readable_type:p[e],type:e,is_starred:t.is_starred,star_str:u,unstar_str:m}}TS.registerModule("templates.builders",{buildStarComponents:function(t,n,i,r){return e(t,n,i,r)},fileHTML:function(e,t){t=t||{};var n=TS.utility.members.getEntityFromFile(e),i=TS.files.getFileActions(e),r="hosted"===e.mode||"external"===e.mode,a={member:n,file:e,for_search:t.for_search,is_enterprise:t.is_enterprise,for_files_list:!t.for_share_dialog,show_channel_name:t.show_channel_name,icon_class:TS.utility.getImageIconClass(e,"thumb_80"),is_email:"email"===e.mode,is_space:"space"===e.mode,is_post:"post"===e.mode,is_docs:"docs"===e.mode,is_snippet:"snippet"===e.mode,is_hosted_or_external:r,has_image:r&&e.thumb_80&&!e.has_rich_preview,can_share:!!i.share&&"docs"!==e.mode,feature_file_threads:TS.boot_data.feature_file_threads};return TS.interop.files.isHiddenByStorageLimit(e)&&_.assign(a,TS.files.getHiddenFileTemplateArgs(t.viewContext)),a.supports_line_clamp=TS.environment.supports_line_clamp,"external"===e.mode&&(a.external_filetype_html=TS.templates.builders.makeExternalFiletypeHTML(e)),"email"===e.mode&&(a.to_more_count=e.to.length-1,a.cc_more_count=e.cc.length-1),TS.templates.file_list_item(a)},buildReplyBarHTML:function(e,t){var n={msg:e,model_ob:t,conversation_permalink:TS.utility.msgs.constructConversationPermalink(t,e.thread_ts)},i=e.replies;if(e.reply_users)n.num_replies=e.reply_count,n.first_repliers=_.chain(e.reply_users).take(5).map((function(e){return TS.interop.utility.looksLikeBotId(e)?TS.interop.bots.getBotById(e):TS.redux.members.getPotentiallyUnknownMemberById(e)})).compact().value(),n.additional_reply_count=e.reply_users_count-n.first_repliers.length;else if(i&&i.length){n.num_replies=i.length;var r=_.chain(i).uniqBy("user").map((function(e){return TS.interop.utility.looksLikeBotId(e.user)?TS.interop.bots.getBotById(e.user):TS.redux.members.getPotentiallyUnknownMemberById(e.user)})).compact().value();n.first_repliers=_.take(r,5),n.additional_reply_count=r.length-n.first_repliers.length}if(n.num_replies){var a=e.latest_reply?e.latest_reply:i&&i.length&&_.last(i).ts,s=TS.interop.datetime.toDateObject(a);TS.interop.datetime.isSameDay(s,new Date)?1===n.num_replies?n.last_reply_at=TS.interop.i18n.t("Today at {time}","threads")({time:TS.interop.datetime.formatDate(a,"{time}",{do24hrTime:TS.utility.date.do24hrTime()})}):n.last_reply_at=TS.interop.i18n.t("Last reply today at {time}","threads")({time:TS.interop.datetime.formatDate(a,"{time}",{do24hrTime:TS.utility.date.do24hrTime()})}):1===n.num_replies?n.last_reply_at=TS.interop.datetime.toTimeAgo(a):n.last_reply_at=TS.interop.i18n.t("Last reply {time_ago}","threads")({time_ago:TS.interop.datetime.toTimeAgo(a)})}return TS.templates.message_reply_bar(n)},formatSoundUrl:function(e,t){return""},buildAttachmentActions:function(e,t,n){return e.actions.map((function(i){switch(i.type){case"button":return TS.templates.builders.buildAttachmentActionButtonHTML(i,n);case"select":return TS.templates.builders.buildAttachmentActionSelectHTML(i,n,t,e.id)}})).join("")},buildAttachmentHTML:function(e){var t=e.msg_dom_id||TS.templates.makeMsgDomId(e.msg.ts),n=e.attachment,i=e.model_ob||TS.shared.legacyGetActiveModelOb();if(TS.templates.builders.shouldDoSimpleAttachment(n,e.msg)){if(n.video_html)return TS.templates.builders.buildInlineVideoTogglerAndDiv(n.from_url,t);if(n.image_url)return TS.templates.builders.buildInlineImgTogglerAndDiv(n.from_url,t,e);if(n.audio_url)return" "+TS.templates.builders.formatSoundUrl(n,e.msg)}n.color&&("number"==typeof n.color&&(n.color=n.color.toString()),n.color.indexOf?n.color=n.color.replace(/#/g,""):(TS.warn("msg "+e.msg.ts+" has an invalid (non string) color:"+n.color+" (removed in client)"),delete n.color));var r=[],a=[];if(n.fields)for(var s,o,l,d=0;d<n.fields.length;d+=1)o=!0,s=n.fields[d],l&&s.short&&l.short&&l._new_row&&(o=!1),s._new_row=o,l=s,s.short?r.push(s):a.push(s);var c=!n._always_expand&&n._short_text&&!TS.inline_attachments.shouldExpandText(TS.templates.makeMsgAttachmentTextExpanderDomId(e.msg.ts,n._index)),u=!!n.more,m=n.from_url||n.ts_link||n.title_link||n.author_link,p="reply_broadcast"===_.get(e.msg,"subtype"),f=n.thumb_link||m,h=!1;i?!1!==e.can_delete&&(h=(n.id||0===n.id)&&(n.from_url||e.msg.text)&&(TS.model.user.is_admin&&!i.is_im||TS.model.user.id==e.msg.user)&&"pinned_item"!==e.msg.subtype&&!p):TS.warn("need to get model_ob passed in here somehow! for expanding messages in activity feed");var g=n.thumb_url&&!n.image_url&&!n.video_html&&!n.audio_html,S=g?n.proxied_thumb_url||n.thumb_url:null,T=!1,b="";if(n.is_msg_unfurl){var v=TS.utility.msgs.getMsg(n.ts,i.msgs);v&&v.pinned_to&&v.pinned_to.length>0&&(T=_.some(v.pinned_to,(function(e){return e===i.id})))&&!p&&(b=TS.templates.builders.buildPinInfoHtml(v))}var y=!1;p&&(y=n.ts?TS.interop.datetime.formatDate(n.ts,"{time}",{do24hrTime:TS.utility.date.do24hrTime()}):TS.interop.datetime.formatDate(e.msg.ts,"{time}",{do24hrTime:TS.utility.date.do24hrTime()}));var w=n.from_url&&e.has_container;p&&(w=!0);var k={is_text_collapsed:c,has_more:u,attachment:n,attachment_meta:y,pin_html:b,short_fields:r,long_fields:a,msg:e.msg,msg_dom_id:t,real_src:TS.utility.attachments.getMediaSource(n),is_standalone:!e.msg.text||e.msg.ignore_if_attachments_supported||!n.pretext,show_fields_table:"0"!=TS.qs_args.show_fields_table,can_delete:h,thumb_link:f,small_thumb_url:S,show_fallback:TS.model.show_attachment_fallback,enable_slack_action_links:!0===e.enable_slack_action_links,render_file_threads:n.is_msg_unfurl&&TS.interop.messages.shouldRenderFileThread(n)};if(!e.from_post){var x,C="web"===TS.boot_data.app||!0!==e.enable_slack_action_links;if(C&&(x="web"===TS.boot_data.app?"ARCHIVES":TS.shared.legacyGetActiveModelOb()&&TS.shared.legacyGetActiveModelOb().is_channel&&!TS.shared.legacyGetActiveModelOb().is_member?"CHANNEL_PREVIEW":"OTHER"),(k=_.assign(k,{attachment:n,has_actions:!(_.isEmpty(n.actions)&&_.isEmpty(n.legacy_actions)),has_source:_.some(n._source),has_border:e.has_border,has_indent:n.indent,has_container:e.has_container,has_media:e.show_media_caret,has_text_content:!(!n.text&&!n.title),has_thumb:!!g,has_footer:!!(n.footer||n.footer_icon||n.ts||n._attribution)&&!p,disable_actions:C,disable_actions_reason:x,border_color:n.color&&"#"+n.color||null,break_border:e.break_border,caret_location:TS.utility.attachments.getMediaCaretLocation(n)})).applied_classes=TS.utility.getAppliedClasses({inline_attachment:!0,standalone:k.is_standalone,has_thumb:k.has_thumb,can_delete:k.can_delete,clickable:w,message_unfurl:n._unfurl_type_message,reply_broadcast:p,is_pinned:T}),k.has_footer&&k.attachment.is_msg_unfurl){var M=TS.utility.attachments.getSlackMessageFooterText(k.attachment,k.msg);M&&(k.attachment.footer=M)}return TS.templates.message_attachment(k)}var I=!0,E="";if(e.show_initial_caret||e.show_media_caret)switch(TS.utility.attachments.getMediaType(n)){case"video":var A=TS.model.inline_videos[n.from_url||n.thumb_url];if(A){E=TS.templates.builders.buildInlineVideoToggler(n.from_url||n.thumb_url,t,!0),I=TS.inline_videos.shouldExpand(t,A)}break;case"audio":var P=TS.model.inline_audios[n.audio_html||n.audio_url];P&&(E=TS.templates.builders.buildInlineAudioToggler(n.audio_html||n.audio_url,t),I=TS.inline_audios.shouldExpand(t,P));break;case"other":var O=TS.model.inline_others[n.other_html];O&&(E=TS.templates.builders.buildInlineOtherToggler(n.other_html,t),I=TS.inline_others.shouldExpand(t,O));break;case"image":var F=TS.model.inline_imgs[n.from_url||n.image_url];if(F){var j=!e.show_media_caret;E=TS.templates.builders.buildInlineImgToggler(n.from_url||n.image_url,t,j),I=TS.inline_imgs.shouldExpand(t,F)}break;default:var $=TS.model.inline_attachments[n.from_url];$?(E=TS.templates.builders.buildInlineAttachmentToggler(n.from_url,t),I=TS.inline_attachments.shouldExpand(t,$)):TS.warn("no inline_attachment for "+n.from_url)}return _.assign(k,{initial_caret_html:e.show_initial_caret?new Handlebars.SafeString(E):"",media_caret_html:e.show_media_caret?new Handlebars.SafeString(E):"",expand_media:!e.show_media_caret||I,expand_it:!e.show_initial_caret||I,bg_color:n.color||"e3e4e6",thumb_at_top:!0,ts_link:m,small_thumb:g,max_width_class:g?"right_thumb_max_w":"",show_action_links:!0===e.enable_slack_action_links,has_content:e.has_content}),TS.templates.spaces_attachment(k)},buildAttachmentActionButtonHTML:function(e,t){var n={_disabled:t=!0===t,_loading:!1,id:"",name:"",style:"default",text:"",value:""},i=e.clicked&&e.clicked_text?e.clicked_text:e.text,r=TS.emoji.graphicReplace(i),a=_.merge({},n,e,{btn_class:{default:"",primary:"btn_primary",danger:"btn_danger"}[e.style],current_text:i,formatted_text:new Handlebars.SafeString(r)});return e.url&&(a.url=TS.interop.url.simpleIsUrl(e.url)?e.url:"#"),a.data_qa_value="button-"+a.name.replace("_","-"),TS.templates.attachment_actions_button(a)},buildAttachmentActionSelectHTML:function(e,t,n,i){var r=TS.attachment_actions.select.getActionModel(e,t);if(r._disabled){var a=['ts-message[data-ts="'+n+'"]','[data-attachment-id="'+i+'"]','[data-action-id="'+e.id+'"]'].join(" "),s=$(a).next(".lazy_filter_select");return s.length?s.clone().addClass("disabled")[0].outerHTML:""}return TS.templates.attachment_actions_select(r)},shouldDoSimpleAttachment:function(e,t){var n=!1;return!t.standalone_attachment&&((e.image_url||e.audio_url)&&e.from_url&&(t&&t.text&&(-1!=t.text.indexOf(e.from_url)&&(n=!0),TS.model.ampersands_are_inconsistent_in_from_urls&&-1!=t.text.indexOf(e.from_url.replace(/&/g,"&amp;"))&&(n=!0)),(e.service_name||e.title)&&(n=!1)),n)},formatAttachments:function(e,t,n,i){if(!e.attachments)return"";var r,a,s="",o=[],l=e.attachments.length;for(e.attachments.length>=20&&(e._shown_attachments||(e._shown_attachments=20),l=e._shown_attachments),r=0;r<l;r+=1)((a=e.attachments[r]).pretext||0===r)&&o.push([]),_.last(o).push(a);for(r=0;r<o.length;r+=1)s+=TS.templates.builders.formatAttachmentGroup(o[r],e,n,i,t);return e._shown_attachments<e.attachments.length&&(s+=TS.templates.builders.getShowMoreAttachmentHTML(e)),s},formatAttachmentGroup:function(e,t,n,i,r){n=!0===n;var a="",s=!1;e=e.map((function(e){return TS.utility.attachments.getDecoratedAttachment(e,t)}));var o=t&&"reply_broadcast"===t.subtype;o&&(s=!0);var l,d=s&&_.some(e,TS.utility.attachments.getMediaType),c=!s||_.some(e,"color"),u=_.some(e,"from_url"),m=_.some(e,"indent"),p=!1;if(o){var f=t.channel_id||_.get(e[1],"channel_id"),h=t.broadcast_thread_ts;if((!f||!/\d+\.\d+/.test(h))&&e[1]&&e[1].from_url){var g=e[1].from_url,S=TS.interop.url.urlQueryStringParse(g);S.cid&&(f=S.cid),S.thread_ts&&(h=S.thread_ts)}if((r=TS.redux.channels.getEntityById(f))&&h){h.indexOf(".")<0&&(h=h.substr(0,10)+"."+h.substr(10));var T={thread_ts:h,model_ob_id:r.id,convo_href:TS.utility.msgs.constructConversationPermalink(r,h)};p=TS.templates.reply_broadcast_preamble(T),p=new Handlebars.SafeString(p)}}for(var b=0;b<e.length;b+=1)if(l=e[b])if(l.from_url&&(TS.boot_data.feature_attachments_inline||TS.templates.builders.shouldDoSimpleAttachment(l,t)))a+="";else if(l.ts&&(l.ts_link=TS.utility.msgs.constructMsgPermalink(r,l.ts.toString())),TS.inline_attachments.legacyShouldShow(l,t)){if(l.actions&&l.actions.length){for(var v,y=["button","select"],w=[],k=[],x=0;x<l.actions.length;x+=1)v=l.actions[x],_.includes(y,v.type)?k.push(v):w.push(v);w.length&&(l.legacy_actions=w),k.length&&(l.actions=k)}var C=TS.utility.attachments.hasContent(l,["pretext"]);if(C){var M=e[b+1];a+=TS.templates.builders.buildAttachmentHTML({model_ob:r,attachment:l,has_border:c,has_indent:m,has_container:s,break_border:c&&M&&l.color!=M.color,url:null,msg:t,msg_dom_id:i,show_initial_caret:TS.templates.builders.shouldDoSimpleAttachment(l,t),show_media_caret:l.video_html||l.image_url||l.audio_html||l.audio_url||l.other_html,enable_slack_action_links:n,has_content:C})}o&&0===b&&(a+=TS.templates.reply_broadcast_count(l))}else a+="";else TS.info("formatAttachments bad attach"),TS.dir(0,t);return a||l.pretext?TS.templates.attachment_group({model_ob:r,first_attachment:e[0],preamble:p,msg:t,has_border:c,has_indent:m,has_container:s,has_link:u,use_shrink_wrap:d,attachments_html:a&&new Handlebars.SafeString(a),enable_slack_action_links:n}):a},getShowMoreAttachmentHTML:function(e){var t,n=e.attachments.length-e._shown_attachments,i=e.ts;return t=TS.interop.i18n.t("{count, plural, =1 {# more attachment} other {# more attachments}}","attachments")({count:n}),TS.templates.show_more_attachment({ts:i,btn_text:t,clickable_show_more_link:!1})},formatMessageAsAttachment:function(e,t){var n,i,r;if(e.user?i=e.user:"file_comment"===e.subtype&&e.comment&&e.comment.user?i=e.comment.user:e.bot_id&&(r=e.bot_id),!e.text&&e.attachments&&e.attachments.length>=1&&e.attachments[0].is_share)n={author_name:e.attachments[0].author_name,author_subname:e.attachments[0].author_subname,author_icon:e.attachments[0].author_icon,author_link:e.attachments[0].author_link};else if(i){var a=TS.interop.members.getMemberById(i);(n={}).author_name=TS.interop.members.getPrefCompliantMemberName(a),a.profile&&(n.author_icon=a.profile.image_24),n.author_link="/team/"+i}else if(r){var s=TS.redux.bots.getBotByMsg(e);n={author_subname:e.username||s.name,author_icon:s&&s.icons&&s.icons.image_48,author_link:"/services/"+r},e.icons&&e.icons.emoji&&e.icons.image_64&&(n.author_icon=e.icons.image_64)}if(!n)return TS.error("no author for msg "+e.ts),"";var o=_.extend({},n,{is_msg_unfurl:!0,id:1,ts:e.ts,from_url:TS.utility.msgs.constructAbsoluteMsgPermalink(t,e.ts),msg_subtype:e.subtype});if(e.text)o.text=e.text,o.mrkdwn_in_hash={text:!0};else if(e.attachments&&e.attachments.length>=1){var l=e.attachments[0];o.text=l.text||l.pretext}if(TS.interop.messages.shouldRenderFileThread(e)){var d=TS.utility.msgs.getFileOnMsg(e),c=_.isString(d)?TS.files.getFileById(d):d;o.files=[c]}TS.inline_attachments.massageAttachment(o,0),o=TS.utility.attachments.getDecoratedAttachment(o,e);var u=TS.templates.builders.buildAttachmentHTML({attachment:o,msg:e,can_delete:!1,has_content:!0,has_border:!0});return u=TS.templates.attachment_group({msg:e,attachments_html:new Handlebars.SafeString(u)})},getMemberCurrentStatusForDisplay:function(e,t){var n=TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),e&&e.id),i="";return n.text&&(i+='<span class="prevent_copy_paste" aria-label=" "></span>'+TS.format.formatCurrentStatus(n.text,void 0,t)),TS.format.formatCurrentStatus(n.emoji,void 0,_.assign({transform_missing_emoji:!0},t))+i},buildBotStr:function(e,t){var n;n=TS.interop.utility.isModelObjectExternal(t)||TS.interop.rules.channels.isOrgShared(t)?e.bot_link?TS.interop.bots.getBotNameByBotLink(e.bot_link):TS.interop.bots.getBotNameByBotLink(e.text):TS.interop.bots.getBotNameById(e.bot_id);var i=_.escape(n),r=TS.interop.i18n.safeString("<"+TS.boot_data.team_url+"services/"+e.bot_id+"/|"+i+">");switch(e.subtype){case"bot_add":return TS.interop.i18n.t("added an integration to this channel: {bot_url}","templates_builders")({bot_url:r});case"bot_enable":return TS.interop.i18n.t("enabled an integration in this channel: {bot_url}","templates_builders")({bot_url:r});case"bot_disable":return TS.interop.i18n.t("disabled an integration in this channel: {bot_url}","templates_builders")({bot_url:r});case"bot_remove":return TS.interop.i18n.t("removed an integration from this channel: {bot_url}","templates_builders")({bot_url:r});default:return TS.interop.i18n.t("updated an integration in this channel: {bot_url}","templates_builders")({bot_url:r})}},formatMessageByType:function(e,t,n,i){var r,a,s,o,l,d,c,u,m,p,f="";if(e.ignore_if_attachments_supported)return f;if(t=!0===t,n=!0===n,e._jl_rollup_hash&&e.user in e._jl_rollup_hash.users){var h,g,S,T,b,v=function(e){e=e.map((function(e){return e.id}));var t,n=_.remove(e,(function(e){return!TS.redux.members.hasMemberWithId(e)}));if(0===e.length)return[];if(e.length>101){var i=e.length-100+n.length;e=e.splice(0,100),t=TS.interop.i18n.t("{count, plural, =1 {# other} other {# others}}","joined_left")({count:i})}else n.length&&(t=TS.interop.i18n.t("{count, plural, =1 {# other} other {# others}}","joined_left")({count:n.length}));return e=e.map((function(e){return TS.interop.members.getPrefCompliantMemberNameById(e,!1,false)})),t&&e.push(t),e},y=function(e){var t=TS.interop.members.getPrefCompliantMemberNameById(e,true,false);return TS.interop.i18n.safeString('<button type="button" class="btn_unstyle internal_member_link member_preview_link" data-member-id="'+e+'">'+t+"</button>")},w={joined:[],joined_left:[],left:[],left_rejoined:[]};for(var k in e._jl_rollup_hash.users)if(k!==e.user){var x={id:k,inviter:(T=e._jl_rollup_hash.users[k]).inviter};T.is_in?T.left&&T.joined?w.left_rejoined.push(x):w.joined.push(x):T.joined&&T.left?w.joined_left.push(x):w.left.push(x)}if(o=i.is_group||i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:"no_name",(T=e._jl_rollup_hash.users[e.user]).is_in)if(T.left&&T.joined)if(T.inviter){var C=w.left_rejoined.filter((function(e){return e.inviter===T.inviter}));w.left_rejoined=w.left_rejoined.filter((function(e){return e.inviter===T.inviter})),h=C.length?C[0].id:null,b=v(C),f=TS.interop.i18n.t('left and rejoined {channel_name, select, no_name {the channel} other {{channel_name}}} by invitation from {inviter}{count, plural, =0 {} =1 {, along with {user}} other {, along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:C.length,user:y(h),channel_name:o,inviter:y(T.inviter),others:TS.interop.i18n.listify(b).join(""),classes:b.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}else h=w.left_rejoined.length?w.left_rejoined[0].id:null,b=v(w.left_rejoined),f=TS.interop.i18n.t('left and rejoined {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:w.left_rejoined.length,user:y(h),channel_name:o,others:TS.interop.i18n.listify(b).join(""),classes:b.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""}),w.joined_left=[];else if(T.inviter){var M=w.joined.filter((function(e){return e.inviter===T.inviter}));w.joined=w.joined.filter((function(e){return e.inviter!==T.inviter})),h=M.length?M[0].id:null,b=v(M);var I={count:M.length,user:y(h),channel_name:o,inviter:y(T.inviter),others:TS.interop.i18n.listify(b).join(""),classes:b.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""};f=TS.interop.i18n.t('was added to {channel_name, select, no_name {the channel} other {{channel_name}}} by {inviter}{count, plural, =0 {} =1 {, along with {user}} other {, along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left","1da8514b4122b0754451ae7944a56a7ca86af5a7")(I)}else h=w.joined.length?w.joined[0].id:null,b=v(w.joined),f=TS.interop.i18n.t('joined {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:w.joined.length,user:y(h),channel_name:o,others:TS.interop.i18n.listify(b).join(""),classes:b.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""}),w.joined=[];else T.joined&&T.left?(h=w.joined_left.length?w.joined_left[0].id:null,b=v(w.joined_left),f=TS.interop.i18n.t('joined and left {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:w.joined_left.length,user:y(h),channel_name:o,others:TS.interop.i18n.listify(b).join(""),classes:b.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""}),w.joined_left=[]):(h=w.left.length?w.left[0].id:null,b=v(w.left),f=TS.interop.i18n.t('left {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:w.left.length,user:y(h),channel_name:o,others:TS.interop.i18n.listify(b).join(""),classes:b.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""}),w.left=[]);var E=!0;if(w.left_rejoined.length){g=w.left_rejoined.shift().id,S=w.left_rejoined.length?w.left_rejoined[0].id:null;var A=E?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left and rejoined.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left and rejoined.',"joined_left");E=!1,b=v(w.left_rejoined),f+=" ",f+=A({count:w.left_rejoined.length,userA:y(g),userB:y(S),others:TS.interop.i18n.listify(b).join(""),classes:b.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(w.joined.length){g=w.joined.shift().id,S=w.joined.length?w.joined[0].id:null;var P=E?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined.',"joined_left");E=!1,b=v(w.joined),f+=" ",f+=P({count:w.joined.length,userA:y(g),userB:y(S),others:TS.interop.i18n.listify(b).join(""),classes:b.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(w.joined_left.length){g=w.joined_left.shift().id,S=w.joined_left.length?w.joined_left[0].id:null;var O=E?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined and left.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined and left.',"joined_left");E=!1,b=v(w.joined_left),f+=" ",f+=O({count:w.joined_left.length,userA:y(g),userB:y(S),others:TS.interop.i18n.listify(b).join(""),classes:b.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(w.left.length){g=w.left.shift().id,S=w.left.length?w.left[0].id:null;var F=E?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left.',"joined_left");E=!1,b=v(w.left),f+=" ",f+=F({count:w.left.length,userA:y(g),userB:y(S),others:TS.interop.i18n.listify(b).join(""),classes:b.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}}else"channel_join"===e.subtype||"app_conversation_join"===e.subtype?(s=TS.interop.members.getMemberById(e.inviter),h=TS.interop.members.getMemberById(e.user),o=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")(),s?(l=TS.interop.i18n.safeString("<@"+s.id+"|"+s.name+">"),r=h&&h.is_app_user?TS.interop.i18n.t("was added to this conversation by {inviter}.","templates_builders")({inviter:l}):TS.interop.i18n.t("joined {channel_name} from an invitation by {inviter}","templates_builders")({channel_name:o,inviter:l}),f=TS.format.formatNoHighlightsNoSpecials(r,e)):f=TS.interop.i18n.t("joined {channel_name}","templates_builders")({channel_name:o})):"channel_leave"===e.subtype||"app_conversation_leave"===e.subtype?(s=TS.interop.members.getMemberById(e.inviter),h=TS.interop.members.getMemberById(e.user),o=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")(),s&&h&&h.is_app_user?(l=TS.interop.i18n.safeString("<@"+s.id+"|"+s.name+">"),r=TS.interop.i18n.t("was removed from this conversation by {inviter}.","templates_builders")({inviter:l}),f=TS.format.formatNoHighlightsNoSpecials(r,e)):f=TS.interop.i18n.t("left {channel_name}","templates_builders")({channel_name:o})):"channel_name"===e.subtype?f=TS.interop.i18n.t('renamed the channel from "{old_name}" to "{new_name}"',"templates_builders")({old_name:e.old_name,new_name:e.name}):"channel_topic"===e.subtype?e.topic?(c=TS.format.formatWithOptions(e.topic,e,{no_highlights:!0}),f=TS.interop.i18n.t('set the channel topic: <span class="topic no_jumbomoji">{topic}</span>',"templates_builders")({topic:TS.interop.i18n.safeString(c)})):f=TS.interop.i18n.t("cleared the channel topic","templates_builders")():"channel_purpose"===e.subtype?e.purpose?(u=TS.format.formatWithOptions(e.purpose,e,{no_highlights:!0}),f=TS.interop.i18n.t('set the channel purpose: <span class="purpose no_jumbomoji">{purpose}</span>',"templates_builders")({purpose:TS.interop.i18n.safeString(u)})):f=TS.interop.i18n.t("cleared the channel purpose","templates_builders")():"group_join"===e.subtype?(d=(a=i)?TS.model.group_prefix+a.name:TS.interop.i18n.t("the private channel","templates_builders")(),(s=TS.interop.members.getMemberById(e.inviter))?(l=TS.interop.i18n.safeString("<@"+s.id+"|"+s.name+">"),r=TS.interop.i18n.t("joined {group_name} from an invitation by {inviter}","templates_builders")({group_name:d,inviter:l}),f=TS.format.formatNoHighlightsNoSpecials(r,e)):f=TS.interop.i18n.t("joined {group_name}","templates_builders")({group_name:d})):"group_leave"===e.subtype?(d=(a=i)?TS.model.group_prefix+a.name:TS.interop.i18n.t("the private channel","templates_builders")(),f=TS.interop.i18n.t("left {group_name}","templates_builders")({group_name:d})):"group_name"===e.subtype?f=TS.interop.i18n.t('renamed the private channel from "{old_name}" to "{new_name}"',"templates_builders")({old_name:e.old_name,new_name:e.name}):"group_topic"===e.subtype?e.topic?(c=TS.format.formatWithOptions(e.topic,e,{no_highlights:!0}),f=TS.interop.i18n.t('set the channel topic: <span class="no_jumbomoji">{topic}</span>',"templates_builders")({topic:TS.interop.i18n.safeString(c)})):f=TS.interop.i18n.t("cleared the channel topic","templates_builders")():"group_purpose"===e.subtype?e.purpose?(u=TS.format.formatWithOptions(e.purpose,e,{no_highlights:!0}),f=TS.interop.i18n.t('set the channel purpose: <span class="no_jumbomoji">{purpose}</span>',"templates_builders")({purpose:TS.interop.i18n.safeString(u)})):f=TS.interop.i18n.t("cleared the channel purpose","templates_builders")():"group_archive"===e.subtype?(d=(a=i)?TS.model.group_prefix+a.name:TS.interop.i18n.t("the private channel","templates_builders")(),m=TS.interop.i18n.safeString(_.escape(TS.redux.teams.getSelfEnterpriseOrgName())),1==a.is_moved?f=TS.interop.i18n.t("moved {group_name} to another {enterprise_name} workspace","templates_builders")({group_name:d,enterprise_name:m}):0==a.is_moved&&(f=TS.interop.i18n.t("archived {group_name}","templates_builders")({group_name:d}))):"group_unarchive"===e.subtype?(d=(a=i)?TS.model.group_prefix+a.name:TS.interop.i18n.t("the private channel","templates_builders")(),f=TS.interop.i18n.t("un-archived {group_name}","templates_builders")({group_name:d})):"channel_archive"===e.subtype?(o=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")(),m=TS.interop.i18n.safeString(_.escape(TS.redux.teams.getSelfEnterpriseOrgName())),i&&1==i.is_moved&&(f=TS.interop.i18n.t("moved {channel_name} to another {enterprise_name} workspace","templates_builders")({channel_name:o,enterprise_name:m}))):"channel_unarchive"===e.subtype?(o=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")(),f=TS.interop.i18n.t("un-archived {channel_name}","templates_builders")({channel_name:o})):"me_message"===e.subtype?f="<i>"+TS.format.formatWithOptions(e.text,e,{do_inline_imgs:t})+"</i>":"play_sound"===e.subtype?f=TS.interop.i18n.t('played "{msg_sound}"',"templates_builders")({msg_sound:e.sound}):"bot_add"===e.subtype||"bot_enable"===e.subtype||"bot_updated"===e.subtype||"bot_disable"===e.subtype||"bot_remove"===e.subtype?(p=TS.templates.builders.buildBotStr(e,i),f=TS.format.formatWithOptions(p,e,{do_inline_imgs:t,enable_slack_action_links:n,no_highlights:!0})):f="reminder_add"===e.subtype||"reminder_delete"===e.subtype?TS.format.formatWithOptions(e.text,e,{do_inline_imgs:t,enable_slack_action_links:n,no_highlights:!0}):TS.format.formatWithOptions(e.text,e,{do_inline_imgs:t,enable_slack_action_links:n});return f||""===f?f=TS.utility.msgs.handleSearchHighlights(f):(TS.warn("no html msg.subtype:"+e.subtype),"")},buildStar:function(t,n,i){var r=e(t,n,i);return _.isObject(r)?TS.templates.star(r):{}},buildStarWithTip:function(t,n,i){var r=e(t,n,i);return _.isObject(r)?TS.templates.star_with_tip(r):{}},buildPinInfoHtml:function(e){var t={},n=TS.interop.channels.getChannelPinnedItemByMessage({message:e,channel:TS.shared.legacyGetActiveModelOb()}),i={};n.createdBy&&n.createdTs?(i=TS.redux.members.getPotentiallyUnknownMemberById(n.createdBy),t.user=i,t.ts=n.createdTs,t.complete_data=t.user&&t.ts):t.complete_data=!1,t.unknown_member_token=new Handlebars.SafeString(TS.templates.unknown_member({id:i.id}));var r=TS.templates.pinned_message_info(t);return new Handlebars.SafeString(r)},buildInlineImgTogglerAndDiv:function(e,t,n){return TS.model.inline_imgs[e]?TS.templates.builders.buildInlineImgToggler(e,t)+" "+TS.templates.builders.buildInlineImgDiv(e,t,n):""},buildInlineImgToggler:function(e,t,n,i){var r=TS.model.inline_imgs[e];if(!r)return TS.warn(8675309,"buildInlineImgToggler did not find anything in TS.model.inline_imgs for key:"+e),"";var a=TS.inline_imgs.shouldExpand(t,r,i),s=r.link_url||e,o=r.bytes&&r.bytes>TS.model.inline_img_byte_limit,l=r.width&&r.height&&r.width*r.height>TS.model.inline_img_pixel_limit,d=!l,c="",u="";if(!a&&(!TS.prefs.getPref("obey_inline_img_limit")||o)||l){var m=!r.internal_file_id&&TS.prefs.getPref("expand_inline_imgs")&&!1!==TS.model.expandable_state["img_"+t+r.src];if(m&&l)d=!1,c='<span class="too_large_for_auto_expand"> '+(u=TS.interop.i18n.t("(Not automatically expanded because {img_width}x{img_height} is too large to display inline.)","templates_builders")({img_width:r.width,img_height:r.height}))+"</span>";else if(m&&o){var p=TS.interop.i18n.t("Open original in new tab","templates_builders")(),f="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+p+'">';TS.model.show_inline_img_size_pref_reminder&&!TS.model.shown_inline_img_size_pref_reminder_once?(u=TS.interop.i18n.t('(Not automatically expanded because {file_size} is too large. \t\t\t\t\t\tYou can <a class="cursor_pointer too_large_but_expand_anyway" data-real-src="{real_src}">expand it anyway</a> or {referer_link_a_tag}open it in a new window</a>.)',"templates_builders","75620bd59d53a9caaec56a62eb8b3b42e3fc98e5")({file_size:TS.interop.utility.convertFilesize(r.bytes),real_src:TS.interop.i18n.safeString(_.escape(r.src)),referer_link_a_tag:TS.interop.i18n.safeString(f)}),TS.model.shown_inline_img_size_pref_reminder_once=!0):u=TS.interop.i18n.t('(Not automatically expanded because {file_size} is too large. \t\t\t\t\t\tYou can <a class="cursor_pointer too_large_but_expand_anyway" data-real-src="{real_src}">expand it anyway</a> or {referer_link_a_tag}open it in a new window</a>.)',"templates_builders")({file_size:TS.interop.utility.convertFilesize(r.bytes),real_src:TS.interop.i18n.safeString(_.escape(r.src)),referer_link_a_tag:TS.interop.i18n.safeString(f)}),c='<span class="too_large_for_auto_expand"> '+u+"</span>"}}var h=r.bytes&&!0!==n?'<span class="inline_img_bytes '+(c?"hidden":"")+'"> ('+TS.interop.utility.convertFilesize(r.bytes)+")</span>":"",g={collapser_class:"msg_inline_img_collapser",expander_class:"msg_inline_img_expander",real_src:r.src,expand_it:a},S=TS.templates.inline_attachment_toggler({inline_attachment:g});return h+c+(d?S:"")},buildInlineImgDiv:function(e,t,n){n=n||{};var i=TS.model.inline_imgs[e];if(!i)return"";var r,a=TS.inline_imgs.shouldExpand(t,i,n),s=i.link_url||e,o=!n.flush_with_attachment&&i.width>0&&i.height>0;i.internal_file_id&&(r=TS.files.getFileById(i.internal_file_id));var l="",d="clear_both msg_inline_img_holder msg_inline_holder";a||(d+=" hidden");var c=i.height<50,u=i.width<200,m=u||c;m&&(d+=" overflow_preview_actions",u&&(d+=" overflow_preview_actions_width")),r&&(d+=" file_container"),d+=" msg_inline_holder_rounded",o||(d+=" file_container_fixed_dimensions"),l+='<div data-real-src="'+_.escape(i.src)+'" class="'+d+'" ',i.internal_file_id&&(l+='data-file-id="'+i.internal_file_id+'" '),o&&(l+='style="width:'+i.width+'px;" '),l+=">";var p="ctrl";TS.model.is_mac&&(p="cmd");var f,h=TS.interop.i18n.t("{cmd_key}+click to open original in new tab","templates_builders")({cmd_key:p}),g=!n||!n.hasOwnProperty("maybe_show_file_viewer")||n.maybe_show_file_viewer;if(i.internal_file_id)if(r&&0===r.mimetype.indexOf("image/"))if(f=g,"dropbox"===r.external_type||"gdrive"===r.external_type||"box"===r.external_type||"onedrive"===r.external_type){var S=r.thumb_720?r.thumb_720:r.thumb_360;l+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+h+'" class="file_viewer_external_link" data-src="'+_.escape(S)+'"data-link-url="'+_.escape(s)+'">'}else l+=f?'<a href="'+s+'" target="_blank" class="file_viewer_channel_link file_viewer_link" data-file-id="'+i.internal_file_id+'">':'<a href="'+s+'" target="_blank" title="'+h+'" class="file_preview_link thumbnail_link" data-file-id="'+i.internal_file_id+'">';else l+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" class="'+r.filetype+'">';else{var T="",b="";g?T="file_viewer_external_link":b=TS.interop.i18n.t("Click to open original in new tab","templates_builders")(),l+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+b+'" class="'+T+'" data-src="'+_.escape(i.src)+'" data-link-url="'+_.escape(i.link_url)+'"',i.width&&(l+=' data-width="'+_.escape(i.width)+'"'),i.height&&(l+=' data-height="'+_.escape(i.height)+'"'),i.rotation&&(l+=' data-rotation="'+_.escape(i.rotation)+'"'),i.content_type&&(l+=' data-content-type="'+_.escape(i.content_type)+'"'),l+=">"}if(o&&(l=l.replace("<a ",'<a style="width:'+i.width+'px;" ')),l+='<div class="msg_inline_img_container">',l+='<div class="file_preview_preserve_aspect_ratio" ',o)if(r&&m)l+='style="padding-top: '+i.height+'px;" ';else{var v="calc("+i.height+" / "+i.width+" * 100% )";l+='style="padding-top: -moz-'+v+"; padding-top: -webkit-"+v+"; padding-top: "+v+';" '}else{var y,w,k=574,x=300,C=i.display_w||i.width,M=i.display_h||i.height;C<=k&&M<=x?(y=C,w=M):1.9133333333333333>C/M?(y=C*x/M,w=x):(y=k,w=M*k/C),l+='style="width: '+Math.round(y)+"px; height: "+Math.round(w)+'px;"'}l+=">",i.proxied_src=TS.utility.getImgProxyURLWithOptions(i.src,{rotate:!0});var I=_.escape(i.proxied_src||i.src);return l+='<figure class="msg_inline_img msg_inline_child" '+("style=\"background-image:url('"+I+"');\"")+">",l+="<img "+('src="'+I+'"')+" />",l+="</figure>",l+="</div>",l+="</div>",l+="</a>",r&&(l+=TS.templates.message_file_preview_actions({file:r,download:"hosted"===r.mode,new_window:!0,external_file_author:TS.files.isFileAuthorExternal(r)})),l+="</div>"},buildInlineAttachmentToggler:function(e,t){var n=TS.model.inline_attachments[e];if(!n)return"";var i=TS.inline_attachments.shouldExpand(t,n),r={real_src:n.from_url,expand_it:i};return TS.templates.inline_attachment_toggler({inline_attachment:r})},buildInlineAudioToggler:function(e,t){var n=TS.model.inline_audios[e];return n?TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_audios.shouldExpand(t,n),src:n.src,media_type:"audio"}):""},buildInlineAudioDiv:function(e,t,n){var i=TS.model.inline_audios[e];if(!i)return"";var r=TS.inline_audios.shouldExpand(t,i),a={src:i.src,expand_it:r,content:n};return TS.templates.attachment_inline_audio_div({inline_audio:a})},buildInlineOtherToggler:function(e,t){var n=TS.model.inline_others[e];return n?TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_others.shouldExpand(t,n),src:n.src,media_type:"other"}):""},buildInlineOtherDiv:function(e,t,n){var i=TS.model.inline_others[e];if(!i)return"";var r=TS.inline_others.shouldExpand(t,i);return'<div data-real-src="'+_.escape(i.src)+'" class="clear_both msg_inline_other_holder msg_inline_holder '+(r?"":"hidden")+'">'+n+"</div>"},buildInlineVideoTogglerAndDiv:function(e,t){return TS.model.inline_videos[e]?TS.templates.builders.buildInlineVideoToggler(e,t)+" "+TS.templates.builders.buildInlineVideoDiv(e,t):""},buildInlineVideoToggler:function(e,t,n){var i=TS.model.inline_videos[e];return i?TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_videos.shouldExpand(t,i),src:i.src,title:n?"":i.title,media_type:"video",is_keyboard_navigable:!0}):""},buildInlineVideoDiv:function(e,t){var n=TS.model.inline_videos[e];if(!n)return"";var i=TS.inline_videos.shouldExpand(t,n),r=n.link_url||e,a=!0;n.html||(a=!1);var s={real_src:n.src,data_url:e,referrer_safe_url_attributes:TS.utility.makeRefererSafeLink(r),show_play:a,proxied_src_or_src:n.proxied_src||n.src,display_w:n.display_w,display_h:n.display_h,expand_it:i};return TS.templates.message_inline_video({inline_video:s})},buildComments:function(e){for(var t,n=e.comments,i="",r=0;r<n.length;r+=1)t=TS.redux.members.getPotentiallyUnknownMemberById(n[r].user),i+=TS.templates.builders.buildCommentHTML({file:e,comment:n[r],show_comment_actions:!0,member:t});return i},buildCommentHTML:function(e){return TS.templates.comment(e)},buildCommentStandalone:function(e,t){var n,i=TS.utility.members.getEntityFromFile(t);return"snippet"===t.mode?n="snippet":"post"===t.mode?n="post":"space"===t.mode?n="space":"hosted"!==t.mode&&"external"!==t.mode||(n="file"),TS.templates.comment_standalone({comment:e,file:t,file_type:n,entity:i,current_user_id:TS.model.user.id})},makeChannelPrefix:function(e){return e?e.is_mpim||e.is_im?"":e.is_group||e.is_private?'<ts-icon class="ts_icon_lock"></ts-icon>':e.is_channel?"#":"":""},makeModelObNameForDisplay:function(e,t){if(!e)return"ERROR: MISSING CHANNEL";t=t||{};var n,i=_.trim(TS.templates.builders.maybeMakeSharedIcon(e,t.show_tooltip,t.tooltip_position,t.inherit_font_size)),r=TS.templates.builders.makeChannelPrefix(e);n=e.is_im?TS.interop.members.getPrefCompliantMemberNameById(e.user):e.is_mpim?TS.mpims.legacyGetDisplayName(e):e.name,n=_.escape(n);var a="";return!t.allow_wrap&&t.overflow_ellipsis?a+='<span class="no_wrap overflow_hidden">':t.allow_wrap?t.allow_wrap&&(a+='<span class="break_word">'):a+='<span class="no_wrap">',t.overflow_ellipsis&&(a+='<span class="overflow_ellipsis">'),a+=t.omit_prefix?"":r,a+=n,t.overflow_ellipsis&&(a+="</span>"),a+="</span>"+i},makeChannelLink:function(e,t){if(!e)return"ERROR: MISSING CHANNEL";t=t||{};var n=e.id,i=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+n+'"':"",r=TS.templates.builders.makeModelObNameForDisplay(e,t);return t.overflow_ellipsis?'<a href="/archives/'+n+'" '+i+' class="channel_link display_flex flex_wrap_none" data-channel-id="'+e.id+'">'+r+"</a>":'<a href="/archives/'+n+'" '+i+' class="channel_link" data-channel-id="'+e.id+'">'+r+"</a>"},maybeMakeSharedIcon:function(e,t,n,i){var r="";if(!TS.interop.rules.channels.isOrgShared(e)||e.is_mpim||e.is_im){if(TS.interop.rules.channels.isExternallySharedChannel(e)&&!e.is_mpim&&!e.is_im){var a=TS.interop.rules.channels.getConnectedTeamIds(TS.redux.getState(),e);0===a.length&&(a=void 0),r=TS.templates.shared_channels_icon({model_ob:e,tooltip:_.isUndefined(t)||t,tooltip_position:n,connectedTeamIds:a,inherit:i})}}else r=TS.templates.shared_channel_icon();return new Handlebars.SafeString(r)},makeGroupLink:function(e,t){if(!e)return"ERROR: MISSING GROUP";t=t||{};var n=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+e.id+'"':"",i=TS.templates.builders.makeModelObNameForDisplay(e,t);return t.overflow_ellipsis?'<a href="/archives/'+e.id+'" '+n+' class="group_link display_flex flex_wrap_none" data-group-id="'+e.id+'">'+i+"</a>":'<a href="/archives/'+e.id+'" '+n+' class="group_link" data-group-id="'+e.id+'">'+i+"</a>"},makeGroupLinkAriaLabelSafe:function(e){e||TS.warn("No valid group to make private channel link aria label");var t=_.escape(e.name),n=TS.model.active_group_id===e.id?TS.interop.i18n.t("active channel","templates_builders")():TS.interop.i18n.t("channel","templates_builders")(),i=function(e){var t="",n=e.unread_highlight_cnt,i=e.unread_cnt;n&&!e.is_im?t+=n+" "+TS.interop.i18n.t("unread highlight","templates_builders")()+" ":i&&(t+=i+" "+TS.interop.i18n.t("unread","templates_builders")()+" ");i&&(t+=TS.interop.i18n.t("{count, plural, =1 {message} other {messages}}","templates_builders")({count:i}));return t}(e),r=null;TS.templates.builders.legacyShowDraftIcon(e)&&(r=TS.interop.i18n.t("draft","messages")());var a=t+", "+n+(i?", "+i:"")+(r?", "+r:"");return new Handlebars.SafeString(a)},makeMemberPreviewLink:function(e,t){if(!e)return"";!0!==t&&(t=!1);var n,i,r=TS.templates.builders.makeMemberColorClass(e);return e.is_service?(i=TS.utility.shouldLinksHaveTargets()?'target="/services/'+e.id+'"':"",r+=" app_preview_link",n='<a href="/services/'+e.id+'" '+i+' data-bot-id="'+e.id+'" class="message_sender service_link '+r+'">'):(i=TS.utility.shouldLinksHaveTargets()?'target="/team/'+e.id+'"':"",r+=e.is_bot?" app_preview_link":" member member_preview_link",r+=" "+TS.templates.builders.makeMemberTypeBadgeClass(e),n='<a href="/team/'+e.id+'" '+i+' class="message_sender '+r+'" data-member-id="'+e.id+'">'),t&&e.id==TS.model.user.id?n+=TS.interop.i18n.t("You","templates_builders")():n+=TS.interop.members.getPrefCompliantMemberName(e,!0),n+=TS.templates.builders.makeMemberTypeBadgeCompact(e,!1),n+="</a>",(e.is_bot||e.is_service)&&(n+='<span class="c-app_label">'+TS.interop.i18n.t("APP","templates_builders")()+"</span>"),e.is_unknown&&(n=TS.templates.unknown_member({id:e.id})),n},legacyShowDraftIcon:function(e){if(!_.isObject(e))return!1;if(TS.interop.utility.looksLikeMemberId(e.id)){var t=TS.redux.channels.getImByMemberId(e.id);if(!t)return!1}var n=t||e,i=n.last_msg_input,r=n.id,a=TS.shared.legacyGetActiveModelOb();if(a){var s=a.id;s&&s==r&&(i=null)}return n.is_channel&&(!TS.interop.rules.channels.isArchived(n)&&n.is_member||(i=null)),n.is_group&&!n.is_mpim&&TS.interop.rules.channels.isArchived(n)&&(i=null),TS.permissions.members.canPostInChannel(n)||(i=null),!!_.trim(i)},makeProfileImage:function(e,t){if(_.isString(e)){var n=TS.interop.members.getMemberById(e);e=n||TS.interop.bots.getBotById(e)}if(!e)return!1;var i,r=t.hash.is_lazy||!1,a=e.profile||e.icons||{},s=t.hash.title||!1;i=a.emoji?"64":"48";var o,l,d=t.hash.size||i,c=Object.keys(TS.constants.avatar_size_map).reduce((function(e,t){return t===d&&m(a,t)?t:e}),i),u={entity:e,size:d,css_classes:function(e,t){var n=[];n.push("thumb_"+t),e.is_bot?(n.push("is_bot"),n.push("app_preview_link")):n.push("member_preview_link");return n.join(" ")}(e,d),image:(o=m(a,c),l=[],l.push("url('"+o+"')"),l.join(",")),is_lazy:r,is_targettable:TS.utility.shouldLinksHaveTargets(),title:s};function m(e,t){var n="image_"+t;return!!e.hasOwnProperty(n)&&(TS.environment.is_retina&&e[TS.constants.avatar_size_map[t].retina]||e[TS.constants.avatar_size_map[t].standard])}return new Handlebars.SafeString(TS.templates.member_profile_image(u))},makeMemberPreviewLinkImage:function(e,t,n,r,a,s,o){var l;if(!(l="object"===i(e)?e:TS.redux.members.getPotentiallyUnknownMemberById(e))||!l.profile)return"";n=!0===n,r=!0===r||TS.utility.members.isMemberEKMRevoked(l),a=!0===a,s=!0===s,o="string"==typeof o&&o,"USLACKBOT"===e&&o&&(l=TS.utility.slackbot.getWithFeels(o));var d={omit_link:r,omit_badge:a,lazy:n,member:l,size:t,include_restricted_overlay:!s||!0,bg_img_style:TS.templates.builders.getImageStyleForMemberPreviewImage(l,t,n)};return TS.templates.member_preview_link_image(d)},getImageStyleForMemberPreviewImage:function(e,t,n){var i,r,a;switch(r="background-image: ",a=[],t){case 20:case 24:i=TS.environment.is_retina?e.profile.image_48:e.profile.image_24;break;case 32:i=TS.environment.is_retina?e.profile.image_72:e.profile.image_32;break;case 36:case 48:i=TS.environment.is_retina?e.profile.image_72:e.profile.image_48;break;case 72:i=TS.environment.is_retina?e.profile.image_192:e.profile.image_72;break;case 192:i=TS.environment.is_retina&&e.profile.image_512||e.profile.image_192;break;case 512:i=TS.environment.is_retina?e.profile.image_1024||e.profile.image_512||e.profile.image_192:e.profile.image_512||e.profile.image_192;break;default:i=TS.environment.is_retina?e.profile.image_72:e.profile.image_48}if(a.push("url('"+i+"')"),512===t){var s=TS.environment.is_retina?e.profile.image_72:e.profile.image_48;a.push("url('"+s+"')")}return r=n?a.length?a.join(", "):"":a.length?r+a.join(", "):""},makePendingUserImage:function(e,t){if(!e||!t)return"";var n=48;36===t&&(n=72);var i="/img/new_channel_modal/airplane_"+n.toString()+".png",r="url('"+vvv(i)+"')",a={restricted:e.invite_prefs&&"restricted"===e.invite_prefs.type,img_url:r,size:t};return TS.templates.pending_user_image(a)},newWindowName:function(){return"web"===TS.boot_data.app||"calls"===TS.boot_data.app?"_self":"new_"+t.toString()},getBotIdentifier:function(e){if(!e.bot_id&&!e.username)return null;var t=TS.redux.bots.getBotByMsg(e),n=!e.username&&t&&t.name?t.name:e.username;return(t?t.id:"NOBOTID")+"_"+n},getBotName:function(e){var t=e.username;if(!t){var n=TS.redux.bots.getBotByMsg(e);n&&n.name&&(t=n.name)}return t},getBotNameWithLink:function(e){var t=e.username,n=TS.redux.bots.getBotByMsg(e),i=TS.templates.builders.makeBotLink(n);return t||(n&&n.name?t=n.name:e.bot_profile&&e.bot_profile.name&&(t=e.bot_profile.name)),new Handlebars.SafeString(i.start_a+_.escape(t)+i.end_a)},makeBotLink:function(e,t){var n="",i="",r=t||{};return e&&!e.deleted?(n='<a class="app_preview_link '+(r.classes?r.classes:" ")+'" target="/services/'+e.id+'" style="'+(r.style?r.style:" ")+'" href="/services/'+e.id+'">',i=(r.external_badge?r.external_badge:" ")+"</a>"):(n='<a class="app_preview_link">',i="</a>"),{start_a:n,end_a:i}},makeFiletypeHTML:function(e){if(e.external_type)return TS.templates.builders.makeExternalFiletypeHTML(e);var t="";return"docs"===e.filetype&&(e.pretty_type=TS.interop.i18n.t("Post","menu_file")()),t+='<a href="'+e.url_private_download+'" ',t+='target="'+e.url_private_download+'" ',t+='title="'+TS.interop.i18n.t("Download this file","templates_builders")()+'" ',t+='data-file-id="'+e.id+'" ',t+='class="subtle_silver file_ssb_download_link">',t+=TS.interop.utility.convertFilesize(e.size)+" ",t+="<span>"+e.pretty_type+"</span>","snippet"===e.mode&&(t+=" "+TS.interop.i18n.t("snippet","templates_builders")()),t+="</a>"},makeExternalFiletypeHTML:function(e){if(e.is_external){var t="";switch(e.external_type){case"gdrive":switch(e.filetype){case"gsheet":t=TS.interop.i18n.t("Spreadsheet from Google Drive","templates_builders")();break;case"gdoc":t=TS.interop.i18n.t("Document from Google Drive","templates_builders")();break;case"gpres":t=TS.interop.i18n.t("Presentation from Google Drive","templates_builders")();break;case"gdraw":t=TS.interop.i18n.t("Drawing from Google Drive","templates_builders")();break;default:t=TS.interop.i18n.t("<span>{file_type}</span> from Google Drive","templates_builders")({file_type:e.pretty_type})}break;case"dropbox":t=TS.interop.i18n.t("<span>{file_type}</span> from Dropbox","templates_builders")({file_type:e.pretty_type});break;case"box":t=TS.interop.i18n.t("<span>{file_type}</span> from Box","templates_builders")({file_type:e.pretty_type});break;case"onedrive":t=TS.interop.i18n.t("<span>{file_type}</span> from OneDrive","templates_builders")({file_type:e.pretty_type});break;default:t=TS.interop.i18n.t("File","templates_builders")()}return t}},makeUnshareLink:function(e,t){var n=(e.is_channel?"#":"")+e.name,i=TS.interop.i18n.t("Unshare from {channel}","templates_builders")({channel:n});return'<a class="unshare_link ts_tip ts_tip_top ts_tip_float ts_tip_unshare_link ts_tip_multiline" onclick="TS.files.promptForFileUnshare(\''+t.id+"', '"+e.id+'\')"><span class="ts_tip_tip"><span class="ts_tip_multiline_inner">'+i+'</span></span><i class="ts_icon ts_icon_minus_circle_small"></i></a>'},updateFileShareLabels:function(e){$('.file_share_label[data-file-id="'+e.id+'"]').each((function(){$(this).replaceWith(TS.templates.builders.makeFileShareLabel(e))})),e.is_shared?($('.file_share_shared_label[data-file-id="'+e.id+'"]').removeClass("hidden"),$('.file_share_unshared_label[data-file-id="'+e.id+'"]').addClass("hidden")):($('.file_share_shared_label[data-file-id="'+e.id+'"]').addClass("hidden"),$('.file_share_unshared_label[data-file-id="'+e.id+'"]').removeClass("hidden")),e.is_public?($('.file_share_private_label[data-file-id="'+e.id+'"]').addClass("hidden"),$('.file_share_public_label[data-file-id="'+e.id+'"]').removeClass("hidden")):($('.file_share_private_label[data-file-id="'+e.id+'"]').removeClass("hidden"),$('.file_share_public_label[data-file-id="'+e.id+'"]').addClass("hidden"))},makeFileShareLabel:function(e){var t='<span class="file_share_label" data-file-id="'+e.id+'">',n=TS.templates.builders.makeFileGroupChannelList(e);return n.length?t+=TS.interop.i18n.t("in {share_list}","templates_builders")({share_list:TS.interop.i18n.safeString(n)}):e.is_public||e.user===TS.model.user.id||(t+=TS.interop.i18n.t("shared with you","templates_builders")()),t+="</span>"},makeFileGroupChannelList:function(e){var t,n,i,r,a=[],s=_.get(e,"channels.length",0);for(i=0;i<s;i+=1)(n=TS.interop.channels.getPublicChannelById(e.channels[i]))&&(n.is_mpim||(t='<span class="no_wrap">',t+=TS.templates.builders.makeChannelLink(n,{inherit_font_size:!0}),t+="&nbsp;"+TS.templates.builders.makeUnshareLink(n,e),t+="</span>",a.push(t)));var o=_.get(e,"groups.length",0);for(i=0;i<o;i+=1)(r=TS.interop.channels.getGroupById(e.groups[i]))&&(t='<span class="no_wrap">',t+=TS.templates.builders.makeGroupLink(r,{inherit_font_size:!0}),t+="&nbsp;"+TS.templates.builders.makeUnshareLink(r,e),t+="</span>",a.push(t));return a.length?a.join(", "):""},makeFileCommentHelpHTML:function(e){if(e&&e.is_public&&(e.channels&&e.channels.length||e.groups&&e.groups.length)){var t=[];return e.channels&&e.channels.length&&(t=t.concat(e.channels)),e.groups&&e.groups.length&&(t=t.concat(e.groups)),(t=_.chain(t).map((function(e){return TS.redux.channels.getEntityById(e)})).filter((function(e){return e&&!e.is_im&&!e.is_mpim&&!TS.interop.rules.channels.isExternallySharedChannel(e)})).value()).length<1?"":TS.interop.i18n.t("Commenting in {channel_names}","templates_builders")({channel_names:TS.interop.i18n.safeString(TS.templates.builders.makeLinksFromModelObs(t))})}return""},makeLinksFromModelObs:function(e,t){t=t||{},e=TS.utility.parseJSONOrElse(e,e),e=_.isArray(e)?e:[e];var n=0;e=_.chain(e).map((function(e){return _.isString(e)?TS.redux.channels.getEntityById(e):e})).filter((function(e){return e||(n+=1),e&&!e.is_im&&!e.is_mpim})).value();var i=TS.sorter.search("",{groups:e},{allow_empty_query:!0}).sort().map((function(e){var n=t.new_lines?'<span class="block">':"";return n+=e.is_channel?TS.templates.builders.makeChannelLink(e,{overflow_ellipsis:t.overflow_ellipsis,inherit_font_size:t.inherit_font_size}):TS.templates.builders.makeGroupLink(e,{overflow_ellipsis:t.overflow_ellipsis,inherit_font_size:t.inherit_font_size}),n+=t.new_lines?"</span>":""}));if(n){var r=TS.interop.i18n.t("{private_channel_or_group_count, plural, =1{# private channel}other{# private channels}}","templates_builders")({private_channel_or_group_count:n});i.push('<span class="no_wrap'+(t.new_lines?" block":"")+'">'+r+"</span>")}return t.new_lines?i.join(""):TS.interop.i18n.listify(i,{noEscape:!0}).join("")},buildFileSharingControls:function(e,t,n,i,r){n=n||"",$("#file_sharing_div").remove();var a=!1,s=!1;if(e){if(e.user===TS.model.user.id)a=!0;else if(e.user){var o=TS.interop.members.getMemberById(e.user);o&&o.isExternal&&(s=TS.teams.getTeamNameByMember(o))}}else a=!0;if(e&&e.id&&TS.files.isFilePrivate(e)&&!a&&!e.bot_id)var l=new Handlebars.SafeString(TS.interop.i18n.t("This file was sent to you privately. You may want to check with <strong>{user_names}</strong> before sharing it.","files")({user_names:TS.interop.i18n.safeString(_.escape(TS.interop.members.getPrefCompliantMemberNameById(e.user))),file_owners_count:1,file_count:1,file_title:e.title?TS.format.formatNoSpecials(e.title||"Untitled"):""}));if(e&&e&&e.mimetype&&-1!=e.mimetype.indexOf("application/vnd.google-apps")){var d=e.pretty_type?e.pretty_type.replace(/GDocs /,""):null;if(d){var c,u={teamFileSpreadsheet:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Spreadsheet","templates_builders"),teamFilePresentation:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Presentation","templates_builders"),teamFileDocument:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Document","templates_builders"),fileSpreadsheet:TS.interop.i18n.t("Anyone with the link will be able to edit this Google Spreadsheet","templates_builders"),filePresentation:TS.interop.i18n.t("Anyone with the link will be able to edit this Google Presentation","templates_builders"),fileDocument:TS.interop.i18n.t("Anyone with the link will be able to edit this Google Document","templates_builders"),fallback:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google file","templates_builders")};TS.model.team.name?d&&"Document"===d?c=u.teamFileDocument({team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)}):d&&"Spreadsheet"===d?c=u.teamFileSpreadsheet({team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)}):d&&"Presentation"===d&&(c=u.teamFilePresentation({team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)})):TS.model.team.name?c=u.fallback():d&&"Document"===d?c=u.fileDocument():d&&"Spreadsheet"===d?c=u.fileSpreadsheet():d&&"Presentation"===d&&(c=u.filePresentation())}}return TS.templates.file_sharing({channels:[],groups:[],members:[],file:e,file_sharing_notice:c,is_owner:a,owner_team:s,reshare_private_file:l,has_title:i,hide_checkbox:t,comment:n,selection:r,show_channel_join_note:!1,disable_file_sharing_dialog_comment:s})},strBuilder:function(e,t){return e.replace(/\${([a-z_]+)}/g,(function(e,n){return n.indexOf("_html")>-1?t[n]:_.escape(t[n])}))},buildRxnTitle:function(e,t){if(t||TS.web){var n,i=":"+e.name+":";if(TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&(i=TS.emoji.maybeGetLocalizedEmojiString(i)),e.is_handy||e.is_poll&&!e.count)return n=_.escape(i||e.name),TS.interop.i18n.t("Add reaction {emoji}","rxn")({emoji:TS.interop.i18n.safeString(n)});if(n=_.escape(i||e.name),TS.emoji.isValidName(e.name)||e.url||(n+=" "+TS.interop.i18n.t("(emoji has been removed)","rxn")()),1===e.count)return e.user_reacted?TS.interop.i18n.t('You (click to remove) <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({emoji:n}):TS.interop.i18n.t('{user} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({user:TS.interop.i18n.safeString(_.escape(TS.interop.members.getPrefCompliantMemberNameById(e.member_ids[0],false,false,true))),emoji:TS.interop.i18n.safeString(n)});var r=!1,a=e.member_ids.length!=e.count,s=e.member_ids.map((function(e,t){var n;return TS.model.user.id===e?(r=!0,n=0===t?TS.interop.i18n.t("You","rxn")():TS.interop.i18n.t("you","rxn")()):n=TS.interop.members.getPrefCompliantMemberNameById(e,false,false,true),n}));return a&&s.push(TS.interop.i18n.t("others","rxn")()),r?TS.interop.i18n.t('{users_and_you} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({users_and_you:TS.interop.i18n.safeString(_.escape(TS.interop.i18n.listify(s,{noEscape:!0}).join(""))),emoji:TS.interop.i18n.safeString(n)}):TS.interop.i18n.t('{users} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({users:TS.interop.i18n.safeString(_.escape(TS.interop.i18n.listify(s,{noEscape:!0}).join(""))),emoji:TS.interop.i18n.safeString(n)})}},buildRxnHtml:function(e){var t,n=TS.emoji.isValidName(e.name);if(e.url)t='<span class="emoji-outer emoji-sizer emoji-bg-contain" style="background-image: url('+e.url+');"></span>';else if(n){var i=e.is_handy&&TS.emoji.isNameSkinToneModifiable(e.name)?TS.emoji.getChosenSkinToneModifier():"";t=TS.emoji.graphicReplace(":"+e.name+":"+i,{no_skin_tone_squares:e.is_handy,obey_emoji_mode_pref:!0})}else t=TS.emoji.MISSING_EMOJI_HTML;var r=TS.templates.builders.buildRxnTitle(e),a=[];return e.user_reacted&&a.push("user_reacted"),e.is_handy&&a.push("is_handy"),e.is_hidden&&a.push("hidden"),"as_text"===TS.prefs.getPref("emoji_mode")&&a.push("plain_text"),TS.templates.rxns_rxn({name:e.name,url:e.url,css_classes:a.join(" "),emoji_html:new Handlebars.SafeString(t),title:new Handlebars.SafeString(r||""),count:e.count,is_handy:!!e.is_handy,is_web:!!TS.web})},updateRxnHtml:function(e,t){var n=e.children('.rxn[data-emoji="'+t.name+'"]');if(n.length){n.find(".emoji_rxn_count").attr("aria-label",t.count),n.toggleClass("user_reacted",t.user_reacted);var i=TS.templates.builders.buildRxnTitle(t,!0),r=n.find(".ts_tip_tip_inner");r.length||(r=n.find(".ts_tip_multiline_inner")),r.length?r.html()!=i&&TS.tips.updateTipTitle(n,i):n.prop("title")!=i&&TS.tips.updateTipTitle(n,i),(t.animate_it_dramatically||t.animate_it)&&setTimeout(t.animate_callback,0)}else e.children(".rxn_hover_container").before($(TS.templates.builders.buildRxnHtml(t))),n=e.children('.rxn[data-emoji="'+t.name+'"]'),(t.animate_it_dramatically||t.animate_it)&&n.css("opacity",0).transition({opacity:1},300,t.animate_callback)},updateRxnPanels:function(e,t,n){var i=TS.rxns.getExistingRxnsByKey(e),r=$("."+TS.templates.makeRxnKeyDomClass(e));r.each((function(r,a){var s,o,l,d=$(a);if(!i)return d.empty(),void TS.ui.messages.maybeUpdateMessageHoverContainer(d.closest("ts-message"));d.children().length||(d=$(TS.templates.builders.rxnPanel(e)).replaceAll(d)),s=d,i&&i.forEach((function(r){o=r.name==t,l=o&&n==TS.model.user.id,TS.templates.builders.updateRxnHtml(s,{animate_it:o,animate_it_dramatically:l,name:r.name,url:r.url,count:r.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(i,r.name),member_ids:r.users,rxn_key:e})})),s.children(".rxn").each((function(e,t){var n=$(t),r=String(n.data("emoji"));TS.rxns.doesRxnsHaveRxn(i,r)||(n.addClass("going_away"),n.transition({opacity:0},300,(function(){n.remove()})))})),TS.ui.messages.maybeUpdateMessageHoverContainer(s.closest("ts-message")),s.children(".rxn_hover_container").find(".rxn.is_handy").each((function(e,t){var n=$(t),r=String(n.data("emoji"));n.toggleClass("hidden",TS.rxns.doesRxnsHaveSkinlessRxn(i,r))}))}))},rxnPanel:function(e){if(e){var t={},n="",i=TS.rxns.getExistingRxnsByKey(e),r="";return i&&(i=_.sortBy(i,(function(e){return TS.emoji.isValidName(e.name)?0:1}))).forEach((function(t){r+=TS.templates.builders.buildRxnHtml({name:t.name,url:t.url,count:t.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(i,t.name),member_ids:t.users,rxn_key:e})})),_.each(_.keys(t.items),(function(t){n+=TS.templates.builders.buildRxnHtml({name:t,is_handy:!0,is_hidden:TS.rxns.doesRxnsHaveSkinlessRxn(i,t),rxn_key:e})})),TS.templates.rxns_panel({css_classes:[].join(" "),rxn_key:e,rxns_html:new Handlebars.SafeString(r),handy_rxns_html:new Handlebars.SafeString(n),id_class:TS.templates.makeRxnKeyDomClass(e),has_hovers:!t.is_poll})}},atLabel:function(e){return"group"===e&&(e="channel"),"@"+((_.keyBy(TS.interop.broadcast_keywords.getAllBroadcastKeywords(),"ms_name")[e]||{}).name||"channel")},makeMemberTypeBadgeClass:function(e){return TS.boot_data.page_needs_enterprise&&e.is_restricted?"has_member_type_badge":""},makeMemberColorClass:function(e){var t="color_";return t+=e?e.id+" color_"+e.color:"unknown"},makeMemberTypeBadgeCompact:function(e,t){if(!TS.boot_data.page_needs_enterprise)return"";"boolean"!=typeof t&&(t=!1);var n={icon_class:"",with_tooltip:t,tooltip:{member_type:"",type_description:""}},i=TS.boot_data.page_needs_enterprise?TS.interop.i18n.t("organization directory","templates_builders")():TS.interop.i18n.t("workspace directory","templates_builders")();return e.isExternal?"":e.is_ultra_restricted?(n.icon_class="ts_icon_single_channel_guest",n.tooltip.member_type=TS.interop.i18n.t("Single-Channel Guests","templates_builders")(),n.tooltip.type_description=TS.interop.i18n.t("see a partial {directory_name} and can only access messages and files from the channel they belong to.","templates_builders")({directory_name:i}),TS.templates.member_type_icon(n)):e.is_restricted?(n.icon_class="ts_icon_restricted_user",n.tooltip.member_type=TS.interop.i18n.t("Multi-Channel Guests","templates_builders")(),n.tooltip.type_description=TS.interop.i18n.t("see only a partial {directory_name} and can only access messages and files from selected channels.","templates_builders")({directory_name:i}),TS.templates.member_type_icon(n)):""},getMemberTypeClass:function(e){return e.is_restricted?" ra":""},loadingHTML:function(){return TS.templates.infinite_spinner({color:"white",size:"medium"})},buildBroadcastRepliersSummaryHTML:function(e){var t,n,i=e.reply_count;if(e.reply_users)t=e.reply_users,n=e.reply_users_count;else{var r=e.replies;if(!r||!r.length)return"";t=_.map(r,"user"),n=(t=_.uniq(t)).length}var a=_.map(t,(function(e){return"U00"===e?null:"B"===e.charAt(0)?TS.interop.bots.getBotById(e):TS.redux.members.getPotentiallyUnknownMemberById(e)}));if(a=_.compact(a),!i||!a.length)return"";if(1===i)return TS.interop.i18n.t("1 reply","threads")();var s=!!_.find(a,{is_self:!0});s&&(a=_.reject(a,{is_self:!0})).push(TS.model.user);var o=_.map(a,(function(e){return e.is_bot?e.name:e.is_self?TS.interop.i18n.t("you","threads")():TS.interop.members.getPrefCompliantMemberName(e)}));if(1===a.length)return s?TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from you","threads")({reply_count:i}):TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name}","threads")({reply_count:i,user_name:TS.interop.i18n.safeString(_.escape(o[0]))});if(2===a.length)return s?TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name} and you","threads")({reply_count:i,user_name:TS.interop.i18n.safeString(_.escape(o[0]))}):TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1} and {user_name2}","threads")({reply_count:i,user_name1:TS.interop.i18n.safeString(_.escape(o[0])),user_name2:TS.interop.i18n.safeString(_.escape(o[1]))});if(3===a.length)return s?TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1}, {user_name2}, and you","threads")({reply_count:i,user_name1:TS.interop.i18n.safeString(_.escape(o[0])),user_name2:TS.interop.i18n.safeString(_.escape(o[1]))}):TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1}, {user_name2}, and {user_name3}","threads")({reply_count:i,user_name1:TS.interop.i18n.safeString(_.escape(o[0])),user_name2:TS.interop.i18n.safeString(_.escape(o[1])),user_name3:TS.interop.i18n.safeString(_.escape(o[2]))});if(a.length>3){var l=_.drop(o,2);l.length<n-2&&l.push(TS.interop.i18n.t("others","threads")());var d=TS.interop.i18n.listify(l,{noEscape:!0}).join("");return TS.templates.thread_broadcast_repliers_with_overflow({reply_count:i,num_others:n-2,user_name1:o[0],user_name2:o[1],other_names:d})}return""},buildMemberCustomStatusExpiration:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),e.id);if(n&&n.expiration){var i=TS.interop.datetime.formatDate(n.expiration,"{status_expiration}",{do24hrTime:TS.prefs.getPref("time24")}),r=TS.interop.i18n.t("Until {expirationDate}","current_status")({expirationDate:i}),a=t.inline?"span":"p",s=t.inline?"no_wrap":"no_bottom_margin";return"<"+a+' class="sk_foreground_max current_status_expiration '+s+'" data-member-id="'+e.id+'">'+r+"</"+a+">"}return""},replaceEmojiForPosts:function(e){if(e.childNodes)for(var t=0;t<e.childNodes.length;t+=1)TS.templates.builders.replaceEmojiForPosts(e.childNodes[t]);if(e.nodeType==Node.TEXT_NODE){var n=_.escape(e.textContent),i=TS.emoji.graphicReplace(TS.emoji.legacyReplaceEmoticons(n),{include_title:!0,include_text:!1});if(i!==n){var r=$("<span>").html(i)[0];[].slice.apply(r.childNodes).forEach((function(t){e.parentNode.insertBefore(t,e)})),e.parentNode.removeChild(e)}}},proxyImgUrlsForEmails:function(e){e.find("img").each((function(){var e,t=$(this).attr("src"),n=$(this).attr("width"),i=$(this).attr("height");e=n&&i?TS.utility.getImgProxyURL(t,n,i):TS.utility.getImgProxyURL(t),$(this).attr("src",e)}))},formatFileTitle:function(e){if(!e||!e.title)return"";var t=e.title;return t=_.unescape(t),t=_.escape(t),TS.format.formatWithOptions(t,null,{no_specials:!0})},test:function(){var t={};return Object.defineProperty(t,"_buildStarComponents",{get:function(){return e},set:function(t){e=t}}),t}});var t=Date.now()}()},jAhp:function(e,t){!function(){var e;TS.registerModule("search",{search_dispatched_sig:new signals.Signal,quick_search_results_fetched_sig:new signals.Signal,all_search_results_fetched_sig:new signals.Signal,message_search_results_fetched_sig:new signals.Signal,file_search_results_fetched_sig:new signals.Signal,autosuggest_search_results_fetched_sig:new signals.Signal,search_channel_set_sig:new signals.Signal,search_group_set_sig:new signals.Signal,search_member_set_sig:new signals.Signal,query:"",query_string:"",query_string_for_display:"",last_search_query:"",previous_query:"",sort:"timestamp",filter:"all",filetype:"all",results:{},submit_tim:0,delay:500,suggestions:[],input:"",per_page:-1,keyword_modifiers:["after","before","bot","during","from","to","has","in","on"],keyword_modifier_pair_regex:null,keyword_modifier_extract_regex:null,skip_next_search:!1,refinement_version:1,onStart:function(){TS.search.keyword_modifier_pair_regex=new RegExp("^("+TS.search.keyword_modifiers.join("|")+"):\\S+$"),TS.search.keyword_modifier_extract_regex=new RegExp("^("+TS.search.keyword_modifiers.join("|")+"):\\w*"),TS.search.per_page=parseInt(TS.qs_args.search_count,10)||20,TS.web&&TS.web.login_sig.add(TS.search.loggedIn,TS.search),TS.search.search_channel_set_sig.add(TS.search.searchAll,TS.search),TS.search.search_group_set_sig.add(TS.search.searchAll,TS.search),TS.search.search_member_set_sig.add(TS.search.searchAll,TS.search),TS.prefs.search_only_my_channels_changed_sig.add(TS.search.searchAll,TS.search),TS.prefs.search_only_current_team_changed_sig.add(TS.search.searchAll,TS.search),TS.prefs.search_exclude_bots_changed_sig.add(TS.search.searchAll,TS.search),TS.files.team_file_changed_sig.add(m),TS.qs_args.delay&&(TS.search.delay=TS.qs_args.delay),"treatment"==TS.interop.experiments.getGroupForUser("sli_all_tab")&&(TS.search.filter="messages"),TS.search.input=$("#search_terms");TS.utility.contenteditable.create(TS.search.input,{modules:{slacksearch:!0,tabcomplete:{completers:["members"],positionMenu:function(e){var t=$(TS.search.input),n=t.offset(),i=355-t.outerWidth(),r=n.left-i+31,a=n.top+t.height()+12;e.style.width="355px",e.style.top=a+"px",e.style.left=r+"px"},render:function(e,t,n){var i=_.filter(n,(function(e){return!e.is_usergroup})),r=_.remove(i,(function(e){return e.deleted})),a={menu_type:"user",noResults:!i&&!r,users:i,users_deleted:r,show_ja_modifier_subtitle:"ja-JP"==TS.interop.i18n.locale};return TS.templates.search_menu(a)},onRender:function(){TS.tips.texty.hide(),TS.utility.rAF((function(){$("#chat_input_tab_ui").addClass("search_menu"),p()}))}}},singleLineInput:!0,placeholder:TS.interop.i18n.t("Search","page_client")(),ariaLabel:TS.interop.i18n.t("Search","page_client")(),onFocus:function(){$("#client-ui").addClass("search_focused"),TS.utility.contenteditable.setCursorAtEnd(TS.search.input)},onBlur:function(){$("#client-ui").removeClass("search_focused")},onEnter:function(){return TS.search.skip_next_search||TS.search.submitSearch(),TS.search.skip_next_search=!1,!0},onTextChange:function(){var e=TS.utility.contenteditable.isEmpty(TS.search.input);$("#header_search_form").toggleClass("active",!e)},onEscape:function(){$(".search_menu").is(":visible")||TS.utility.contenteditable.blur(TS.search.input)},onTab:function(){return!0}})},loggedIn:function(){"recency"===TS.interop.experiments.getGroupForUser("sli_default_sorting")?TS.search.sort="timestamp":"relevance"===TS.interop.experiments.getGroupForUser("sli_default_sorting")?TS.search.sort="score":TS.search.sort="timestamp"},startSearchTimer:function(e,t,n,i,r){clearTimeout(TS.search.submit_tim),TS.search.submit_tim=setTimeout(TS.search.dispatchSearch,TS.search.delay,e,t,n,i,null,r),TS.search.search_dispatched_sig.dispatch()},getNextPageOfSearchResults:function(e,t,n){TS.search.dispatchSearch(e,t,TS.search.per_page,TS.search.onSearchAll,n,null)},extractNonModifierSearchTxt:function(e){var t="";return e.split(" ").forEach((function(e){e.match(TS.search.keyword_modifier_extract_regex)||(t+=" "+e)})),t=$.trim(t)},dispatchSearch:function(e,t,n,i,r,a){if(TS.interop.console.info("SEARCH","Entering dispatchSearch"),TS.interop.console.info("SEARCH","In dispatchSearch after boot is complete"),!r||1===r){var s=TS.search.extractNonModifierSearchTxt(e);s&&TS.interop.desktop.writeFindString(s)}if(TS.search.updateSessionsUponSearch(),TS.search.separateMessagesAndFiles()){r&&1!==r||(TS.search.results[e]=null);var o=u();l("search.messages",e,t,n,r,o.msgs,a),l("search.files",e,t,n,r,o.files,a)}else l("search.all",e,t,n,r,i,a)},getModuleSort:function(){return"files"==TS.search.filter?"auto":"messages"==TS.search.filter?TS.search.sort:null},searchAll:function(e,t){TS.interop.console.info("SEARCH","Entering searchAll"),window.desktop&&desktop.teams&&desktop.teams.getCurrentTeam&&TS.boot_data.page_needs_enterprise&&desktop.teams.getCurrentTeam().team_id&&desktop.teams.getCurrentTeam().team_id!=TS.model.team.id?TS.interop.console.info("SEARCH","In searchAll current team id "+desktop.teams.getCurrentTeam().team_id+" and "+TS.model.team.id+" differ"):(clearTimeout(TS.search.widget.key_tim),TS.search.previous_query=TS.search.query,TS.search.query_string=e?_.trim(e):_.trim(TS.utility.contenteditable.value(TS.search.input)),TS.search.query=TS.interop.texty.convertContentsStringForEncodedMembers(TS.search.query_string,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale}),TS.search.query_string_for_display=TS.interop.texty.convertContentsStringToDisplayString(TS.search.query_string,TS.interop.prefs.getHighlightWords()),TS.search.query_string?(TS.interop.console.info("SEARCH","In searchAll startSearchTimer for TS.search.onSearchAll"),TS.search.startSearchTimer(TS.search.query,TS.search.query_string,TS.search.per_page,TS.search.onSearchAll,t)):(TS.interop.console.info("SEARCH","In searchAll with empty query"),TS.search.widget.stopSpinner()))},onSearchAll:function(e,t,n){if(TS.interop.console.info("SEARCH","Entering onSearchAll"),"1"===TS.qs_args.force_search_fail&&(window.failed_once=!0,e=!1,t={ok:!1,error:"solr_failed"}),!e){var i=t&&t.error?t.error:"unknown_error";t||(t={ok:!1,error:i}),TS.interop.console.error("SEARCH","In onSearchAll search failed with "+i),t.query=t.query||n.query,t.messages=t.messages||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]},t.files=t.files||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}if(n.query===TS.search.query||TS.search.results[n.query]&&TS.search.results[n.query].error)if(TS.search.last_search_query=n.query,TS.search.expandChannelsAndCheckForMsgsInModel(t),1===n.page)TS.search.results[n.query]=t,TS.search.results[n.query]._time_of_search=Date.now(),TS.search.all_search_results_fetched_sig.dispatch(t,n),TS.search.getNextPageOfSearchResults(n.query,n.query_string,2);else{var r=TS.search.results[n.query];r.messages.matches&&(t.messages.matches=r.messages.matches.concat(t.messages.matches)),r.files.matches&&(t.files.matches=r.files.matches.concat(t.files.matches)),TS.search.results[n.query]=t,TS.search.all_search_results_fetched_sig.dispatch(t,n)}else TS.interop.console.info("SEARCH","In onSearchAll returning from same last query")},searchSuggest:function(e){var t=TS.search.getQuerySessionId(),n=(new Date).getTime();TS.interop.api.call("search.autocomplete",{query:e,client_request_id:t,search_session_id:TS.search.getSearchSessionId()}).then((function(e){var i=e.data,r=e.args,a=e.request_id;return TS.search.onSearchSuggest&&TS.search.onSearchSuggest(!0,i,r,a),TS.interop.clog.track("SEARCH_AUTOCOMPLETE",{client_request_id:t,search_session_id:TS.search.getSearchSessionId(),request_duration_ms:(new Date).getTime()-n}),{data:i,args:r,request_id:a}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return TS.search.onSearchSuggest&&TS.search.onSearchSuggest(!1,t,n,i),{data:t,args:n,request_id:i}}))},onSearchSuggest:function(e,t,n,i){if(TS.search.widget.suppress_suggestions)TS.search.widget.suppress_suggestions=!1;else if(e)if(TS.search.suggestions=[],t.suggestions[0]===TS.search.query&&1===t.suggestions.length)TS.search.suggestions=[];else{var r=/<@([^>]+)>/gi,a=[];t.suggestions.forEach((function(e){e.replace(r,(function(e,t){a.push(t)}))})),a=_.uniq(a),TS.interop.members.ensureMembersArePresent(a).then((function(){for(var e=0;e<t.suggestions.length;e+=1){var a=t.suggestions[e];a=a.replace(r,(function(e,t){var n=TS.interop.members.getMemberById(t);return n?TS.interop.texty.getMemberAsContentsString(n):e})),TS.search.suggestions[e]={value:a,highlighted:TS.search.highlightSuggestion(_.escape(a))},t.suggestions[e]=a}TS.search.autosuggest_search_results_fetched_sig.dispatch(t,n,i)}))}},highlightSuggestion:function(e){var t=TS.utility.contenteditable.value(TS.search.input),n=new RegExp("("+TS.utility.preg_quote(t)+")","gi");return e.replace(n,"<b>$1</b>")},expandChannelsAndCheckForMsgsInMatch:function(e){var t,n=e.channel.id;o(e,n),s.forEach((function(t){e[t]&&o(e[t],n)})),TS.rxns.getExistingRxnsByKey(e._rxn_key)&&!e.reactions?TS.warn("msg:"+e.ts+" has reactions in local model, but we got an object in search results that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(e._rxn_key,e.reactions),(t=TS.redux.channels.getEntityById(n))&&("im"!==e.type||TS.interop.channels.isImWithDeletedMember(t)||(e.im_exists=!0),t.msgs&&(e.is_loaded=!!TS.utility.msgs.getMsg(e.ts,t.msgs)),e.channel=t,e.permalink||(e.permalink=TS.utility.msgs.constructMsgPermalink(t,e.ts)))},expandChannelsAndCheckForMsgsInModel:function(e){var t,n;if(e.messages&&e.messages.matches){for(n=0;n<e.messages.matches.length;n+=1)(t=e.messages.matches[n])&&TS.search.expandChannelsAndCheckForMsgsInMatch(t);if(e.messages.modules&&e.messages.modules.score){for(n=0;n<e.messages.modules.score.matches.length;n+=1)(t=e.messages.modules.score.matches[n])&&TS.search.expandChannelsAndCheckForMsgsInMatch(t);if(e.messages.modules.score.top_results)for(n=0;n<e.messages.modules.score.top_results.length;n+=1)(t=e.messages.modules.score.top_results[n])&&TS.search.expandChannelsAndCheckForMsgsInMatch(t)}}},saveSearch:function(e,t){e.terms&&(e.terms=$.trim(e.terms),TS.search.keyword_modifier_pair_regex.test(e.terms)||TS.interop.api.call("search.save",e).then((function(e){var n=e.data,i=e.args,r=e.request_id;return t&&t(!0,n,i,r),{data:n,args:i,request_id:r}})).catch((function(e){var n=e.data,i=e.args,r=e.request_id;return t&&t(!1,n,i,r),{data:n,args:i,request_id:r}})))},separateMessagesAndFiles:function(){return!1},submitSearch:function(){TS.search.input.closest("form").trigger("submit")},searchSessionExpired:function(){var n=e;return e=new Date,!n||Date.now()-n>t},querySessionExpired:function(){return TS.search.searchSessionExpired()},getSearchSessionId:function(){return(TS.search.searchSessionExpired()||null==n)&&(n=TS.interop.utility.uuidv4()),n},maybeSetQuerySessionId:function(){(null==r||TS.search.querySessionExpired())&&(r=TS.interop.utility.uuidv4(),TS.interop.clog.track("SEARCH_QUERY_SESSION",{request_id:TS.search.last_request_id,search_session_id:TS.search.getSearchSessionId(),client_request_id:r}))},getQuerySessionId:function(){return TS.search.maybeSetQuerySessionId(),r},getSearchSessionIdForResults:function(){return TS.search.getSearchSessionId()==i&&(e=new Date),i},getQuerySessionIdForResults:function(){return a},querySessionEnd:function(){r=null},updateSessionsUponSearch:function(){a=TS.search.getQuerySessionId(),i=TS.search.getSearchSessionId(),TS.search.querySessionEnd()},getSort:function(e){return"search.files"===e?"auto":TS.search.sort},shouldGetTopResults:function(e){return"recency"!==TS.interop.experiments.getGroupForUser("sli_default_sorting")&&("relevance"!==TS.interop.experiments.getGroupForUser("sli_default_sorting")&&(1==e?1:0))}});var t=3e5,n=null,i=null,r=null,a=null,s=["next","next_2","previous","previous_2"],o=function(e,t){e._rxn_key=TS.rxns.getRxnKey("message",e.ts,t),TS.utility.msgs.processAttachments(e.attachments),e.extracts&&e.extracts.length&&e.extracts.forEach((function(t){t._rxn_key=e._rxn_key}))},l=function(e,t,n,i,r,a,s){TS.interop.console.info("SEARCH","Entering _callSearchPerSe "+e);var o=e.replace(".","_"),l="start_dispatch_"+o;TS.telemeter.mark(l);var d=r||1,c={query:TS.emoji.maybeGetCanonicalEmojiString(t),query_string:n,highlight:!0,count:i,types:[TS.search.filetype],sort:TS.search.getSort(e),page:d,extracts:1,extra_message_data:1,max_extract_len:150,highlight_attachments:1,active_cid:TS.model.active_cid,top_results:TS.search.shouldGetTopResults(d),experts:1==d?1:0,locale:TS.interop.i18n.isPseudoLocale()?"pseudo":TS.interop.i18n.locale,search_tab_open:"search"==TS.model.ui.active_tab_id,search_tab_filter:TS.search.filter,search_tab_sort:TS.search.getModuleSort(TS.search.filter),client_req_id:TS.search.getQuerySessionIdForResults(),search_session_id:TS.search.getSearchSessionIdForResults(),no_user_profile:!0};"search.all"===e&&(c.no_posts=1),"search.files"!==e&&(c.more_matches=!0),"search.messages"===e&&(c.refinement_version=TS.search.refinement_version,s&&(s.refinement_client_request_id&&(c.refinement_client_request_id=s.refinement_client_request_id),s.refinement_iid&&(c.refinement_iid=s.refinement_iid),s.refinement_session_id&&(c.refinement_session_id=s.refinement_session_id),s.refinement_request_id&&(c.refinement_request_id=s.refinement_request_id),s.suppress_refinements&&(c.suppress_refinements=1))),TS.boot_data.page_needs_enterprise&&TS.boot_data.enterprise_api_token&&(c.enterprise_token=TS.boot_data.enterprise_api_token,"search.messages"===e&&(c.team=TS.model.team.id)),TS.interop.api.call(e,c).then((function(e){var t=e.data,n=e.args,i=e.request_id;TS.telemeter.measure(l,o+"_response");return a&&a(!0,t,n,i),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;TS.interop.console.error("SEARCH","_callSearchPerSe failed");return a&&a(!1,t,n,i),{data:t,args:n,request_id:i}}))},d=function(e,t,n,i){if(!e||!t.messages){var r=t&&t.error?t.error:"unknown_error";t||(t={ok:!1,error:r}),t.query=t.query||n.query,t.messages=t.messages||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}if(n.query===TS.search.query||TS.search.results[n.query]&&TS.search.results[n.query].error){TS.search.last_search_query!==n.query&&delete TS.search.results[TS.search.last_search_query],TS.search.last_search_query=n.query,TS.search.last_request_id=i,TS.search.expandChannelsAndCheckForMsgsInModel(t);var a=TS.search.results[n.query];1==n.page?(a?$.extend(a,t):(TS.search.results[n.query]=t,a=t),a.initial_messages_total=t.messages.total,a.messages.pages=[{start:0,count:_.get(t.messages,"matches.length",0)}],_.has(a,"messages.modules.score.matches")&&(a.messages.modules.score.pages=[{start:0,count:_.get(a.messages.modules.score,"matches.length",0)}]),a._time_of_search=Date.now(),TS.search.message_search_results_fetched_sig.dispatch(a,n)):(a.messages&&a.messages.matches&&(t.messages.matches=a.messages.matches.concat(t.messages.matches),t.messages.pages=a.messages.pages.concat([{start:a.messages.matches.length,count:_.get(t.messages,"matches.length",0)}])),$.extend(a,t),TS.search.message_search_results_fetched_sig.dispatch(a,n))}},c=function(e,t,n,i){if(!e||!t.files){var r=t&&t.error?t.error:"unknown_error";t||(t={ok:!1,error:r}),t.query=t.query||n.query,t.files=t.files||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}if(t.query=TS.emoji.maybeGetLocalizedEmojiString(t.query),n.query=TS.emoji.maybeGetLocalizedEmojiString(n.query),n.query===TS.search.query||TS.search.results[n.query]&&TS.search.results[n.query].error){TS.search.last_search_query!==n.query&&delete TS.search.results[TS.search.last_search_query],TS.search.last_search_query=n.query,TS.search.last_files_request_id=i;var a=TS.search.results[n.query];1===n.page?(a?$.extend(a,t):(TS.search.results[n.query]=t,a=t),a.initial_files_total=t.files.total,a._time_of_search=Date.now(),TS.search.file_search_results_fetched_sig.dispatch(a,n)):(a.files&&a.files.matches&&(t.files.matches=a.files.matches.concat(t.files.matches)),$.extend(a,t),TS.search.file_search_results_fetched_sig.dispatch(a,n))}},u=function(){var e=!1,t=!1,n=function(){e&&t&&TS.search.all_search_results_fetched_sig.dispatch()};return{msgs:function(){e=!0,d.apply(this,arguments),n()},files:function(){t=!0,c.apply(this,arguments),n()}}},m=function(e){var t=$("#search_results_items"),n=TS.files.containerHasFileListItem(e,t);!TS.interop.files.isObjectFresh(e.id)&&n?TS.files.getFileById(e.id):n&&TS.files.updateFileListItem(e,t)},p=function(){var e=$(".reveal_hidden_items");e.one("click enter",(function(t){var n=$(".results .deleted");n&&(t.stopPropagation(),n.removeClass("deleted"),e.remove())}))}}()},kyJk:function(e,t){!function(){TS.registerModule("attachment_actions.select",{onStart:_.noop,decorateNewElements:function(e){e.find(".attachment_actions_interactions select:not(.hidden)").each((function(){var e=$(this),t={},c={adjustAvailableSpaceAbove:o,adjustAvailableSpaceBelow:s,allow_list_position_above:!0,classes:"select_attachment",data_promise:d(t),disabled:e.attr("disabled"),errorTemplate:i,filter:r,input_debounce_wait_time:u(t),min_query_length:_.get(t,"action.min_query_length",0),no_default_selection:!0,onListShown:a(t),placeholder_text:p(t),filter_placeholder_text:f(t),should_graphic_replace_emoji:!0,style:TS.ui.lazy_filter_select.STYLES.filter_in_list,template:m(t)};e.lazyFilterSelect(c).addClass("hidden"),function(e,t){if(!$.contains(document,t[0]))return;var i=l(e),r=_.get(e,"action.selected_options[0]");if(r){if(_.includes([n.channels,n.conversations,n.users],i)){var a;if(!(a=i===n.users?TS.interop.members.getMemberById(r.value):TS.redux.channels.getEntityById(r.value)))return;r={model_ob:a}}else r.text=_.unescape(r.text),r.description=_.unescape(r.description),r=y(r);t.lazyFilterSelect("forceSelectItem",r)}}(t,e)}))},getActionModel:function(e,t){var i=n[e.data_source]||n.default;return _.merge({},e,{_disabled:e._disabled||!!t,data_source:i,options:b(e.options),option_groups:T(e.option_groups),text:e.text||h(i)})}});var e={channels:TS.interop.i18n.t("Choose a channel\u2026","attachment_actions")(),conversations:TS.interop.i18n.t("Choose a conversation\u2026","attachment_actions")(),default:TS.interop.i18n.t("Choose an option\u2026","attachment_actions")(),external:TS.interop.i18n.t("Choose an option\u2026","attachment_actions")(),users:TS.interop.i18n.t("Choose a person\u2026","attachment_actions")()},t={channels:TS.interop.i18n.t("Search channels","attachment_actions")(),conversations:TS.interop.i18n.t("Search conversations","attachment_actions")(),default:TS.interop.i18n.t("Filter options","attachment_actions")(),external:TS.interop.i18n.t("Search options","attachment_actions")(),users:TS.interop.i18n.t("Search people","attachment_actions")()},n={channels:"channels",conversations:"conversations",default:"default",external:"external",users:"users"};function i(e){return e?TS.interop.i18n.t("Couldn\u2019t load results.","lazy_filter_select")():TS.interop.i18n.t("No results.","lazy_filter_select")()}function r(e,t){return _.isEmpty(t)||TS.fuzzy.score(e.text.toLowerCase(),t.toLowerCase())<1/0}function a(e){var t=_.get(e,"action.data_source"),n=w(e);return function(){!function(e,t){TS.interop.clog.track("MSG_MENU_OPEN",{data_source:e,service_id:t})}(t,n)}}function s(e){return e-($("#footer").height()||0)}function o(e){return e-($("#client_header").height()||0)}function l(e){var t=_.get(e,"action.data_source");return n[t]||n.default}function d(e){switch(l(e)){case n.channels:return c({channels:{include_archived:!1}},{default_query:"#"});case n.conversations:return function(e){return new Promise((function(t,n){TS.ui.file_share.promiseToGetFileShareSelectOptions(e).then((function(e){t({all_items_fetched:!0,items:e,replace_all_items:!0})}),n)}))};case n.external:return function(e){return function(t){return new Promise((function(n,i){var r=_.get(e.message,"bot_profile.team_id",!1),a={name:e.action.name,value:t,attachment_id:e.attachment.id,callback_id:e.attachment.callback_id,channel_id:e.channel_id,is_ephemeral:!0,message_ts:e.message.ts};r&&(a.team_id=r),TS.interop.api.call("chat.attachmentSuggestion",{service_id:w(e),payload:JSON.stringify(a)}).then((function(e){n({all_items_fetched:!0,items:v(e),replace_all_items:!0})})).catch((function(e){i(e)}))}))}}(e);case n.users:return c({members:{include_self:!0}},{default_query:"@"})}}function c(e,t){return e=_.defaults(e,{limit:100,sort:{frecency:!0}}),t=_.defaults(t,{default_query:""}),function(n){return n=n||t.default_query,new Promise((function(t,i){TS.searcher.search(n,e).then((function(e){t({all_items_fetched:!0,items:e,replace_all_items:!0})}),i)}))}}function u(e){if(l(e)!==n.default)return 250}function m(e){var t=l(e);return"users"===t?S:_.includes([n.channels,n.conversations],t)?g:void 0}function p(e){return _.get(e,"action.text")||h(e)}function f(e){return _.get(t,l(e),t.default)}function h(t){return _.get(e,l(t),e.default)}function g(e){var t=TS.templates.attachment_actions_select_channel_or_conversation_option(e.model_ob);return new Handlebars.SafeString(t)}function S(e){var t=TS.templates.attachment_actions_select_user_option(e.model_ob);return new Handlebars.SafeString(t)}function T(e){if(e)return e.map((function(e){return _.merge({},e,{options:b(e.options),text:e.text&&new Handlebars.SafeString(e.text)})}))}function b(e){if(e)return e.map((function(e){return _.merge({},e,{description:e.description&&new Handlebars.SafeString(e.description),text:e.text&&new Handlebars.SafeString(e.text)})}))}function v(e){var t=_.get(e,"data.option_groups");return _.isArray(t)?t.map((function(e){var t=_.get(e,"options",[]).map((function(e){return y(e,{is_group_item:!0})}));return{lfs_group:!0,label:e.text,children:t}})):_.get(e,"data.options",[]).map(y)}function y(e,t){e=_.merge({},e,{is_group_item:_.get(t,"is_group_item")});var n=TS.templates.attachment_actions_select_option(e);return $("<div>").html(n).children()[0]}function w(e){return _.get(e,"attachment.is_app_unfurl")?e.attachment.bot_id:_.get(e,"message.bot_id")}}()},lSNA:function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},laYx:function(e,t){!function(){TS.registerModule("tips",{onStart:function(){e.delegate(".ts_tip_lazy, .ts_tip_float","mouseenter",s),e.delegate(".ts_tip_float","mouseleave",o),e.on("click",".ts_tip",(function(){c($(this))}))},hideAll:function(){$(".ts_tip").addClass("ts_tip_hide")},unhideAll:function(){$(".ts_tip").removeClass("ts_tip_hide")},updateTipTitle:function(e,t){var i=u(e);i.length?i.html(t):e.attr("title",t),n&&n[0]==e[0]&&(t?(r.html(t),d()):l())},updateFloater:function(e){r&&e.title&&r.text(e.title),i&&e.classes_to_add&&i.addClass(e.classes_to_add.join(" "))},manuallyToggleTipTitle:function(e){c(e)}});var e=$("BODY"),t=null,n=null,i=null,r=null,a=0,s=function(s){var o=(n=$(s.currentTarget)).hasClass("ts_tip_multiline");if(n.addClass("ts_tip_hidden"),0==n.children(".ts_tip_tip").length&&m(n,o),n.removeAttr("title"),n.removeClass("ts_tip_lazy"),$("#ts_tip_float_floater").remove(),n.hasClass("ts_tip_float")){var c=n.attr("class").split(/\s+/).filter((function(e){return"ts_tip_float"!==e&&("ts_tip_lazy"!==e&&0===e.indexOf("ts_tip"))})),u=TS.templates.builders.strBuilder('<div id="ts_tip_float_floater" style="width:${w}px; height:${h}px;" class="${classes}">${tip_html}</div>',{w:n.outerWidth(),h:n.outerHeight(),classes:c.join(" "),tip_html:n.find(".ts_tip_tip").clone()[0].outerHTML});i=$(u),e.append(i),a=setTimeout((function(){i.removeClass("ts_tip_hidden"),d()}),10),(t=n.closest(":scrollable(vertical)")).on("scroll.ts_tip_removal",l),n.on("destroyed.ts_tip_removal",l),n.hasClass("ts_tip_hide_on_click")&&n.on("click.ts_tip_removal",l),o?r=i.find(".ts_tip_multiline_inner"):(r=i.find(".ts_tip_tip_inner")).length||(r=i.find(".ts_tip_tip"))}else setTimeout((function(){n.removeClass("ts_tip_hidden")}),10)},o=function(){l()},l=function(){clearTimeout(a),i&&i.addClass("ts_tip_hidden"),n&&n.length&&(n.off("click.ts_tip_removal"),n.off("destroyed.ts_tip_removal")),t&&t.off("scroll.ts_tip_removal"),t=null,n=null,i=null,r=null},d=function(){var e=n.offset(),t=window.innerWidth-2,r=window.innerHeight-2,a=i.hasClass("ts_tip_multiline"),s=function(){return a?i.find(".ts_tip_multiline_inner").dimensions_rect():i.find(".ts_tip_tip").dimensions_rect()},o=function(e){i.removeClass("\t\t\tts_tip_right \t\t\tts_tip_rightish \t\t\tts_tip_left \t\t\tts_tip_leftish \t\t\tts_tip_multiline_top_leftish \t\t\tts_tip_multiline_top_left \t\t\tts_tip_multiline_top_right \t\t\tts_tip_multiline_top_rightish \t\t").addClass(e)};i.css("left",e.left).css("top",e.top);var l=s();l.bottom>r?i.removeClass("ts_tip_bottom").addClass("ts_tip_top"):l.top<2&&i.removeClass("ts_tip_top").addClass("ts_tip_bottom"),a?(l.right>t?o("ts_tip_multiline_top_rightish"):l.left<2&&o("ts_tip_multiline_top_leftish"),(l=s()).right>t?o("ts_tip_multiline_top_right"):l.left<2&&o("ts_tip_multiline_top_left")):(l.right>t?o("ts_tip_rightish"):l.left<2&&o("ts_tip_leftish"),(l=s()).right>t?o("ts_tip_right"):l.left<2&&o("ts_tip_left"))},c=function(e){var t,n=u(e),i="tip-toggle-auto";if(e.data(i)?t=e:n.data(i)&&(t=n),t&&t.length){var r=n.html(),a=t.data(i);if(!a)return TS.warn("No toggle state text defined on tipped element. Please add text to data-tip-toggle-text or data-tip-toggle-auto attribute");TS.tips.updateTipTitle(e,a),t.data(i,r)}},u=function(e){var t=e.find(".ts_tip_multiline_inner");return t.length||(t=e.find(".ts_tip_tip_inner")),t.length||(t=e.find(".ts_tip_tip")),t},m=function(e,t){var n="";if(e.data("tip-member"))n=TS.templates["c-unified_member"]({member:TS.interop.members.getMemberById(e.data("tip-member")),size:"small",avatar:!0,no_tip:!0,dark:!0,omit_status:!0,forced_primary:"real_name"});else{var i=_.escape(e.prop("title")),r=function(e){if(!e.text().trim().length&&!e.attr("aria-label"))return _.uniqueId("ts_tip_tip_")}(e),a=r?' id="'+r+'"':"";n=t?'<span class="ts_tip_multiline_inner">'+i+"</span>":i}var s=["<span",a,' class="ts_tip_tip"',">",n,"</span>"];e.append(s.join("")),e.attr("aria-labelledby",r)}}()},m0LI:function(e,t){e.exports=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}return n}}},m7EJ:function(e,t,n){var i=n("cDf5"),r=n("lSNA");function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(){TS.registerModule("utility.contenteditable",{create:function(e,t){if(t||(t={}),(e=r(e))&&!a(e)&&!l(e)){var i={modules:{tabcomplete:{searchOptions:{},appendMenu:function(e){$("body").prepend(e)},render:TS.tabcomplete.render,shouldCompleteOnTab:function(){return!TS.i18n.sendButtonEnabled()},onRender:function(){TS.tips.texty.hide()},tooltipIsShowing:function(){return TS.tips.texty.isShowing()},tooltipShow:function(e){TS.tips.texty.show(e)},tooltipHide:function(){TS.tips.texty.isShowing()&&TS.tips.texty.hide()}},textsubstitutions:{getTextPreferences:function(){return $("#chat_input_tab_ui").length?null:TS.interop.utility.getSystemTextPreferences()}},clipboard:{onPaste:function(t){return TS.utility.contenteditable.paste(e,t)}},keyboard:{featureReactMessages:TS.boot_data.feature_react_messages,featureFileThreads:TS.boot_data.feature_file_threads,shouldInsertNewline:function(t){return TS.interop.texty.shouldInsertNewline(s(s({},t),{},{useSendButton:TS.i18n.sendButtonEnabled(),usePreNewlines:TS.prefs.getPref("enter_is_special_in_tbt"),isCursorInPreBlock:TS.utility.contenteditable.isCursorInPreBlock(e)}))}},slackmention:!0},onEnter:function(){return!TS.boot_data.feature_file_threads},onEscape:function(){return!TS.boot_data.feature_file_threads},onTab:function(){return!0},onMentionReplace:function(t){var i=t.replacements;if(t.isLastReplacement&&1===i.length&&"UNVERIFIED"!==i[0].id){var r=e.querySelectorAll("ts-mention[data-id="+i[0].id+"]");1===r.length&&r[0].offsetTop>=e.offsetTop&&(TS.tips.texty.show(r[0]),n=setTimeout((function(){TS.tips.texty.hide(),n=null}),1500))}},singleLineInput:!1,inlineEmojiIsEnabled:TS.utility.contenteditable.inlineEmojiIsEnabled,convertEmoticonsIsEnabled:function(){return TS.prefs.getPref("convert_emoticons")},isJumbomojiEnabled:!1,onTextChange:_.noop,useSonicEmoji:TS.boot_data.feature_sonic_emoji,getLocale:function(){return TS.interop.i18n.locale},getTeamId:function(){return TS.model.team.id},enableBroadcastKeywords:!0,isAutocompleteOpen:function(){return!!$("#chat_input_tab_ui").length},getBroadcastKeywords:function(){return _.curry(TS.interop.broadcast_keywords.getBroadcastKeywordsForUser)(TS.model.active_cid)},getUserHighlightWords:TS.interop.prefs.getHighlightWords,promiseToSearchMembers:u,tabIndex:0,showTextyTooltips:!0,getEmojiNames:TS.emoji.legacyGetEmojiNames,logger:TS.interop.utility.getLogger({teamId:TS.model.team.id})};if(_.defaultsDeep(t,i),t.modules&&t.modules.tabcomplete&&(t.modules.tabcomplete.completers||(t.modules.tabcomplete.completers=["channels","commands","emoji","members"]),t.modules.tabcomplete.completers=_.compact(t.modules.tabcomplete.completers.map((function(e){return"channels"===e?TS.tabcomplete.channels:"commands"===e?TS.tabcomplete.commands:"emoji"===e?TS.tabcomplete.emoji:"members"===e?TS.tabcomplete.members:(TS.error("TEXTY","Invalid completer passed to texty"),null)})))),!t.singleLineInput){var o=t.onTextChange;t.onTextChange=function(e){n||TS.tips.texty.hide(),o(e)}}var c=new TS.interop.texty.TextyClass(e,t);return d(e,c),c}},inlineEmojiIsEnabled:function(){return TS.prefs.prefs_loaded?!TS.interop.rules.emoji.shouldRenderEmojiAsText():"as_text"!==TS.boot_data.pref_emoji_mode},isJumbomojiEnabled:function(){return TS.prefs.prefs_loaded?TS.utility.contenteditable.inlineEmojiIsEnabled()&&TS.prefs.getPref("jumbomoji")&&"dense"!==TS.prefs.getPref("theme"):TS.utility.contenteditable.inlineEmojiIsEnabled()&&!!TS.boot_data.pref_jumbomoji&&"dense"!==TS.boot_data.pref_messages_theme},refreshJumbomoji:function(e){if((e=r(e))&&o(e)){var t=l(e);t&&t.refreshJumbomoji()}},refreshContents:function(e){if((e=r(e))&&o(e)){var t=l(e);if(t){var n=TS.utility.contenteditable.value(e),i=TS.interop.texty.convertContentsStringToContents(n,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});t.refreshContents(i)}}},unload:function(e){if((e=r(e))&&o(e)){var t=l(e);t&&(t.unload(),c(e))}},isActiveElement:function(e){return!!(e=r(e))&&(a(e)?document.activeElement===e:!!o(e)&&(!!l(e).hasFocus()||document.activeElement&&-1!=document.activeElement.className.indexOf("ql-clipboard")&&document.activeElement.parentNode===e))},focus:function(e){if(e=r(e))if(a(e))e.focus();else if(o(e)){l(e).focus()}},hasFocus:function(e){if(e=r(e)){if(a(e))return $(e).is(":focus");if(o(e))return l(e).hasFocus()}},blur:function(e){if(e=r(e))if(a(e))e.blur();else if(o(e)){l(e).blur()}},disable:function(e){if(e=r(e))if(a(e))e.disabled=!0;else if(o(e)){l(e).disable()}},isDisabled:function(e){if(e=r(e))return a(e)?!0===e.disabled:!!o(e)&&!l(e).isEnabled()},enable:function(e){if(e=r(e))if(a(e))e.disabled=!1;else if(o(e)){l(e).enable(),TS.utility.contenteditable.updateSpellCheck(e)}},isEnabled:function(e){return!!(e=r(e))&&(a(e)?!0!==e.disabled:!!o(e)&&l(e).isEnabled())},value:function(e,t){if(!(e=r(e)))return"";if(a(e))return _.isString(t)&&(e.value=t),e.value;if(o(e)){var n=l(e);if(_.isString(t)){var i=TS.interop.texty.convertContentsStringToContents(t,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});n.setContents(i)}else _.isObject(t)&&n.setContents(t);return TS.interop.texty.convertContentsToString(n.getContents())}return""},displayValue:function(e){return(e=r(e))?a(e)?e.value:o(e)?TS.interop.texty.convertContentsStringToDisplayString(TS.utility.contenteditable.value(e),TS.interop.prefs.getHighlightWords()):"":""},getContentsForRange:function(e,t,n){if(e=r(e),o(e))return l(e).getContentsForRange({index:t,length:n})},getLength:function(e){return(e=r(e))?a(e)?e.value.length:o(e)?l(e).getLength():0:0},getDisplayValueLength:function(e){return TS.utility.contenteditable.displayValue(e).length},getTextForRange:function(e,t,n){return(e=r(e))?a(e)?TS.utility.contenteditable.value(e).substr(t,n):o(e)?l(e).getTextForRange(t,n):"":""},getDisplayTextForRange:function(e,t,n){if(!(e=r(e)))return"";if(a(e))return TS.utility.contenteditable.value(e).substr(t,n);if(o(e)){var i=l(e);return TS.interop.texty.convertContentsToStringForDisplay({contents:i.getContentsForRange(t,n).ops})}return""},insertTextAtCursor:function(e,t,n){var i;if(e=r(e))if(a(e)){if(!_.isString(t))return e.value;i=TS.utility.contenteditable.cursorPosition(e);var s=TS.utility.contenteditable.value(e),d=s.substr(0,i.start)+t+s.substr(i.start);e.value=d,n&&(TS.utility.contenteditable.focus(e),TS.utility.contenteditable.cursorPosition(e,i.start+t.length,0))}else if(o(e)){var c=l(e);_.isString(t)&&c.insertTextAtCursor(t,n)}},insertContentsAtCursor:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"api";if(e=r(e))if(a(e))TS.utility.contenteditable.insertTextAtCursor(e,TS.interop.texty.convertContentsToString(t),n);else if(o(e)){var s=l(e);s.insertContentsAtCursor(t,n,i)}},updateContents:function(e,t){if(e=r(e))if(a(e))TS.warn("updateContents called on form element");else if(o(e)){l(e).updateContents(t)}},paste:function(t,n){if(!(t=r(t)))return!1;if(a(t))return!1;if(!o(t))return!1;var i,s,l=n&&n.clipboardData&&n.clipboardData.types;if(!(l&&l.length||(s=window.clipboardData&&window.clipboardData.getData("Text"))))return TS.interop.console.info("CONTENTEDITABLE","no MIME types in clipboard"),!1;if(s?(TS.interop.console.info("CONTENTEDITABLE","Using alternate clipboard"),i={contents:[{insert:s}]}):(l=Array.prototype.slice.call(l),TS.interop.console.info("CONTENTEDITABLE",'MIME types in clipboard: "'+l.join(', "')+'"'),i=TS.interop.texty.getContentsFromClipboard(n)),!i)return TS.interop.console.info("CONTENTEDITABLE","nothing usable in clipboard"),!1;n.preventDefault();var d=TS.interop.texty.detachInvalidMentionsFromContents(i,(function(e){return m(e.id)}));return TS.interop.texty.convertContentsToStringForDisplay(d).length>e?(n.stopPropagation(),TS.interop.console.info("CONTENTEDITABLE","paste contents exceeded limit"),!0):(TS.utility.contenteditable.insertContentsAtCursor(t,d,!0,"user"),TS.interop.console.info("CONTENTEDITABLE",'pasted into "'+t.id+'"'),!0)},getFormats:function(e,t){return(e=r(e))&&o(e)?l(e).getFormats(t):{}},isEmpty:function(e,t){var n=TS.utility.contenteditable.value(e);return n&&t&&(n=n.trim()),0===n.length},clear:function(e,t){if(e=r(e))if(a(e))e.value="";else if(o(e)){l(e).clear({is_silent:!!t})}},placeholder:function(e,t){if(!(e=r(e)))return"";var n;if(a(e))_.isString(t)&&(""===t?e.removeAttribute("placeholder"):e.setAttribute("placeholder",t)),n=e.getAttribute("placeholder");else if(o(e)){var i=l(e);i.setPlaceholder(t),n=i.getPlaceholder()}return n||""},ariaLabel:function(e,t){(e=r(e))&&(o(e)&&l(e).setAriaLabel(t))},cursorPosition:function(e,t,n){_.isString(e)&&(e=$(e));var i={start:0,end:0,length:0};if(!(e=r(e)))return i;if(_.isNumber(t))n||(n=0),i.start=t,i.end=t+n,i.length=n,a(e)?TS.selection.selectCharacters(e,i.start,i.end):o(e)&&l(e).setSelection(i.start,i.length);else{if(!TS.utility.contenteditable.isActiveElement(e)){var s=$(e).data("utility-contenteditable-cursor-position");if(_.isObject(s))return s}if(a(e))e.focus(),i.start=e.selectionStart,i.end=e.selectionEnd,i.length=Math.abs(e.selectionEnd-e.selectionStart);else if(o(e)){var d=l(e).getSelection();d&&(i.start=d.index,i.length=d.length,i.end=i.start+i.length)}}return i},setCursorAtEnd:function(e){var n=TS.utility.contenteditable.getLength(e);TS.utility.contenteditable.cursorPosition(e,n),e=r(e),o(e)&&($(e).find(".ql-editor").get(0).scrollLeft=t)},selectAll:function(e){var t=TS.utility.contenteditable.getLength(e);TS.utility.contenteditable.cursorPosition(e,0,t)},isTextSelected:function(e){if(e=r(e)){if(a(e))return!(!window.getSelection||!window.getSelection().toString());if(o(e))return l(e).getSelection().length>0}},deserialize:function(e,t){if(t&&(e=r(e)))if(a(e))e.value=t;else if(o(e)){if("object"===i(t)&&t.hasOwnProperty("contents"))return void TS.utility.contenteditable.value(e,t);if("string"!=typeof t)return;try{var n=JSON.parse(t);if(null!==n&&"object"===i(n))return void TS.utility.contenteditable.value(e,n)}catch(e){}TS.utility.contenteditable.value(e,t)}},isCursorInPreBlock:function(e){return!!(e=r(e))&&(!!o(e)&&l(e).isCursorInPreBlock())},isIndexInCode:function(e,t){return!!(e=r(e))&&(!!o(e)&&l(e).isIndexInCode(t))},deleteSelection:function(e){return!!(e=r(e))&&(o(e)?l(e).deleteSelection():void window.getSelection().deleteFromDocument())},deleteText:function(e,t,n){(e=r(e))&&(o(e)&&l(e).deleteText(t,n))},clearHistory:function(e){if(!(e=r(e)))return!1;var t=l(e);t&&t.clearHistory()},updateSpellCheck:function(e){if(!(e=r(e)))return!1;l(e)&&$(e).find("[contenteditable=true]").attr("spellcheck",!1)},legacySynchronouslyReplacePotentialMentions:function(e){return e},legacyGetIsValidMention:function(e){return m(e)},test:function(){var e={_normalizeInput:r,_isFormElement:a};return e}});var e=5e4,t=1e4,n=null,r=function(e){return!!e&&(e instanceof jQuery&&e[0]&&(e=e[0]),e.nodeType===Node.ELEMENT_NODE&&("textarea"===e.tagName.toLowerCase()||"input"===e.tagName.toLowerCase()?e:$(e).hasClass("ql-editor")?e.parentNode:(e.hasAttribute("contenteditable")||"DIV"===e.tagName)&&e))},a=function(e){return!(!e||!e.tagName)&&("textarea"===e.tagName.toLowerCase()||"input"===e.tagName.toLowerCase())},o=function(e){return!!e&&!!l(e)},l=function(e){return $(e).data("__ts_quill")},d=function(e,t){$(e).data("__ts_quill",t),$(e).attr("data-contenteditable-override","true")},c=function(e){$(e).removeData("__ts_quill")},u=function(e,t){var n;t.no_model_ob||(n=t.model_ob||TS.shared.legacyGetActiveModelOb());var i={query:e.replace(/^[@\uff20]/,""),max_api_results:20,include_org:!0,include_slackbot:!0,include_self:!0,full_profile_filter:!1,limit_by_model_relevancy:n};return TS.members.promiseToSearchMembers(i).then((function(t){var n={usergroups:TS.interop.userGroups.getActiveUserGroups(),members:t&&t.items?t.items:[]};return TS.sorter.search(e,n,{allow_empty_query:!1,frecency:!1,limit:20,prefer_exact_match:!0}).map((function(e){return{item:e}}))}))},m=function(e){if(TS.interop.members.getMemberById(e))return!0;var t=TS.interop.userGroups.getUserGroupById(e);if(t&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(t))return!0;var n=TS.utility.members.getBroadcastKeywordsForUser(),i=_.map(n,"id");return!!_.includes(i,e)}}()},mGpN:function(e,t){!function(){TS.registerModule("templates",{onStart:function(){n(),TS.members&&TS.members.user_color_changed_sig.add(TS.templates.memberUserColorChanged,TS.templates),TS.prefs&&TS.prefs.sidebar_behavior_changed_sig.add(TS.templates.sidebarBehaviorPrefChanged,TS.templates),TS.environment.retina_changed_sig.add(e)},makeRxnKeyDomClass:function(e){return TS.utility.makeSafeForDomId("rxns_key_"+e)},makeMsgDomId:function(e){return TS.utility.makeSafeForDomId("msg_"+e)},makeMsgAttachmentTextExpanderDomId:function(e,t){return TS.utility.makeSafeForDomId("msg_rest_text_expander_"+e+"_"+t)},makeMSRDomId:function(e){return TS.utility.makeSafeForDomId("MSR_"+e.channel.id+"_"+e.ts)},makeFileDragData:function(e){return JSON.stringify({id:e.id,name:e.name,title:e.title,mimetype:e.mimetype,filetype:e.filetype,size:e.size})},makeDayDividerDomId:function(e){return TS.utility.makeSafeForDomId("day_divider_"+e)},makeMemberDomId:function(e){if(e)return TS.templates.makeMemberDomIdById(e.id)},makeMemberDomIdById:function(e){if(e)return"member_"+e},makeFileDomId:function(e){return"file_"+e.id},makeMemberPresenceDomClass:function(e){return"member_presence_"+e},makeMemberPresenceStateClass:function(e){return TS.redux.presence.getPresenceByMemberId(e.id)},makeMemberPresenceIcon:function(e){if(e.deleted)return"";var t=TS.templates.makeMemberPresenceDomClass(e.id),n="ts_icon_presence",i="active"===TS.redux.presence.getPresenceByMemberId(e.id)?TS.interop.i18n.t("active","templates_helpers")():TS.interop.i18n.t("away","templates_helpers")();e.is_ultra_restricted?(t+=" ura",n="ts_icon_presence_ura"):e.is_restricted?(t+=" ra",n="ts_icon_presence_ra"):TS.interop.members.isExternal(e)?(t+=" external",n="ts_icon_presence_external"):e.is_slackbot&&(n="ts_icon_heart");var r='<i aria-hidden="true" class="ts_icon '+n+' presence_icon"></i>',a=TS.templates.makeMemberPresenceStateClass(e);return'<span data-member-presence="'+e.id+'" class="presence '+a+" "+t+'" title="'+i+'">'+r+"</span>"},memberUserColorChanged:function(e){var t="color_"+e.id;e.color!=e.member_color?TS.templates.makeUserColorRule(e):$("#"+("color_rule_"+t)).remove()},makeUserColorRule:function(e){var t,n="color_"+e.id;t="            ."+n+":not(.nuc) {                color:"+("#"+_.escape(e.member_color))+";            }        ";var i="color_rule_"+n,r=$("#"+i);r.length?r.text(t):$('<style type="text/css" id="'+i+'">'+t+"</style>").appendTo("body")},sidebarBehaviorPrefChanged:function(){TS.templates.makeSidebarBehaviorRule()},makeSidebarBehaviorRule:function(){var e,t="sidebar_behavior",n=$("#"+t);"hide_read_channels"===TS.prefs.getPref("sidebar_behavior")?e="\t\t\t\t.channels_list_holder ul li:not(.unread):not(.active):not(.show_in_list_even_though_no_unreads) {\t\t\t\t\tdisplay: none;\t\t\t}":"hide_read_channels_unless_starred"===TS.prefs.getPref("sidebar_behavior")&&(e="\t\t\t\t.channels_list_holder div:not(#starred_div)>ul li:not(.unread):not(.active):not(.is_starred):not(.show_in_list_even_though_no_unreads) {\t\t\t\t\tdisplay: none;\t\t\t}"),e?n.length?n.text(e):$('<style type="text/css" id="'+t+'">'+e+"</style>").appendTo("head"):$("#"+t).remove()},makeMsgDomIdInConversation:function(e){return TS.templates.makeMsgDomId(e)+"_conversation"},makeMsgDomIdInUnreadView:function(e){return TS.templates.makeMsgDomId(e)+"_unread_view"},makeMsgDomIdInThreadsView:function(e){return TS.templates.makeMsgDomId(e)+"_threads_view"}});var e=function(){var e,t,n,i;$(".member_image").each((function(){i=$(this),e=i.data("member-id"),t=i.data("thumb-size"),n=!i.is("a"),e&&t&&$(this).replaceWith(TS.templates.builders.makeMemberPreviewLinkImage(e,t,!1,n))})),i=null},t=/{{\s*i18n_ns\s*('|")[a-zA-Z0-9]+('|")\s*}}/,n=function(){Object.keys(TS.raw_templates).forEach((function(e){TS.templates[e]=i(e,TS.raw_templates[e]),TS.raw_template_paths||(TS.raw_template_paths={},TS.interop.utility.getLogger({getState:TS.redux.getState}).error("MISSING_RAW_TEMPLATE_PATHS")),TS.templates[e+"_path"]=TS.raw_template_paths[e],Handlebars.registerPartial(e,TS.templates[e])})),delete TS.raw_templates},i=function(e,n){if(!n)return TS.warn(e+" was passed no html"),null;t.test(n)&&(n+=" {{_i18n_ns_end}}");var i=Handlebars.compile(n);return function(t){t=t||{};var n=!1,r=!1;"variant"===TS.interop.experiments.getGroupForUser("jira_newxp_2040")&&(n=1==Math.floor(1e5*Math.random()),TS.templates_to_audit&&TS.templates_to_audit.includes(e)&&(n=!0,r=!0));if(n)try{var a={contexts:{ui_context:{action:"impression",ui_properties:{element_name:e+".hbs"}}}};TS.interop.environment.isDev||TS.interop.environment.isQa||TS.interop.clog.track("HANDLEBARS_TEMPLATE_LOGS",a);var s=window.location.pathname.replace(/\/[A-Z0-9-.]*\//g,"/#####/"),o=new Error;o.fileName=TS.templates[e+"_path"],o.message=s+" "+window.location.hash,o.stack="";var l="HANDLEBARS_TEMPLATE_LOGS";r&&(l="HANDLEBARS_TEMPLATE_LOGS_AUDIT"),TS.interop.utility.getLogger({getState:TS.redux.getState}).error(o,l,{subtype:e})}catch(e){}return i(t)}}}()},mmJJ:function(e,t){var n;n={},TS.registerModule("utility.members",{checkMemberMatch:function(e,t,n){return!n&&e.profile&&e.profile.email&&e.profile.email.match(t)||e.profile&&e.profile.real_name_normalized&&e.profile.real_name_normalized.match(t)||e.profile&&e.profile.real_name&&e.profile.real_name.match(t)||e.profile&&e.profile.display_name_normalized&&e.profile.display_name_normalized.match(t)||e.profile&&e.profile.display_name&&e.profile.display_name.match(t)},filterMembersByQuery:function(e,t){if(!(t=_.toString(t).trim().toLowerCase().replace(/^@/,"")))return e;var n=new RegExp(TS.utility.regexpEscape(t),"i");return e.filter((function(e){return TS.utility.members.checkMemberMatch(e,n)}))},getBroadcastKeywordsForUser:function(){var e=TS.shared.legacyGetActiveModelOb();if(!e)return[];var t=TS.interop.broadcast_keywords.getBroadcastKeywordsForUser(e.id),i=t.filter((function(e){return"BKchannel"===e.id||"BKhere"===e.id})),r=TS.boot_data.page_needs_enterprise&&TS.interop.rules.channels.isRequired(e)&&TS.interop.rules.channels.isOrgShared(e);return i.length||!TS.model.user.is_admin||!e.is_channel&&!e.is_group||n[e.id]||(n[e.id]=!0,TS.interop.utility.getLogger({getState:TS.redux.getState}).error({model_ob:e.id,is_channel:e.is_channel,is_group:e.is_group,is_general:e.is_general,is_enterprise_required_channel:r,who_can_at_channel:TS.prefs.getTeamPref("who_can_at_channel"),canAtChannelOrGroup:TS.permissions.members.canAtChannelOrGroup(e.id),canAtMentionEveryone:TS.permissions.members.canAtMentionEveryone(e.id)},"getBroadcastKeywordsForUser no channel_keywords for admin",{subtype:"getBroadcastKeywordsForUser_empty_v2"})),t},isMemberRelevantToModel:function(e,t){return _.isObject(e)||(e=TS.interop.members.getMemberById(e)),!(!e||!TS.interop.rules.members.isSlackbot(e)&&(e.deleted||(_.isObject(t)||(t=TS.redux.channels.getEntityById(t)||TS.shared.legacyGetActiveModelOb()),0)))},isMemberElement:function(e){return!!e.hasAttribute("data-member-id")||!!e.classList.contains("internal_member_link")},isMemberNonBotNonDeletedNonSelf:function(e){return e&&!e.deleted&&!e.is_bot&&!TS.interop.rules.members.isSlackbot(e)&&!e.is_self},isMemberEKMRevoked:function(e){return e&&"UREVOKEDU"===e.id},getEntityFromMessage:function(e){if(!e)return!1;var t=TS.utility.msgs.getFilesOnMsg(e),n=_.first(t);return"USLACKBOT"===e.user&&n&&n.bot_id?TS.utility.members.getEntityFromFile(n):e.comment?TS.redux.members.getPotentiallyUnknownMemberById(e.comment.user):TS.redux.members.getPotentiallyUnknownMemberById(e.user)},getUsernamesMentionedInString:function(e){var t=_.toLower(e).match(/\B@\w+/g);return t?_(t).map((function(e){return e.replace(/^@/,"")})).uniq().compact().value():[]},getEntityFromFile:function(e){return!!e&&("USLACKBOT"===e.user&&e.bot_id?((t=TS.interop.bots.getBotById(e.bot_id))||(t={}),t.is_bot=!0,t.is_service=!0):t=TS.redux.members.getPotentiallyUnknownMemberById(e.user),t);var t}})},"nH+9":function(e,t){!function(){var e,t,n,i;TS.registerModule("ui.new_channel_modal",{start:function(){if(TS.permissions.members.canCreateChannels()||TS.permissions.members.canCreateGroups())return TS.interop.mountChannelCreateModal(TS.boot_data.team_id)},startInContainer:function(r,a,o,l){if(TS.permissions.members.canCreateChannels()||TS.permissions.members.canCreateGroups()){e=r,n=!1!==o,TS.permissions.members.canCreateChannels()||(n=!1),TS.permissions.members.canCreateGroups()||(n=!0);var d=TS.permissions.members.canCreateChannels()&&TS.permissions.members.canCreateGroups();a=TS.interop.utility.cleanChannelName(a||""),l=l||[];var c=TS.templates.channel_new_modal;return e.html(c({title:a,is_public:n,can_toggle_private:d,compliance_exports_enabled_for_team:!!TS.prefs.getTeamPref("compliance_export_start"),is_ra:TS.model.user.is_restricted,can_create_shared_channel:TS.interop.rules.user.canUserRequestSharedChannel()})),t=Ladda.create(e.find(".new_channel_go")[0]),s(l),setTimeout((function(){m()}),500),new Promise((function(e,t){i={resolve:e,reject:t}}))}},go:function(){var i=e.find(".title_input").val(),r=$("#invite_members_container").lazyFilterSelect("value"),a=[],s=[];r&&r.forEach((function(e){e.member?a.push(e.member.id):s.push(e)}));var o=_.trim(TS.utility.contenteditable.value(e.find("#channel_purpose_input")));t&&t.start(),n?l(i,o,a,s):d(i,o,a,s)},end:function(){p()},test:function(){return{createPublicChannel:l,createPrivateChannel:d,maybeSwapped:undefined}}});var r=function(e){var t=!0,n=new Promise((function(e){TS.model.user.is_admin?TS.interop.api.call("users.admin.invited").then((function(t){var n=TS.pending_users.filterOutURAs(t.data.pending);n.length?(n.forEach((function(e){TS.pending_users.sanitizeNameFields(e)})),e(n)):e([])})):e([])}));return function(i,r){var s;"@"===i.charAt(0)&&(i=i.substring(1));var o=!1;if(t&&(t=!1,_.get(e,"length")&&(o=!0)),o){var l=_.compact(e.map((function(e){return TS.interop.members.getMemberById(e)}))).map((function(e){return{member:e,lfs_id:String(e.id),preselected:!0}}));return Promise.resolve({items:l})}return r>0?Promise.resolve({items:[]}):(s=a(i),Promise.all([s,n]).then((function(e){var t=e[0],n=e[1];if(_.isUndefined(n)||0===n.length)return t;var r=new RegExp("^"+TS.utility.regexpEscape(i),"i"),a=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(i),"i");return n=n.filter((function(e){return TS.pending_users.checkUserMatch(e,r)||TS.pending_users.checkUserMatch(e,a)})),t=t.concat(n).sort((function(e,t){return TS.pending_users.usersSorterByName(e,t)}))})))}},a=function(e){var t={query:e,filter:"people"};return TS.members.fetchAndUpsertMembersWithQuery(t).then((function(t){var n=[],i=TS.members.getMembersWithOptions({include_bots:!1}),r=i.map((function(e){return e.id}));return n=""===e?i:t.objects,n=_.filter(n,(function(e){return!e.is_self&&(!TS.interop.rules.members.isSlackbot(e)&&-1!==_.indexOf(r,e.id))})),n=_.filter(n,(function(e){return!(e.is_ultra_restricted||e.deleted||!TS.interop.rules.members.isMemberOnTeam(e,TS.model.team.id)||e.is_app_user)})).map((function(e){return{member:e,lfs_id:String(e.id)}}))}))},s=function(t){var a;!function(e){var t,n,i,a={append:!0,per_page:50,max_selected_items:1e3,approx_item_height:36,placeholder_text:TS.interop.i18n.t("Search by name","new_channel")(),template:function(e){var t;return t=e.member?TS.templates.channel_invite_member_small({member:e.member}):TS.templates.channel_invite_pending_user_small({invitee:e}),new Handlebars.SafeString(t)},tokenTemplate:function(e){var t;return t=e.member?TS.templates.channel_invite_member_token({member:e.member}):TS.templates.channel_invite_pending_user_token({invitee:e}),new Handlebars.SafeString(t)},tokenClass:function(e){return e.member?TS.templates.builders.getMemberTypeClass(e.member):"lfs_token_pending_user"},filter:function(e,r){var a=e.member;return t!==r&&(n=new RegExp("^"+TS.utility.regexpEscape(r),"i"),i=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(r),"i"),t=r),a?TS.utility.members.checkMemberMatch(a,n,!0)||TS.utility.members.checkMemberMatch(a,i,!0):TS.pending_users.checkUserMatch(e,n)||TS.pending_users.checkUserMatch(e,i)},noResultsTemplate:function(e){return e?TS.interop.i18n.t("No one found matching <strong>{query}</strong>","new_channel")({query:TS.interop.i18n.safeString(TS.utility.truncateAndEscape(e,50))}):TS.interop.i18n.t("No one found","new_channel")()}};a.data_promise=r(e),$("#invite_members_container").lazyFilterSelect(a)}(t),e.find(".lfs_input").attr("id","invite_members_input"),e.find(".new_channel_go").click(TS.ui.new_channel_modal.go),e.find(".create_share_channel").click((function(){TS.ui.new_channel_modal.end()})),function(){var t=e.find("#invite_members_container").find("input")[0],n=e.find("#channel_purpose_input");e.on("keydown",(function(e){e.which!==TS.utility.keymap.enter||document.activeElement==t||TS.utility.contenteditable.hasFocus(n)?e.which===TS.utility.keymap.esc&&(TS.ui.fs_modal.close(),e.preventDefault()):(TS.ui.new_channel_modal.go(),e.preventDefault())}))}(),(a=$("#channel_public_private_toggle")).togglify(),a.bind("change",(function(){n=a.is(":checked"),a.is(":checked")?(e.find(".private_channel_item").addClass("hidden"),e.find(".public_channel_item").removeClass("hidden")):(e.find(".public_channel_item").addClass("hidden"),e.find(".private_channel_item").removeClass("hidden"))})),e.find(".title_input").keydown((function(){e&&e.find(".modal_input_note.mustard_yellow").each((function(){$(this).addClass("hidden")}))})),$("#channel_create_title").focus(),e.find(".new_channel_cancel_btn").on("click",(function(){var e=i&&i.reject;e&&e(),TS.ui.fs_modal.close()}));var s=$("#save_channel"),o=$("#channel_create_title");function l(){var e=o.val();e&&e.length?TS.utility.disableElement(s,!1):TS.utility.disableElement(s,!0)}s.length&&o.length&&(o.on("input",l),l());var d=e.find("#channel_purpose_input");TS.utility.contenteditable.create(d,{ariaLabel:TS.interop.i18n.t("Channel purpose","new_channel")(),singleLineInput:!0,modules:{tabcomplete:{positionMenu:function(e){e.style.width=d.outerWidth()+"px",TS.tabcomplete.positionUIRelativeToInput(e,d)},completers:["channels","emoji","members"]}},enableBroadcastKeywords:!1,onTab:function(){return!0},onEnter:function(){return!1},onEscape:function(){TS.ui.fs_modal.close()}}),TS.utility.contenteditable.enable(d)},o=function(e){var t=i&&i.resolve;t&&t(e)},l=function(n,i,r,a){TS.redux.dispatch(TS.interop.channels.createChannel({name:n})).then((function(e){c(e.id,r),i&&TS.redux.dispatch(TS.interop.channels.submitChannelPurpose({channelId:e.id,purpose:i})).catch(TS.channels.legacyAlertSetPurposeError),u(e.id,a),o(e),TS.ui.fs_modal.close()})).catch((function(i){var r=new RegExp(n,"g"),a=(_.get(i,"data.error")||i.message).toString().replace(r,"CHANNEL_NAME_REDACTED"),s=_.get(i,"stack","").replace(r,"CHANNEL_NAME_REDACTED");TS.interop.utility.getLogger({getState:TS.redux.getState}).error({message:a,stack:s,public:!0},a,{subtype:"channel_create_error"}),t&&t.stop();var o=TS.ui.validation.getErrorMessage(_.get(i,"data.error")||i.message,{name:n});TS.ui.validation.showWarning(e.find(".title_input"),o,{custom_for:"channel_create_title"})}))},d=function(n,i,r,a){TS.redux.dispatch(TS.interop.channels.createChannel({name:n,isPrivate:!0})).then((function(e){c(e.id,r),i&&TS.redux.dispatch(TS.interop.channels.submitChannelPurpose({channelId:e.id,purpose:i})).catch(TS.channels.legacyAlertSetPurposeError),u(e.id,a),o(e),TS.ui.fs_modal.close()})).catch((function(i){var r=new RegExp(n,"g"),a=(_.get(i,"data.error")||i.message).toString().replace(r,"CHANNEL_NAME_REDACTED"),s=_.get(i,"stack","").replace(r,"CHANNEL_NAME_REDACTED");TS.interop.utility.getLogger({getState:TS.redux.getState}).error({message:a,stack:s,public:!1},a,{subtype:"channel_create_error"}),t&&t.stop();var o=TS.ui.validation.getErrorMessage(_.get(i,"data.error")||i.message,{name:n});TS.ui.validation.showWarning(e.find(".title_input"),o,{custom_for:"channel_create_title"})}))},c=function(e,t){e&&t&&t.length&&(_.pull(t,TS.model.user.id),t.length&&TS.interop.api.call("conversations.invite",{channel:e,users:t.join(","),just_created:!0,force:!0}))},u=function(e,t){e&&t&&t.length&&TS.pending_users.invitePendingUsersToChannel(t,e)},m=function(){var e=new Date("March 17, 2017 10:00:00"),t=Math.floor(e.getTime()/1e3);TS.prefs.getPref("seen_intl_channel_names_coachmark")||"en-US"!==TS.boot_data.browser_lang&&"en-us"!==TS.boot_data.browser_lang&&(TS.model.user.created>t||(TS.prefs.setPrefLocal("seen_intl_channel_names_coachmark",!0),TS.prefs.setPrefByAPI({name:"seen_intl_channel_names_coachmark",value:!0},(function(){TS.coachmark.start(TS.coachmarks.coachmarks.intl_channel_names)}))))},p=function(){e&&(e.find(".new_channel_go").off("click"),e.find("#channel_public_private_toggle").off("change"),e.off("keydown")),e=null,t=null,i=null}}()},nOzb:function(e,t){!function(){TS.registerModule("searcher",{search:function(t,n){n.tiered?TS.telemeter.mark("ts-searcher-search-tiered-mark"):TS.telemeter.mark("ts-searcher-search-mark"),n.limit?n.limit_option={limit:n.limit}:n.limit_option={limit:e},n.members&&!0===n.members&&(n.members=_.cloneDeep(r));var i=p(t,n);if(n.tiered){var a=s(t,n);return a.promise=i,Promise.resolve(a).finally((function(){TS.telemeter.measureAndClear("ts-searcher-search-tiered-mark","ts-searcher-search-tiered")}))}return i.then((function(e){try{if(_.get(TS,"model.user.id")&&e.members&&["U0620EL8G","WFKHTCZ29","WKLQEGRRB"].indexOf(TS.model.user.id)>-1){var t=_.map(e.members,(function(e){return{user:e.id,is_stranger:e.is_stranger}}));TS.interop.utility.getLogger({getState:TS.redux.getState}).error("guest_to_guest_visibility",{type:"flannel_search_results",member_list:t})}}catch(e){TS.interop.utility.getLogger({getState:TS.redux.getState}).error("guest_to_guest_visibility",{type:"flannel_search_results",error:e})}return e})).finally((function(){TS.telemeter.measureAndClear("ts-searcher-search-mark","ts-searcher-search")}))},test:function(){return{count:b}}});var e=24,t={prefer_exact_match:!0,frecency:!0,prefer_channels_user_belongs_to:!0},n={include_archived:!0,only_if_member:!1},i={include_archived:!0},r={include_self:!1,include_slackbot:!0,include_bots:!0,only_local_team:!1,only_admins:!1},a={include_deleted:!1,include_from_another_team:!1},s=function(e,n){v(n);var i={};if(n.members&&(i.members=o(n.members)),n.channels&&(i.channels=l(n.channels)),n.groups&&(i.groups=d(n.groups)),n.all_mpims&&(i.all_mpims=TS.redux.channels.dangerouslyGetMpims().filter(TS.interop.rules.channels.isVisibleMpim)),n.mpims&&(i.mpims=TS.redux.channels.dangerouslyGetMpims()),n.teams&&(i.teams=c(n.teams)),n.usergroups&&(i.usergroups=u(n.usergroups)),n.views&&(i.views=m(n.views)),n.filter&&(i=n.filter(i)),!1!==n.sort){var r=T(n.sort,n.limit_option,t);return TS.sorter.search(e,i,r)}return i},o=function(e){return e=T(e,r),TS.members.getMembersWithOptions(e)},l=function(e){var t;return e=T(e,n),t=TS.redux.channels.dangerouslyGetPublicChannels({includeFromAnotherTeam:e.include_from_another_team}),e.include_archived||(t=_.reject(t,TS.interop.rules.channels.isArchived)),e.exclude_required&&(t=_.reject(t,TS.interop.rules.channels.isRequired)),e.only_if_member&&(t=_.filter(t,"is_member")),e.can_post&&(t=_.filter(t,TS.permissions.members.canPostInModelOb)),t=_.reject(t,{is_moved:1,is_archived:!0})},d=function(e){e=T(e,i);var t=TS.redux.channels.dangerouslyGetPrivateChannels({includeFromAnotherTeam:e.include_from_another_team});return e.include_archived||(t=_.reject(t,TS.interop.rules.channels.isArchived)),t=_.reject(t,{is_moved:1,is_archived:!0})},c=function(){var e=_.map(TS.boot_data.other_accounts,(function(e){return TS.teams.getTeamById(e.team_id)})),t=[];return!TS.boot_data.page_needs_enterprise||TS.model.is_our_app&&!TS.interop.environment.isSSBAndAtLeastVersion("2.8")||(t=_.values(TS.teams.getEnterpriseTeams({only_member_of:!0,exclude_current_team:!0}))),_.uniqBy(t.concat(e),"id")},u=function(e){var t=TS.interop.userGroups.getKnownUserGroups();return e.include_deleted||(t=t.filter((function(e){return TS.interop.userGroups.isUserGroupActive(e)}))),e.include_from_another_team||(t=t.filter((function(e){return!TS.interop.userGroups.isUserGroupFromAnotherTeam(e.id)}))),t},m=function(){var e=[];return e.push(_.find(TS.model.NAMED_VIEWS,{id:"Vall_threads"})),e.push(_.find(TS.model.NAMED_VIEWS,{id:"Vapp_space"})),e},p=function(e,t){var n=[],i=[];if(t.members){var r=f(e,t);(t.members.runaway?i:n).push(r)}if(t.channels||t.groups){var a=h(e,t);(t.channels&&t.channels.runaway||t.groups&&t.groups.runaway?i:n).push(a)}if(t.usergroups){var o=g(e,t);(t.usergroups.runaway?i:n).push(o)}if(TS.boot_data.page_needs_enterprise&&t.teams){var l=S(e,t);(t.teams.runaway?i:n).push(l)}return Promise.all(n).then((function(){var n=s(e,t),r=!1!==t.sort?!!n.length:_.some(_.values(n),"length");return i.length&&!r?new Promise((function(e){Promise.all(i).then(e)})).then((function(){return s(e,t)})):n}))},f=function(e,t){var n=e.charAt(0);return"#"===n?Promise.resolve():("@"===n&&(e=e.slice(1)),n&&!e?Promise.resolve():((t=T(t.members,t.limit_option,r)).max_api_results=t.remote_limit||t.limit,t.query=e,TS.members.promiseToSearchMembers(t).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop)))},h=function(e,t){var n=e.charAt(0);if("@"===n)return Promise.resolve();if("#"===n&&(e=e.slice(1)),n&&!e)return Promise.resolve();var i=t.channels&&t.channels.include_from_another_team||t.groups&&t.groups.include_from_another_team,r=(t=T(t.channels||t.groups,t.limit_option)).remote_limit||t.limit;return TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:{query:e,count:r},includeFromAnotherTeam:i}).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop)},g=function(e,t){var n=e.charAt(0);if("#"===n)return Promise.resolve();if("@"===n&&(e=e.slice(1)),n&&!e)return Promise.resolve();var i=(t=T(t.usergroups,t.limit_option,a)).remote_limit||t.limit;return TS.interop.userGroups.fetchAndUpsertUserGroupsWithQuery({query:e,count:i}).catch(_.noop)},S=function(e,t){var n=(t=T(t.teams,t.limit_option)).remote_limit||t.limit;return TS.interop.teams.fetchAndUpsertTeamsWithQuery({query:e,count:n}).catch(_.noop)},T=function(e,t){return!0===e&&(e={}),_.defaultsDeep.apply(null,arguments)},b=function(e){return _.size(_.flatten(_.values(e)))},v=function(e){(e.members||e.mpims||e.all_mpims)&&TS.interop.members.pauseRefetch(),(e.channels||e.groups||e.mpims||e.all_mpims)&&TS.interop.channels.pauseRefetch(),e.teams&&TS.interop.teams.pauseRefetch()}}()},oTOb:function(e,t){!function(){var e,t,n,i,r,a;TS.registerModule("ui.edit_member_profile",{onStart:function(){TS.members.changed_profile_sig.add(G),$("body").on("click",'[data-action="edit_member_profile_modal"]',(function(e){e.preventDefault(),TS.ui.edit_member_profile.start(),TS.interop.clog.track("USER_PROFILE_CLICK")}))},start:function(){d()}});var s,o=[],l="UPLOAD_PROFILE_IMAGE",d=function(){var e={};e.custom_username_policy=TS.prefs.getTeamPref("username_policy");var t={body_template_html:TS.templates.edit_member_profile_modal(e),onShow:c,onGo:F,onCancel:u,go_button_text:TS.interop.i18n.t("Save Changes","edit_profile")(),go_button_class:"edit_member_profile_confirm_edit_btn ladda-button",modal_class:"fs_modal_header fs_modal_footer",title:TS.interop.i18n.t("Edit your profile","edit_profile")()};TS.ui.fs_modal.start(t)},c=function(){e=$("#edit_member_profile_container"),t=$("body"),Y()&&$("#fs_modal_footer").prepend(TS.templates.edit_member_profile_footer({can_edit_team_profile:!0})),e.on("click",'[data-action="edit_member_profile_cancel_photo"]',M),e.on("click",'[data-action="edit_member_profile_confirm_photo_delete"]',f),e.on("click",'[data-action="edit_member_profile_confirm_photo_crop"]',h),e.on("click",'[data-action="edit_member_profile_photo_menu"]',D),e.on("click",'[data-action="edit_member_profile_upload_image"]',L),e.on("click",'[data-action="edit_member_profile_to_delete"]',N),t.on("change.photo",'[data-action="edit_member_profile_upload_photo"]',g),t.on("keydown.member_submit",m),e.on("input","input",U).on("change","select",U).on("keyup","#custom_status_input_for_edit_profile",U),e.on("input",'[data-plastic-type="date"]',V),p().then(M).catch(TS.error)},u=function(){x(),e=null,n=null,i=null,r=null,o=[],a=null,t&&(t.off("change.photo"),t.off("keydown.member_submit"),t=null)},m=function(e){if(e.which==TS.utility.keymap.enter){var t=$(a).find('button[type="submit"]');return t.length?t.trigger("click"):F(),!1}},p=function(){return TS.team.ensureTeamProfileFields()},f=function(){$("#edit_member_profile_cancel_photo_delete_btn").addClass("disabled"),$("#fs_modal").addClass("stop_pointer_events"),t.on("keydown.deletePhoto",(function(e){e.stopPropagation()})),TS.interop.api.call("users.deletePhoto").then((function(){if(TS.web)return TS.interop.api.call("users.info",{user:TS.model.user.id,_x_reason:"web_edit_member_profile"}).then((function(e){delete e.data.ok;var t=$.extend(!0,TS.model.user,e.data.user);TS.members.legacyUpsertMember(t),G(),M()}),M);M()})).catch((function(e){return TS.warn("Unable to delete profile photo"),TS.error(e),C()})).finally((function(){Ladda.stopAll(),t.off("keydown.deletePhoto"),$("#fs_modal").removeClass("stop_pointer_events"),$("#edit_member_profile_cancel_photo_delete_btn").removeClass("disabled")}))},h=function(){TS.interop.console.info(l,"Begin to upload photo"),i&&i.disable(),$("#edit_member_profile_cancel_photo_crop_btn").addClass("disabled"),$("#fs_modal").addClass("stop_pointer_events"),t.on("keydown.uploadPhoto",(function(e){e.stopPropagation()}));var e=$("#edit_member_profile_photo"),n=$("#cropbox"),r=n.data("dimensions");r.id=e.data("src_id"),TS.interop.console.info(l,"Upload photo using users.setPhoto endpoint"),TS.interop.api.call("users.setPhoto",r).then((function(e){TS.interop.console.info(l,"Call to users.setPhoto is ok? "+(e&&e.data&&e.data.ok));var t=_.merge(TS.model.user,{profile:e.data.profile});TS.members.legacyUpsertAndSignal(t),G(),M()})).catch((function(e){return TS.interop.console.warn(l,"Unable to upload cropped profile photo"),TS.error(e),C()})).finally((function(){Ladda.stopAll(),t.off("keydown.uploadPhoto"),$("#fs_modal").removeClass("stop_pointer_events"),$("#edit_member_profile_cancel_photo_crop_btn").removeClass("disabled"),n.removeData("dimensions"),TS.interop.console.info(l,"Attempt to upload profile photo complete")}))},g=function(t){var n="change"===t.type?$(this):void 0;if(TS.interop.console.info(l,"Begin to preprocess profile photo"),n){if(!n.val())return void(TS.model.is_iOS&&TS.menu.end());t=n.get(0).files}if(t){if(TS.model.is_iOS&&TS.menu.end(),!t.length)return;E(),W(0),S(t[0]).then(T).then(b).then(v).then(y).then(w).catch(k),e.find('[data-action="edit_member_profile_upload_photo"]').val("")}else TS.interop.console.info(l,"No files found to process, returning early")},S=function(e){return new Promise((function(t,n){var i=new FileReader;i.onload=function(n){TS.interop.console.info(l,"Photo successfully read"),t({file:e,src:n.target.result})},i.onabort=function(){TS.interop.console.info(l,"Profile photo file read aborted"),n(new Error("abort"))},i.onerror=function(e){TS.interop.console.warn(l,"Unable to read profile photo file"),TS.error(e),n(e)},s=function(){try{i.abort()}catch(e){TS.error(e)}},i.readAsDataURL(e)}))},T=function(e){if(e.file.type.match(/image\/(?:gif|png|jpeg)/i))return TS.interop.console.info(l,"Photo format valid"),Promise.resolve(e);TS.interop.console.warn(l,"Photo format invalid"),Promise.reject(new Error("format"))},b=function(e){return new Promise((function(t,n){(r=new Image).onload=function(){TS.interop.console.info(l,"Photo size valid"),t(e)},r.onerror=function(e){TS.interop.console.warn(l,"Unable to set profile photo file image src when validating size"),TS.error(e),n(e)},r.src=e.src}))},v=function(e){var t=TS.model.api_url+"users.preparePhoto",n=new FormData;return n.append("image",e.file),n.append("token",TS.model.api_token),TS.interop.console.info(l,"Begin preparing photo on server"),new Promise((function(e,i){var r=$.ajax({url:t,data:n,dataType:"json",cache:!1,contentType:!1,processData:!1,type:"POST",xhr:function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",(function(e){e.lengthComputable?W(e.loaded/e.total):(TS.info("Upload length not computable"),W(1))}),!1),e}}).fail((function(e,t,n){s=null,TS.interop.console.warn(l,"Preparing photo on server failed"),i(new Error(n))})).done((function(t){s=null,t.ok?(TS.interop.console.info(l,"Preparing photo on server succeeded"),e(t)):(TS.interop.console.warn(l,"Preparing photo on server resolved with an error"),i(new Error(t.error)))}));s=r.abort}))},y=function(e){return new Promise((function(t,n){var i=$("#edit_member_profile_photo"),a=i.get(0);TS.interop.console.info(l,"Begin setting up photo for crop");var o=function(){r.src=e.url,$("#edit_member_profile_photo_preview").css("background","url("+e.url+")"),i.css("opacity",0),I(),c(),TS.interop.console.info(l,"Photo set up for crop"),t()},d=function(e){TS.interop.console.warn(l,"Unable to set crop photo file image src"),TS.error(e),c(),n(e)},c=function(){a.removeEventListener("load",o),a.removeEventListener("error",d)};s=function(){c(),t()},i.attr("src",e.url).data("src_id",e.id),a.addEventListener("load",o),a.addEventListener("error",d)}))},w=function(){function e(e){if(r){TS.interop.console.info(l,"Update photo preview");var t=o.width(),n=t*r.width/e.crop_w,i=t*r.height/e.crop_w,a=n*e.crop_x*-1/r.width,s=i*e.crop_y*-1/r.height;o.css({"background-size":n+"px","background-position":a+"px "+s+"px"})}}function t(t){if(r){TS.interop.console.info(l,"Update photo selection");var n={crop_x:Math.round(t.x),crop_y:Math.round(t.y),crop_w:Math.min(Math.round(t.w),r.height)};s.data("dimensions",n),e(n)}}function n(){i.animateTo(a,(function(){var e=this.tellSelect();e.w=r.width,t(e)})),i.focus(),TS.interop.console.info(l,"Photo crop complete")}TS.interop.console.info(l,"Begin photo crop");var a,s=$("#cropbox"),o=$("#edit_member_profile_photo_preview"),d=$("#edit_member_profile_photo"),c=d.width(),u=d.height();if(r){var _=Math.min(r.width,r.height);e({crop_x:(r.width-_)/2,crop_y:(r.height-_)/2,crop_w:_}),$("#edit_member_profile_photo").css("opacity",0),d.Jcrop({aspectRatio:1,allowSelect:!1,boxWidth:c,boxHeight:u,onSelect:t,onRelease:n,bgColor:"white",trueSize:[r.width,r.height]},(function(){i=this;var e=this.getBounds(),t=Math.min(e[0],e[1]),r=(e[0]-t)/2,s=(e[1]-t)/2;a=[r,s,t,t],n()}))}},k=function(e){switch(TS.interop.console.warn(l,"Catching upload photo failure"),e&&e.message){case"abort":TS.interop.console.warn(l,"Upload photo aborted");break;case"format":case"bad_image":case"too_many_frames":TS.interop.console.warn(l,"Photo format error: "+e.message),P();break;case"too_large":TS.interop.console.warn(l,"Photo too large"),O();break;default:return TS.interop.console.warn(l,"Unexpected error when processing photo"),TS.interop.console.error(JSON.stringify(e,null,2)),C()}},x=function(){s&&(s(),s=null)},C=function(){return TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")()).then(M)},M=function t(){if(o.length=0,o.push({back:t}),K(),x(),r=null,!e.find("#edit_member_profile_list").children().first().length){var n={member:TS.model.user,team:TS.model.team,team_member_profile_fields:TS.team.getVisibleTeamProfileFieldsForMember(TS.model.user,!0)},i=[];_.each(TS.boot_data.slack_timezones,(function(e){i.push({label:e[0],val:e[1]})})),n.timezone_options=i,n.member_tz=TS.model.user.tz||TS.boot_data.default_tz,n.custom_username_policy=TS.prefs.getTeamPref("username_policy"),n.lock_display_name=!1,"normal"!==TS.prefs.getTeamPref("auth_mode")&&!1===TS.prefs.getTeamPref("sso_choose_username")&&(n.lock_display_name=!0);var a=TS.templates.edit_member_profile_list(n);e.find("#edit_member_profile_list").html(a),TS.ui.validation.validate(e,{fast:!0})}B("#edit_member_profile_list"),TS.ui.fs_modal.showFooter(),TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Edit your profile","edit_profile")()),Ladda.bind(".edit_member_profile_confirm_edit_btn"),U(),q(),H(),R(!0)},I=function(){o.push({back:M}),B("#edit_member_profile_photo_crop"),TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Crop your photo","edit_profile")()),Ladda.bind("#edit_member_profile_confirm_photo_crop_btn"),H(),R()},E=function(){o.push({back:M}),n||z(),B("#edit_member_profile_photo_upload"),TS.ui.fs_modal.hideFooter(),TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Uploading your photo\u2026","edit_profile")()),H(),R()},A=function e(){o.push({back:e}),B("#edit_member_profile_photo_delete"),TS.ui.fs_modal.hideFooter(),TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Remove profile photo","edit_profile")()),Ladda.bind("#edit_member_profile_confirm_photo_delete_btn"),j(),R()},P=function(){o.push({back:M}),B("#edit_member_profile_photo_format_error"),TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Oh cripes","edit_profile")()),H(),R()},O=function(){o.push({back:M}),B("#edit_member_profile_photo_oversize_error"),TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Dang","edit_profile")()),H(),R()},F=function(){if(!TS.ui.validation.validate(e,{quiet:!0,fast:!0}))return TS.ui.validation.validate(e),Ladda.stopAll(),$(".edit_member_profile_confirm_edit_btn").addClass("disabled"),!1;var t={};["real_name","display_name","title","phone"].forEach((function(n){var i;i=e.find('input[name="'+n+'"]').val(),t[n]=i&&i.trim()})),(TS.model.team.profile.fields||[]).filter((function(e){return!e.is_hidden})).forEach((function(n){var i=TS.model.user.profile.fields||{},r=J(i[n.id]),a=J(r.value),s=J(r.alt),o=e.find('input[name="'+n.id+'"], select[name="'+n.id+'"]'),l=e.find('input[name="'+n.id+'_alt"]'),d=J(o.val()),c=J(l.val());t.fields=t.fields||{},a===d&&s===c||(t.fields[n.id]={value:d&&d.trim(),alt:c&&c.trim()}),"text"===n.type&&"skype"===n.label.toLocaleLowerCase()&&(t.skype=d&&d.trim()),o.val("").val(d),l.val("").val(c)}));var n=[];_.each(t.fields,(function(e,t){e.value&&e.value.length||n.push(t)})),n.length&&TS.warn("EVALUE-1371: Calling users.profile.set with emptied fields: "+n.join(" "));var i={profile:JSON.stringify(t)},r=e.find('[name="tz"]').val();return r!==TS.model.user.tz&&(TS.web&&(TS.model.user.tz=r,TS.model.user.tz_offset=TS.boot_data.dst_offsets[r].tz_offset),TS.prefs.setPrefByAPI({name:"tz",value:r,_x_reason:"tz_edit_member_profile"})),TS.interop.api.call("users.profile.set",i).then((function(e){$(".edit_member_profile_confirm_edit_btn").addClass("disabled"),TS.model.user.profile=e.data.profile,TS.web?TS.members.legacyUpsertMember(TS.model.user):TS.members.legacyUpsertAndSignal(TS.model.user),TS.ui.fs_modal.close()})).catch((function(t){if($(".edit_member_profile_confirm_edit_btn").addClass("disabled"),"ratelimited"===t.data.error)return TS.generic_dialog.alert(TS.interop.i18n.t("You\u2019re changing your profile too often! You might have better luck if you try again in a few minutes.","edit_profile")());t.data.error=TS.ui.validation.maybeConvertNameErrorCode(t.data.error);var n=TS.ui.validation.getErrorMessage(t.data.error,{maxlength:80});return"real_name"===t.data.field?(TS.ui.validation.showWarning(e.find('input[name="'+t.data.field+'"]'),n,{custom_for:"real_name_profile_field_warnings",should_truncate:!1}),!1):"display_name"===t.data.field?(TS.ui.validation.showWarning(e.find('input[name="'+t.data.field+'"]'),n,{custom_for:"display_name_profile_field_warnings",should_truncate:!1}),!1):(TS.ui.fs_modal.close(),void TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")()))})).finally(Ladda.stopAll),!1},j=function(){e.closest(".contents").addClass("display_flex flex_direction_column").css("height","70vh"),e.css({margin:"auto 0",height:"auto","padding-top":0})},H=function(){e.closest(".contents").removeClass("display_flex flex_direction_column").css("height",""),e.css({margin:"",height:"","padding-top":""})},D=function(t){t.stopPropagation(),TS.interop.console.info(l,"Maybe open upload photo menu"),!0===TS.model.user.profile.is_custom_image&&!$(t.target).is(".btn")||TS.model.is_iOS?TS.menu.member.startWithEditMemberProfilePhotoActions(t,L):e.find('[data-action="edit_member_profile_upload_photo"]').trigger("click")},L=function(t){var n=$(t.target).closest("li");n.is('[data-action="edit_member_profile_upload_image"]')?TS.model.is_iOS||(t.preventDefault(),TS.interop.console.info(l,"User clicked edit profile image menu option"),e.find('[data-action="edit_member_profile_upload_photo"]').trigger("click"),TS.menu.end()):n.is('[data-action="edit_member_profile_to_delete"]')&&(t.preventDefault(),TS.interop.console.info(l,"User clicked delete profile image menu option"),A(),TS.menu.end())},N=function(e){$(e.target).closest("li").is('[data-action="edit_member_profile_to_delete"]')&&(e.preventDefault(),A(),TS.menu.end())},B=function(t){var n=["#edit_member_profile_loading","#edit_member_profile_list","#edit_member_profile_photo_upload","#edit_member_profile_photo_crop","#edit_member_profile_photo_delete","#edit_member_profile_photo_format_error","#edit_member_profile_photo_oversize_error"].filter((function(e){return e!==t})).join(", ");e.find(n).addClass("hidden"),e.find(t).removeClass("hidden"),a=t},R=function(e){e?(TS.ui.fs_modal.unbindBackButton(),TS.ui.fs_modal.hideBackButton()):(TS.ui.fs_modal.bindBackButton((function(){o.pop(),o.pop().back()})),TS.ui.fs_modal.showBackButton())},U=function(){$(".edit_member_profile_confirm_edit_btn").toggleClass("disabled",!TS.ui.validation.validate(e,{quiet:!0,fast:!0}))},q=function(){e.find(".edit_member_profile_lazy_filter_select").each((function(e,t){var n=$(t),i=n.val().split(/\s*,\s*/);TS.ui.people_picker.make(n,{preselected_ids:i}),n.on("change",(function(){var e=TS.ui.people_picker.value(n).map((function(e){return e.member.id})).join(",");n.val(e),U()}))}))},G=function(){e&&$("#edit_member_profile_photo_container .member_image").replaceWith(TS.templates.builders.makeMemberPreviewLinkImage(TS.model.user.id,192,!1,!0))},z=function(){n=$("#edit_member_profile_progress_circle").circleProgress({value:0,size:64,fill:{gradient:["#50acf4","#41a6f5"]},startAngle:Math.PI/-2})},W=function(e){var t=parseFloat(e);isNaN(t)||n.circleProgress({value:t.toFixed(2)})},K=function(){i&&(i.destroy(),i=null,$("#edit_member_profile_photo").css({width:"auto",height:"auto",display:"block",visibility:"visible",opacity:1}))},V=function(e){var t=$(e.target),n=$('input[name="'+t.attr("name")+'_alt"]'),i=t.val();i&&(i=i.trim()),TS.ui.validation.validate(t,{quiet:!0,fast:!0})&&n.val(TS.interop.datetime.convertISOtoUTCReadableDate(i))},Y=function(){if(!TS.model.team.plan)return!1;var e=TS.model.user;return!!e&&(TS.model.user.enterprise_user?TS.model.user.enterprise_user.is_admin||TS.model.user.enterprise_user.is_owner:"admin"===TS.prefs.getTeamPref("who_can_change_team_profile")?e.is_admin:"owner"!==TS.prefs.getTeamPref("who_can_change_team_profile")||e.is_owner)},J=function(e){return _.isUndefined(e)?"":e}}()},omB7:function(e,t){!function(){TS.registerModule("tabcomplete.channels",{type:"channels",getMatch:function(e){if(_.isString(e)){var t,n=Math.max(e.lastIndexOf("\uff03"),e.lastIndexOf("#"));if(TS.interop.i18n.deburr(e).replace(/(^|\n|.)([#\uff03][^~`!@#\uff03$%^&*()+=[\]{}\\|;:'",.<>/?\s]*)$/i,(function(i,r){TS.interop.texty.trimAllowedMatchPrefix(r)||(t=e.substr(n,e.length-n))})),t)return{match:t,index:n}}},shouldDisplayResults:function(e,t){if(!e||_.isEmpty(t))return!1;var n=e.replace(/^#/,"").toLowerCase();return!(1===t.length&&t[0].name===n)},getResultAtIndex:function(e,t){if(e&&_.isNumber(t))return e[t]},getInsertData:function(e){if(e)return TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"channel"}}}),{text:"#"+e.name,ensure_preceding_space:!0}},search:function(n,i,r){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_typing",trigger:"channel"}}}),function(e){var t=e.replace(/^(#|\uff03)/,"");return TS.searcher.search(t,{channels:{include_archived:!1},tiered:!0,sort:{prefer_exact_match:!0,frecency:!0,allow_empty_query:!0,search_previous_channel_names:!0,prefer_channels_user_belongs_to:!1},limit:25})}(n).then((function(i){var a=_.map(i,"model_ob");if(r(null,a),e(n,a))return i.promise.then((function(e){var n=_.map(e,"model_ob");t(a,n)||r(null,n)}))}))},render:function(e,t){var n=TS.templates.tabcomplete_channel_header({text:e}),i=TS.templates.tabcomplete_channel_results({results:t});return TS.tabcomplete.renderMenu(n,i)},onSelect:function(e,t){e&&(t||(t=""),t=t.replace(/^(#|\uff03)/,""),TS.ui.frecency.record(e,t))},onSelectedIndexChange:function(e){TS.tabcomplete.onSelectedIndexChange(e)}});var e=function(e,t){return e=e.replace(/^(#|\uff03)/,""),!t||1!==t.length||""+t[0].name!==e},t=function(e,t){return!t&&!e||!(!t||!e)&&(e.length===t.length&&_.isEqualWith(e,t,(function(e,t){return e.id===t.id})))}}()},pW7e:function(e,t){TS.registerModule("channels.ui",{onStart:function(){},showArchiveChannelDialog:function(e){TS.generic_dialog.start({title:TS.interop.i18n.t("Archive #{channel_name}","channels")({channel_name:e.name}),body:TS.templates.channel_option_archive({name:e.name}),go_button_text:TS.interop.i18n.t("Yes, archive the channel","channels")(),onGo:function(){var t=function(e,t){if(e)TS.web&&($("p.alert").addClass("hidden"),$("#archive_success").removeClass("hidden"),$("#archive_btn").addClass("hidden"),$("#unarchive_btn").removeClass("hidden"));else{var n=TS.interop.i18n.t("Archiving failed with error: {error}","channels")({error:t.error});"last_ra_channel"===t.error?n=TS.model.user.is_admin?TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channels")():TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to.","channels")():"restricted_action"===t.error?n=TS.interop.i18n.t("<p>You don\u2019t have permission to archive channels.</p><p>Talk to your Workspace Owner.</p>","channels")():"already_archived"===t.error?n=TS.interop.i18n.t("This channel was already archived.","channels")():"cant_archive_general"===t.error&&(n=TS.interop.i18n.t("This channel cannot be archived.","channels")()),setTimeout(TS.generic_dialog.alert,500,n)}};TS.interop.api.call("conversations.archive",{channel:e.id}).then((function(e){var n=e.data,i=e.args,r=e.request_id;return t(!0,n),{data:n,args:i,request_id:r}}),(function(e){var n=e.data,i=e.args,r=e.request_id;return t(!1,n),{data:n,args:i,request_id:r}}))}})},showArchiveGroupDialog:function(e,t){var n=TS.interop.i18n.t("{leave, select, true{Leave and archive}other{Archive}} {prefix}{name}","channels")({leave:t,prefix:TS.model.group_prefix,name:e.name}),i=TS.interop.i18n.t("{leave, select, true{Yes, leave & archive the channel}other{Yes, archive the channel}}","channel")({leave:t});TS.generic_dialog.start({title:n,body:TS.templates.channel_option_archive({name:e.name,group_prefix:TS.model.group_prefix}),go_button_text:i,onGo:function(){var n=function(e,n){if(e)TS.web&&($("p.alert").addClass("hidden"),$("#archive_success").removeClass("hidden"),$("#archive_btn").addClass("hidden"),$("#unarchive_btn").removeClass("hidden"));else{var i=TS.interop.i18n.t("Archiving failed with error: {error}","channels")({error:n.error});"last_ra_channel"===n.error?i=TS.model.user.is_admin?TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channels")():TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to.","channels")():"already_archived"===n.error?i=TS.interop.i18n.t("This channel was already archived.","channels")():"restricted_action"===n.error?i=TS.interop.i18n.t("<p>You don\u2019t have permission to archive private channels.</p><p>Talk to your Workspace Owner.</p>","channels")():"user_is_restricted"===n.error&&(i=t?TS.interop.i18n.t('<h3 class="top_margin">Ask an admin to archive this channel</h3><p>Since you\u2019re the last one here, you\u2019ll need to invite an admin and ask them to archive the channel.</p>',"channels","1cbc791173101451030c2c2ad2d4a672ee7b86d8")():TS.interop.i18n.t("<p>You don\u2019t have permission to archive private channels.</p><p>Talk to your Workspace Owner.</p>","channels")()),setTimeout(TS.generic_dialog.alert,500,i)}};TS.interop.api.call("conversations.archive",{channel:e.id}).then((function(e){var t=e.data,i=e.args,r=e.request_id;return n(!0,t),{data:t,args:i,request_id:r}}),(function(e){var t=e.data,i=e.args,r=e.request_id;return n(!1,t),{data:t,args:i,request_id:r}}))}})},channelCreateDialogShowDisallowedCharsAlert:function(e){e.find(".modal_input_note").addClass("hidden"),e.find(".invalid_chars_warning").removeClass("hidden"),$("#channel_create_title").select()},channelCreateDialogShowSinglePunctuationAlert:function(e){e.find(".modal_input_note").addClass("hidden"),e.find(".single_punctuation_warning").removeClass("hidden"),$("#channel_create_title").select()},channelCreateDialogCleanName:function(e){for(var t=e.find(".title_input").val(),n=TS.interop.utility.cleanChannelName(t);"#"===t.substr(0,1);)t=t.substr(1);return n==t||(e.find(".title_input").val(n),TS.channels.ui.channelCreateDialogShowDisallowedCharsAlert(e),!1)},channelCreateDialogValidateInput:function(e){var t=e.find(".title_input").val(),n=TS.interop.utility.cleanChannelName(t);return!(!TS.channels.ui.channelCreateDialogCleanName(e)||("_"===n||"-"===n?(TS.channels.ui.channelCreateDialogShowSinglePunctuationAlert(e),1):t?(TS.redux.channels.getPublicChannelByName(t)||TS.interop.memberExistsWithName(t))&&(TS.channels.ui.channelCreateDialogShowNameTakenAlert(e),1):($("#channel_create_title").select(),1)))}})},pdVC:function(e,t){!function(){TS.registerModule("cmd_handlers",{server_cmds:null,onStart:function(){s=TS.utility.throttleFunc(s,3e3,!0),_.get(window,"desktop.app.toggleDevTools")||(delete TS.cmd_handlers["/slackdevtools"],delete TS.cmd_handlers["/slackgpuinfo"],delete TS.cmd_handlers["/slackmediainfo"],delete TS.cmd_handlers["/slackaccessibility"],delete TS.cmd_handlers["/slackdesktopsettings"]),_.get(window,"desktop.stats.downloadCookies")||delete TS.cmd_handlers["/slackcookies"],_.get(window,"desktop.app.openTaskManager")||delete TS.cmd_handlers["/slacktaskmanager"],_.get(window,"desktop.stats.restartWithNetlog")||delete TS.cmd_handlers["/slacknetlog"],TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&t.push("/"+TS.interop.i18n.t("active","cmd_handlers")())},test:function(){return{_maybeInviteUserToModelOb:u,_maybeInviteUserGroupToModelOb:m,_getUserIdentifier:p}},groupCmdsByType:function(e){var t=[o(e),l(e),c(e)];return Array.prototype.concat.apply([],t).filter((function(e){return e.cmds.length>0}))},getAvailableUserCmds:function(e){var t={},n=TS.shared.legacyGetActiveModelOb();return e=e||{},_.forOwn(TS.cmd_handlers,(function(i,r){if(0===r.indexOf("/")&&("function"!=typeof i.autocomplete||i.autocomplete())&&!1!==i.autocomplete&&!i.alias_of&&(!e.in_thread||TS.cmd_handlers.isCmdSupportedInThreads(r))){switch(r){case"/archive":if(!TS.permissions.channels.canSeeArchiveChannelOption(n))return;break;case"/unarchive":if(TS.boot_data.page_needs_enterprise&&!_.get(TS.model.user,"enterprise_user.is_admin",!1)&&TS.interop.rules.channels.isOrgDefaultChannel(n))return;if(TS.interop.rules.channels.isRequired(n))return;if(n.is_im)return;if(n.is_mpim)return;if((n.is_group||n.is_private)&&TS.model.user.is_restricted)return;if(n.is_channel&&!TS.permissions.members.canArchiveChannels())return;if(TS.interop.rules.channels.isExternallySharedChannel(n))return;break;case"/kick":case"/remove":if(!TS.interop.rules.user.canKickFromChannel(n.id))return;break;case"/join":case"/feed":if(TS.model.user.is_restricted)return;break;case"/invite":if(TS.model.user.is_ultra_restricted)return;break;case"/invite_people":if(!TS.interop.rules.invites.canUserSeeInviteModal(TS.redux.getState()))return;break;case"/topic":case"/purpose":if(n.is_im)return;if(n.is_mpim)return;if(TS.model.user.is_restricted)return;if(TS.interop.rules.channels.isRequired(n)&&!TS.permissions.members.canPostInChannel(n))return;break;case"/leave":if(n.is_group||n.is_private)return;break;case"/rename":if(!TS.permissions.channels.canSeeRenameChannelOption(n))return}("custom"===i.type||"service"===i.type)&&TS.prefs.commands_only_regular&&TS.model.user.is_restricted||(t[r]=i)}})),t},parseArgs:function(e){var t=e,n={cmd:"",rest:"",words:[]};if(!_.isString(e))return n;var i=e.trim();return i?(n.words=i.split(/\s+/),n.cmd=n.words[0].toLowerCase().replace(/\u2019/g,"'"),n.disp=n.words[0],n.rest=i.substring(n.cmd.length).trim(),n.original_txt=t,n):n},setUpCmds:function(){if(!TS.boot_data.page_needs_custom_cmds)return Promise.resolve();if(i(),a()){var e=TS.storage.fetchCmds();return TS.model.did_we_load_with_cmd_cache=!0,TS.cmd_handlers.mergeInServerCmds(e.data),d(e.data),Promise.resolve()}return TS.interop.api.call("commands.list",{},null,!0).then((function(e){e.data.commands&&r(e.data.commands,e.data.cache_ts)})).catch(_.noop)},removeCommand:function(e,t){delete TS.cmd_handlers.server_cmds[e],r(TS.cmd_handlers.server_cmds,t)},updateCommand:function(e,t){TS.cmd_handlers.server_cmds[e.name]=e,r(TS.cmd_handlers.server_cmds,t)},resetUpCmds:function(){TS.storage.storeCmds(""),s()},getCmdAppUserIds:function(){return n},sortNames:function(e){var t=e.sort(TS.interop.i18n.sorter);function n(e,t){return e.filter((function(e){return-1!==t.indexOf(TS.cmd_handlers[e].type)}))}var i=n(t,["client","core"]),r=n(t,["custom"]),a=n(t,["app","service"]),s=a.filter((function(e){return!!TS.cmd_handlers.getAppNameForCmdName(e)}));s.sort((function(e,t){var n=TS.cmd_handlers.getAppNameForCmdName(e),i=TS.cmd_handlers.getAppNameForCmdName(t);return TS.interop.i18n.sorter(n,i)}));var o=a.filter((function(e){return!TS.cmd_handlers.getAppNameForCmdName(e)}));return o.sort(),[].concat(i,r,s,o)},getAppNameForCmdName:function(e){var t="",n=TS.cmd_handlers[e];if(n)if(n.app){var i=TS.interop.apps.getAppById(n.app);!i||i.isUnknown||i.isNonExistent||(t=i.name)}else n.service_name&&(t=n.service_name);return t},mergeInServerCmds:function(e){var t;for(var n in TS.cmd_handlers.server_cmds=e,TS.cmd_handlers)0===n.indexOf("/")&&("client"===TS.cmd_handlers[n].type?delete TS.cmd_handlers[n].override:delete TS.cmd_handlers[n]);for(t in e)0===t.indexOf("/")&&(!TS.cmd_handlers[t]||TS.cmd_handlers[t].can_be_overridden_by_server_cmd?TS.cmd_handlers[t]=TS.cmd_handlers.makeInternalCmdObject(e[t]):TS.cmd_handlers[t].override=!0);for(t in e)if(0===t.indexOf("/")&&TS.cmd_handlers[t].alias_of){var i=TS.cmd_handlers[TS.cmd_handlers[t].alias_of];i&&"client"!==i.type&&(i.aliases||(i.aliases=[]),i.aliases.push(t))}},makeInternalCmdObject:function(e){return{autocomplete:!0,alias_of:e.alias_of?e.alias_of:null,aliases:null,usage:e.usage||"",desc:e.desc||"",help_text:e.help_text||"",type:e.type||"",app:e.app||"",service_name:e.service_name||"",normalized:TS.interop.i18n.deburr(e.name),canonical_name:e.canonical_name||null}},addEphemeralFeedback:function(e,t){var n={text:e};(t=_.defaults(t,{temporary:!0})).input_txt&&t.c_id&&t.thread_ts&&TS.utility.populateThreadInputs(t.input_txt,t.c_id,t.thread_ts),t.temporary||(t.c_id&&t.thread_ts?TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",t.c_id):TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid)),t.temporary&&(n.ephemeral_type="temp_slash_cmd_feedback"),t.slackbot_feels&&(n.slackbot_feels=t.slackbot_feels),t.c_id&&t.thread_ts&&(n.channel=t.c_id,n.thread_ts=t.thread_ts,t.temporary&&(n.ephemeral_type="threads_temp_slash_cmd_feedback"))},runCommand:function(e,t,n){if(TS.cmd_handlers[e.cmd])if(!t||TS.cmd_handlers.isCmdSupportedInThreads(e.cmd)){TS.model.last_active_cid&&TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.last_active_cid);var i=e.cmd;TS.cmd_handlers[e.cmd].canonical_name&&(i=TS.cmd_handlers[e.cmd].canonical_name),"client"===TS.cmd_handlers[e.cmd].type&&TS.interop.clog.track("BUILTIN_CHAT_COMMAND_CALLED",{locale:TS.interop.i18n.locale,slash_command_canonical_name:i,slash_command_name:e.cmd}),TS.cmd_handlers[e.cmd].func(e.cmd,e.rest,e.words,e.original_txt,t,n)}else TS.cmd_handlers.sendCmdNotSupportedInThreadsMsg(e.cmd,e.original_txt,t,n)},isCmdSupportedInThreads:function(e){return e&&_.includes(t,e)},sendCmdNotSupportedInThreadsMsg:function(e,t,n,i){var r;r=TS.cmd_handlers[e]?TS.interop.i18n.t("*{cmd}* is not supported in threads. Sorry!","threads")({cmd:e}):TS.interop.i18n.t("*{cmd}* is not a valid command.","threads")({cmd:e}),TS.cmd_handlers.addEphemeralFeedback(r,{input_txt:t,slackbot_feels:"sad_surprise",c_id:i.id,thread_ts:n.ts})},"/slacknetlog":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,func:function(){window.desktop&&TS.model.is_our_app&&window.desktop.stats&&window.desktop.stats.restartWithNetlog&&window.desktop.stats.restartWithNetlog()}},"/slackaccessibility":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,func:function(){window.desktop&&TS.model.is_our_app&&TS.utility.window.open({url:"chrome://accessibility/",try_window_open_in_ssb:!0})}},"/slackcookies":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,func:function(){_.get(window,"desktop.stats.downloadCookies")&&desktop.stats.downloadCookies({showItemInFolder:!0})}},"/slackgpuinfo":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,func:function(){window.desktop&&TS.model.is_our_app&&TS.utility.window.open({url:"chrome://gpu/",try_window_open_in_ssb:!0})}},"/slackmediainfo":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,func:function(){window.desktop&&TS.model.is_our_app&&TS.utility.window.open({url:"chrome://media-internals/",try_window_open_in_ssb:!0})}},"/slackdevtools":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,func:function(){if(_.get(window,"desktop.app.toggleDevTools")){desktop.app.toggleDevTools(!1)}}},"/slackdesktopsettings":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,func:function(){_.get(window,"desktop.app.showSettingsEditor")?window.desktop.app.showSettingsEditor():_.get(window,"desktop.store.dispatch")&&window.desktop.store.dispatch({type:"SHOW_SETTINGS_EDITOR"})}},"/slacktaskmanager":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,func:function(){TS.model.is_our_app&&window.desktop.app&&window.desktop.app.openTaskManager&&desktop.app.openTaskManager()}},"/slackdebugunreads":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,func:function(){var e=TS.interop.channels.getAllChannels();if(!e||!Object.keys(e).length){var t="/slackdebugunreads: Could not get list of model objects for user. :(";return TS.warn(t),void TS.cmd_handlers.addEphemeralFeedback(t)}var n=[],i=0,r=0;_.each(e,(function(e){var a;if(e.unread_cnt)if(a=e.is_group?"group":e.is_mpim?"mpim":e.is_im?"im":e.is_channel?"channel":"unknown",(e.unread_cnt||e.unread_highlight_cnt)&&a)i+=1,n.push([">","`"+e.id+"`","group"===a||"mpim"===a?" ("+a+"):":":",e.unread_cnt?" unread"+(e.is_im||e.is_mpim?" (highlight)":"")+" = "+e.unread_cnt:"",e.unread_highlight_cnt?", highlight = "+e.unread_highlight_cnt:"",TS.notifs.isCorGMuted(e.id)?" (muted)":""].join("")),r+=e.unread_cnt;else{var s="/slackdebugunreads: bad type for channel id "+e.id+"? ("+a+")";TS.warn(s),TS.cmd_handlers.addEphemeralFeedback(t)}})),r||n.push("No unreads found across "+e.length+" channels??");var a=TS.model.all_unread_highlights_cnt,s=TS.model.all_unread_cnt;n=["\ud83d\udd75\ufe0f \ud83d\udcd6 *Unreads Report for user @"+TS.model.user.name+" (`"+TS.model.user.id+'`) in workspace "'+_.escape(TS.interop.rules.teams.getTeamDisplayName(TS.model.team))+'" (`'+TS.model.team.id+"`)*","> "+r+" unreads across "+i+(1===i?" channel":" channels"),"> TS.model.threads_has_unreads: "+TS.model.threads_has_unreads+" (TS.model.all_unread_cnt++ when true), TS.model.threads_mention_count: "+TS.model.threads_mention_count].concat(n),TS.model.is_our_app&&(TS.boot_data.page_needs_enterprise&&TS.model.team&&TS.model.team.enterprise_id&&TS.boot_data.other_accounts&&(TS.model.all_unread_highlights_cnt_to_exclude&&(n.push("> TS.model.all_unread_highlights_cnt_to_exclude = "+TS.model.all_unread_highlights_cnt_to_exclude),a=Math.max(0,a-TS.model.all_unread_highlights_cnt_to_exclude)),TS.model.all_unread_cnt_to_exclude&&(n.push("> TS.model.all_unread_cnt_to_exclude = "+TS.model.all_unread_cnt_to_exclude),s=Math.max(0,s-TS.model.all_unread_cnt_to_exclude))),n.push("> SSB setBadgeCount details: all_unread_highlights_cnt = "+a+", all_unread_cnt = "+s+", bullet = "+(window.desktop&&TS.prefs.getPref("mac_ssb_bullet")?"true":"false"))),n=n.join("\n"),TS.cmd_handlers.addEphemeralFeedback(n),TS.info(n)}},"/away":{localized:"/"+TS.interop.i18n.t("away","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:null,desc:TS.interop.i18n.t('Toggle your "away" status',"cmd_handlers")(),func:function(e,t,n,i,r,a){TS.redux.presence.toggleUserPresence().then((function(e){var t;t="away"===(e.args.presence||TS.redux.presence.getPresenceByMemberId(TS.model.user.id))?":white_check_mark: "+TS.interop.i18n.t("You are now marked as *away*.","cmd_handlers")():":white_check_mark: "+TS.interop.i18n.t("You are now marked as *active*.","cmd_handlers")(),a&&r?TS.cmd_handlers.addEphemeralFeedback(t,{temporary:!1,c_id:a.id,thread_ts:r.ts}):TS.cmd_handlers.addEphemeralFeedback(t,{temporary:!1})})).catch(_.noop),t&&TS.members.setUserStatus(t)}},"/shortcuts":{localized:"/"+TS.interop.i18n.t("shortcuts","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:["/keys"],localized_aliases:["/"+TS.interop.i18n.t("keys","cmd_handlers")()],desc:TS.interop.i18n.t("Open the keyboard shortcuts dialog","cmd_handlers")(),func:function(){TS.redux.dispatch(TS.interop.actions.toggleKeyboardShortcuts())}},"/keys":{localized:"/"+TS.interop.i18n.t("keys","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:"/shortcuts",aliases:null,desc:"",func:function(){TS.cmd_handlers["/shortcuts"].func()}},"/open":{localized:"/"+TS.interop.i18n.t("open","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:["/join"],localized_aliases:["/"+TS.interop.i18n.t("join","cmd_handlers")()],desc:TS.interop.i18n.t("Open a channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("channel","cmd_handlers")(),optional:!0}],func:function(e,t,n,i,r,a){if(1!=n.length){var s=_.trim(i.substr(e.length)),o=TS.interop.texty.convertContentsStringToDisplayString(s),l=(o=TS.interop.utility.cleanChannelName(o))&&TS.redux.channels.getPublicOrPrivateChannelByName(o);(o&&!l?TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:{query:o,count:1}}).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop):Promise.resolve()).then((function(){if((l=l||o&&TS.redux.channels.getPublicOrPrivateChannelByName(o))&&l.is_channel){if(l.is_member)TS.channels.legacyDisplayChannel({id:l.id});else if(!TS.model.user.is_restricted){TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:l.id})).catch((function(e){!function(e,t){if(!e){var n=TS.interop.i18n.t("There was a problem joining \u201c{channel_name}\u201d, sorry!","cmd_handlers")({channel_name:o});"is_archived"==t.error&&(n=TS.interop.i18n.t("\u201c{channel_name}\u201d has been archived, so can\u2019t be opened.","cmd_handlers")({channel_name:o})),a&&r?TS.cmd_handlers.addEphemeralFeedback(n,{temporary:!1,slackbot_feels:"sad_surprise",c_id:a.id,thread_ts:r.ts}):TS.cmd_handlers.addEphemeralFeedback(n,{temporary:!1,slackbot_feels:"sad_surprise"})}}(!1,{error:e.message})}))}}else if(l&&l.is_group)TS.interop.rules.channels.isArchived(l)&&!l.was_archived_this_session||TS.groups.legacyDisplayGroup({id:l.id});else if(TS.permissions.members.canCreateChannels())TS.ui.new_channel_modal.start(o);else{var e=TS.interop.i18n.t("I couldn\u2019t find a channel named \u201c{channel_name}\u201d, sorry!","cmd_handlers")({channel_name:o});a&&r?TS.cmd_handlers.addEphemeralFeedback(e,{temporary:!1,slackbot_feels:"sad_surprise",c_id:a.id,thread_ts:r.ts}):TS.cmd_handlers.addEphemeralFeedback(e,{temporary:!1,slackbot_feels:"sad_surprise"})}}))}}},"/join":{localized:"/"+TS.interop.i18n.t("join","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:"/open",aliases:null,desc:"",func:function(e,t,n,i,r,a){TS.cmd_handlers["/open"].func(e,t,n,i,r,a)}},"/msg":{localized:"/"+TS.interop.i18n.t("msg","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:["/dm"],localized_aliases:["/"+TS.interop.i18n.t("dm","cmd_handlers")()],desc:TS.interop.i18n.t("Send a DM message to another user","cmd_handlers")(),args:[{name:TS.interop.i18n.t("@user","cmd_handlers")(),optional:!1},{name:TS.interop.i18n.t("your message","cmd_handlers")(),optional:!0}],func:function(e,t,n,i,r,a){var s,o,l=n.length>1?n[1]:"",d=f(l);if(!d)if(l){var c=l.replace("#","");if(!(s=TS.redux.channels.getPublicOrPrivateChannelByName(c)))return o=TS.interop.i18n.t("A valid member name is required.","cmd_handlers")(),void(a&&r?TS.cmd_handlers.addEphemeralFeedback(o,{input_txt:i,slackbot_feels:"sad_surprise",c_id:a.id,thread_ts:r.ts}):TS.cmd_handlers.addEphemeralFeedback(o,{input_txt:i,slackbot_feels:"sad_surprise"}))}else $("#direct_messages_header").trigger("click.open_dialog").scrollintoview({duration:500});var u=t.replace(l,"");if(u=d?_.trim(i.substr(i.indexOf(">")+1)):_.trim(i.substr(i.indexOf(l)+l.length)),d){if(d.deleted)return o=TS.interop.i18n.t("That user has been deactivated","cmd_handlers")()+" :disappointed:",void(a&&r?TS.cmd_handlers.addEphemeralFeedback(o,{input_txt:i,slackbot_feels:"sad_surprise",c_id:a.id,thread_ts:r.ts}):TS.cmd_handlers.addEphemeralFeedback(o,{input_txt:i,slackbot_feels:"sad_surprise"}));TS.ims.legacyStartImByMemberId(d.id,!1,u)}else if(s){if(TS.interop.rules.channels.isArchived(s))return o=TS.interop.i18n.t("That {channel} has been archived","cmd_handlers")({channel:s.is_channel?TS.interop.i18n.t("channel","cmd_handlers")():TS.interop.i18n.t("private channel","cmd_handlers")()}),void(a&&r?TS.cmd_handlers.addEphemeralFeedback(o,{input_txt:i,slackbot_feels:"sad_surprise",c_id:a.id,thread_ts:r.ts}):TS.cmd_handlers.addEphemeralFeedback(o,{input_txt:i,slackbot_feels:"sad_surprise"}));s.is_channel?TS.channels.legacyDisplayChannel({id:s.id,and_send_txt:u}):TS.groups.legacyDisplayGroup({id:s.id,and_send_txt:u})}}},"/invite":{localized:"/"+TS.interop.i18n.t("invite","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Invite another member to a channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("@user","cmd_handlers")(),optional:!1},{name:TS.interop.i18n.t("channel","cmd_handlers")(),optional:!0}],func:function(e,t,n,i){TS.interop.clog.track("CHANNEL_CREATE_FLOW",{contexts:{family:"channel",ui_context:{step:"add_people_modal",action:"enter_text",entry_point:"invite_people_slash_command",ui_properties:{element_type:"input",element_name:"message_input"}}}});var r,a=n.length>1?n[1]:"",s=f(a);if(a&&(r=TS.interop.userGroups.getUserGroupById(a.substr(1))),s||r&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(r)||!a)if(s&&s.deleted)TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("That user has been deactivated.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});else{var o=n.length>2?n[2]:"",l=TS.interop.texty.convertContentsStringToDisplayString(o),d=l&&TS.redux.channels.getPublicOrPrivateChannelByName(l);(l&&!d?TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:{query:l,count:1}}).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop):Promise.resolve()).then((function(){d=d||l&&TS.redux.channels.getPublicOrPrivateChannelByName(l)||TS.shared.legacyGetActiveModelOb();var e=function(){s&&s.is_app_user?TS.interop.addAppToChannel({appUserId:s.id,channelId:d.id,onError:function(){},referringEventId:"BUILTIN_CHAT_COMMAND_CALLED",sendEphemeralErrorMessage:!0}):d&&!d.is_im&&(s||r||d.is_mpim)?s?u(s,d,i):r&&!d.is_mpim&&m(r,d,i):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid channel name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"})};!s||!s.is_restricted||d&&(d.is_im||d.is_mpim)?e():TS.interop.members.fetchMemberProfileExtras(s.id,["channels"]).then((function(e){return e&&_.isArray(e.channels)&&e.channels||[]})).then((function(t){if(!s.is_ultra_restricted&&TS.model.user.is_admin||d&&t.indexOf(d.id)>-1)e();else{if(s.is_ultra_restricted&&t.length)return TS.model.user.is_admin?TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Single-Channel Guest and can\u2019t be added to a second channel. To invite {user} to this channel, you\u2019ll need to <{team_url}admin#restricted|upgrade their membership> to a Multi-Channel Guest. \u200bNote: This will add a billable seat to your workspace.","cmd_handlers")({user:p(s),team_url:TS.boot_data.team_url}),{input_txt:i,slackbot_feels:"sad_surprise"}):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Single-Channel Guest and can\u2019t be added to a second channel. Your Workspace Admin can upgrade their membership to a Multi-Channel Guest.","cmd_handlers")({user:p(s)}),{input_txt:i,slackbot_feels:"sad_surprise"}),!1;if(!TS.model.user.is_admin){if(s.is_ultra_restricted)return TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Single-Channel Guest. Only your Workspace Admin can invite them to a channel.","cmd_handlers")({user:p(s)}),{input_txt:i,slackbot_feels:"sad_surprise"}),!1;if(d&&!d.is_private&&!d.is_group)return TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Multi-Channel Guest. Only your Workspace Admin can invite them to a channel.","cmd_handlers")({user:p(s)}),{input_txt:i,slackbot_feels:"sad_surprise"}),!1}e()}}))}))}else TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid member name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"})}},"/invite_people":{localized:"/"+TS.interop.i18n.t("invite_people","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Invite people to your workspace","cmd_handlers")(),args:[{name:TS.utility.exampleEmailAddress()+", ...",optional:!0}],func:function(e,t){TS.interop.rules.invites.canUserSeeInviteModal(TS.redux.getState())?((t=t&&t.trim())&&TS.redux.dispatch(TS.interop.actions.setUnsentInvites(t.split(/\s*,\s*|\s+/).map((function(e){return{email:e}})))),TS.interop.mountInviteModal(TS.boot_data.team_id,{source:"invite_people_slash_command"})):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You don\u2019t have permission to invite people.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}},"/dm":{localized:"/"+TS.interop.i18n.t("dm","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:"/msg",aliases:null,desc:"",func:function(e,t,n,i,r,a){TS.cmd_handlers["/msg"].func(e,t,n,i,r,a)}},"/archive":{localized:"/"+TS.interop.i18n.t("archive","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Archive the current channel","cmd_handlers")(),func:function(){var e=TS.shared.legacyGetActiveModelOb();if(!TS.interop.rules.channels.isArchived(e)&&!TS.interop.rules.channels.isRequired(e)&&!TS.interop.rules.channels.isExternallySharedChannel(e))if(e.is_channel&&!e.is_mpim){if(!TS.permissions.members.canArchiveChannels())return;if(TS.boot_data.page_needs_enterprise&&!_.get(TS.model.user,"enterprise_user.is_admin",!1)&&TS.interop.rules.channels.isOrgDefaultChannel(e))return;TS.channels.ui.showArchiveChannelDialog(e)}else if(e.is_group&&!e.is_mpim){if(TS.model.user.is_restricted)return;TS.channels.ui.showArchiveGroupDialog(e)}}},"/leave":{localized:"/"+TS.interop.i18n.t("leave","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:["/close","/part"],localized_aliases:["/"+TS.interop.i18n.t("close","cmd_handlers")(),"/"+TS.interop.i18n.t("part","cmd_handlers")()],desc:TS.interop.i18n.t("Leave a channel","cmd_handlers")(),func:function(e,t,n){if(1==n.length){var i=TS.shared.legacyGetActiveModelOb();i.is_channel?i.is_mpim?TS.redux.dispatch(TS.interop.channels.closeChannelApi({channelId:i.id})):TS.interop.rules.channels.isArchived(i)?TS.shared.legacyCloseArchivedChannel(i.id):TS.channels.leave(i.id):i.is_mpim||i.is_im?TS.redux.dispatch(TS.interop.channels.closeChannelApi({channelId:i.id})):i.is_group?TS.interop.rules.channels.isArchived(i)?TS.shared.legacyCloseArchivedChannel(i.id):TS.channels.leave(i.id):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid channel or member name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}else{var r=TS.interop.texty.convertContentsStringToDisplayString(t),a=r&&TS.redux.channels.getPublicOrPrivateChannelByName(r);(r&&!a?TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:{query:r,count:1}}).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop):Promise.resolve()).then((function(){(a=a||r&&TS.redux.channels.getPublicOrPrivateChannelByName(r))?TS.channels.leave(a.id):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid channel name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}))}}},"/close":{localized:"/"+TS.interop.i18n.t("close","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:"/leave",aliases:null,desc:"",func:function(e,t,n){TS.cmd_handlers["/leave"].func(e,t,n)}},"/part":{localized:"/"+TS.interop.i18n.t("part","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:"/leave",aliases:null,desc:"",func:function(e,t,n){TS.cmd_handlers["/leave"].func(e,t,n)}},"/topic":{localized:"/"+TS.interop.i18n.t("topic","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:null,desc:TS.interop.rules.channels.isExternallySharedChannel(TS&&TS.shared&&TS.shared.legacyGetActiveModelOb())?TS.interop.i18n.t("Set the channel topic for your workspace","cmd_handlers")():TS.interop.i18n.t("Set the channel topic","cmd_handlers")(),args:[{name:TS.interop.i18n.t("new topic","cmd_handlers")(),optional:!0}],func:function(e,t,n,i){var r=TS.shared.legacyGetActiveModelOb();if(TS.model.user.is_restricted||TS.interop.rules.channels.isRequired(r)&&!TS.permissions.members.canPostInChannel(r))TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Setting the topic is a restricted action.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});else if(TS.interop.channels.channelTopicExceedsLimit(t))TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Topics cannot exceed {max_characters} characters.","cmd_handlers")({max_characters:TS.model.channel_topic_max_length}),{input_txt:i,slackbot_feels:"sad_surprise"});else{var a=_.trim(i.substr(e.length));r.is_mpim||r.is_im?TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Regrettably, direct messages do not have topics","cmd_handlers")(),{slackbot_feels:"sad_surprise"}):a?TS.interop.channels.submitChannelTopic(r.id,a).then(TS.channels.legacyUpdateTopicFromAPI).catch(TS.channels.legacyAlertSetTopicError):$("#channel_topic_text").click().focus().select()}}},"/search":{localized:"/"+TS.interop.i18n.t("search","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:["/s"],localized_aliases:["/"+TS.interop.i18n.t("s","cmd_handlers")()],desc:TS.interop.i18n.t("Perform a search","cmd_handlers")(),args:[{name:TS.interop.i18n.t("your text","cmd_handlers")(),optional:!0}],func:function(e,t){TS.interop.searchActions.openFromSlashCommand({query:t})}},"/s":{localized:"/"+TS.interop.i18n.t("s","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:"/search",aliases:null,desc:"",func:function(e,t){TS.cmd_handlers["/search"].func(e,t)}},"/rename":{localized:"/"+TS.interop.i18n.t("rename","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:null,desc:TS.interop.rules.channels.isExternallySharedChannel(TS&&TS.shared&&TS.shared.legacyGetActiveModelOb())?TS.interop.i18n.t("Rename this channel for your workspace","cmd_handlers")():TS.interop.i18n.t("Rename a channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("new name","cmd_handlers")(),optional:!0}],func:function(){if(TS.model.user.is_restricted)TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You don\u2019t have permission to rename.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});else{var e=TS.shared.legacyGetActiveModelOb();e.is_mpim||e.is_im?TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Direct messages don\u2019t even have a name! Ergo, regrettably, you can\u2019t change it.","cmd_handlers")(),{slackbot_feels:"sad_surprise"}):!e.is_channel&&!e.is_group||TS.model.user.is_admin||e.creator==TS.model.user.id?TS.permissions.channels.canSeeRenameChannelOption(e)||TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You don\u2019t have permission to rename.","cmd_handlers")(),{slackbot_feels:"sad_surprise"}):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Only Workspace Admins (or the channel creator) are allowed to rename channels.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}}},"/color":{localized:"/"+TS.interop.i18n.t("color","cmd_handlers")(),type:"client",autocomplete:!1,alias_of:null,aliases:["/colour"],localized_aliases:["/"+TS.interop.i18n.t("colour","cmd_handlers")()],desc:TS.interop.i18n.t("Set a custom color for another member","cmd_handlers")(),func:function(e,t,n,i,r,a){var s,o,l=n.length>1?n[1]:"",d=n.length>2?n[2].replace(/#/g,""):"",c=f(l);return c?(c&&(o=TS.interop.members.getPrefCompliantMemberName(c,!0,!0)),!d||6==d.length&&("#"+d).match(TS.format.hex_rx)?(TS.members.setMemberUserColor(c,d),TS.prefs.setPrefLocal("user_colors",JSON.stringify(TS.model.user_colors)),TS.prefs.setPrefByAPI({name:"user_colors",value:TS.prefs.getPref("user_colors")}),s=d?TS.interop.i18n.t("You\u2019ve set your custom color for {user} to {color}","cmd_handlers")({user:o,color:"#"+d}):TS.interop.i18n.t("You\u2019ve removed your custom color for {user}.","cmd_handlers")({user:o}),void(a&&r?TS.cmd_handlers.addEphemeralFeedback(s,{input_txt:i,c_id:a.id,thread_ts:r.ts}):TS.cmd_handlers.addEphemeralFeedback(s,{input_txt:i}))):(s=TS.interop.i18n.t("A valid 6 character hex code is required, like `FF0000`.","cmd_handlers")(),void(a&&r?TS.cmd_handlers.addEphemeralFeedback(s,{input_txt:i,c_id:a.id,thread_ts:r.ts}):TS.cmd_handlers.addEphemeralFeedback(s,{input_txt:i})))):(s=TS.interop.i18n.t("A valid member name is required.","cmd_handlers")(),void(a&&r?TS.cmd_handlers.addEphemeralFeedback(s,{input_txt:i,slackbot_feels:"sad_surprise",c_id:a.id,thread_ts:r.ts}):TS.cmd_handlers.addEphemeralFeedback(s,{input_txt:i,slackbot_feels:"sad_surprise"})))}},"/colour":{localized:"/"+TS.interop.i18n.t("colour","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:"/color",aliases:null,desc:"",func:function(e,t,n,i,r,a){TS.cmd_handlers["/color"].func(e,t,n,i,r,a)}},"/discon":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,desc:"",func:function(){TS.interop.SocketManager.disconnect()}},"/sleepsleep":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,desc:"",func:function(){TS.interop.SocketManager.sleep()}},"/sleepsleep2":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,desc:"",func:function(){TS.interop.SocketManager.clearFastReconnectUrl(),TS.interop.SocketManager.sleep()}},"/discon4":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,desc:"",func:function(){TS.interop.SocketManager.clearFastReconnectUrl(),TS.interop.SocketManager.disconnect()}},"/slackdebugdegrade":{localized:null,type:"client",autocomplete:function(){return TS.boot_data.feature_tinyspeck},alias_of:null,aliases:null,desc:"",func:function(){TS.interop.SocketManager.clearFastReconnectUrl(),TS.interop.SocketManager.debugSetSocketConnectFlakiness(1),TS.interop.SocketManager.disconnect()}},"/slackdebugdegraderecover":{localized:null,type:"client",autocomplete:function(){return TS.boot_data.feature_tinyspeck},alias_of:null,aliases:null,desc:"",func:function(){var e=0;TS.qs_args.ws_flakiness&&(e=parseFloat(TS.qs_args.ws_flakiness),(_.isNaN(e)||e<0||e>1)&&(e=0)),TS.interop.SocketManager.debugSetSocketConnectFlakiness(e)}},"/collapse":{localized:"/"+TS.interop.i18n.t("collapse","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Collapse all files in the current channel (opposite of /expand)","cmd_handlers")(),func:function(){var e=TS.shared.legacyGetActiveModelOb().id,t=TS.redux.messages.getExpandablesInChannel(e),n=_.zipObject(t,_.map(t,(function(){return!1})));TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(n)),TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("I\u2019ve collapsed all files in this channel for you.","cmd_handlers")(),{temporary:!1})}},"/expand":{localized:"/"+TS.interop.i18n.t("expand","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Expand all files in the current channel (opposite of /collapse)","cmd_handlers")(),func:function(){var e=TS.shared.legacyGetActiveModelOb().id,t=TS.redux.messages.getExpandablesInChannel(e),n=_.zipObject(t,_.map(t,(function(){return!0})));TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(n)),TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("I\u2019ve expanded all files in this channel for you.","cmd_handlers")(),{temporary:!1})}},"/remove":{localized:"/"+TS.interop.i18n.t("remove","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:["/kick"],localized_aliases:["/"+TS.interop.i18n.t("kick","cmd_handlers")()],desc:TS.interop.i18n.t("Remove a person from the current channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("@user","cmd_handlers")(),optional:!1}],func:function(e,t,n,i){var r=TS.shared.legacyGetActiveModelOb();t=$.trim(t);var a=f(t),s=_.get(a,"is_app_user",!1);!r.is_im&&!r.is_mpim||s?!TS.interop.rules.channels.isPublicChannel(r)||s||TS.permissions.members.canKickFromChannels()?!TS.interop.rules.channels.isPrivateChannel(r)||s||TS.permissions.members.canKickFromGroups()?TS.interop.rules.channels.isArchived(r)?TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You can\u2019t remove anyone from *{channel}* while it is archived.","cmd_handlers")({channel:(TS.model.active_channel_id?"#":"")+r.name}),{slackbot_feels:"sad_surprise"}):t?a?!TS.interop.rules.channels.isRequired(r)||a.is_restricted||a.is_bot?TS.interop.membership.ensureChannelMembershipIsKnownForUsers(r.id,[a.id]).then((function(){var t;if(!TS.interop.membership.getCachedChannelMembershipInfoForUser(r.id,a.id).is_member)return t=s?TS.interop.i18n.t("{app_user} isn\u2019t in this conversation, so you can\u2019t remove it.","apps")({app_user:TS.interop.i18n.safeString("<@"+a.id+">")}):TS.interop.i18n.t("*{user}* is not a member of this {channel}.","cmd_handlers")({user:TS.interop.i18n.safeString(_.escape(TS.interop.texty.convertContentsStringToDisplayString(_.trim(i.substr(e.length))),TS.interop.prefs.getHighlightWords(),TS.interop.rules.emoji.shouldRenderEmojiAsText())),channel:r.is_channel?TS.interop.i18n.t("channel","cmd_handlers")():TS.interop.i18n.t("private channel","cmd_handlers")()}),void TS.cmd_handlers.addEphemeralFeedback(t,{input_txt:i,slackbot_feels:"sad_surprise"});if(!a.is_self)if(s)TS.interop.removeAppFromChannel({appUserId:a.id,channelId:r.id,onError:function(){},referringEventId:"BUILTIN_CHAT_COMMAND_CALLED",sendEphemeralErrorMessage:!0});else if(TS.interop.members.isExternal(a)){var n=TS.interop.i18n.t("You can\u2019t remove {member_name} from this channel, because they\u2019re from another organization.","cmd_handlers")({member_name:p(a)});TS.cmd_handlers.addEphemeralFeedback(n,{input_txt:i,slackbot_feels:"sad_surprise"})}else r.is_channel?TS.channels.legacyKickMember(r.id,a.id):r.is_group&&TS.groups.kickMember(r.id,a.id)})):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You can\u2019t remove this member from *{channel}*!","cmd_handlers")({channel:(TS.model.active_channel_id?"#":"")+r.name})):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{input}* is not a recognized member name.","cmd_handlers")({input:TS.interop.i18n.safeString(_.escape(TS.interop.texty.convertContentsStringToDisplayString(_.trim(i.substr(e.length))),TS.interop.prefs.getHighlightWords(),TS.interop.rules.emoji.shouldRenderEmojiAsText()))}),{input_txt:i,slackbot_feels:"sad_surprise"}):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Please specify someone to remove!","cmd_handlers")(),{input_txt:i}):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Removing someone from a private channel is a restricted action.","cmd_handlers")(),{slackbot_feels:"sad_surprise"}):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Removing someone from a channel is a restricted action.","cmd_handlers")(),{slackbot_feels:"sad_surprise"}):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You can\u2019t remove someone from a direct message.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}},"/kick":{localized:"/"+TS.interop.i18n.t("kick","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:"/remove",aliases:null,desc:"",func:function(e,t,n,i){TS.cmd_handlers["/remove"].func(e,t,n,i)}},"/feedback":{localized:"/"+TS.interop.i18n.t("feedback","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Send feedback to Slack","cmd_handlers")(),args:[{name:TS.interop.i18n.t("your message","cmd_handlers")(),optional:!0}],func:function(e,t,n,i,r,a){if(t){var s=_.trim(i.substr(e.length));s=TS.interop.texty.convertContentsStringToDisplayString(s,TS.interop.prefs.getHighlightWords()),TS.generic_dialog.start({title:TS.interop.i18n.t("Send feedback","cmd_handlers")(),body:'<p class="bold">'+TS.interop.i18n.t("Looks like you are trying to send us some feedback! Yes?","cmd_handlers")()+"</p>",show_cancel_button:!0,show_go_button:!0,go_button_text:TS.interop.i18n.t("Yes, send it","cmd_handlers")(),onGo:function(){var t={command:e,text:s,channel:TS.model.active_cid,client_token:TS.interop.client_action_token.generateAndEnqueue()};a&&r&&(t.channel=a.id,t.thread_ts=r.ts);TS.interop.api.call("chat.command",t).then((function(e){var t=e.data,n=e.args,i=e.request_id;return{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return{data:t,args:n,request_id:i}}))},onCancel:function(){a&&r&&TS.utility.populateThreadInputs(i,a.id,r.ts)}})}else TS.utility.openInNewTab("/help/requests/new","_blank")}},"/shrug":{localized:"/"+TS.interop.i18n.t("shrug","cmd_handlers")(),type:"client",autocomplete:!0,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Appends \xaf\\_(\u30c4)_/\xaf to your message","cmd_handlers")(),args:[{name:TS.interop.i18n.t("your message","cmd_handlers")(),optional:!0}],func:function(){}},"/showfallbacks":{localized:null,type:"client",autocomplete:!1,alias_of:null,aliases:null,desc:"",func:function(){TS.model.show_attachment_fallback=!TS.model.show_attachment_fallback}}});var e,t=["/shrug","/shortcuts","/keys","/away","/search","/feedback","/slack_diagnostic_report","/msg","/dm","/s","/star","/color","/colour","/active","/giphy","/mute"],n=[],i=function(){var n,i;e||TS.interop.i18n.locale===TS.interop.i18n.DEFAULT_LOCALE||(e=!0,_.forOwn(TS.cmd_handlers,(function(e,r){0===r.indexOf("/")&&(n=TS.cmd_handlers[r].localized?TS.cmd_handlers[r].localized.toLowerCase():null)&&n!==r&&!TS.cmd_handlers[n]&&(TS.cmd_handlers[n]=_.clone(TS.cmd_handlers[r]),TS.cmd_handlers[n].localized=null,TS.cmd_handlers[n].canonical_name=r,TS.cmd_handlers[r].autocomplete=!1,i=TS.interop.i18n.deburr(n),n!==i&&(TS.cmd_handlers[n].normalized=i,TS.cmd_handlers[i]||(TS.cmd_handlers[i]=_.clone(TS.cmd_handlers[r]))),_.includes(t,r)&&(t.push(n),n!==i&&t.push(i)))})))},r=function(e,t){TS.model.commands_cache_ts=t;var n={data:e,cache_ts:TS.model.commands_cache_ts,locale:TS.interop.i18n.locale};TS.storage.storeCmds(n),TS.cmd_handlers.mergeInServerCmds(e),d(e)},a=function(){var e=TS.storage.fetchCmds();return!!e&&(TS.model.commands_cache_ts===e.cache_ts&&TS.interop.i18n.locale===e.locale)},s=function(){TS.cmd_handlers.setUpCmds()},o=function(e){var t=!1,n=TS.shared.legacyGetActiveModelOb();return TS.interop.rules.channels.isOrgShared(n)&&(t=!0),{cmds:e.filter((function(e){return!("core"!==e.type&&"client"!==e.type||t&&"/call"===e.name)})),id:"core",name:"Slack"}},l=function(e){return{cmds:e.filter((function(e){return"custom"===e.type})),id:"custom",name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)}},d=function(e){var t=[];_.each(e,(function(e){var n=e.app;if(n){var i=TS.interop.apps.getAppById(n),r=i&&i.app_user_id;r&&t.push(r)}})),n=t},c=function(e){var t=e.filter((function(e){return"app"===e.type||"service"===e.type})),n=t.filter((function(e){return!(!e.service_name&&!e.app)})),i=t.filter((function(e){return!(e.service_name||e.app)})),r={};n.forEach((function(e){var t=TS.cmd_handlers.getAppNameForCmdName(e.name);r[t]||(r[t]=[]),r[t].push(e)}));var a=Object.keys(r).slice().sort(TS.interop.i18n.sorter).map((function(e){var t={cmds:r[e],id:"app",name:e};return t.xoxa_app_not_in_channel=function(e){var t=TS.interop.apps.getAppById(e);if(!t)return!1;if(t.isUnknown||t.isNonExistent)return!1;if(!t.is_xoxa_app)return!1;var n=TS.interop.membership.getCachedChannelMembershipInfoForUser(TS.model.active_cid,t.app_user_id);return!0===n.is_known&&!1===n.is_member}(r[e][0].app),t}));return a.push({cmds:i,id:"app",name:"Other"}),a},u=function(e,t,n){if(!_.isObject(e))throw new Error("Expected user to be an object");if(!_.isObject(t))throw new Error("Expected model_ob to be an object");if(!_.isString(n))throw new Error("Expected input_txt to be a string");return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(t.id,[e.id]).then((function(){if(TS.interop.membership.getCachedChannelMembershipInfoForUser(t.id,e.id).is_member)TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("{user} is already in this channel.","cmd_handlers")({user:p(e)}),{input_txt:n});else{if(!t.is_mpim&&!TS.permissions.channels.canMemberBeInvitedToChannel(t,e)){var i;if(TS.boot_data.page_needs_enterprise)return i=TS.interop.members.isExternal(e)?TS.interop.rules.channels.isExternallySharedChannel(t)||!TS.teams.getTeamNameByMember(e)?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from a workspace outside your organization.","cmd_handlers")({member_name:p(e)}):TS.interop.rules.teams.isSharedChannelsEnabled(TS.redux.getState(),TS.model.team)?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from a workspace outside your organization. If you\u2019d like, you can share this channel with {team_name}.","cmd_handlers")({member_name:p(e),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(e)))}):TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from a workspace outside your organization. If you\u2019d like, you can share this channel with {team_name}. <https://slack.com/help/articles/115004151203-A-guide-to-shared-channels|Learn about shared channels>","cmd_handlers","d7091ca6b333c5995afb7cea035a4200f90c80e2")({member_name:p(e),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(e)))}):TS.interop.i18n.t("{user} is not a member of {team_name}.","cmd_handlers")({user:p(e),team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(TS.model.team)))}),void TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:n,slackbot_feels:"sad_surprise"});if(TS.interop.members.isExternal(e))return i=TS.interop.rules.channels.isExternallySharedChannel(t)||!TS.teams.getTeamNameByMember(e)?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from another workspace.","cmd_handlers")({member_name:p(e)}):TS.interop.rules.teams.isSharedChannelsEnabled(TS.redux.getState(),TS.interop.teams.getCurrentTeam())?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from another workspace. If you\u2019d like, you can share this channel with {team_name}.","cmd_handlers")({member_name:p(e),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(e)))}):TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from another workspace. If you\u2019d like, you can share this channel with {team_name}. <https://slack.com/help/articles/115004151203-A-guide-to-shared-channels|Learn about shared channels>","cmd_handlers","fc4ec08c96b8476f2b02f7a58c6fe1927ab3670e")({member_name:p(e),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(e)))}),void TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:n,slackbot_feels:"sad_surprise"})}if(TS.interop.rules.channels.isMpim(t));else if(!TS.interop.rules.channels.isPrivateChannel(t))return TS.interop.api.call("conversations.invite",{channel:t.id,users:e.id})}}))},m=function(e,t,n){if(!_.isObject(e))throw new Error("Expected ug to be an object");if(!_.isObject(t))throw new Error("Expected model_ob to be an object");if(!_.isString(n))throw new Error("Expected input_txt to be a string");TS.interop.userGroups.promiseToGetUserGroupMembers(e.id).then((function(e){TS.interop.membership.ensureChannelMembershipIsKnownForUsers(t.id,e.users).then((function(){var i=e.users.filter((function(e){if(TS.boot_data.page_needs_enterprise){var n=TS.interop.members.getMemberById(e);if(!TS.permissions.channels.canMemberBeInvitedToChannel(t,n))return!1}return!TS.interop.membership.getCachedChannelMembershipInfoForUser(t.id,e).is_member}));if(i.length)(!t.is_private&&!t.is_group||TS.interop.rules.channels.isExternallySharedChannel(t))&&TS.interop.api.call("conversations.invite",{channel:t.id,users:i,force:!0});else{var r=TS.interop.i18n.t("All of the users in that user group are already in this channel.","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(r,{input_txt:n})}}))}))},p=function(e){if(!_.isObject(e))throw new Error("Expected user to be an object");return TS.interop.members.getPrefCompliantMemberName(e,!1,!0)},f=function(e){return TS.interop.members.getMemberById(e)}}()},q3cq:function(e,t){TS.registerModule("redux.teams",{onStart:function(){Object.defineProperty(TS.model,"team",{get:function(){return TS.redux.teams.getCurrentTeam()},set:function(){return TS.error("TS.redux.teams: trying to set TS.model.team???"),!1}})},upsertTeam:function(e){if(e&&e.id)return TS.interop.teams.upsertTeam({team:e})},removeTeam:function(e){e&&e.id&&TS.interop.teams.removeTeam(e)},getTeamById:function(e,t){return TS.interop.teams.getTeamById?TS.interop.teams.getTeamById(e,t):null},getAllTeams:function(){return TS.interop.teams.getAllTeams?TS.interop.teams.getAllTeams():null},getTeamByDomain:function(e){return TS.interop.teams.getTeamByDomain?TS.interop.teams.getTeamByDomain(e):null},getCurrentTeam:function(){return TS.interop.teams.getCurrentTeam?TS.interop.teams.getCurrentTeam():null},ensureEnterpriseTeamIsKnown:function(e,t){return TS.interop.teams.ensureEnterpriseTeamIsKnown?TS.interop.teams.ensureEnterpriseTeamIsKnown({teamId:e,additionalOptions:t}):null},getSelfEnterpriseTeam:function(){return TS.interop.teams.getSelfEnterpriseTeam?TS.interop.teams.getSelfEnterpriseTeam(TS.redux.getState()):null},getSelfEnterpriseOrgName:function(){return TS.interop.teams.getSelfEnterpriseOrgName?TS.interop.teams.getSelfEnterpriseOrgName(TS.redux.getState()):null},fetchAndUpsertEnterpriseOrgInfo:function(){return TS.interop.teams.fetchAndUpsertEnterpriseOrgInfo?TS.redux.dispatch(TS.interop.teams.fetchAndUpsertEnterpriseOrgInfo()):null}})},"qQ+f":function(e,t){!function(){TS.registerModule("groups",{switched_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,legacyRemoveMsg:function(e,t){var n=TS.interop.channels.getGroupById(e,!1);if(n){if(TS.redux.messages.removeMessage(t),TS.interop.messages.isReply(t)){n._archive_msgs&&TS.utility.msgs.spliceMsg(n._archive_msgs,t);var i=n.msgs;TS.utility.msgs.spliceMsg(i,t)}TS.groups.message_removed_sig.dispatch(n,t)}else TS.error('unknown group "'+e+'"')},legacyDisplayGroup:function(e){var n=_.defaults({},e,{from_history:!1,replace_history_state:!1}),i=n.id;if(i){var r=n.and_send_txt,a=n.from_history,s=n.replace_history_state,o=n.last_active_primary_view;TS.telemeter.mark("start_channel_change_"+i),TS.redux.dispatch(TS.interop.redux.models.channelsMeta.prqMetrics.updateChannelLastFocus({lastFocus:TS.interop.redux.models.window.getWindowLastFocusEvent(TS.redux.getState()),objId:i}));var l=TS.interop.channels.getGroupById(i,!1);if(l){if(TS.utility.msgs.maybeClearPrevLastRead(),TS.utility.msgs.maybeClearPrevLastRead(l),TS.has_pri[t]&&TS.log(t,"legacyDisplayGroup "+l.id+" from_history:"+a+" replace_history_state:"+s),i===(o||TS.model.active_group_id)&&!s)return TS.warn('group "'+i+'" already displayed'),void(r&&TS.shared.legacySendMsg(i,$.trim(r)));r&&TS.shared.legacySendMsg(i,$.trim(r))}else TS.error('group "'+i+'" unknown')}else TS.error("no group id supplied")},legacyMarkMostRecentReadMsg:function(e,t){e?TS.interop.channels.markMostRecentMsgRead({channelId:e.id,reason:t}):TS.error("group unknown")},kickMember:function(e,t){if(TS.permissions.members.canKickFromGroups()){var n=TS.interop.channels.getGroupById(e,!1);if(n)return TS.shared.legacyKickMember(n,t)}},test:function(){return{_onCreate:e}}});var e=function(e,t,n){if(e){if(t.channel)var i=TS.interop.channels.upsertChannel(t.channel),r=t.channel.id;if(r)if(i){var a=n._and_invite_members_ids?n._and_invite_members_ids.split(","):null;a&&TS.interop.api.call("conversations.invite",{channel:r,users:a.join(",")})}else TS.error("no group?!!");else TS.error("no group_id?!!")}else"name_taken"===t.error||"restricted_action"===t.error||TS.error("failed to create group")},t=999}()},qWi6:function(e,t){!function(){TS.registerModule("utility.search",{test:function(){return{_fetchMembersFromFlannel:i}},makeClause:function(t,n,i){if(!e(t,n,i)){var r={type:t.toLowerCase(),value:n};return i&&(r.field_id=i),r}},makeConjunction:function(e,n){if(!t(e,n))return{type:e.toLowerCase(),clauses:n}},promiseToSearch:function(e){if(!e)return Promise.reject(new Error("Cannot search without arguments."));if(e.all_of_org&&!TS.boot_data.page_needs_enterprise)return Promise.reject(new Error("cannot search an org when not an enterprise team"));if(!e.solr){if(!e.hasOwnProperty("raw_query"))return Promise.reject(new Error("Flannel searches require a `raw_query` to be provided"));var t,a=e.raw_query,s=e.count||1/0;if(_.isEmpty(e.raw_query)&&!e.only_admins)t=Promise.resolve([]);else{var o={};e.only_admins?o.filter="admins":e.only_local_team&&(o.filter="team"),t=i(e.raw_query,s,e.determine_membership_for_channel,o)}return t.then((function(t){var n=t.objects;if(!e.include_bots){var i=_.remove(n,{is_bot:!0});i.length&&TS.has_pri[r]&&TS.log(r,"Flannel: removed these bots from results:",i)}if(e.exclude_slackbot&&e.include_bots){var o=_.remove(n,{is_slackbot:!0});o.length&&TS.has_pri[r]&&TS.log(r,"Flannel: removed slackbot from results:",o)}if(TS.boot_data.page_needs_enterprise&&!e.all_of_org){var l=_.remove(n,(function(e){var t=_.get(e,"enterprise_user.teams",[]);return!_.includes(t,TS.model.team.id)}));l.length&&TS.has_pri[r]&&TS.log(r,"Flannel: removed these org members from results:",l)}if(!e.include_deleted){var d=_.remove(n,{deleted:!0});d.length&&TS.has_pri[r]&&TS.log(r,"Flannel: removed these deleted members from results:",d)}return{ok:!0,data:{items:(n=_.intersectionBy(TS.members.getMembersForUser(),n,"id")).slice(0,s),next_cursor_mark:null,num_found:n.length,teams:[TS.model.team]},args:{query:a}}}))}if(!e.query)return Promise.reject(new Error("Cannot search without a query."));var l={query:JSON.stringify(e.query)};["sort","sort_direction","count","cursor_mark","include_bots","include_deleted","exclude_slackbot","ignore_guest_accounts"].forEach((function(t){e.hasOwnProperty(t)&&(l[t]=e[t])}));var d=e.endpoint;return d||(d=e.all_of_org?"search.enterprise":"search.team"),TS.interop.api.call(d,l).catch(n)}});var e=function(e,t,n){e?t?"custom"!==e||n||TS.error("cannot make a custom type clause without a field id"):TS.error("cannot make a clause without a value"):TS.error("cannot make a clause without a type")},t=function(e,t){e?(!t||t.length<2)&&TS.error("cannot make a conjunction without at least two clauses"):TS.error("cannot make a conjunction without an 'and' or 'or' type")},n=function(e){throw TS.error(e.data.error+" error occured while searching"),TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","utility_search")()),e},i=function(e,t,n,i){var r={query:e,count:t};(i=i||{}).filter&&(r.filter=i.filter);var a=TS.members.fetchAndUpsertMembersWithQuery(r);if(!n)return a;var s=_.assign({channels:[n]},r),o=TS.members.fetchAndUpsertMembersWithQuery(s);return Promise.join(a,o).then((function(e){var t=e[0],i=e[1],r=_.map(t.objects,"id"),a=_.map(i.objects,"id"),s={};return a.forEach((function(e){s[e]=!0})),_.difference(r,a).forEach((function(e){s[e]=!1})),TS.redux.dispatch(TS.interop.redux.models.membership.setChannelMembershipInfoForUsers({channelId:n,membershipInfo:s})),t}))},r=1989}()},qYTV:function(e,t,n){"use strict";n.r(t);n("LzIY"),n("GhXE"),n("XUc0"),n("J7dF"),n("laYx"),n("Nwtb"),n("SkS5"),n("ftdm"),n("gYX6"),n("sOV0"),n("weHv"),n("VACg"),n("2hNN"),n("EXLS"),n("Ysd/"),n("/xdr"),n("GNek"),n("/q0e"),n("4B0H"),n("q3cq"),n("YZHV"),n("fK9Z"),n("Oszc"),n("pW7e"),n("qQ+f"),n("Foai"),n("gm7A"),n("F/UT"),n("W17R"),n("zkfd"),n("Pv2O"),n("rRwQ"),n("7EQy"),n("4Cq+"),n("SaiC"),n("8FFK"),n("jAhp"),n("mGpN"),n("j9dp"),n("HtJm"),n("I1WX"),n("4KQo"),n("6btA"),n("mmJJ"),n("aLMH"),n("SmOH"),n("Cs7e"),n("V+wu"),n("e9QI"),n("Chwb"),n("pdVC"),n("PhMi"),n("bFS3"),n("2h3S"),n("sVQH"),n("EcSN"),n("L48h"),n("oTOb"),n("UP61"),n("HUaD"),n("9mk2"),n("4oWp"),n("Zt5a"),n("QqCU"),n("HfRC"),n("nH+9"),n("IZwQ"),n("R0Lu"),n("3D55"),n("5+2p"),n("bdn/"),n("3Vm1"),n("gj8S"),n("54vr"),n("qWi6"),n("m7EJ"),n("D7d6"),n("Jzty"),n("GhNQ"),n("kyJk"),n("Nyv6"),n("OHyl"),n("PU4x"),n("+J8v"),n("VTIS"),n("G4VQ"),n("zmUN"),n("nOzb"),n("16zC"),n("ae6w"),n("omB7"),n("b1eP"),n("RvrE"),n("T0l3")},rRwQ:function(e,t,n){var i=n("cDf5"),r=n("RIqP");!function(){TS.registerModule("members",{presence_changed_sig:new signals.Signal,ds_presence_changed_sig:new signals.Signal,user_color_changed_sig:new signals.Signal,joined_team_sig:new signals.Signal,changed_current_status_sig:new signals.Signal,changed_name_sig:new signals.Signal,changed_real_name_sig:new signals.Signal,changed_deleted_sig:new signals.Signal,changed_profile_sig:new signals.Signal,changed_tz_sig:new signals.Signal,changed_account_type_sig:new signals.Signal,changed_admin_perms_sig:new signals.Signal,changed_owner_perms_sig:new signals.Signal,changed_self_sig:new signals.Signal,lazily_added_sig:new signals.Signal,batch_upserted_sig:new signals.Signal,member_was_upserted_sig:new signals.Signal,user_added_to_team_sig:new signals.Signal,user_removed_from_team_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,legacy_is_in_bulk_upsert_mode:!1,onStart:function(){TS.channels.joined_sig.add((function(){TS.members.invalidateMembersUserCanSeeArrayCaches()})),TS.channels.left_sig.add((function(){TS.members.invalidateMembersUserCanSeeArrayCaches()}))},legacyUpsertAndSignal:function(e){var t=TS.members.legacyUpsertMember(e);return k(t,e)},legacyUpsertMember:function(t){var n=TS.redux.members.hasMemberWithId(t.id)&&TS.interop.members.getRawMemberById(t.id),i="NOOP",r=[];if(t=TS.interop.members.processMemberForUpserting(t),n){TS.has_pri[y]&&TS.log(y,'updating existing member "'+t.id+'"');var a=S(n,t);if(i=a.status,r=a.what_changed,_.includes(r,"deleted")){var s=TS.redux.channels.getImByMemberId(t.id);s&&(s.is_archived=t.deleted)}}else t.id?(i="ADDED",_.includes(c,t.id)&&r.push("is_unknown"),T(t),TS.has_pri[y]&&TS.log(y,'adding member "'+t.id+'" color:'+t.color+" member_color:"+t.member_color)):TS.error("bad error, no member.id");if(!t.is_self||!t.deleted){TS.members.legacy_is_in_bulk_upsert_mode||(TS.members.invalidateMembersUserCanSeeArrayCaches(),TS.members.invalidateActiveMembersArrayCaches()),TS.members.member_was_upserted_sig.dispatch(),TS.members.legacy_is_in_bulk_upsert_mode||("NOOP"!==i&&(TS.interop.members.dangerouslyAddMember(t),TS.redux.dispatch(TS.interop.redux.features.presence.updatePresence({memberId:t.id,presence:t.presence||"away"}))),TS.interop.members.markObjectsAsFresh([t.id]),TS.interop.members.setCanMembersInteract([t]));var o={status:i,member:t,what_changed:r};return TS.members.legacy_is_in_bulk_upsert_mode&&e.push(o),o}TS.reload(null,"member.is_self && member.deleted")},setMemberUserColor:function(e,t){t=_.escape(t),e.member_color=t||e.color,t&&t!=e.color?TS.model.user_colors[e.id]=t:delete TS.model.user_colors[e.id],TS.members.user_color_changed_sig.dispatch(e)},getActiveMembersWithSelfAndNotSlackbot:function(){return t.length||(t=u(t,{include_self:!0,include_slackbot:!1,include_bots:!0})),t},getActiveMembersExceptSelfAndSlackbot:function(){return n.length||(n=u(n,{include_self:!1,include_slackbot:!1,include_bots:!0})),n},getActiveMembersWithSelfAndSlackbot:function(){return s.length||(s=u(s,{include_self:!0,include_slackbot:!0,include_bots:!0})),s},getMembersWithOptions:function(e){var t=TS.members.getMembersForUser();return _.filter(t,(function(t){return!t.is_stranger&&(e.only_admins?t.is_admin&&!t.deleted:!(e.only_local_team&&!TS.interop.rules.members.isMemberOnTeam(t,TS.model.team.id))&&(!(!e.include_deleted&&t.deleted)&&(!(!e.include_slackbot&&TS.interop.rules.members.isSlackbot(t))&&(!(!e.include_self&&t.is_self)&&!(!e.include_bots&&t.is_bot)))))}))},getMembersForUser:function(){return d.length?d:d=_.filter(TS.redux.members.getAllMembers(),(function(e){return!0!==e.is_stranger&&!!e.name}))},legacyGetPrefCompliantMemberNameLowerCase:function(e,t){if(!e)return"";var n,i=(n=TS.interop.members.getMemberRealNameLowerCase(e),!TS.interop.members.shouldDisplayRealNames()&&TS.interop.members.getMemberProfileFieldDisplayNameLowerCase(e)&&(n=TS.interop.members.getMemberProfileFieldDisplayNameLowerCase(e)),n);return t?_.escape(i):i},invalidateMembersUserCanSeeArrayCaches:function(){TS.model.user&&(d.length&&(d.length=0,TS.members.invalidateActiveMembersArrayCaches()))},invalidateActiveMembersArrayCaches:function(){t.length=0,n.length=0,a.length=0,s.length=0,o.length=0,l.length=0},legacyMemberSorterByActiveWithBotsLast:function(e){var t=e.filter((function(e){return e.is_bot||TS.interop.rules.members.isSlackbot(e)})),n=t.filter((function(e){return"active"===e.presence})),i=t.filter((function(e){return"away"===e.presence})),a=e.filter((function(e){return!e.is_bot&&!TS.interop.rules.members.isSlackbot(e)})),s=a.filter((function(e){return"active"===e.presence})),o=a.filter((function(e){return"away"===e.presence})),l=s.sort((function(e,t){var n=TS.interop.members.getPrefCompliantMemberName(e)||e.name,i=TS.interop.members.getPrefCompliantMemberName(t)||t.name;return TS.interop.i18n.sorter(n,i)})),d=o.sort((function(e,t){var n=TS.interop.members.getPrefCompliantMemberName(e)||e.name,i=TS.interop.members.getPrefCompliantMemberName(t)||t.name;return TS.interop.i18n.sorter(n,i)})),c=n.sort(TS.interop.i18n.mappedSorter("name")),u=i.sort(TS.interop.i18n.mappedSorter("name")),_=[];return _.push.apply(_,r(l).concat(r(c),r(d),r(u))),_},legacyEnsureMembersInDataArePresent:function(e,t){var n=TS.interop.utility.extractAllMemberIds(e);if("T02J3DPUE"===_.get(TS,"model.team.id")&&!_.isEmpty(n)&&_.some(n,(function(e){return"U"===e[0]}))){var i={message:"Fetching U users on W team from source: "+t,stack:TS.console.getStackTrace()};$.post(TS.boot_data.beacon_error_url,{description:"fetch_u_on_w_team",error_json:JSON.stringify(i),team:_.get(TS,"model.team.id","none"),user:TS.boot_data.user_id,version:TS.boot_data.version_ts})}return TS.interop.members.ensureMembersArePresent(n)},fetchAndUpsertMembersWithQuery:function(e){return TS.interop.members.fetchAndUpsertMembersWithQuery({query:e}).then((function(e){return{objects:e.members,next_marker:e.next_marker}}))},legacyStartBatchUpsert:function(){return!TS.members.legacy_is_in_bulk_upsert_mode&&(TS.members.legacy_is_in_bulk_upsert_mode=!0,!0)},legacyFinishBatchUpsert:function(){if(!TS.members.legacy_is_in_bulk_upsert_mode)return!1;TS.members.legacy_is_in_bulk_upsert_mode=!1,TS.members.invalidateMembersUserCanSeeArrayCaches(),TS.members.invalidateActiveMembersArrayCaches();var t=_.partition(e,(function(e){return _.includes(e.what_changed,"is_unknown")}))[0];TS.interop.members.dangerouslyBulkAddMembers(e.map((function(e){return e.member})));var n=e.reduce((function(e,t){var n=t.member;return n.presence&&(e[n.id]=e[n.presence]),e}),{});return TS.redux.dispatch(TS.interop.redux.features.presence.bulkUpdatePresence(n)),t.length>0&&TS.members.changed_is_unknown_sig.dispatch({batch:_.map(t,"member")}),TS.members.batch_upserted_sig.dispatch(e),TS.interop.members.markObjectsAsFresh(_.map(e,"member.id")),TS.interop.members.setCanMembersInteract(e.map((function(e){return e.member}))),e=[],!0},legacyAllocateTeamListMembers:function(e){var t,n=[],i=[],r=[],a=[],s=[],o=[];e.sort((function(e,t){var n=e._real_name_lc||e._name_lc,i=t._real_name_lc||t._name_lc;return n>i?1:i>n?-1:0}));for(var l=0;l<e.length;l+=1)(t=e[l]).deleted?t.is_bot?r.push(t):i.push(t):t.is_ultra_restricted?o.push(t):t.is_restricted?s.push(t):t.is_bot||TS.interop.rules.members.isSlackbot(t)?a.push(t):n.push(t);return{members:n,disabled_members:i,deleted_bots:r,bots:a,restricted_members:s,ultra_restricted_members:o}},promiseToSearchMembers:function(e){return Promise.resolve(e).then((function(e){return e?(e.query=e.query&&e.query.trim()||"",e.include_org=!!TS.boot_data.page_needs_enterprise&&!!e.include_org,e.org_team_ids=e.include_org&&Array.isArray(e.org_team_ids)?e.org_team_ids:[],(e=m(e,TS.interop.searcher.isNewMemberSearch(e)))._is_new||e.num_remaining>0?p(e):Promise.resolve(e)):Promise.reject(new Error("No search parameters provided"))}))},readyMemberSearcher:function(e,t){return m(e,t)},buildPromiseToSearchMembersArguments:function(e){return f(e)},userAddedToTeam:function(e){var t=_.merge({},TS.model.user);t.enterprise_user&&(t.enterprise_user.teams=_.uniq(t.enterprise_user.teams.concat(e))),TS.members.legacyUpsertMember(t),TS.members.user_added_to_team_sig.dispatch(e)},userRemovedFromTeam:function(e){var t=_.merge({},TS.model.user);t.enterprise_user&&(t.enterprise_user.teams=t.enterprise_user.teams.filter((function(t){return t!==e}))),TS.members.legacyUpsertMember(t),TS.members.user_removed_from_team_sig.dispatch(e)},legacyEnsureMemberObjectsForUserProfileFields:function(e){var t=[];e.is_restricted&&e.profile.guest_invited_by&&t.push(e.profile.guest_invited_by);var n=TS.team.getVisibleTeamProfileFieldsForMember(e),i=_.chain(n).filter({type:"user"}).reduce((function(e,t){return e.concat(t.value.split(/\s*,\s*/))}),[]).value();return(t=_.chain(t).concat(i).compact().uniq().value()).length?TS.interop.members.ensureMembersArePresent(t):Promise.resolve()},maybeUpdateMembersUserCanSee:function(e){if(!e)return v()},legacySetMemberUnknown:function(e){c.push(e)},getAvatarBaseUrl:function(){return TS.model.team&&TS.model.team.avatar_base_url},test:function(){var e={};return Object.defineProperty(e,"_accessible_user_ids_last_fetched_ts",{get:function(){return b},set:function(e){b=e}}),Object.defineProperty(e,"_processNewMemberForUpserting",{get:function(){return T},set:function(e){T=e}}),Object.defineProperty(e,"_processExistingMemberForUpserting",{get:function(){return S},set:function(e){S=e}}),Object.defineProperty(e,"_fillMembersWithOptions",{get:function(){return u},set:function(e){u=e}}),Object.defineProperty(e,"_members_for_user",{get:function(){return d},set:function(e){d=e}}),e}});var e=[],t=[],n=[],a=[],s=[],o=[],l=[],d=[],c=[],u=function(e,t){if(!_.isArray(e))throw new TypeError("members passed to _fillMembersWithOptions is not an array!");e.length=0;var n=TS.members.getMembersWithOptions(t);return _.each(n,(function(t){e.push(t)})),e},m=function(e,t){return(e=e||{}).hasOwnProperty("_searcher_p")&&t&&e._searcher_p.cancel(),e.hasOwnProperty("_cursor_mark")&&!t||(e._cursor_mark=""),e.hasOwnProperty("full_profile_filter")||(e.full_profile_filter=!0),e.hasOwnProperty("include_bots")||(e.include_bots=!0),e.hasOwnProperty("include_deleted")||(e.include_deleted=!1),e.hasOwnProperty("include_self")||(e.include_self=!1),e.hasOwnProperty("include_slackbot")||(e.include_slackbot=!0),e.hasOwnProperty("only_local_team")||(e.only_local_team=!1),e.hasOwnProperty("only_admins")||(e.only_admins=!1),e.hasOwnProperty("items")&&!t||(e.items=[]),e.hasOwnProperty("not_member_of")||(e.not_member_of=[]),e.hasOwnProperty("member_of")||(e.member_of=[]),e.hasOwnProperty("num_found")&&!t||(e.num_found=0),e.hasOwnProperty("num_remaining")&&!t||(e.num_remaining=0),e.hasOwnProperty("num_new")&&!t||(e.num_new=0),e.hasOwnProperty("max_api_results")||(e.max_api_results=100),t&&(e._last_query=e.query,e._last_include_org=e.include_org,e._last_org_team_ids=e.org_team_ids),e._is_new=!!t,e},p=function(e){var t=function(){return h(e)};return e._is_new?e._searcher_p=t():e._searcher_p=e._searcher_p.then(t),e._searcher_p},f=function(e){var t=[TS.utility.search.makeClause("is","user")];if(e._last_query){var n=e._last_query.split(/\s*,\s*|\s+/).map((function(e){return"@"===e.charAt("0")?e.substring(1):e})).filter((function(e){return!!e})).map((function(t){return 1!==t.length&&e.full_profile_filter?TS.utility.search.makeClause("fuzzy_with_email",t):TS.utility.search.makeConjunction("OR",[TS.utility.search.makeClause("real_name",t),TS.utility.search.makeClause("display_name",t)])}));t=t.concat(n)}if(e.not_member_of&&e.not_member_of.length){var i=e.not_member_of.map((function(e){return TS.utility.search.makeClause("not_member_of",e)}));t.push(i.length>1?TS.utility.search.makeConjunction("OR",i):i[0])}if(e.member_of&&e.member_of.length){var r=e.member_of.map((function(e){return TS.utility.search.makeClause("member_of",e)}));t.push(r.length>1?TS.utility.search.makeConjunction("OR",r):r[0])}if(e._last_include_org&&e._last_org_team_ids.length){var a=e._last_org_team_ids.map((function(e){return TS.utility.search.makeClause("belongs_to_team_id",e)}));t.push(a.length>1?TS.utility.search.makeConjunction("OR",a):a[0])}var s={query:t.length>1?TS.utility.search.makeConjunction("AND",t):t[0],count:e.max_api_results,include_bots:e.include_bots,include_deleted:e.include_deleted,ignore_guest_accounts:e.ignore_guest_accounts,only_local_team:e.only_local_team,only_admins:e.only_admins,raw_query:e.query,solr:e.solr};return e._last_include_org&&(s.all_of_org=e._last_include_org),e._cursor_mark&&(s.cursor_mark=e._cursor_mark),e.determine_membership_for_channel&&(s.determine_membership_for_channel=e.determine_membership_for_channel),s},h=function(e){var t=f(e);return e.num_new=0,TS.utility.search.promiseToSearch(t).then((function(t){if(!t.data.items.length)return Promise.resolve(e);e.num_remaining||(e.num_remaining=t.data.num_found,e.num_found=t.data.num_found),e.num_remaining-=t.data.items.length,e._cursor_mark=t.data.next_cursor_mark;var n=t.data.items.map((function(t){var n=TS.interop.members.getMemberById(t.id);return n||(e._last_include_org&&t.team_id!==TS.model.team.id&&(t.is_primary_owner=!1,t.is_owner=!1,t.is_admin=!1),n=TS.members.legacyUpsertMember(t).member),n})).filter((function(t){return t.is_self&&!e.include_self||TS.interop.rules.members.isSlackbot(t)&&!e.include_slackbot?(e.num_found-=1,!1):!e.limit_by_model_relevancy||TS.utility.members.isMemberRelevantToModel(t,e.limit_by_model_relevancy)}));return e.num_new=n.length,e.items.push.apply(e.items,n),Promise.resolve(e)}))},g=function(e){return _.isObject(e)?_.omitBy(e,(function(e,t){return 0===t.indexOf("image_")})):e},S=function(e,t){var n="NOOP",r=[];return Object.keys(t).forEach((function(a){if("profile"===a){var s=g(e.profile),o=g(t.profile);if(_.isObject(o)){s.status_text===o.status_text&&s.status_emoji===o.status_emoji||(n="CHANGED",r.push("current_status"));var l=Object.keys(s).filter((function(e){return void 0===o[e]})).concat(["status_text","status_emoji"]);s=_.omit(s,l),o=_.omit(o,l),_.isEqual(s,o)||(n="CHANGED",r.push(a))}}else if("enterprise_user"===a)if(e[a])for(var d in t[a])_.isEqual(e[a][d],t[a][d])||(n="CHANGED",r.push(a));else n="CHANGED",r.push(a);else if("id"===a){if(e.id!=t.id&&e.enterprise_user&&t.enterprise_user){var c=e.enterprise_user.id===e.id,u=t.id!=t.enterprise_user.id;c&&u&&(n="CHANGED",r.push(a))}}else"teams"===a?(n="CHANGED",r.push(a)):e[a]!=t[a]&&("is_admin"===a&&TS.has_pri[w]&&(TS.warn(w,a+"is changing from `"+e[a]+"` to `"+t[a]+"`"),TS.console.trace(w)),t[a]&&!TS.utility.isScalar(t[a])?(e[a]=t[a],TS.warn(a+" is not scalar! it needs to be handled by upsertMember specifically to test if it has changed! "+i(t[a]))):"boolean"==typeof t[a]&&!t[a]==!e[a]||(r.push(a),n="CHANGED"))})),function(e){var t=!!e&&e.is_unknown;return e&&e.is_unknown&&(e.is_unknown=!1),_.pull(c,e.id),t}(e)&&r.push("is_unknown"),{status:n,what_changed:r}},T=function(e){TS.members.user_color_changed_sig.dispatch(e)},b=0,v=function(){TS.members.invalidateMembersUserCanSeeArrayCaches()},y=4,w=1975,k=function(e,t){if("ADDED"===e.status)TS.members.lazily_added_sig.dispatch(e.member);else if("CHANGED"===e.status){if(-1!==e.what_changed.indexOf("is_unknown"))return TS.members.changed_is_unknown_sig.dispatch(e.member),e;-1!==e.what_changed.indexOf("current_status")&&TS.members.changed_current_status_sig.dispatch(e.member),-1!==e.what_changed.indexOf("profile")&&TS.members.changed_profile_sig.dispatch(e.member),-1===e.what_changed.indexOf("is_restricted")&&-1===e.what_changed.indexOf("is_ultra_restricted")||TS.members.changed_account_type_sig.dispatch(e.member),-1!==e.what_changed.indexOf("real_name")&&TS.members.changed_real_name_sig.dispatch(e.member),-1===e.what_changed.indexOf("member_color")&&-1===e.what_changed.indexOf("color")||TS.members.user_color_changed_sig.dispatch(e.member),-1!==e.what_changed.indexOf("name")&&TS.members.changed_name_sig.dispatch(e.member),-1!==e.what_changed.indexOf("tz")&&TS.members.changed_tz_sig.dispatch(e.member),-1!==e.what_changed.indexOf("deleted")&&TS.members.changed_deleted_sig.dispatch(e.member),-1!==e.what_changed.indexOf("presence")&&TS.members.presence_changed_sig.dispatch(e.member),-1!==e.what_changed.indexOf("is_owner")&&TS.members.changed_owner_perms_sig.dispatch(e.member),-1!==e.what_changed.indexOf("is_admin")&&TS.members.changed_admin_perms_sig.dispatch(e.member),t.is_self&&TS.members.changed_self_sig.dispatch(e.member)}return e}}()},sOV0:function(e,t){!function(){TS.registerModule("redux.channels.interop",{maybeWrapEntity:function(e){return e&&e.id?p(e.id):e},getSetCounts:function(){return _.chain(t).map((function(e,t){return{key:t,value:e}})).sortBy("value").reverse().value()},getReduxSetCounts:function(){return _.chain(n).map((function(e,t){return{key:t,value:e}})).sortBy("value").reverse().value()},test:function(){return{}}});var e=TS.interop.channels.getChannelById,t={},n={},i={},r=["_show_in_list_even_though_no_unreads","deleted","has_draft","is_archived","is_frozen","is_channel","is_ext_shared","is_group","is_im","is_member","is_mpim","is_open","is_org_shared","is_pending_ext_shared","is_starred","last_read","members","priority","unread_cnt","unread_highlight_cnt","internalTeamIds","pendingAndConnectedTeamIds"],a=["_display_name","_archive_msgs","_checking_at_channel_status","_delayed_fetch_timer","_did_defer_initial_msg_history","_display_name_lc","_display_name_truncated","_i18n_ns_history","_i18n_ns","_internal_name","_jumper_previous_name_match","_latest_via_users_counts","_mark_most_recent_read_timer","_marked_reason","_members","_mention_count_display_via_users_counts","_name_lc","_prev_last_read","_score","_users_counts_info","active_members","can_thread","create_channel","created","creator","date_created","enterprise_id","fetched_history_after_scrollback_time","has_fetched_history_after_scrollback","has_pins","history_changed","history_fetch_failed","history_fetch_retries","history_is_being_fetched","id","inherit","is_default","is_general","is_global_shared","is_limited","is_moved","is_non_threadable","is_org_default","is_org_mandatory","is_private","is_read_only","is_thread_only","last_made_active","last_msg_input","latest","length","member","msgs","name_normalized","name","needs_joined_message","never_needs_joined_msg","note","num_members","old_name","oldest_msg_ts","opened_this_session","org","parent_group","pinned_items","pinned_items_count","presence","previous_names","purpose","scroll_top","shares","domain","tooltip","topic","unlinked","unread_count_display","unread_count","unread_highlight_cnt_in_client","unread_highlights","unreads","user","was_archived_this_session","isUnknown","isNonExistent","fromAnotherTeam","internalTeamIds","team_id","pendingAndConnectedTeamIds","previously_connected_team_ids","pending_connected_team_ids","conversation_host_id"],s=_.reduce(r,(function(e,t){return e[t]=!0,e}),{}),o=_.reduce(a,(function(e,t){return e[t]=!0,e}),{}),l=_.reduce(["_get","_is_interop_channel_object","_set","_setWithReduxAction","attributes","children","disabled","is_broadcast_keyword","is_divider","is_emoji","is_usergroup","is_view","is_app_action","nodeType","old_name","props_to_define","selector","then","title","toObject","toJSON","window","@@toStringTag"],(function(e,t){return e[t]=!0,e}),{}),d={},c=function(e){this.id=e,Object.defineProperties(this,this.props_to_define)},u={};_.without(a,"id").forEach((function(e){u[e]={enumerable:!0,get:function(){return this._get(e)},set:function(t){return this._set(e,t)}},r.forEach((function(e){u[e]={enumerable:!0,get:function(){return this._get(e)},set:function(t){return this._setWithReduxAction(e,t)}}}))})),c.prototype.props_to_define=u,c.prototype._is_interop_channel_object=!0,c.prototype._get=function(t){var n=e(this.id);if(n)return n[t]},c.prototype._set=function(t,n){var i=e(this.id);return i&&(i[t]=n),!0},c.prototype._setWithReduxAction=function(t,i){var r=e(this.id);return r&&r[t]!==i&&(!function(e,t,n){if(e&&t){var i={id:e};i[t]=n,TS.interop.channels.updateOneKeyForChannel(i)}}(this.id,t,i),n[t]=(n[t]||0)+1),!0};var m=function(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)},p=function(n){if(!n)throw new Error("Must pass in a valid id to _createWrappedEntityById");var r,a=window.Proxy&&m();return d[n]?r=d[n]:(r=new c(n),a&&(r=new window.Proxy(r,{get:function(t,n){return function(t,n){if(!o[n]&&!s[n]&&!l[n]&&_.isString(n)){TS.console.logStackTrace("Accessing an unknown key "+n+" on a model object"),i[n]||(i[n]=!0),m()&&TS.console.error('Dev only warning: Trying to get an unknown field "'+n+'" from a model object. If this is not a typo and you are relying on this property, please try and store this data outside of the model ob, or add to the model_ob_keys_as_map whitelist in TS.redux.channels.interop.source.js. Questions? Feel free to ask in #dhtml');var r=e(t.id);return r&&r[n]}return t[n]}(t,n)},set:function(n,r,a){return function(n,r,a){if(_.isString(r)&&(t[r]=(t[r]||0)+1),!o[r]&&!s[r]&&_.isString(r)){if(TS.console.logStackTrace("Setting an unknown key "+r+" on a model object"),i[r]||(i[r]=!0),m())throw new Error('Dev only warning: Trying to set an unknown field "'+r+'" on a model object. If this is not a typo and you are relying on this property, please try and store this data outside of the model ob, or add to the model_ob_keys_as_map whitelist in TS.redux.channels.interop.source.js. Questions? Feel free to ask in #dhtml');var l=e(n.id);l&&(l[r]=a)}return n[r]=a,!0}(n,r,a)}})),d[n]=r),r}}()},sVQH:function(e,t,n){var i=n("lSNA");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(){TS.registerModule("msg_edit",{editing:!1,editing_in_msg_pane:!1,editing_in_convo_pane:!1,deleting_from_editing:!1,current_msg:null,current_model_ob:null,mousedown_active:!1,edit_interv:0,onStart:function(){},onCountDownInterval:function(){if(TS.msg_edit.current_msg)if(-1==TS.prefs.getTeamPref("msg_edit_window_mins")||TS.interop.rules.channels.isYou(TS.msg_edit.current_model_ob))$("#edit_countdown").empty();else{var e=TS.interop.datetime.toDateObject(TS.msg_edit.current_msg.ts).getTime()+60*TS.prefs.getTeamPref("msg_edit_window_mins")*1e3,t=Math.floor((e-Date.now())/1e3);t<1?$("#edit_countdown").html(TS.interop.i18n.t("(your time to edit ran out)","msg_edit")()+"&nbsp&nbsp&nbsp&nbsp"):t<61?$("#edit_countdown").html(TS.interop.i18n.t("(you have <strong>{seconds_count, number}</strong> seconds)","msg_edit")({seconds_count:t})+"&nbsp&nbsp&nbsp&nbsp"):$("#edit_countdown").empty()}},cancelEditingINothingHasChanged:function(){if(!TS.msg_edit.editing)return!0;var e=TS.format.unFormatMsg(TS.msg_edit.current_msg.text);return TS.utility.contenteditable.value($("#message_edit_form").find("#msg_text"))===e&&(TS.msg_edit.onCancelEdit(),!0)},editExpiration:function(e){if(e>0){var n=t(e);return TS.model.user.is_admin?'<p class="no_bottom_margin">'+TS.interop.i18n.t('In this workspace, you can\u2019t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.',"msg_edit")({msg_edit_duration_text:n})+"</p>":'<p class="no_bottom_margin">'+TS.interop.i18n.t("In this workspace, you can\u2019t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in Workspace&nbsp;Settings.","msg_edit")({msg_edit_duration_text:n})+"</p>"}return TS.model.user.is_admin?'<p class="no_bottom_margin">'+TS.interop.i18n.t('In this workspace, you can\u2019t edit messages after the fact. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.',"msg_edit")()+"</p>":'<p class="no_bottom_margin">'+TS.interop.i18n.t("In this workspace, you can\u2019t edit messages after the fact. Admins can adjust this in Workspace&nbsp;Settings.","msg_edit")()+"</p>"},startEdit:function(t,n,i,r){if(!$("#message_edit_form").length||TS.msg_edit.cancelEditingINothingHasChanged()){if(!t)return TS.error("no msg_ts?"),null;if(!n)return TS.error("no model_ob?"),null;if(r||(r=TS.utility.msgs.getMsg(t,e(n))),!r)return TS.error("no msg in msgs?"),null;if("convo"===i){var a,s=TS.format.unFormatMsg(r.text);if(!(i&&i.force_reopen)){var o=Date.now(),l=(o-TS.interop.datetime.toDateObject(r.ts))/6e4;if(TS.prefs.getTeamPref("msg_edit_window_mins")>=0&&l>TS.prefs.getTeamPref("msg_edit_window_mins")&&!TS.interop.rules.channels.isYou(n)){TS.warn("Editing unavailable on channel "+n.id+", msg with ts = "+r.ts+". now = "+o+", elapsed (minutes) = "+l+", msg_edit_window_mins = "+TS.prefs.getTeamPref("msg_edit_window_mins"));var d=TS.prefs.getTeamPref("msg_edit_window_mins")>0?TS.interop.i18n.t("This message can\u2019t be edited","msg_edit")():TS.interop.i18n.t("Messages can\u2019t be edited","msg_edit")();return void TS.generic_dialog.alert(TS.msg_edit.editExpiration(TS.prefs.getTeamPref("msg_edit_window_mins")),d,TS.interop.i18n.t("Got It","msg_edit")())}}if("convo"===i?(TS.msg_edit.editing_in_msg_pane=!1,TS.msg_edit.editing_in_convo_pane=!0,a=TS.msg_edit.getDivForMsgInConvoPane(r.ts)):(TS.msg_edit.editing_in_msg_pane=!0,TS.msg_edit.editing_in_convo_pane=!1,a=TS.msg_edit.getDivForMsgInMsgPane(r.ts)),!a.length)return TS.error("no msg div for edit"),null;TS.msg_edit.current_msg=r,TS.msg_edit.current_model_ob=n,a.addClass("hidden");var c=s;i&&i.text&&(c=i.text);var u=TS.templates.message_edit_form({msg:r,edit_text:c,permalink:TS.utility.msgs.constructMsgPermalink(n,r.ts,r.thread_ts),include_emo:!1,relative_ts:TS.interop.messages.isReply(r)});a.after(u);var m=$("#message_edit_form"),p=m,f=m.find("#msg_text");TS.utility.contenteditable.create(f,{ariaLabel:TS.interop.i18n.t("Edit message","msg_edit")(),modules:{tabcomplete:{searchOptions:{},positionMenu:function(e){e.style.width=f.outerWidth()+"px",TS.tabcomplete.positionUIRelativeToInput(e,f)},completers:["channels","emoji","members"]}},onEnter:function(){return TS.msg_edit.checkAndSubmit(f,m),!1},onEscape:function(){TS.model.menu_is_showing||TS.model.dialog_is_showing||setTimeout(TS.msg_edit.onCancelEdit,0)},onTextChange:function(){TS.msg_edit.checkLengthAndUpdateMessage(f)},enableBroadcastKeywords:!("convo"===i)}),TS.utility.contenteditable.enable(f),f.on("keyup",(function(){TS.utility.contenteditable.cursorPosition(f).length||p.find(".edit_controls").scrollintoview({px_offset:-50})})),TS.utility.contenteditable.value(f,c),TS.msg_edit.checkLengthAndUpdateMessage(f),TS.info("message_edit_form added"),TS.msg_edit.editing=!0,m.bind("destroyed",(function(){TS.utility.contenteditable.unload($("#message_edit_form #msg_text")),TS.info("message_edit_form removed"),TS.msg_edit.editing=!1,TS.msg_edit.editing_in_msg_pane=!1,TS.msg_edit.editing_in_convo_pane=!1,m=null,f=null,TS.msg_edit.resetEditUI()})),m.bind("submit",(function(e){e.preventDefault();var o=TS.utility.contenteditable.value(f);if((o=TS.utility.contenteditable.legacySynchronouslyReplacePotentialMentions(o,{enableBroadcastKeywords:!("convo"===i)}))!==s)if(o){var l=TS.ui.needToBlockAtChannelKeyword(o,null,TS.msg_edit.current_model_ob.id);l?TS.generic_dialog.alert("<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{blocked_keyword}</strong> messages.","msg_edit")({blocked_keyword:TS.interop.i18n.safeString(_.escape(l))})+"</p>"):$.trim(o)&&TS.msg_edit.onConfirmEdit(o)}else{var d=TS.utility.msgs.getMsgActions(r,n),c=a.attr("id")===TS.templates.makeMsgDomIdInConversation(t)||a.attr("id")===TS.templates.makeMsgDomIdInThreadsView(t);d.remove_broadcast&&!c?TS.msg_edit.startRemoveBroadcast(TS.msg_edit.current_msg.ts,TS.msg_edit.current_model_ob,!0):d.delete_msg?TS.msg_edit.startDelete(TS.msg_edit.current_msg.ts,TS.msg_edit.current_model_ob,TS.msg_edit.onCancelEdit,!0):TS.msg_edit.onConfirmEdit("~"+r.text.replace(/~/g,"")+"~")}else TS.msg_edit.onCancelEdit()})),m.find("#commit_edit").bind("click",(function(){TS.msg_edit.checkAndSubmit(f,m)})),m.find("#cancel_edit").bind("click",(function(){TS.msg_edit.onCancelEdit()})),m.bind("mousedown",(function(){TS.msg_edit.mousedown_active=!0})),m.bind("mouseup",(function(){TS.msg_edit.mousedown_active=!1}));var h=m.find(".emo_menu");h.removeClass("hidden"),h.bind("click.open_dialog",(function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:"#msg_text"})})),p.find(".edit_controls").scrollintoview({duration:500,px_offset:-50,complete:function(){TS.msg_edit.focusAndSetCursorPosition(f,i)}}),TS.msg_edit.onCountDownInterval(),TS.msg_edit.edit_interv=setInterval(TS.msg_edit.onCountDownInterval,1e3)}else TS.redux.dispatch(TS.interop.redux.features.messageEdit.maybeStartEditingMessage({channelId:r.channel,ts:t,scroll:!0}))}else TS.msg_edit.promptEdit()},isMessageTooLong:function(e){return TS.format.cleanMsg(TS.utility.contenteditable.value(e)).length>TS.interop.constants.MAX_MESSAGE_INPUT_LENGTH},updateTooLongWarning:function(e,t){var n=$(e).parent().find(".edit_warning");t?n.removeClass("hidden"):$(e).parent().find(".edit_warning").addClass("hidden")},checkLengthAndUpdateMessage:function(e){var t=TS.msg_edit.isMessageTooLong(e);return TS.msg_edit.updateTooLongWarning(e,t),!t},checkAndSubmit:function(e,t){TS.msg_edit.checkLengthAndUpdateMessage(e)&&t.submit()},onConfirmEdit:function(e){return TS.msg_edit.current_msg?e?(TS.msg_edit.commitEditInternal(e),void TS.msg_edit.resetEditUI()):(TS.error("no edited_text?"),null):(TS.error("no TS.msg_edit.current_msg?"),null)},onCancelEdit:function(){if(!TS.msg_edit.current_msg)return TS.error("no TS.msg_edit.current_msg?"),null;TS.msg_edit.resetEditUI()},resetEditUI:function(){if(clearInterval(TS.msg_edit.edit_interv),!TS.msg_edit.current_msg)return TS.error("no TS.msg_edit.current_msg?"),null;TS.msg_edit.getDivBeingEdited().removeClass("hidden"),$("#message_edit_container").remove()},getDivBeingEdited:function(){return TS.msg_edit.editing_in_msg_pane?TS.msg_edit.getDivForMsgInMsgPane(TS.msg_edit.current_msg.ts):TS.msg_edit.editing_in_convo_pane?TS.msg_edit.getDivForMsgInConvoPane(TS.msg_edit.current_msg.ts):$()},getDivForMsgInMsgPane:function(e){var t=TS.model.unread_view_is_showing,n=TS.model.threads_view_is_showing;return t?$("#"+TS.templates.makeMsgDomIdInUnreadView(e)):n?$("#"+TS.templates.makeMsgDomIdInThreadsView(e)):$("#"+TS.templates.makeMsgDomId(e))},getDivForMsgInConvoPane:function(e){return $("#"+TS.templates.makeMsgDomIdInConversation(e))},getAllDivsForMsg:function(e){return TS.msg_edit.getDivForMsgInMsgPane(e).add(TS.msg_edit.getDivForMsgInConvoPane(e))},commitEditInternal:function(e){TS.msg_edit.commitEdit(TS.msg_edit.current_msg,TS.msg_edit.current_model_ob,e)},commitEdit:function(e,n,i,r,a){if(!e)return TS.error("no msg?"),null;if(!n)return TS.error("no model_ob?"),null;r||(r=0),a||(a=100);var s=function(r,a,s){if(r){var o=!1;if(TS.interop.rules.messages.isReply(e)&&e.text!==a.text&&(o=!0),TS.web||n.is_channel&&!n.is_member||o){var l=_.extend({},e,{text:a.text,edited:{ts:TS.interop.datetime.makeTsStamp(null,{padder:"0"})}});TS.utility.msgs.replaceMsg(n,l)}}else{if(a&&a.error)if("message_not_found"===a.error){if(s._attempts<10)return s._delay_ms*=1.75,void setTimeout((function(){TS.msg_edit.commitEdit(e,n,i,s._attempts+1,s._delay_ms)}),s._delay_ms);n.is_channel?TS.channels.legacyRemoveMsg(n.id,e):n.is_im?TS.ims.legacyRemoveMsg(n.id,e):n.is_mpim?TS.mpims.legacyRemoveMsg(n.id,e):n.is_group&&TS.groups.legacyRemoveMsg(n.id,e),TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")())}else if("edit_window_closed"===a.error){var d="<p>"+TS.interop.i18n.t("Sorry, but messages can only be edited for <strong>{msg_edit_duration_text}</strong> after posting.","msg_edit")({msg_edit_duration_text:t(TS.prefs.getTeamPref("msg_edit_window_mins"))})+"</p>";TS.model.user.is_admin&&(d+="<p>"+TS.interop.i18n.t('(To adjust the message editing window, visit <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.)',"msg_edit")()+"</p>"),TS.generic_dialog.alert(d,TS.interop.i18n.t("Message editing failed","msg_edit")())}else"msg_too_long"===a.error?TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, your message is too long. Please shorten it and try again.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")()):TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")());else TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")());TS.msg_edit.startEdit(e.ts,n,{text:i,force_reopen:!0})}};return TS.interop.api.call("chat.update",{channel:n.id,ts:e.ts,text:TS.format.cleanMsg(i),_attempts:r,_delay_ms:a}).then((function(e){var t=e.data,n=e.args,i=e.request_id;return s(!0,t,n),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return s(!1,t,n),{data:t,args:n,request_id:i}}))},promptEdit:function(){"none"===$("#message_editing_info").css("display")?($("#message_editing_info").css("display",""),$("#message_editing_info").css("opacity",0),$("#message_edit_container").scrollintoview({duration:300,px_offset:0,complete:function(){$("#message_editing_info").transition({opacity:1},250)}})):$("#message_edit_container").scrollintoview({duration:300,px_offset:0})},startDelete:function(t,n,i,r,s){if(s=s||_.noop,!t)return TS.error("no msg_ts?"),s(),null;if(_.isString(n)&&(n=TS.redux.channels.getEntityById(n)),!n)return TS.error("no model_ob?"),s(),null;var o=TS.redux.messages.getMessageByTimestamp(n.id,t);if(o&&o.file&&(o=a(a({},o),{},{file:TS.redux.files.getFileById(o.file)})),o||(o=TS.utility.msgs.getMsg(t,e(n))),!o)return TS.error("no msg in msgs?"),s(),null;TS.msg_edit.deleting_from_editing=!!r,TS.msg_edit.current_msg=o,TS.msg_edit.current_model_ob=n;var l=TS.msg_edit.getAllDivsForMsg(o.ts),d='<p class="bottom_margin">'+TS.interop.i18n.t("Are you sure you want to delete this message? This cannot be undone.","msg_edit")()+"</p>";if(o.subtype){var c;o.file&&(c="file","snippet"===o.file.mode?c="snippet":"post"===o.file.mode&&(c="post"));var u="";"file_upload"===o.subtype?"file"===c?u=TS.interop.i18n.t("Note that deleting this message will not delete the file that was uploaded.","msg_edit")():"snippet"===c?u=TS.interop.i18n.t("Note that deleting this message will not delete the snippet that was uploaded.","msg_edit")():"post"===c&&(u=TS.interop.i18n.t("Note that deleting this message will not delete the post that was uploaded.","msg_edit")()):"file_share"===o.subtype?"file"===c?u=TS.interop.i18n.t("Note that deleting this message will not unshare the file.","msg_edit")():"snippet"===c?u=TS.interop.i18n.t("Note that deleting this message will not unshare the snippet.","msg_edit")():"post"===c&&(u=TS.interop.i18n.t("Note that deleting this message will not unshare the post.","msg_edit")()):"file_comment"===o.subtype&&(u=TS.interop.i18n.t("Note that deleting this message will not delete the comment.","msg_edit")()),u&&(d+="<p>"+u+"</p>")}l.addClass("delete_mode"),TS.generic_dialog.start({title:TS.interop.i18n.t("Delete message","msg_edit")(),body:d+TS.templates.builders.msgs.buildHTML({msg:o,model_ob:n,standalone:!0}),go_button_text:TS.interop.i18n.t("Delete","msg_edit")(),go_button_class:"btn_danger",onGo:function(){TS.msg_edit.deleting_from_editing&&TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessage({channelId:n.id,ts:t})),TS.msg_edit.commitDeleteInternal(i)},onCancel:function(){TS.msg_edit.onCancelDelete()},onEnd:s}),TS.generic_dialog.div.find("img.msg_inline_img.hidden").each((function(e,t){var n=$(t);n.prop("src",n.data("real-src")),n.removeClass("hidden")}))},onCancelDelete:function(){if(!TS.msg_edit.current_msg)return TS.error("no TS.msg_edit.current_msg?"),null;TS.msg_edit.getAllDivsForMsg(TS.msg_edit.current_msg.ts).removeClass("delete_mode"),TS.msg_edit.deleting_from_editing&&TS.utility.contenteditable.focus($("#msg_text"))},commitDeleteInternal:function(e){TS.msg_edit.commitDelete(TS.msg_edit.current_msg,TS.msg_edit.current_model_ob,TS.msg_edit.onCancelDelete,e)},commitDelete:function(t,n,i,r,a,s,o){if(!t)return TS.error("no msg?"),null;if(!n)return TS.error("no model_ob?"),null;var l=n.id;if(s||(s=0),o||(o=100),t.is_ephemeral||TS.interop.rules.messages.isTempMsg(t))n.is_channel?TS.channels.legacyRemoveMsg(n.id,t):n.is_im?TS.ims.legacyRemoveMsg(n.id,t):n.is_mpim?TS.mpims.legacyRemoveMsg(n.id,t):n.is_group&&TS.groups.legacyRemoveMsg(n.id,t);else{if(t._jl_rollup_hash&&t._jl_rollup_hash.msg_ids)t._jl_rollup_hash.msg_ids.forEach((function(d){if(d!=t.ts){var c=function(s,o,l){if(s||"message_not_found"===o.error){if("message_not_found"===o.error&&l._attempts<10)return l._delay_ms*=1.75,void setTimeout((function(){TS.msg_edit.commitDelete(t,n,i,r,a,l._attempts+1,l._delay_ms)}),l._delay_ms);(TS.web||n.is_channel&&!n.is_member)&&(n.is_channel?TS.channels.legacyRemoveMsg(n.id,TS.utility.msgs.getMsg(l.ts,e(n))):n.is_im?TS.ims.legacyRemoveMsg(n.id,TS.utility.msgs.getMsg(l.ts,e(n))):n.is_mpim?TS.mpims.legacyRemoveMsg(n.id,TS.utility.msgs.getMsg(l.ts,e(n))):n.is_group&&TS.groups.legacyRemoveMsg(n.id,TS.utility.msgs.getMsg(l.ts,e(n))))}};TS.interop.api.call("chat.delete",{channel:l,ts:d,_attempts:s,_delay_ms:o}).then((function(e){var t=e.data,n=e.args,i=e.request_id;return c(!0,t,n),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return c(!1,t,n),{data:t,args:n,request_id:i}}))}}));var d=function(e,s,o){if(e||"message_not_found"===s.error){if("message_not_found"===s.error&&o._attempts<10)return o._delay_ms*=1.75,void setTimeout((function(){TS.msg_edit.commitDelete(t,n,i,r,a,o._attempts+1,o._delay_ms)}),o._delay_ms);(TS.web||n.is_channel&&!n.is_member)&&(n.is_channel?TS.channels.legacyRemoveMsg(n.id,t):n.is_im?TS.ims.legacyRemoveMsg(n.id,t):n.is_mpim?TS.mpims.legacyRemoveMsg(n.id,t):n.is_group&&TS.groups.legacyRemoveMsg(n.id,t)),r&&r()}else{var l;if(i&&i(),!a)l=s&&s.error?TS.interop.i18n.t("The message was not deleted. The error was: {error}","msg_edit")({error:s.error}):TS.interop.i18n.t("The message was not deleted. The error was: unknown","msg_edit")(),TS.generic_dialog.start({title:TS.interop.i18n.t("Delete Message Failed","msg_edit")(),body:l,show_cancel_button:!1,esc_for_ok:!0})}if(TS.web&&!TS.utility.msgs.getDisplayedMsgs(n.msgs).length){var d=$(".pager .previous a");d.attr("href")?window.location=d.attr("href"):TS.reload(!1,"TS.msg_edit.commitEdit")}};TS.interop.api.call("chat.delete",{channel:l,ts:t.ts,_attempts:s,_delay_ms:o}).then((function(e){var t=e.data,n=e.args,i=e.request_id;return d(!0,t,n),{data:t,args:n,request_id:i}})).catch((function(e){var t=e.data,n=e.args,i=e.request_id;return d(!1,t,n),{data:t,args:n,request_id:i}}))}},$last_clicked_cb:null,startBatchDelete:function(){$("#msgs_div").addClass("selecting_messages"),$("#channel_actions_div").addClass("hidden"),$("#batch_delete_div").removeClass("hidden"),TS.msg_edit.batchDeleteSelectionChanged()},cancelBatchDelete:function(){TS.msg_edit.selectNoneBatchDelete(),$("#msgs_div").removeClass("selecting_messages"),$("#channel_actions_div").removeClass("hidden"),$("#batch_delete_div").addClass("hidden")},doBatchDelete:function(){var t=$("#msgs_div").find(".msg_select_cb:checked"),n=TS.shared.legacyGetActiveModelOb();if(t.length){var i=t.length;if(1==i)return void TS.msg_edit.startDelete(t.eq(0).closest(".message").data("ts"),n,TS.msg_edit.cancelBatchDelete);for(var r,a,s='<p class="small_bottom_margin">'+TS.interop.i18n.t("Are you sure you want to delete {count, plural, =1 {this message} other {these messages}}? This cannot be undone! Note that deleting these messages will not delete any files or file comments.","msg_edit")({count:i})+"</p>",o=0;o<i;o+=1){a&&!a.no_display&&(r=a);var l=t.eq(o).closest(".message").data("ts");(a=TS.utility.msgs.getMsg(l,e(n)))&&(s+=TS.templates.builders.msgs.buildHTML({msg:a,prev_msg:r,model_ob:n,standalone:!0}))}var d=function(e){function t(){e.length?setTimeout((function(){!function(e){TS.msg_edit.commitDelete(e,n,t,t,!0)}(e.pop())}),100):(TS.generic_dialog.cancel(),TS.generic_dialog.start({title:"",body:TS.interop.i18n.t("Messages deleted.","msg_edit")(),show_cancel_button:!1,esc_for_ok:!0}))}TS.generic_dialog.start({title:"",body:"<p>"+TS.interop.i18n.t("Deleting messages...","msg_edit")()+"</p>",show_cancel_button:!1,show_go_button:!1}),t()};TS.generic_dialog.start({title:TS.interop.i18n.t("Delete Messages","msg_edit")(),body:s,go_button_text:TS.interop.i18n.t("Yes, delete these messages","msg_edit")(),go_button_class:"btn_danger",onGo:function(){for(var r=[],a=0;a<i;a+=1){var s=t.eq(a).closest(".message").data("ts");if(!s)return void alert("no msg_ts");var o=TS.utility.msgs.getMsg(s,e(n));if(!o)return void alert("no msg");r.push(o)}TS.msg_edit.cancelBatchDelete(),d(r)}})}},batchDeleteSelectionChanged:function(e,t){var n=TS.msg_edit.$last_clicked_cb;if(n&&e&&t){var i=$("#msgs_div").find(".msg_select_cb:visible"),r=i.index(n),a=i.index(e);r>a&&(a=r,r=i.index(e));for(var s="checked"===n.prop("checked"),o=r;o<=a;o+=1)i.eq(o).prop("checked",s)}n=e,TS.msg_edit.$last_clicked_cb=n;var l=TS.interop.i18n.t("0 messages","msg_edit")(),d=$("#msgs_div").find(".msg_select_cb:checked");$("#msgs_div").find(".multi_delete_mode").removeClass("multi_delete_mode"),d.length?(l=TS.interop.i18n.t("{count, plural, =1 {# message} other {# messages}}","msg_edit")({count:d.length}),$("#batch_delete_button").removeClass("disabled"),d.each((function(){$(this).closest(".message").addClass("multi_delete_mode")}))):$("#batch_delete_button").addClass("disabled"),$("#batch_delete_count_span").html(l)},selectAllBatchDelete:function(){$("#msgs_div").find(".msg_select_cb:visible").prop("checked",!0),TS.msg_edit.batchDeleteSelectionChanged()},selectNoneBatchDelete:function(){$("#msgs_div").find(".msg_select_cb:visible").prop("checked",!1),TS.msg_edit.batchDeleteSelectionChanged()},startRemoveBroadcast:function(e,t,n,i){i=i||_.noop,_.isString(t)&&(t=TS.redux.channels.getEntityById(t));var r=TS.utility.msgs.findMsg(e,t.id);if(!r)return TS.error("Cannot find "+e+" for startRemoveBroadcast"),void i();TS.msg_edit.deleting_from_editing=!!n,TS.msg_edit.current_msg=r,TS.msg_edit.current_model_ob=t;var a,s=TS.msg_edit.getDivForMsgInMsgPane(e),o=t.is_channel||t.is_group&&!t.is_mpim,l=TS.templates.builders.msgs.buildHTML({msg:r,model_ob:t,standalone:!0}),d=TS.templates.thread_confirm_remove_broadcast({is_channel_or_group:o,msg_html:new Handlebars.SafeString(l)});s.addClass("delete_mode"),a=o?TS.interop.i18n.t("Remove from channel","msg_edit")():TS.interop.i18n.t("Remove from conversation","msg_edit")(),TS.generic_dialog.start({title:a,body:d,go_button_text:TS.interop.i18n.t("Remove message","msg_edit")(),onGo:function(){TS.msg_edit.deleting_from_editing&&TS.msg_edit.onCancelEdit(),TS.interop.api.call("chat.delete",{channel:t.id,ts:r.ts,broadcast_delete:!0}).then((function(){TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessage({channelId:t.id,ts:r.ts})),TS.web&&(t.is_channel?TS.channels.legacyRemoveMsg(t.id,r):t.is_im?TS.ims.legacyRemoveMsg(t.id,r):t.is_mpim?TS.mpims.legacyRemoveMsg(t.id,r):t.is_group&&TS.groups.legacyRemoveMsg(t.id,r))})).catch((function(e){TS.error("Failed to remove broadcast "+r.ts),TS.error(e),TS.msg_edit.current_msg===r&&TS.msg_edit.onCancelDelete()}))},onCancel:function(){TS.msg_edit.onCancelDelete()},onEnd:i})},pauseEditing:function(){if(TS.msg_edit.editing){var e=$("#msg_text"),t=TS.utility.contenteditable.value(e),n=TS.utility.contenteditable.cursorPosition(e),i={msg_ts:TS.msg_edit.current_msg.ts,model_ob:TS.msg_edit.current_model_ob,text:t,cursor_start:n.start,cursor_length:n.length};return TS.msg_edit.resetEditUI(),i}},resumeEditing:function(e){TS.msg_edit.editing||e&&TS.model.active_cid===e.model_ob.id&&TS.msg_edit.startEdit(e.msg_ts,e.model_ob,e)},focusAndSetCursorPosition:function(e,t){TS.utility.contenteditable.focus(e),TS.utility.rAF((function(){t&&_.isFinite(t.cursor_start)&&_.isFinite(t.cursor_length)?TS.utility.contenteditable.cursorPosition(e,t.cursor_start,t.cursor_length):TS.utility.contenteditable.cursorPosition(e,1e8,0)}))}});var e=function(e){return e.msgs},t=function(e){return TS.interop.datetime.toTimeDuration(e,{units:"minutes"})}}()},wTVA:function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},weHv:function(e,t){!function(){TS.registerModule("redux.presence",{onStart:function(){i()},getPresenceByMemberId:function(t){return e(t)},toggleUserPresence:function(){return TS.redux.dispatch(TS.interop.redux.features.presence.toggleUserPresence())},updatePresenceForMember:function(e){e&&e.id&&TS.redux.dispatch(TS.interop.redux.features.presence.updatePresence({memberId:e.id,presence:e.presence}))},addToBulkUpsertPayload:function(e){if(e){var n=e.id,i=e.presence;t[n]=i}},test:function(){return{}}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.features.presence.getPresenceByMemberId"),t={},n=function(){t.length&&(TS.redux.dispatch(TS.interop.redux.features.presence.bulkUpdatePresence(t)),t={})},i=function(){TS.members.presence_changed_sig.add(TS.redux.presence.updatePresenceForMember),TS.members.batch_upserted_sig.add(n)}}()},wkBT:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},zkfd:function(e,t,n){var i=n("lSNA");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(){TS.registerModule("teams",{added_sig:new signals.Signal,rename_sig:new signals.Signal,changed_icon_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,unknown_resolution_rebuild_sig:new signals.Signal,onStart:function(){TS.teams.changed_icon_sig.add(t),TS.teams.rename_sig.add(t)},getTeamById:function(e,t){return _.isString(e)?TS.redux.teams.getTeamById(e,t):null},getAllExternalTeams:function(){return TS.interop.teams.getAllExternalTeams(TS.redux.getState()).reduce((function(e,t){return a(a({},e),{},i({},t.id,t))}),{})},isPartOfMyOrg:function(e){if(!_.isObject(e))return!1;var t=c();return t&&t===e.enterprise_id},getAllEnterpriseTeams:function(){return _.pickBy(TS.redux.teams.getAllTeams(),TS.teams.isPartOfMyOrg)},getEnterpriseTeams:function(e){e=_.isObject(e)?e:{};var t=TS.teams.getAllEnterpriseTeams();return e.only_member_of&&(t=_.pickBy(t,(function(e){return TS.model.user.enterprise_user.teams.indexOf(e.id)>-1}))),e.exclude_current_team&&(t=_.omitBy(t,(function(e){return e.id===TS.model.team.id}))),t},getTeamByDomain:function(e){return _.isString(e)?TS.redux.teams.getTeamByDomain(e):null},getTeamByMsg:function(e){if(!_.isObject(e))return null;var t=e.source_team_id;if(!t)return null;var n=TS.teams.getTeamById(t);return n||null},getTeamNameByMember:function(e){if(!_.isObject(e)||!e.team_id)return null;var t=TS.teams.getTeamById(e.team_id);return TS.interop.rules.teams.getTeamDisplayName(t)},getTeamNameByMemberId:function(e){if(!_.isString(e))return null;var t=TS.interop.members.getMemberById(e);if(!t)return null;var n=TS.teams.getTeamById(t.team_id);return TS.interop.rules.teams.getTeamDisplayName(n)},getTeamNameById:function(e){var t=TS.teams.getTeamById(e);return TS.interop.rules.teams.getTeamDisplayName(t)},updateTeamName:function(e){if(e.name){var t=TS.teams.getTeamById(e.source_team,!1);t&&((t=_.clone(t)).name=e.name,TS.teams.rename_sig.dispatch(TS.redux.teams.upsertTeam(t)))}},updateTeamIcon:function(e){if(e.icon){var t=TS.teams.getTeamById(e.source_team,!1);t&&((t=_.clone(t)).icon=e.icon,TS.teams.changed_icon_sig.dispatch(TS.redux.teams.upsertTeam(t)))}},ensureTeamsArePresent:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.ensureTeamsArePresent";if(!_.isArray(t))return Promise.reject(Error("t_ids is not an array"));var i=_.filter(t,(function(e){var t=TS.teams.getTeamById(e,!1);return!t||t._other_account}));return i.length?e(i,n):Promise.resolve()},ensureTeamsInDataArePresent:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.ensureTeamsInDataArePresent",n=TS.interop.utility.extractAllTeamIds(e);return TS.teams.ensureTeamsArePresent(n,t)},ensureSharedTeamsForMember:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.ensureSharedTeamsForMember";return e?TS.teams.ensureTeamsArePresent(r(e),t):Promise.resolve()},getSharedTeamsForMember:function(e){return e?_.map(r(e),(function(e){return TS.teams.getTeamById(e)})):[]},promiseToSearchTeams:function(e){return c()?Promise.resolve(e).then((function(e){return e?(e=s(e))._is_new||e.num_remaining>0?l(e):Promise.resolve(e):Promise.reject(new Error("No search parameters provided"))})):Promise.resolve(e)},test:function(){var t={_getSharedTeamIdsForMember:r};return Object.defineProperty(t,"_readyTeamSearcher",{get:function(){return s},set:function(e){s=e}}),Object.defineProperty(t,"_promiseToSearchTeamsWorker",{get:function(){return d},set:function(e){d=e}}),Object.defineProperty(t,"_buildPromiseToSearchTeamsArguments",{get:function(){return o},set:function(e){o=e}}),Object.defineProperty(t,"_getTeamsByIdFromApi",{get:function(){return e},set:function(t){e=t}}),t}});var e=function(e,t){if(!_.isArray(e))return Promise.reject(Error("t_ids is not an array"));var n=_.chunk(e,250);return Promise.map(n,(function(e){return TS.interop.api.callExpedited("team.info",{teams:e,_x_reason:t}).then((function(t){var n=[];return t.data.teams.forEach((function(t){t&&t.id&&"E"===t.id.charAt(0)?TS.warn("EVALUE-1721: team.info response included an Enterprise org of "+t.id+". NOT adding to model. Client requested teams="+e.join(", ")+"."):n.push(TS.redux.teams.upsertTeam(t))})),n})).catch((function(t){TS.error("_getTeamsByIdFromApi failed with "+(t.data&&t.data.error||"unknown error")+", when requesting teams="+e.join(", "))}))})).then((function(e){return _.compact(_.flatten(e))}))},t=function(e){e.id!==TS.model.team.id&&n(e)},n=function(e){if(_.isObject(e)){var t=TS.utility.teams.getMembersForTeam(e);t.length&&_.forEach(t,(function(e){TS.members.changed_profile_sig.dispatch(e)}))}},r=function(e){return e?_.get(e,"enterprise_user")?_.intersection(_.get(e,"enterprise_user.teams",[]),_.get(TS.model.user,"enterprise_user.teams",[])):_.get(e,"team_id")===_.get(TS.model.user,"team_id")?[e.team_id]:[]:[]},s=function(e){return(e=e||{})._is_new=!1,e.hasOwnProperty("query")||(e.query=""),e.hasOwnProperty("additional_args")||(e.additional_args={}),e._last_query!==e.query&&(e.hasOwnProperty("_searcher_p")&&e._searcher_p.cancel(),e._last_query=e.query,e._is_new=!0,e._cursor_mark=null,e.items=[]),_.isEqual(e._last_additional_args,e.additional_args)||(e.hasOwnProperty("_searcher_p")&&e._searcher_p.cancel(),e._last_additional_args=_.assign({},e.additional_args),e._is_new=!0,e._cursor_mark=null,e.items=[]),e},o=function(e){var t=[TS.utility.search.makeClause("is","team")];e.query&&t.push(TS.utility.search.makeClause("fuzzy",e.query)),_.get(e,"included_ids.length")&&(1===e.included_ids.length?t.push(TS.utility.search.makeClause("id",_.head(e.included_ids))):t.push(TS.utility.search.makeConjunction("or",_.map(e.included_ids,(function(e){return TS.utility.search.makeClause("id",e)})))));var n={count:e.max_api_results||100,query:t.length>1?JSON.stringify(TS.utility.search.makeConjunction("and",t)):JSON.stringify(_.head(t))};return _.isEmpty(_.get(e,"additional_args"))||(n=_.merge(n,e.additional_args)),e._cursor_mark&&(n.cursor_mark=e._cursor_mark),n},l=function(e){var t=function(){return d(e)};return e._is_new?e._searcher_p=t():e._searcher_p=e._searcher_p.then(t),e._searcher_p},d=function(e){var t=_.get(e,"endpoint","search.enterprise"),n=_.get(e,"response_key","items");return TS.interop.api.call(t,o(e)).then((function(t){if(e._cursor_mark||(e.num_remaining=t.data.num_found,e.num_found=t.data.num_found),!t.data[n].length)return Promise.resolve(e);e.num_remaining-=t.data[n].length,e._cursor_mark=t.data.next_cursor_mark;var i=_.keyBy(e.omitted_ids,_.identity),r=_(t.data[n]).filter((function(e){return!i[e.id]})).map((function(e){return TS.redux.teams.upsertTeam(e)})).value();return e.num_found-=t.data[n].length-r.length,e.items=_.concat(e.items,r),Promise.resolve(e)}))},c=function(){return _.get(TS.model,"team.enterprise_id",TS.boot_data.enterprise_id)}}()},zmUN:function(e,t){!function(){TS.registerModule("ui.enterprise_teams_dialog",{show:function(e){i(e)},test:function(){var e={};return Object.defineProperty(e,"_showTeamsDialog",{get:function(){return i},set:function(e){i=e}}),Object.defineProperty(e,"_getTeamsDialogChannelTitle",{get:function(){return r},set:function(e){r=e}}),Object.defineProperty(e,"_getTeamsDialogMemberTitle",{get:function(){return a},set:function(e){a=e}}),e}});var e="enterprise_team_dialog",t=null;var n=function(e){e.which==TS.utility.keymap.esc&&""===TS.generic_dialog.div.find("input").val()&&TS.generic_dialog.cancel()},i=function(i){var s=_.get(i,"id");if(t!==s){t=s;var o,l=TS.templates.enterprise_teams_dialog(),d=TS.interop.utility.looksLikeMemberId(_.get(i,"id"));d&&!_.get(i,"enterprise_user.teams.length")||(d||i.is_global_shared||TS.interop.rules.channels.getInternalTeamIds(TS.redux.getState(),i))&&(o=d?a(i):r(i),TS.generic_dialog.start({dialog_class:"p-enterprise_teams_dialog",title:o,body:l,cancel_button_text:TS.interop.i18n.t("Close","teams")(),hide_footer:!0,show_cancel_button:!0,show_go_button:!1,backdrop_click_to_dismiss:!0,onShow:function(){!function(t){$(window.document).bind("keydown",n);var i=$(".p-searchable_enterprise_team_list");new TS.SearchableEnterpriseTeamList({$container:i,id:e,model_ob_id:t.id,triggered_by_user_action:!0}).showInitial(),i.on("click",".p-enterprise_team_row",TS.generic_dialog.cancel)}(i)},onEnd:function(){var i=TS.SearchableEnterpriseTeamList.get(e);i&&i.destroy(),TS.generic_dialog.div.remove(),TS.generic_dialog.div=void 0,$(window.document).unbind("keydown",n),t=null}}))}},r=function(e){return e.is_global_shared?TS.interop.i18n.t("All workspaces in {channel_name}","teams")({channel_name:TS.interop.rules.channels.getDisplayNameForChannel(e)}):TS.interop.i18n.t("{team_count, number} workspaces in {channel_name}","teams")({team_count:TS.interop.rules.channels.getInternalTeamIds(TS.redux.getState(),e).length,channel_name:TS.interop.rules.channels.getDisplayNameForChannel(e)})},a=function(e){return TS.interop.i18n.t("Your {enterprise_name} workspaces","teams")({enterprise_name:_.escape(_.get(e,"enterprise_user.enterprise_name"))})}}()}},[["qYTV","webpack.manifest"]]]);